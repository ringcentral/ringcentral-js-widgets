{"version":3,"sources":["containers/RecentActivityContainer/index.js"],"names":["getTabs","ready","currentLocale","dateTimeFormatter","navigateTo","recentMessages","recentCalls","currentContact","sessionId","messages","calls","unreadMessageCounts","id","contactId","activityCardId","icon","label","getString","path","isActive","view","getData","cleanUp","composeText","noticeCounts","isMessagesLoaded","fromLocal","getMessages","cleanUpMessages","contact","active","isCallsLoaded","getCalls","cleanUpCalls","mapToProps","_","locale","dateTimeFormat","formatDateTime","contactMatcher","getSession","session","contactMatch","contactMapping","dataMapping","phoneNumber","direction","outbound","to","from","length","title","showSpinner","tabs","defaultTab"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport callDirections from 'ringcentral-integration/enums/callDirections';\nimport RecentActivityPanel from '../../components/RecentActivityPanel';\nimport dynamicsFont from '../../assets/DynamicsFont/DynamicsFont.scss';\nimport RecentActivityMessages from '../../components/RecentActivityMessages';\nimport RecentActivityCalls from '../../components/RecentActivityCalls';\nimport VoicemailIcon from '../../assets/images/VoicemailIcon.svg';\nimport FaxIcon from '../../assets/images/Fax.svg';\nimport i18n from './i18n';\n\nfunction getTabs({\n  ready,\n  currentLocale,\n  dateTimeFormatter,\n  navigateTo,\n  recentMessages,\n  recentCalls,\n  currentContact,\n  sessionId,\n}) {\n  if (!ready) return [];\n  let messages = [];\n  let calls = [];\n  let unreadMessageCounts = 0;\n  if (currentContact && currentContact.id) {\n    const contactId = currentContact.id;\n    const activityCardId = sessionId ? `${contactId}-${sessionId}` : contactId;\n    if (recentMessages.messages[activityCardId]) {\n      messages = recentMessages.messages[activityCardId];\n    }\n    if (recentCalls.calls[activityCardId]) {\n      calls = recentCalls.calls[activityCardId];\n    }\n    if (recentMessages.unreadMessageCounts[activityCardId]) {\n      unreadMessageCounts = recentMessages.unreadMessageCounts[activityCardId];\n    }\n  }\n  return [\n    {\n      icon: <VoicemailIcon width={21} height={21} />,\n      label: i18n.getString('voicemail', currentLocale),\n      path: 'voicemails',\n      isActive: path => path === 'voicemails',\n      view: null,\n      getData: () => {},\n      cleanUp: () => {}\n    },\n    {\n      icon: <span className={dynamicsFont.composeText} />,\n      label: i18n.getString('text', currentLocale),\n      path: 'recentMessages',\n      noticeCounts: unreadMessageCounts,\n      isActive: path => path === 'recentMessages',\n      view: (\n        <RecentActivityMessages\n          messages={messages}\n          navigateTo={navigateTo}\n          dateTimeFormatter={dateTimeFormatter}\n          currentLocale={currentLocale}\n          isMessagesLoaded={recentMessages.isMessagesLoaded}\n        />\n      ),\n      getData: (fromLocal) => {\n        recentMessages.getMessages({ currentContact, fromLocal, sessionId });\n      },\n      cleanUp: () => recentMessages.cleanUpMessages({ contact: currentContact, sessionId })\n    },\n    {\n      icon: <FaxIcon width={21} height={21} />,\n      label: i18n.getString('fax', currentLocale),\n      path: 'faxes',\n      isActive: path => path === 'faxes',\n      view: null,\n      getData: () => {},\n      cleanUp: () => {}\n    },\n    {\n      icon: <span className={dynamicsFont.active} />,\n      label: i18n.getString('call', currentLocale),\n      path: 'recentCalls',\n      isActive: path => path === 'recentCalls',\n      view: (\n        <RecentActivityCalls\n          calls={calls}\n          dateTimeFormatter={dateTimeFormatter}\n          currentLocale={currentLocale}\n          isCallsLoaded={recentCalls.isCallsLoaded}\n        />\n      ),\n      getData: () => {\n        recentCalls.getCalls({ currentContact, sessionId });\n      },\n      cleanUp: () => recentCalls.cleanUpCalls({ contact: currentContact, sessionId })\n    },\n  ];\n}\n\nfunction mapToProps(_, {\n  locale,\n  currentLocale = locale.currentLocale,\n  dateTimeFormat,\n  navigateTo,\n  dateTimeFormatter = (...args) => dateTimeFormat.formatDateTime(...args),\n  recentMessages,\n  recentCalls,\n  contactMatcher,\n  getSession\n}) {\n  const session = getSession();\n  const sessionId = session.id;\n  let currentContact = session.contactMatch;\n  const contactMapping = contactMatcher && contactMatcher.dataMapping;\n  const phoneNumber = session.direction === callDirections.outbound ?\n    session.to : session.from;\n  if (!currentContact) {\n    currentContact = contactMapping && contactMapping[phoneNumber];\n    if (currentContact && currentContact.length >= 1) {\n      currentContact = currentContact[0];\n    }\n  }\n  const ready =\n    dateTimeFormat.ready &&\n    locale.ready &&\n    contactMatcher.ready &&\n    recentMessages.ready &&\n    recentCalls.ready;\n  return {\n    currentLocale,\n    title: i18n.getString('recentActivities', locale.currentLocale),\n    showSpinner: !ready,\n    currentContact,\n    calls: recentCalls.calls || [],\n    tabs: getTabs({\n      ready,\n      currentLocale,\n      dateTimeFormatter,\n      navigateTo,\n      currentContact,\n      recentMessages,\n      recentCalls,\n      sessionId,\n    }),\n    defaultTab: 'recentCalls',\n  };\n}\n\nexport default connect(mapToProps)(RecentActivityPanel);\n"]}