{"version":3,"sources":["gulpfile.js"],"names":["BUILD_PATH","path","resolve","__dirname","RELEASE_PATH","getVersionFromTag","tag","process","env","TRAVIS_TAG","test","execa","shell","stdout","replace","console","error","clean","fs","remove","copy","gulp","src","pipe","dest","preBuild","localeSettings","sourcemaps","init","write","build","series","releaseClean","exists","readdir","files","filter","file","releaseCopy","preRelease","JSON","readFile","packageInfo","parse","scripts","jest","version","log","name","writeFile","stringify","release","parallel","normalizeName","str","split","map","token","idx","toUpperCase","toLowerCase","substr","join","exports","cssLocation","content","output","regExp","match","exec","target","normalizedName","newContent","dedent","exportType","sourceFolder"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,UAAU,GAAGC,iBAAKC,OAAL,CAAaC,SAAb,EAAwB,iCAAxB,CAAnB;;AACA,IAAMC,YAAY,GAAGH,iBAAKC,OAAL,CACnBC,SADmB,EAEnB,mCAFmB,CAArB;;SAKeE,iB;;;;;+EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AACMC,YAAAA,GADN,GACYC,OAAO,CAACC,GAAR,CAAYC,UADxB;;AAAA,kBAEMH,GAAG,IAAI,eAAeI,IAAf,CAAoBJ,GAApB,CAFb;AAAA;AAAA;AAAA;;AAAA,8CAGWA,GAHX;;AAAA;AAAA;AAAA;AAAA,mBAMgBK,kBAAMC,KAAN,CACV,yDADU,CANhB;;AAAA;AAMIN,YAAAA,GANJ;AASIA,YAAAA,GAAG,GAAGA,GAAG,CAACO,MAAJ,CAAWC,OAAX,CAAmB,WAAnB,EAAgC,EAAhC,CAAN;;AATJ,iBAUQ,eAAeJ,IAAf,CAAoBJ,GAApB,CAVR;AAAA;AAAA;AAAA;;AAAA,8CAWaA,GAXb;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAcIS,YAAAA,OAAO,CAACC,KAAR;;AAdJ;AAAA,8CAgBS,IAhBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAkBA,SAASC,KAAT,GAAiB;AACf,SAAOC,oBAAGC,MAAH,CAAUnB,UAAV,CAAP;AACD;;AACD,SAASoB,IAAT,GAAgB;AACd,SAAOC,iBACJC,GADI,CACA,CACH,MADG,EAEH,YAFG,EAGH,eAHG,EAIH,mBAJG,EAKH,uBALG,EAMH,oBANG,CADA,EASJC,IATI,CASCF,iBAAKG,IAAL,CAAUxB,UAAV,CATD,CAAP;AAUD;;AACD,SAASyB,QAAT,GAAoB;AAClB,SAAOJ,iBACJC,GADI,CACA,CACH,WADG,EAEH,WAFG,EAGH,YAHG,EAIH,iBAJG,EAKH,eALG,EAMH,mBANG,EAOH,uBAPG,EAQH,oBARG,CADA,EAWJC,IAXI,CAYH,mDACKG,0BADL,EAZG,EAgBJH,IAhBI,CAgBCI,2BAAWC,IAAX,EAhBD,EAiBJL,IAjBI,CAiBC,4BAjBD,EAkBJA,IAlBI,CAkBCI,2BAAWE,KAAX,CAAiB,GAAjB,CAlBD,EAmBJN,IAnBI,CAmBCF,iBAAKG,IAAL,CAAUxB,UAAV,CAnBD,CAAP;AAoBD;;AACD,IAAM8B,KAAK,GAAGT,iBAAKU,MAAL,CAAYd,KAAZ,EAAmBG,IAAnB,EAAyBK,QAAzB,CAAd;;;;SACeO,Y;;;;;0EAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACcd,oBAAGe,MAAH,CAAU7B,YAAV,CADd;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAEUO,kBAAMC,KAAN,oBAAwBR,YAAxB,EAFV;;AAAA;AAAA;AAAA,mBAIuBc,oBAAGgB,OAAH,CAAW9B,YAAX,CAJvB;;AAAA;AAIQ+B,YAAAA,KAJR,kBAIiDC,MAJjD,CAKI,UAACC,IAAD;AAAA,qBAAU,CAAC,MAAM3B,IAAN,CAAW2B,IAAX,CAAX;AAAA,aALJ;AAAA,mDAOqBF,KAPrB;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOaE,YAAAA,IAPb;AAAA;AAAA,mBAQUnB,oBAAGC,MAAH,CAAUlB,iBAAKC,OAAL,CAAaE,YAAb,EAA2BiC,IAA3B,CAAV,CARV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAWA,SAASC,WAAT,GAAuB;AACrB,SAAOjB,iBACJC,GADI,CACA,WAAItB,UAAJ,oBAAwBG,SAAxB,2BAAkDA,SAAlD,cADA,EAEJoB,IAFI,CAECF,iBAAKG,IAAL,CAAUpB,YAAV,CAFD,CAAP;AAGD;;SACcmC,U;;;;;wEAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BACsBC,IADtB;AAAA;AAAA,mBAEUtB,oBAAGuB,QAAH,CAAYxC,iBAAKC,OAAL,CAAaF,UAAb,EAAyB,cAAzB,CAAZ,CAFV;;AAAA;AAAA;AACQ0C,YAAAA,WADR,gBAC2BC,KAD3B;AAIE,mBAAOD,WAAW,CAACE,OAAnB;AACA,mBAAOF,WAAW,CAACG,IAAnB;AALF;AAAA,mBAMwBxC,iBAAiB,EANzC;;AAAA;AAMQyC,YAAAA,OANR;AAOE/B,YAAAA,OAAO,CAACgC,GAAR,CAAY,UAAZ,EAAwBD,OAAxB;;AACA,gBAAIA,OAAJ,EAAa;AACXJ,cAAAA,WAAW,CAACI,OAAZ,GAAsBA,OAAtB;AACAJ,cAAAA,WAAW,CAACM,IAAZ,GAAmB,qBAAnB;AACD;;AAXH;AAAA,mBAYQ9B,oBAAG+B,SAAH,CACJhD,iBAAKC,OAAL,CAAaE,YAAb,EAA2B,cAA3B,CADI,EAEJoC,IAAI,CAACU,SAAL,CAAeR,WAAf,EAA4B,IAA5B,EAAkC,CAAlC,CAFI,CAZR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAiBA,IAAMS,OAAO,GAAG9B,iBAAKU,MAAL,CACdV,iBAAK+B,QAAL,CAActB,KAAd,EAAqBE,YAArB,CADc,EAEdM,WAFc,EAGdC,UAHc,CAAhB;;;;AAKA,SAASc,aAAT,CAAuBC,GAAvB,EAA4B;AAC1B,SAAOA,GAAG,CACPC,KADI,CACE,OADF,EAEJC,GAFI,CAGH,UAACC,KAAD,EAAQC,GAAR;AAAA,qBAEIA,GAAG,GAAG,CAAN,GAAUD,KAAK,CAAC,CAAD,CAAL,CAASE,WAAT,EAAV,GAAmCF,KAAK,CAAC,CAAD,CAAL,CAASG,WAAT,EAFvC,SAGKH,KAAK,CAACG,WAAN,GAAoBC,MAApB,CAA2B,CAA3B,CAHL;AAAA,GAHG,EAQJC,IARI,CAQC,EARD,CAAP;AASD;;AAGDC,OAAO,CAAC,eAAD,CAAP,wEAA2B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEjBC,UAAAA,WAFiB,GAEH/D,iBAAKC,OAAL,CAClBC,SADkB,EAElB,+BAFkB,CAFG;AAAA;AAAA,iBAMDe,oBAAGuB,QAAH,CAAYuB,WAAZ,EAAyB,MAAzB,CANC;;AAAA;AAMjBC,UAAAA,OANiB;AAOnBC,UAAAA,MAPmB,GAOVD,OAAO,CACjBnD,OADU,CACF,6BADE,EAC6B,4BAD7B,EAEVA,OAFU,CAEF,qCAFE,EAEqC,OAFrC,CAPU;AAUjBqD,UAAAA,MAViB,GAUR,oBAVQ;;AAYvB,aAAG;AACDC,YAAAA,KAAK,GAAGD,MAAM,CAACE,IAAP,CAAYH,MAAZ,CAAR;;AACA,gBAAIE,KAAJ,EAAW;AAAA,uBACcA,KADd,uCACFE,MADE,eACMtB,IADN;AAEHuB,cAAAA,cAFG,GAEclB,aAAa,CAACL,IAAD,CAF3B;AAGHwB,cAAAA,UAHG,OAGUC,kBAHV,qBAIRF,cAJQ,EAORA,cAPQ;AAQTL,cAAAA,MAAM,GAAGA,MAAM,CAACpD,OAAP,CAAewD,MAAf,EAAuBE,UAAvB,CAAT;AACD;AACF,WAZD,QAYSJ,KAZT;;AAZuB;AAAA,iBAyBjBlD,oBAAG+B,SAAH,CACJhD,iBAAKC,OAAL,CAAaC,SAAb,EAAwB,uCAAxB,CADI,EAEJ+D,MAFI,EAGJ,MAHI,CAzBiB;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AA+BvBnD,UAAAA,OAAO,CAACgC,GAAR;;AA/BuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAA3B;AAkCAgB,OAAO,CAAC,eAAD,CAAP,wEAA2B;AAAA;AAAA;AAAA;AAAA;AAAA,4CACzB,gDACKrC,0BADL,EADyB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAA3B;AAIAqC,OAAO,CAAC,oBAAD,CAAP,wEAAgC;AAAA;AAAA;AAAA;AAAA;AAAA,4CAC9B,8DACKrC,0BADL;AAEEgD,YAAAA,UAAU,EAAE;AAFd,aAD8B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAhC;AAKAX,OAAO,CAAC,0BAAD,CAAP,wEAAsC;AAAA;AAAA;AAAA;AAAA;AAAA,4CACpC,8DACKrC,0BADL;AAEEgD,YAAAA,UAAU,EAAE;AAFd,aADoC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAtC;AAKAX,OAAO,CAAC,eAAD,CAAP,wEAA2B;AAAA;AAAA;AAAA;AAAA;AAAA,4CACzB,gDACKrC,0BADL,EADyB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAA3B;AAIAqC,OAAO,CAAC,oBAAD,CAAP,wEAAgC;AAAA;AAAA;AAAA;AAAA;AAAA,4CAC9B,mEACKrC,0BADL;AAEEiD,YAAAA,YAAY,EAAE1E,iBAAKC,OAAL,CAAaC,SAAb,EAAwB,kBAAxB;AAFhB,aAD8B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAhC","sourcesContent":["import gulp from 'gulp';\nimport path from 'path';\nimport fs from 'fs-extra';\nimport babel from 'gulp-babel';\nimport sourcemaps from 'gulp-sourcemaps';\nimport execa from 'execa';\nimport transformLoader from '@ringcentral-integration/locale-loader/lib/transformLoader';\nimport dedent from 'dedent';\nimport exportLocale from '@ringcentral-integration/locale-loader/lib/exportLocale';\nimport importLocale from '@ringcentral-integration/locale-loader/lib/importLocale';\nimport consolidateLocale from '@ringcentral-integration/locale-loader/lib/consolidateLocale';\nimport localeSettings from '@ringcentral-integration/locale-settings';\n\nconst BUILD_PATH = path.resolve(__dirname, '../../build/ringcentral-widgets');\nconst RELEASE_PATH = path.resolve(\n  __dirname,\n  '../../release/ringcentral-widgets',\n);\n\nasync function getVersionFromTag() {\n  let tag = process.env.TRAVIS_TAG;\n  if (tag && /^\\d+.\\d+.\\d+/.test(tag)) {\n    return tag;\n  }\n  try {\n    tag = await execa.shell(\n      'git describe --exact-match --tags $(git rev-parse HEAD)',\n    );\n    tag = tag.stdout.replace(/\\r?\\n|\\r/g, '');\n    if (/^\\d+.\\d+.\\d+/.test(tag)) {\n      return tag;\n    }\n  } catch (e) {\n    console.error(e);\n  }\n  return null;\n}\nfunction clean() {\n  return fs.remove(BUILD_PATH);\n}\nfunction copy() {\n  return gulp\n    .src([\n      './**',\n      '!./**/*.js',\n      '!./test{/**,}',\n      '!./coverage{/**,}',\n      '!./node_modules{/**,}',\n      '!package-lock.json',\n    ])\n    .pipe(gulp.dest(BUILD_PATH));\n}\nfunction preBuild() {\n  return gulp\n    .src([\n      './**/*.js',\n      './**/*.ts',\n      './**/*.tsx',\n      '!./**/*.test.js',\n      '!./test{/**,}',\n      '!./coverage{/**,}',\n      '!./node_modules{/**,}',\n      '!gulpfile.babel.js',\n    ])\n    .pipe(\n      transformLoader({\n        ...localeSettings,\n      }),\n    )\n    .pipe(sourcemaps.init())\n    .pipe(babel())\n    .pipe(sourcemaps.write('.'))\n    .pipe(gulp.dest(BUILD_PATH));\n}\nconst build = gulp.series(clean, copy, preBuild);\nasync function releaseClean() {\n  if (!(await fs.exists(RELEASE_PATH))) {\n    await execa.shell(`mkdir -p ${RELEASE_PATH}`);\n  }\n  const files = (await fs.readdir(RELEASE_PATH)).filter(\n    (file) => !/^\\./.test(file),\n  );\n  for (const file of files) {\n    await fs.remove(path.resolve(RELEASE_PATH, file));\n  }\n}\nfunction releaseCopy() {\n  return gulp\n    .src([`${BUILD_PATH}/**`, `${__dirname}/README.md`, `${__dirname}/LICENSE`])\n    .pipe(gulp.dest(RELEASE_PATH));\n}\nasync function preRelease() {\n  const packageInfo = JSON.parse(\n    await fs.readFile(path.resolve(BUILD_PATH, 'package.json')),\n  );\n  delete packageInfo.scripts;\n  delete packageInfo.jest;\n  const version = await getVersionFromTag();\n  console.log('version:', version);\n  if (version) {\n    packageInfo.version = version;\n    packageInfo.name = 'ringcentral-widgets';\n  }\n  await fs.writeFile(\n    path.resolve(RELEASE_PATH, 'package.json'),\n    JSON.stringify(packageInfo, null, 2),\n  );\n}\nconst release = gulp.series(\n  gulp.parallel(build, releaseClean),\n  releaseCopy,\n  preRelease,\n);\nfunction normalizeName(str) {\n  return str\n    .split(/[-_]/g)\n    .map(\n      (token, idx) =>\n        `${\n          idx > 0 ? token[0].toUpperCase() : token[0].toLowerCase()\n        }${token.toLowerCase().substr(1)}`,\n    )\n    .join('');\n}\nexport { build, release };\n\nexports['generate-font'] = async () => {\n  try {\n    const cssLocation = path.resolve(\n      __dirname,\n      'assets/DynamicsFont/style.css',\n    );\n    const content = await fs.readFile(cssLocation, 'utf8');\n    let output = content\n      .replace(/url\\('fonts\\/dynamics_icon/g, \"url('./fonts/dynamics_icon\")\n      .replace('[class^=\"icon-\"], [class*=\" icon-\"]', '.icon');\n    const regExp = /\\.icon-(.*):before/;\n    let match;\n    do {\n      match = regExp.exec(output);\n      if (match) {\n        const [target, name] = match;\n        const normalizedName = normalizeName(name);\n        const newContent = dedent`\n      .${normalizedName} {\n        composes: icon;\n      }\n      .${normalizedName}:before `;\n        output = output.replace(target, newContent);\n      }\n    } while (match);\n    await fs.writeFile(\n      path.resolve(__dirname, 'assets/DynamicsFont/DynamicsFont.scss'),\n      output,\n      'utf8',\n    );\n  } catch (error) {\n    console.log(error);\n  }\n};\nexports['export-locale'] = async () =>\n  exportLocale({\n    ...localeSettings,\n  });\nexports['export-locale-full'] = async () =>\n  exportLocale({\n    ...localeSettings,\n    exportType: 'full',\n  });\nexports['export-locale-translated'] = async () =>\n  exportLocale({\n    ...localeSettings,\n    exportType: 'translated',\n  });\nexports['import-locale'] = async () =>\n  importLocale({\n    ...localeSettings,\n  });\nexports['consolidate-locale'] = async () =>\n  consolidateLocale({\n    ...localeSettings,\n    sourceFolder: path.resolve(__dirname, 'lib/countryNames'),\n  });\n"],"file":"gulpfile.js"}