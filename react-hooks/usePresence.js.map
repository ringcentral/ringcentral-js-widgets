{"version":3,"file":"usePresence.js","names":["_juno","require","_react","_usePromise","_interopRequireDefault","obj","__esModule","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","push","isArray","usePresence","contact","_ref","_contact$presence","fetch","_ref$timeout","timeout","_useState","useState","presence","_useState2","setPresence","mounted","usePromise","_useSleep","useSleep","sleep","useEffect","fetchPresence","_fetchPresence","regeneratorRuntime","mark","_callee","result","wrap","_callee$","_context","prev","sent","stop","exports"],"sources":["react-hooks/usePresence.ts"],"sourcesContent":["import type {\n  ContactPresence,\n  IContact,\n} from '@ringcentral-integration/commons/interfaces/Contact.model';\nimport { useSleep } from '@ringcentral/juno';\n\nimport { useEffect, useState } from 'react';\nimport usePromise from './usePromise';\n\nexport type GetPresenceFn = (\n  contact: IContact,\n  useCache: boolean,\n) => Promise<ContactPresence | null>;\n\n/**\n * get presence state from contact, and that will auto get data from that fetch callback\n * @param contact\n * @param fetch fetch presence\n * @param timeout -1 means not to use timeout\n * @returns\n */\nexport const usePresence = (\n  contact: IContact & { presence?: ContactPresence },\n  {\n    fetch,\n    timeout = -1,\n  }: {\n    fetch: GetPresenceFn | undefined;\n    timeout?: number;\n  },\n) => {\n  const [presence, setPresence] = useState(contact?.presence ?? null);\n  const mounted = usePromise();\n  const { sleep } = useSleep();\n  useEffect(() => {\n    async function fetchPresence() {\n      if (fetch && contact) {\n        const result = await mounted(fetch!(contact, true));\n        setPresence(result);\n      }\n    }\n    if (timeout >= 0) {\n      sleep(timeout).then(() => {\n        fetchPresence();\n      });\n    } else {\n      fetchPresence();\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [contact, fetch]);\n  return presence;\n};\n"],"mappings":"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"}