{"version":3,"file":"usePresence.js","names":["_juno","require","_react","_usePromise","_interopRequireDefault","e","__esModule","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","_arrayLikeToArray","toString","call","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","f","next","Object","push","isArray","usePresence","contact","_ref","_contact$presence","fetch","_ref$timeout","timeout","_useState","useState","presence","_useState2","setPresence","mounted","usePromise","_useSleep","useSleep","sleep","useEffect","fetchPresence","_fetchPresence","regeneratorRuntime","mark","_callee","result","wrap","_callee$","_context","prev","sent","stop","exports"],"sources":["react-hooks/usePresence.ts"],"sourcesContent":["import type {\n  ContactPresence,\n  IContact,\n} from '@ringcentral-integration/commons/interfaces/Contact.model';\nimport { useSleep } from '@ringcentral/juno';\nimport { useEffect, useState } from 'react';\n\nimport usePromise from './usePromise';\n\nexport type GetPresenceFn = (\n  contact: IContact,\n  useCache: boolean,\n) => Promise<ContactPresence | null>;\n\n/**\n * get presence state from contact, and that will auto get data from that fetch callback\n * @param contact\n * @param fetch fetch presence\n * @param timeout -1 means not to use timeout\n * @returns\n */\nexport const usePresence = (\n  contact: IContact & { presence?: ContactPresence },\n  {\n    fetch,\n    timeout = -1,\n  }: {\n    fetch: GetPresenceFn | undefined;\n    timeout?: number;\n  },\n) => {\n  const [presence, setPresence] = useState(contact?.presence ?? null);\n  const mounted = usePromise();\n  const { sleep } = useSleep();\n  useEffect(() => {\n    async function fetchPresence() {\n      if (fetch && contact) {\n        const result = await mounted(fetch!(contact, true));\n        setPresence(result);\n      } else {\n        setPresence(null);\n      }\n    }\n    if (timeout >= 0) {\n      sleep(timeout).then(() => {\n        fetchPresence();\n      });\n    } else {\n      fetchPresence();\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [contact, fetch]);\n  return presence;\n};\n"],"mappings":"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","ignoreList":[]}