{"version":3,"sources":["components/PlaceholderImage/index.tsx"],"names":["cache","defaultContainer","x","PlaceholderImage","props","onLoad","src","img","setState","isLoaded","onError","loadImg","Image","onload","onerror","unloadImg","e","console","error","state","isLoading","nextProps","imgSrc","container","placeholder","placeholderContainer","rest","imgProps","Component","defaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,KAAK,GAAG,EAAd;;AACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,CAAD;AAAA,SAAOA,CAAP;AAAA,CAAzB;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;IACMC,gB;;;;;AAUJ,4BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,UAOnBC,MAPmB,GAOV,YAAM;AAAA,UACLC,GADK,GACG,MAAKF,KADR,CACLE,GADK;AAEbN,MAAAA,KAAK,CAACM,GAAD,CAAL,GAAa,IAAb;;AACA,UAAI,MAAKC,GAAT,EAAc;AACZ,cAAKC,QAAL,CAAc;AAAEC,UAAAA,QAAQ,EAAE;AAAZ,SAAd;AACD;AACF,KAbkB;;AAAA,UAcnBC,OAdmB,GAcT,YAAM;AAAA,UACNJ,GADM,GACE,MAAKF,KADP,CACNE,GADM;AAEdN,MAAAA,KAAK,CAACM,GAAD,CAAL,GAAa,KAAb;;AACA,UAAI,CAAC,MAAKC,GAAV,EAAe;AACb,eAAO,KAAP;AACD;;AACD,YAAKC,QAAL,CAAc;AAAEC,QAAAA,QAAQ,EAAE;AAAZ,OAAd;AACD,KArBkB;;AAAA,UAsBnBE,OAtBmB,GAsBT,YAAM;AAAA,UACNL,GADM,GACE,MAAKF,KADP,CACNE,GADM;AAEd,YAAKC,GAAL,GAAW,IAAIK,KAAJ,EAAX;AACA,YAAKL,GAAL,CAASD,GAAT,GAAeA,GAAf,CAHc,CAId;;AACA,YAAKC,GAAL,CAASM,MAAT,GAAkB,MAAKR,MAAvB;AACA,YAAKE,GAAL,CAASO,OAAT,GAAmB,MAAKJ,OAAxB;AACD,KA7BkB;;AAAA,UA8BnBK,SA9BmB,GA8BP,YAAM;AAChB,aAAO,MAAKR,GAAL,CAASO,OAAhB;AACA,aAAO,MAAKP,GAAL,CAASM,MAAhB;;AACA,UAAI;AACF,eAAO,MAAKN,GAAL,CAASD,GAAhB;AACD,OAFD,CAEE,OAAOU,CAAP,EAAU;AACVC,QAAAA,OAAO,CAACC,KAAR,CAAc,kCAAd;AACD;;AACD,aAAO,MAAKX,GAAZ;AACD,KAvCkB;;AAEjB,UAAKY,KAAL,GAAa;AACXC,MAAAA,SAAS,EAAE,IADA;AAEXX,MAAAA,QAAQ,EAAE;AAFC,KAAb;AAFiB;AAMlB;;;;wCAkCmB;AAAA,UACVW,SADU,GACI,KAAKD,KADT,CACVC,SADU;;AAElB,UAAIA,SAAJ,EAAe;AACb,aAAKT,OAAL;AACD;AACF;;;2CACsB;AACrB,UAAI,KAAKJ,GAAT,EAAc;AACZ,aAAKQ,SAAL;AACD;AACF;;;8CACyBM,S,EAAW;AAAA,UACtBC,MADsB,GACXD,SADW,CAC3Bf,GAD2B;AAAA,UAE3BA,GAF2B,GAEnB,KAAKF,KAFc,CAE3BE,GAF2B;;AAGnC,UAAIA,GAAG,KAAKgB,MAAZ,EAAoB;AAClB;AACA,YAAI,CAACA,MAAL,EAAa;AACX,iBAAO,KAAKd,QAAL,CAAc;AAAEY,YAAAA,SAAS,EAAE,KAAb;AAAoBX,YAAAA,QAAQ,EAAE;AAA9B,WAAd,CAAP;AACD;;AACD,aAAKD,QAAL,CACE;AACEC,UAAAA,QAAQ,EAAE,KADZ;AAEEW,UAAAA,SAAS,EAAE;AAFb,SADF,EAKE,KAAKT,OALP;AAOD;AACF;;;6BACQ;AAAA,wBAEL,KAAKP,KAFA;AAAA,UACCmB,SADD,eACCA,SADD;AAAA,UACYjB,GADZ,eACYA,GADZ;AAAA,UACiBkB,WADjB,eACiBA,WADjB;AAAA,UAC8BC,oBAD9B,eAC8BA,oBAD9B;AAAA,UACuDC,IADvD;;AAAA,wBAGyB,KAAKP,KAH9B;AAAA,UAGCC,SAHD,eAGCA,SAHD;AAAA,UAGYX,QAHZ,eAGYA,QAHZ;;AAIP,UAAIA,QAAJ,EAAc;AACZ,YAAMkB,QAAQ,mCACT;AAAErB,UAAAA,GAAG,EAAHA;AAAF,SADS,GAEToB,IAFS,CAAd;AAIA;;;AACA,eAAOH,SAAS,eAAC,uCAASI,QAAT,CAAD,CAAhB;AACD;;AACD,UAAI,CAAClB,QAAD,IAAaW,SAAjB,EAA4B;AAC1B,eAAOI,WAAW,GAAGC,oBAAoB,CAACD,WAAD,CAAvB,GAAuC,IAAzD;AACD;;AACD,aAAO,IAAP;AACD;;;;EA9F4BI,gB;;AAAzBzB,gB,CAIG0B,Y,GAAe;AACpBvB,EAAAA,GAAG,EAAE,EADe;AAEpBkB,EAAAA,WAAW,EAAE,KAFO;AAGpBD,EAAAA,SAAS,EAAEtB,gBAHS;AAIpBwB,EAAAA,oBAAoB,EAAExB;AAJF,C;eA4FTE,gB","sourcesContent":["import React, { Component } from 'react';\n\nconst cache = {};\nconst defaultContainer = (x) => x;\ntype PlaceholderImageProps = {\n  src?: string;\n  placeholder?: React.ReactNode;\n  placeholderContainer?: (...args: any[]) => any;\n  container?: (...args: any[]) => any;\n};\ntype PlaceholderImageState = {\n  isLoaded: boolean;\n  isLoading: boolean;\n};\n/**\n * Reference: https://github.com/mbrevda/react-image\n * This component contains too many features we do not need for now\n *\n * @class PlaceholderImage\n * @extends {Component}\n */\nclass PlaceholderImage extends Component<\n  PlaceholderImageProps,\n  PlaceholderImageState\n> {\n  static defaultProps = {\n    src: '',\n    placeholder: false,\n    container: defaultContainer,\n    placeholderContainer: defaultContainer,\n  };\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      isLoaded: false,\n    };\n  }\n  onLoad = () => {\n    const { src } = this.props;\n    cache[src] = true;\n    if (this.img) {\n      this.setState({ isLoaded: true });\n    }\n  };\n  onError = () => {\n    const { src } = this.props;\n    cache[src] = false;\n    if (!this.img) {\n      return false;\n    }\n    this.setState({ isLoaded: false });\n  };\n  loadImg = () => {\n    const { src } = this.props;\n    this.img = new Image();\n    this.img.src = src;\n    // TODO: Consider using decode first here\n    this.img.onload = this.onLoad;\n    this.img.onerror = this.onError;\n  };\n  unloadImg = () => {\n    delete this.img.onerror;\n    delete this.img.onload;\n    try {\n      delete this.img.src;\n    } catch (e) {\n      console.error('Error: error on deleting img src');\n    }\n    delete this.img;\n  };\n  componentDidMount() {\n    const { isLoading } = this.state;\n    if (isLoading) {\n      this.loadImg();\n    }\n  }\n  componentWillUnmount() {\n    if (this.img) {\n      this.unloadImg();\n    }\n  }\n  componentWillReceiveProps(nextProps) {\n    const { src: imgSrc } = nextProps;\n    const { src } = this.props;\n    if (src !== imgSrc) {\n      // If the source is invalid, just render the placeholder\n      if (!imgSrc) {\n        return this.setState({ isLoading: false, isLoaded: false });\n      }\n      this.setState(\n        {\n          isLoaded: false,\n          isLoading: false,\n        },\n        this.loadImg,\n      );\n    }\n  }\n  render() {\n    const { container, src, placeholder, placeholderContainer, ...rest } =\n      this.props;\n    const { isLoading, isLoaded } = this.state;\n    if (isLoaded) {\n      const imgProps = {\n        ...{ src },\n        ...rest,\n      };\n      /* eslint-disable-next-line */\n      return container(<img {...imgProps} />);\n    }\n    if (!isLoaded && isLoading) {\n      return placeholder ? placeholderContainer(placeholder) : null;\n    }\n    return null;\n  }\n}\nexport default PlaceholderImage;\n"],"file":"index.js"}