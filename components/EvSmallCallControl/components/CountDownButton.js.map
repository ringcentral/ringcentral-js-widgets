{"version":3,"file":"CountDownButton.js","names":["_utils","require","_juno","_react","_interopRequireWildcard","_i18n","_interopRequireDefault","e","__esModule","_getRequireWildcardCache","WeakMap","r","t","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","asyncGeneratorStep","o","c","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","f","next","push","isArray","CountDown","_ref","data","count","createElement","RcText","color","variant","exports","CountDownButton","_ref2","currentLocale","onRestartTimer","onResumeRecord","size","className","dataSign","recordPauseCount","timeStamp","_useState","useState","_useState2","intervalTime","setIntervalTime","useEffect","clearTimerSet","handleTime","_ref3","regeneratorRuntime","mark","_callee","time","wrap","_callee$","_context","prev","Math","ceil","Date","now","sleep","abrupt","stop","intervalId","setInterval","clearInterval","RcIconButton","symbol","title","i18n","getString","onClick","shouldPersistBg","defaultProps"],"sources":["components/EvSmallCallControl/components/CountDownButton.tsx"],"sourcesContent":["import { sleep } from '@ringcentral-integration/commons/utils';\nimport { RcIconButton, RcText } from '@ringcentral/juno';\nimport type { FunctionComponent } from 'react';\nimport React, { useEffect, useState } from 'react';\n\nimport type { CallButtonsProps } from '../../SmallCallControl';\nimport i18n from '../i18n';\n\ntype CountDownProps = {\n  data: number;\n};\nexport const CountDown: FunctionComponent<CountDownProps> = ({ data }) => {\n  const count = data > 99 ? '99+' : data;\n  return (\n    <RcText color=\"danger.f02\" variant=\"subheading1\" data-sign=\"CountDownText\">\n      {count}\n    </RcText>\n  );\n};\n\nexport type CountDownButtonProps = CallButtonsProps & {\n  onRestartTimer?(): void | Promise<void>;\n  onResumeRecord?(): void;\n  recordPauseCount?: number;\n  timeStamp?: number;\n};\n\nexport const CountDownButton: FunctionComponent<CountDownButtonProps> = ({\n  currentLocale,\n  onRestartTimer,\n  onResumeRecord,\n  size,\n  className,\n  dataSign,\n  recordPauseCount,\n  timeStamp,\n}) => {\n  const [intervalTime, setIntervalTime] = useState(recordPauseCount);\n\n  useEffect(() => {\n    if (!timeStamp) return;\n    let clearTimerSet = () => {};\n    const handleTime = async () => {\n      const time = Math.ceil(\n        recordPauseCount + (timeStamp - Date.now()) / 1000,\n      );\n      if (time < 0) {\n        clearTimerSet();\n        // to handle other tabs had not execute this part code because this Component destroyed\n        await sleep(1000);\n\n        onResumeRecord();\n        return;\n      }\n      setIntervalTime(time);\n    };\n\n    const intervalId = setInterval(handleTime, 1000);\n    handleTime();\n    clearTimerSet = () => {\n      clearInterval(intervalId);\n    };\n    return clearTimerSet;\n  }, [timeStamp, recordPauseCount]);\n\n  return (\n    <RcIconButton\n      data-sign={dataSign}\n      color=\"danger.f02\"\n      symbol={() => <CountDown data={intervalTime} />}\n      variant=\"round\"\n      title={i18n.getString('restartTimer', currentLocale)}\n      onClick={onRestartTimer}\n      size={size}\n      className={className}\n      shouldPersistBg\n    />\n  );\n};\n\nCountDownButton.defaultProps = {\n  currentLocale: 'en-US',\n  dataSign: 'CountDown',\n};\n"],"mappings":"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","ignoreList":[]}