{"version":3,"file":"CountDownButton.js","names":["_react","_interopRequireWildcard","require","_utils","_juno","_i18n","_interopRequireDefault","obj","__esModule","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","toString","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","push","isArray","CountDown","_ref","data","count","createElement","RcText","color","variant","exports","CountDownButton","_ref2","currentLocale","onRestartTimer","onResumeRecord","size","className","dataSign","recordPauseCount","timeStamp","_useState","useState","_useState2","intervalTime","setIntervalTime","useEffect","clearTimerSet","handleTime","_ref3","regeneratorRuntime","mark","_callee","time","wrap","_callee$","_context","prev","Math","ceil","Date","now","sleep","abrupt","stop","intervalId","setInterval","clearInterval","RcIconButton","symbol","title","i18n","getString","onClick","shouldPersistBg","defaultProps"],"sources":["components/EvSmallCallControl/components/CountDownButton.tsx"],"sourcesContent":["import type { FunctionComponent } from 'react';\nimport React, { useEffect, useState } from 'react';\n\nimport { sleep } from '@ringcentral-integration/commons/utils';\nimport { RcIconButton, RcText } from '@ringcentral/juno';\n\nimport type { CallButtonsProps } from '../../SmallCallControl';\nimport i18n from '../i18n';\n\ntype CountDownProps = {\n  data: number;\n};\nexport const CountDown: FunctionComponent<CountDownProps> = ({ data }) => {\n  const count = data > 99 ? '99+' : data;\n  return (\n    <RcText color=\"danger.f02\" variant=\"subheading1\" data-sign=\"CountDownText\">\n      {count}\n    </RcText>\n  );\n};\n\nexport type CountDownButtonProps = CallButtonsProps & {\n  onRestartTimer?(): void | Promise<void>;\n  onResumeRecord?(): void;\n  recordPauseCount?: number;\n  timeStamp?: number;\n};\n\nexport const CountDownButton: FunctionComponent<CountDownButtonProps> = ({\n  currentLocale,\n  onRestartTimer,\n  onResumeRecord,\n  size,\n  className,\n  dataSign,\n  recordPauseCount,\n  timeStamp,\n}) => {\n  const [intervalTime, setIntervalTime] = useState(recordPauseCount);\n\n  useEffect(() => {\n    if (!timeStamp) return;\n    let clearTimerSet = () => {};\n    const handleTime = async () => {\n      const time = Math.ceil(\n        recordPauseCount + (timeStamp - Date.now()) / 1000,\n      );\n      if (time < 0) {\n        clearTimerSet();\n        // to handle other tabs had not execute this part code because this Component destroyed\n        await sleep(1000);\n\n        onResumeRecord();\n        return;\n      }\n      setIntervalTime(time);\n    };\n\n    const intervalId = setInterval(handleTime, 1000);\n    handleTime();\n    clearTimerSet = () => {\n      clearInterval(intervalId);\n    };\n    return clearTimerSet;\n  }, [timeStamp, recordPauseCount]);\n\n  return (\n    <RcIconButton\n      data-sign={dataSign}\n      color=\"danger.f02\"\n      symbol={() => <CountDown data={intervalTime} />}\n      variant=\"round\"\n      title={i18n.getString('restartTimer', currentLocale)}\n      onClick={onRestartTimer}\n      size={size}\n      className={className}\n      shouldPersistBg\n    />\n  );\n};\n\nCountDownButton.defaultProps = {\n  currentLocale: 'en-US',\n  dataSign: 'CountDown',\n};\n"],"mappings":"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"}