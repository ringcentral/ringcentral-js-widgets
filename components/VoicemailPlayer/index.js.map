{"version":3,"sources":["components/VoicemailPlayer/index.js"],"names":["audiosMap","VoicemailPlayer","props","state","playing","paused","progress","_id","uri","split","pop","Date","getTime","_audio","Audio","preload","volume","addEventListener","_mounted","setState","currentTime","duration","isPlaying","console","error","_playAudio","src","load","Number","isNaN","_pauseOtherAudios","_playPromise","play","onPlay","_pauseAudio","undefined","then","pause","_onDownloadClick","e","disabled","preventDefault","Object","keys","forEach","id","otherAudio","className","currentLocale","icon","styles","i18n","getString","downloadUri","root","startTime","download","endTime","all","done","width","current","left","Component","propTypes","PropTypes","number","string","isRequired","func","bool","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport formatDuration from '../../lib/formatDuration';\nimport DownloadIcon from '../../assets/images/Download.svg';\nimport PlayIcon from '../../assets/images/Play.svg';\nimport PauseIcon from '../../assets/images/Pause.svg';\n\nimport Button from '../Button';\n\nimport styles from './styles.scss';\nimport i18n from './i18n';\n\nconst audiosMap = {};\n\nclass VoicemailPlayer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playing: false,\n      paused: false,\n      progress: 0,\n    };\n\n    this._id = `${props.uri && props.uri.split('?')[0].split('/').pop()}/${(new Date()).getTime()}`;\n    this._audio = new Audio();\n    this._audio.preload = false;\n    this._audio.volume = 1;\n    audiosMap[this._id] = this._audio;\n    this._audio.addEventListener('timeupdate', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        progress: (this._audio.currentTime / this._audio.duration),\n      });\n    });\n\n    this._audio.addEventListener('ended', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('pause', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        paused: true,\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('play', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: true,\n        paused: false,\n      });\n      this._audio.isPlaying = true;\n    });\n\n    this._audio.addEventListener('error', () => {\n      console.error(this._audio.error);\n    });\n\n    this._playAudio = () => {\n      if (this.state.playing) {\n        return;\n      }\n      if (!this.state.paused) {\n        this._audio.src = this.props.uri;\n        this._audio.load(this.props.uri);\n        if (!Number.isNaN(this._audio.duration)) {\n          this._audio.currentTime = 0;\n        }\n      }\n      this._pauseOtherAudios();\n      this._audio._playPromise = this._audio.play();\n      if (typeof this.props.onPlay === 'function') {\n        this.props.onPlay();\n      }\n    };\n\n    this._pauseAudio = () => {\n      if (this.state.paused) {\n        return;\n      }\n      if (this._audio._playPromise !== undefined) {\n        this._audio._playPromise.then(() => {\n          this._audio.pause();\n        });\n      }\n    };\n\n    this._onDownloadClick = (e) => {\n      if (this.props.disabled) {\n        e.preventDefault();\n      }\n    };\n  }\n\n  _pauseOtherAudios() {\n    Object.keys(audiosMap).forEach((id) => {\n      if (id === this._id) {\n        return;\n      }\n      const otherAudio = audiosMap[id];\n      if (otherAudio.isPlaying && otherAudio._playPromise) {\n        otherAudio._playPromise.then(() => {\n          otherAudio.pause();\n        });\n      }\n    });\n  }\n\n  componentDidMount() {\n    this._mounted = true;\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n    if (!Number.isNaN(this._audio.duration)) {\n      this._audio.currentTime = 0;\n    }\n    this._audio.pause();\n    delete audiosMap[this._id];\n  }\n\n  render() {\n    const {\n      className,\n      duration,\n      uri,\n      disabled,\n      currentLocale,\n    } = this.props;\n    let icon;\n    if (this.state.playing) {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._pauseAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('pause', currentLocale)}>\n            <PauseIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    } else {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._playAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('play', currentLocale)} data-sign='play'>\n            <PlayIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    }\n    const currentTime =\n      (this._audio.currentTime < duration) ? this._audio.currentTime : duration;\n    const downloadUri = `${uri}&contentDisposition=Attachment`;\n    return (\n      <div className={classnames(styles.root, className)}>\n        {icon}\n        <span className={styles.startTime}>{formatDuration(currentTime)}</span>\n        <a\n          className={classnames(styles.download, (disabled ? styles.disabled : null))}\n          target=\"_blank\"\n          download\n          data-sign='download'\n          title={i18n.getString('download', currentLocale)}\n          href={downloadUri}\n          onClick={this._onDownloadClick}\n        >\n          <DownloadIcon width={18} height={18} />\n        </a>\n        <span className={styles.endTime}>{formatDuration(duration)}</span>\n        <div className={styles.progress}>\n          <div className={styles.all} />\n          <div className={styles.done} style={{ width: `${this.state.progress * 100}%` }} />\n          <div className={styles.current} style={{ left: `${this.state.progress * 100}%` }} />\n        </div>\n      </div>\n    );\n  }\n}\n\nVoicemailPlayer.propTypes = {\n  duration: PropTypes.number,\n  uri: PropTypes.string.isRequired,\n  className: PropTypes.string,\n  onPlay: PropTypes.func,\n  disabled: PropTypes.bool,\n  currentLocale: PropTypes.string.isRequired,\n};\n\nVoicemailPlayer.defaultProps = {\n  duration: 0,\n  className: undefined,\n  onPlay: undefined,\n  disabled: false,\n};\n\nexport default VoicemailPlayer;\n"],"file":"index.js"}