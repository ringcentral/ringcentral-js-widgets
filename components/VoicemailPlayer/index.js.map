{"version":3,"sources":["components/VoicemailPlayer/index.tsx"],"names":["audiosMap","VoicemailPlayer","props","state","playing","paused","progress","_id","uri","split","pop","Date","getTime","_audio","Audio","preload","volume","addEventListener","_mounted","setState","currentTime","duration","isPlaying","console","error","_playAudio","src","load","Number","isNaN","_pauseOtherAudios","_playPromise","play","onPlay","_pauseAudio","undefined","then","pause","_onDownloadClick","e","disabled","preventDefault","Object","keys","forEach","id","otherAudio","className","currentLocale","icon","styles","i18n","getString","downloadUri","root","startTime","download","endTime","all","done","width","current","left","Component","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nimport classnames from 'classnames';\n\nimport DownloadIcon from '../../assets/images/Download.svg';\nimport PauseIcon from '../../assets/images/Pause.svg';\nimport PlayIcon from '../../assets/images/Play.svg';\nimport formatDuration from '../../lib/formatDuration';\nimport { Button } from '../Button';\nimport i18n from './i18n';\nimport styles from './styles.scss';\n\nconst audiosMap = {};\ntype VoicemailPlayerProps = {\n  duration?: number;\n  uri: string;\n  className?: string;\n  onPlay?: (...args: any[]) => any;\n  disabled?: boolean;\n  currentLocale: string;\n};\ntype VoicemailPlayerState = {\n  playing: boolean;\n  paused: boolean;\n  progress: number;\n};\nclass VoicemailPlayer extends Component<\n  VoicemailPlayerProps,\n  VoicemailPlayerState\n> {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playing: false,\n      paused: false,\n      progress: 0,\n    };\n    this._id = `${\n      props.uri && props.uri.split('?')[0].split('/').pop()\n    }/${new Date().getTime()}`;\n    this._audio = new Audio();\n    this._audio.preload = false;\n    this._audio.volume = 1;\n    audiosMap[this._id] = this._audio;\n    this._audio.addEventListener('timeupdate', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        progress: this._audio.currentTime / this._audio.duration,\n      });\n    });\n    this._audio.addEventListener('ended', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n    this._audio.addEventListener('pause', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        paused: true,\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n    this._audio.addEventListener('play', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: true,\n        paused: false,\n      });\n      this._audio.isPlaying = true;\n    });\n    this._audio.addEventListener('error', () => {\n      console.error(this._audio.error);\n    });\n    this._playAudio = () => {\n      if (this.state.playing) {\n        return;\n      }\n      if (!this.state.paused) {\n        this._audio.src = this.props.uri;\n        this._audio.load(this.props.uri);\n        if (!Number.isNaN(this._audio.duration)) {\n          this._audio.currentTime = 0;\n        }\n      }\n      this._pauseOtherAudios();\n      this._audio._playPromise = this._audio.play();\n      if (typeof this.props.onPlay === 'function') {\n        this.props.onPlay();\n      }\n    };\n    this._pauseAudio = () => {\n      if (this.state.paused) {\n        return;\n      }\n      if (this._audio._playPromise !== undefined) {\n        this._audio._playPromise.then(() => {\n          this._audio.pause();\n        });\n      }\n    };\n    this._onDownloadClick = (e) => {\n      if (this.props.disabled) {\n        e.preventDefault();\n      }\n    };\n  }\n  _pauseOtherAudios() {\n    Object.keys(audiosMap).forEach((id) => {\n      if (id === this._id) {\n        return;\n      }\n      const otherAudio = audiosMap[id];\n      if (otherAudio.isPlaying && otherAudio._playPromise) {\n        otherAudio._playPromise.then(() => {\n          otherAudio.pause();\n        });\n      }\n    });\n  }\n  componentDidMount() {\n    this._mounted = true;\n  }\n  componentWillUnmount() {\n    this._mounted = false;\n    if (!Number.isNaN(this._audio.duration)) {\n      this._audio.currentTime = 0;\n    }\n    this._audio.pause();\n    delete audiosMap[this._id];\n  }\n  render() {\n    const { className, duration, uri, disabled, currentLocale } = this.props;\n    let icon;\n    if (this.state.playing) {\n      icon = (\n        <Button\n          className={classnames(styles.play, disabled ? styles.disabled : null)}\n          onClick={this._pauseAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('pause', currentLocale)}>\n            <PauseIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    } else {\n      icon = (\n        <Button\n          className={classnames(styles.play, disabled ? styles.disabled : null)}\n          onClick={this._playAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('play', currentLocale)} data-sign=\"play\">\n            <PlayIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    }\n    const currentTime =\n      this._audio.currentTime < duration ? this._audio.currentTime : duration;\n    const downloadUri = `${uri}&contentDisposition=Attachment`;\n    return (\n      <div className={classnames(styles.root, className)}>\n        {icon}\n        <span className={styles.startTime}>{formatDuration(currentTime)}</span>\n        <a\n          className={classnames(\n            styles.download,\n            disabled ? styles.disabled : null,\n          )}\n          target=\"_blank\"\n          download\n          data-sign=\"download\"\n          title={i18n.getString('download', currentLocale)}\n          href={downloadUri}\n          onClick={this._onDownloadClick}\n        >\n          <DownloadIcon width={18} height={18} />\n        </a>\n        <span className={styles.endTime}>{formatDuration(duration)}</span>\n        <div className={styles.progress}>\n          <div className={styles.all} />\n          <div\n            className={styles.done}\n            style={{ width: `${this.state.progress * 100}%` }}\n          />\n          <div\n            className={styles.current}\n            style={{ left: `${this.state.progress * 100}%` }}\n          />\n        </div>\n      </div>\n    );\n  }\n}\nVoicemailPlayer.defaultProps = {\n  duration: 0,\n  className: undefined,\n  onPlay: undefined,\n  disabled: false,\n};\nexport default VoicemailPlayer;\n"],"file":"index.js"}