{"version":3,"file":"index.js","names":["_callLogHelpers","require","_juno","_react","_interopRequireWildcard","_rxjs","_LogBasicInfo","_interopRequireDefault","_SpinnerOverlay","_SaveButton","_i18n","_styles","e","__esModule","t","WeakMap","r","n","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","u","next","done","push","value","isArray","LogSection","_ref","isInnerMask","_ref$currentLog","currentLog","_ref$onLogBasicInfoCl","onLogBasicInfoClick","noop","_ref$renderSmallCallC","renderSmallCallContrl","_ref$showSaveLogBtn","showSaveLogBtn","renderSaveLogButton","currentLocale","formatPhone","onSaveCallLog","_ref$showSmallCallCon","showSmallCallControl","renderEditLogSection","onUpdateCallLog","additionalInfo","onCallLogSaved","scrollRef","useRef","showSpinner","_useState","useState","_useState2","mainCtrlOverlapped","setMainCtrlOverlapped","checkOverlap","_ref2","target","scrollHeight","clientHeight","scrollTop","overlappedHeight","beOverlapped","useEventListener","window","getEditLogSection","genSaveLogButton","currentLogCall","overlapped","createElement","SaveButton","isSaving","onClick","i18n","getString","renderLogBasicInfo","currentSessionId","telephonyStatus","result","status","isActive","clickable","isRingingInboundCall","extraButton","dataSign","className","styles","root","SpinnerOverlay","spinner","ref","editSection","innerMask","_default","exports"],"sources":["components/LogSection/index.tsx"],"sourcesContent":["import { isRingingInboundCall } from '@ringcentral-integration/commons/lib/callLogHelpers';\nimport { useEventListener } from '@ringcentral/juno';\nimport React, { useRef, useState } from 'react';\nimport { noop } from 'rxjs';\n\nimport LogBasicInfo from '../LogBasicInfo';\nimport { SpinnerOverlay } from '../SpinnerOverlay';\n\nimport { SaveButton } from './SaveButton';\nimport i18n from './i18n';\nimport styles from './styles.scss';\n\ntype LogSectionProps = {\n  currentLog?: any;\n  additionalInfo?: object;\n  currentLocale: string;\n  formatPhone?: (...args: any[]) => any;\n  onUpdateCallLog?: (...args: any[]) => any;\n  onSaveCallLog?: (...args: any[]) => any;\n  renderEditLogSection?: (...args: any[]) => any;\n  renderSaveLogButton?: (...args: any[]) => any;\n  isInnerMask?: boolean;\n  onLogBasicInfoClick?: (...args: any[]) => any;\n  showSaveLogBtn?: boolean;\n  showSmallCallControl?: boolean;\n  renderSmallCallContrl?: (...args: any[]) => any;\n  onCallLogSaved?: (...args: any[]) => any;\n};\n\nconst LogSection: React.FC<LogSectionProps> = ({\n  isInnerMask,\n  currentLog = {},\n  onLogBasicInfoClick = noop,\n  renderSmallCallContrl = noop,\n  showSaveLogBtn = true,\n  renderSaveLogButton,\n  currentLocale,\n  formatPhone,\n  onSaveCallLog,\n  showSmallCallControl = true,\n  renderEditLogSection,\n  onUpdateCallLog,\n  additionalInfo,\n  onCallLogSaved,\n}) => {\n  const scrollRef = useRef(null);\n\n  const { showSpinner } = currentLog;\n  const [mainCtrlOverlapped, setMainCtrlOverlapped] = useState(false);\n\n  const checkOverlap = (e: Event): void => {\n    const { scrollHeight, clientHeight, scrollTop } =\n      e.target as HTMLDivElement;\n    const overlappedHeight = scrollHeight - clientHeight - scrollTop;\n    const beOverlapped = overlappedHeight > 1;\n\n    if (beOverlapped !== mainCtrlOverlapped) {\n      setMainCtrlOverlapped(beOverlapped);\n    }\n  };\n\n  useEventListener(window, 'resize', checkOverlap);\n  useEventListener(scrollRef, 'scroll', checkOverlap);\n\n  const getEditLogSection = () => {\n    return renderEditLogSection?.({\n      currentLocale,\n      onSaveCallLog,\n      onUpdateCallLog,\n      currentLog,\n      additionalInfo,\n      onCallLogSaved,\n    });\n  };\n\n  const genSaveLogButton = () => {\n    const { call, currentLogCall } = currentLog;\n    if (!showSaveLogBtn) {\n      return null;\n    }\n    if (renderSaveLogButton) {\n      return renderSaveLogButton({\n        currentLocale,\n        onSaveCallLog,\n        currentLog,\n        overlapped: mainCtrlOverlapped,\n      });\n    }\n\n    return (\n      <SaveButton\n        isSaving={currentLogCall.isSaving}\n        onClick={() => onSaveCallLog?.(call)}\n        overlapped={mainCtrlOverlapped}\n      >\n        {i18n.getString('saveLog', currentLocale)}\n      </SaveButton>\n    );\n  };\n\n  const renderLogBasicInfo = () => {\n    const { currentSessionId, call } = currentLog;\n    const { telephonyStatus, result } = call;\n    const status = telephonyStatus || result;\n    const isActive = !result;\n    const clickable = isActive && !isRingingInboundCall(call);\n    let extraButton;\n    if (showSmallCallControl && isActive) {\n      extraButton = renderSmallCallContrl(status, currentSessionId);\n    }\n    return (\n      <LogBasicInfo\n        dataSign=\"leftSectionInfo\"\n        currentLog={currentLog}\n        currentLocale={currentLocale}\n        formatPhone={formatPhone}\n        extraButton={extraButton}\n        clickable={clickable}\n        onClick={\n          clickable\n            ? onLogBasicInfoClick\n            : () => {\n                //\n              }\n        }\n      />\n    );\n  };\n\n  return (\n    <div className={styles.root}>\n      {showSpinner ? <SpinnerOverlay className={styles.spinner} /> : null}\n      {renderLogBasicInfo()}\n      <div ref={scrollRef} className={styles.editSection}>\n        {getEditLogSection()}\n      </div>\n      {genSaveLogButton()}\n      {isInnerMask ? <div className={styles.innerMask} /> : null}\n    </div>\n  );\n};\n\nexport default LogSection;\n"],"mappings":"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","ignoreList":[]}