{"version":3,"file":"getTextFieldInsertResult.js","names":["_juno","require","_runes","_interopRequireDefault","e","__esModule","getTextFieldInsertResult","_ref","input","insertValue","sourcePosition","currentText","value","document","activeElement","currentPositionInfo","getSelectionPosition","position","emojiAsOneCharArr","runes","count","start","end","i","length","slice","flat","join","exports"],"sources":["components/MessageInput/utils/getTextFieldInsertResult.ts"],"sourcesContent":["import { getSelectionPosition } from '@ringcentral/juno';\n// @ts-ignore\nimport runes from 'runes';\n\ntype GetTextFieldInsertResultOptions = {\n  input: HTMLInputElement | HTMLTextAreaElement;\n  insertValue: string;\n  sourcePosition: ReturnType<typeof getSelectionPosition> | null;\n};\n\n/**\n * handle emoji with textfield selection insert logic\n */\nexport const getTextFieldInsertResult = ({\n  input,\n  insertValue,\n  sourcePosition,\n}: GetTextFieldInsertResultOptions) => {\n  const currentText = input.value;\n  // when not have source position and is not activeElement\n  // insert at end of current text\n  if (!sourcePosition && input !== document.activeElement) {\n    return {\n      value: currentText + insertValue,\n    };\n  }\n\n  const currentPositionInfo = sourcePosition || getSelectionPosition(input);\n  const position = currentPositionInfo.position;\n  // https://www.npmjs.com/package/runes\n  // light separate string with emojis\n  // runes('Emoji ðŸ¤–') => ['E', 'm', 'o', 'j', 'i', ' ', 'ðŸ¤–']\n  const emojiAsOneCharArr: string[] = runes(currentText);\n\n  let count = 0;\n  let start = 0;\n  let end = 0;\n\n  if (position.start !== 0 || position.end !== 0) {\n    for (let i = 0; i < emojiAsOneCharArr.length; i++) {\n      count += emojiAsOneCharArr[i].length;\n\n      if (start === 0 && position.start !== 0 && count >= position.start) {\n        start = i + 1;\n      }\n\n      if (position.end !== 0 && count >= position.end) {\n        end = i + 1;\n        break;\n      }\n    }\n  }\n\n  return {\n    start: position.start + insertValue.length,\n    value: [\n      emojiAsOneCharArr.slice(0, start),\n      insertValue,\n      emojiAsOneCharArr.slice(end),\n    ]\n      .flat()\n      .join(''),\n  };\n};\n"],"mappings":";;;;;;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AAEA,IAAAC,MAAA,GAAAC,sBAAA,CAAAF,OAAA;AAA0B,SAAAE,uBAAAC,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,gBAAAA,CAAA;AAD1B;;AASA;AACA;AACA;AACO,IAAME,wBAAwB,GAAG,SAA3BA,wBAAwBA,CAAAC,IAAA,EAIE;EAAA,IAHrCC,KAAK,GAAAD,IAAA,CAALC,KAAK;IACLC,WAAW,GAAAF,IAAA,CAAXE,WAAW;IACXC,cAAc,GAAAH,IAAA,CAAdG,cAAc;EAEd,IAAMC,WAAW,GAAGH,KAAK,CAACI,KAAK;EAC/B;EACA;EACA,IAAI,CAACF,cAAc,IAAIF,KAAK,KAAKK,QAAQ,CAACC,aAAa,EAAE;IACvD,OAAO;MACLF,KAAK,EAAED,WAAW,GAAGF;IACvB,CAAC;EACH;EAEA,IAAMM,mBAAmB,GAAGL,cAAc,IAAI,IAAAM,0BAAoB,EAACR,KAAK,CAAC;EACzE,IAAMS,QAAQ,GAAGF,mBAAmB,CAACE,QAAQ;EAC7C;EACA;EACA;EACA,IAAMC,iBAA2B,GAAG,IAAAC,iBAAK,EAACR,WAAW,CAAC;EAEtD,IAAIS,KAAK,GAAG,CAAC;EACb,IAAIC,KAAK,GAAG,CAAC;EACb,IAAIC,GAAG,GAAG,CAAC;EAEX,IAAIL,QAAQ,CAACI,KAAK,KAAK,CAAC,IAAIJ,QAAQ,CAACK,GAAG,KAAK,CAAC,EAAE;IAC9C,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,iBAAiB,CAACM,MAAM,EAAED,CAAC,EAAE,EAAE;MACjDH,KAAK,IAAIF,iBAAiB,CAACK,CAAC,CAAC,CAACC,MAAM;MAEpC,IAAIH,KAAK,KAAK,CAAC,IAAIJ,QAAQ,CAACI,KAAK,KAAK,CAAC,IAAID,KAAK,IAAIH,QAAQ,CAACI,KAAK,EAAE;QAClEA,KAAK,GAAGE,CAAC,GAAG,CAAC;MACf;MAEA,IAAIN,QAAQ,CAACK,GAAG,KAAK,CAAC,IAAIF,KAAK,IAAIH,QAAQ,CAACK,GAAG,EAAE;QAC/CA,GAAG,GAAGC,CAAC,GAAG,CAAC;QACX;MACF;IACF;EACF;EAEA,OAAO;IACLF,KAAK,EAAEJ,QAAQ,CAACI,KAAK,GAAGZ,WAAW,CAACe,MAAM;IAC1CZ,KAAK,EAAE,CACLM,iBAAiB,CAACO,KAAK,CAAC,CAAC,EAAEJ,KAAK,CAAC,EACjCZ,WAAW,EACXS,iBAAiB,CAACO,KAAK,CAACH,GAAG,CAAC,CAC7B,CACEI,IAAI,CAAC,CAAC,CACNC,IAAI,CAAC,EAAE;EACZ,CAAC;AACH,CAAC;AAACC,OAAA,CAAAtB,wBAAA,GAAAA,wBAAA","ignoreList":[]}