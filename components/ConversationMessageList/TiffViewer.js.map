{"version":3,"file":"TiffViewer.js","names":["_utils","require","_react","_interopRequireWildcard","_reactUse","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","asyncGeneratorStep","o","c","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","TiffViewer","_ref","tiffUrl","onLoad","canvasRef","useRef","wrapperRef","mounted","usePromise","useEffect","regeneratorRuntime","mark","_callee","result","_wrapperRef$current$c","_wrapperRef$current","width","height","rgba","canvas","ctx","wrapperWidth","scale","offCanvas","offCtx","imageData","wrap","_callee$","_context","prev","next","getTiffInfoWithCache","sent","current","getContext","clientWidth","document","createElement","createImageData","data","putImageData","drawImage","error","console","stop","ref","style","_default","exports"],"sources":["components/ConversationMessageList/TiffViewer.tsx"],"sourcesContent":["import type MessageAttachmentInfo from '@rc-ex/core/lib/definitions/MessageAttachmentInfo';\nimport { getTiffInfoWithCache } from '@ringcentral-integration/utils';\nimport React, { useEffect, useRef } from 'react';\nimport { usePromise } from 'react-use';\n\nexport interface ImageAttachmentRenderProps {\n  attachment: MessageAttachmentInfo;\n}\n\nconst TiffViewer = ({\n  tiffUrl,\n  onLoad,\n}: {\n  tiffUrl: string;\n  onLoad?: () => void;\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const mounted = usePromise();\n\n  useEffect(() => {\n    (async () => {\n      const result = await mounted(getTiffInfoWithCache(tiffUrl));\n\n      if (result) {\n        try {\n          const { width, height, rgba } = result;\n\n          const canvas = canvasRef.current!;\n          const ctx = canvas.getContext('2d')!;\n\n          // Get the width of the wrapper div\n          const wrapperWidth = wrapperRef.current?.clientWidth ?? 0;\n\n          // Calculate the scale to fit the image within the wrapper\n          const scale = wrapperWidth / width;\n\n          // Set canvas size based on the scale factor\n          canvas.width = width * scale;\n          canvas.height = height * scale;\n\n          const offCanvas = document.createElement('canvas');\n          offCanvas.width = width;\n          offCanvas.height = height;\n          const offCtx = offCanvas.getContext('2d')!;\n\n          const imageData = offCtx?.createImageData(width, height)!;\n          imageData.data.set(rgba);\n          offCtx.putImageData(imageData, 0, 0);\n\n          ctx.drawImage(\n            offCanvas,\n            0,\n            0,\n            width,\n            height,\n            0,\n            0,\n            canvas.width,\n            canvas.height,\n          );\n          onLoad?.();\n        } catch (error) {\n          console.error('Draw canvas fail', error);\n        }\n      }\n    })();\n  }, [mounted, tiffUrl, onLoad]);\n\n  return (\n    <div ref={wrapperRef} style={{ width: '100%' }}>\n      <canvas ref={canvasRef} style={{ width: '100%', height: 'auto' }} />\n    </div>\n  );\n};\n\nexport default TiffViewer;\n"],"mappings":"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","ignoreList":[]}