{"version":3,"file":"TiffViewer.js","names":["_utils","require","_react","_interopRequireWildcard","_reactUse","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_regenerator","Symbol","iterator","toStringTag","c","prototype","Generator","u","create","_regeneratorDefine2","p","y","G","v","a","d","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","displayName","w","m","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","TiffViewer","_ref","tiffUrl","onLoad","canvasRef","useRef","wrapperRef","mounted","usePromise","useEffect","_callee","result","_wrapperRef$current$c","_wrapperRef$current","width","height","rgba","canvas","ctx","wrapperWidth","scale","offCanvas","offCtx","imageData","_context","getTiffInfoWithCache","current","getContext","clientWidth","document","createElement","createImageData","data","putImageData","drawImage","error","console","ref","style","_default","exports"],"sources":["components/ConversationMessageList/TiffViewer.tsx"],"sourcesContent":["import type MessageAttachmentInfo from '@rc-ex/core/lib/definitions/MessageAttachmentInfo';\nimport { getTiffInfoWithCache } from '@ringcentral-integration/utils';\nimport React, { useEffect, useRef } from 'react';\nimport { usePromise } from 'react-use';\n\nexport interface ImageAttachmentRenderProps {\n  attachment: MessageAttachmentInfo;\n}\n\nconst TiffViewer = ({\n  tiffUrl,\n  onLoad,\n}: {\n  tiffUrl: string;\n  onLoad?: () => void;\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const mounted = usePromise();\n\n  useEffect(() => {\n    (async () => {\n      const result = await mounted(getTiffInfoWithCache(tiffUrl));\n\n      if (result) {\n        try {\n          const { width, height, rgba } = result;\n\n          const canvas = canvasRef.current!;\n          const ctx = canvas.getContext('2d')!;\n\n          // Get the width of the wrapper div\n          const wrapperWidth = wrapperRef.current?.clientWidth ?? 0;\n\n          // Calculate the scale to fit the image within the wrapper\n          const scale = wrapperWidth / width;\n\n          // Set canvas size based on the scale factor\n          canvas.width = width * scale;\n          canvas.height = height * scale;\n\n          const offCanvas = document.createElement('canvas');\n          offCanvas.width = width;\n          offCanvas.height = height;\n          const offCtx = offCanvas.getContext('2d')!;\n\n          const imageData = offCtx?.createImageData(width, height)!;\n          imageData.data.set(rgba);\n          offCtx.putImageData(imageData, 0, 0);\n\n          ctx.drawImage(\n            offCanvas,\n            0,\n            0,\n            width,\n            height,\n            0,\n            0,\n            canvas.width,\n            canvas.height,\n          );\n          onLoad?.();\n        } catch (error) {\n          console.error('Draw canvas fail', error);\n        }\n      }\n    })();\n  }, [mounted, tiffUrl, onLoad]);\n\n  return (\n    <div ref={wrapperRef} style={{ width: '100%' }}>\n      <canvas ref={canvasRef} style={{ width: '100%', height: 'auto' }} />\n    </div>\n  );\n};\n\nexport default TiffViewer;\n"],"mappings":"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","ignoreList":[]}