{"version":3,"file":"sanitizeHtml.js","names":["_dompurify","_interopRequireDefault","require","e","__esModule","sanitizeHtml","html","DOMPurify","addHook","node","data","attrName","startsWith","keepAttr","tagName","rel","getAttribute","includes","setAttribute","concat","trim","hasAttributes","attrsToRemove","i","attributes","length","attr","name","attrValue","value","test","push","forEach","removeAttribute","sanitized","sanitize","ALLOWED_TAGS","ALLOWED_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","removeHook"],"sources":["components/SanitizeHtml/utils/sanitizeHtml.ts"],"sourcesContent":["import DOMPurify from 'dompurify';\n\n/**\n * Sanitizes HTML content to prevent XSS attacks.\n * Uses DOMPurify to clean the HTML while preserving safe formatting tags.\n *\n * @param html - The HTML string to sanitize\n * @returns Sanitized HTML string safe for rendering\n */\nexport function sanitizeHtml(html: string): string {\n  if (!html || typeof html !== 'string') {\n    return '';\n  }\n\n  // Add hook to ensure links have rel=\"noopener noreferrer\" for security\n  // and allow all aria-* attributes dynamically\n  DOMPurify.addHook('uponSanitizeAttribute', (node, data) => {\n    // Allow all aria-* attributes dynamically (more maintainable than listing each one)\n    if (data.attrName && data.attrName.startsWith('aria-')) {\n      data.keepAttr = true;\n      return;\n    }\n    // Ensure all links have rel=\"noopener noreferrer\" for security\n    if (node.tagName === 'A' && data.attrName === 'target') {\n      const rel = node.getAttribute('rel') || '';\n      if (!rel.includes('noopener')) {\n        node.setAttribute('rel', `${rel} noopener noreferrer`.trim());\n      }\n    }\n  });\n\n  // Add hook to sanitize data-* attribute values after attributes are processed\n  // Note: data-* attributes can be XSS vectors if:\n  // 1. Their values are inserted via innerHTML/outerHTML\n  // 2. Their values are executed via eval() or Function()\n  // 3. Their values contain HTML/script tags that get parsed\n  // 4. Their values are used as event handlers\n  DOMPurify.addHook('afterSanitizeAttributes', (node) => {\n    // Remove data attributes with dangerous values to prevent XSS\n    if (node.hasAttributes && node.hasAttributes()) {\n      const attrsToRemove: string[] = [];\n      for (let i = 0; i < node.attributes.length; i++) {\n        const attr = node.attributes[i];\n        if (attr.name.startsWith('data-')) {\n          const attrValue = attr.value || '';\n          // Check for dangerous content in data attribute values\n          if (\n            // JavaScript protocol (can be executed in various contexts)\n            attrValue.includes('javascript:') ||\n            // Event handler names (could be used maliciously)\n            /on\\w+\\s*=/i.test(attrValue) ||\n            // Script tags (HTML injection risk)\n            /<script/i.test(attrValue) ||\n            // eval() function calls (code execution risk)\n            /eval\\s*\\(/i.test(attrValue) ||\n            // Function constructor (code execution risk)\n            /Function\\s*\\(/i.test(attrValue) ||\n            // alert() calls (often used in XSS payloads)\n            /alert\\s*\\(/i.test(attrValue)\n          ) {\n            attrsToRemove.push(attr.name);\n          }\n        }\n      }\n      // Remove dangerous data attributes\n      attrsToRemove.forEach((attrName) => {\n        node.removeAttribute(attrName);\n      });\n    }\n  });\n\n  const sanitized = DOMPurify.sanitize(html, {\n    // Allow common formatting tags\n    ALLOWED_TAGS: [\n      'p',\n      'br',\n      'strong',\n      'em',\n      'u',\n      'b',\n      'i',\n      'span',\n      'div',\n      'ul',\n      'ol',\n      'li',\n      'a',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'blockquote',\n      'code',\n      'pre',\n      'hr',\n      'sub',\n      'sup',\n      'del',\n      's',\n      'mark',\n      'small',\n      'abbr',\n      'cite',\n      'q',\n      'dl',\n      'dt',\n      'dd',\n      'img',\n    ],\n    // Allow safe attributes\n    // Note: All aria-* attributes are allowed dynamically via hook above\n    ALLOWED_ATTR: [\n      'href',\n      'target',\n      'rel',\n      'class',\n      'style',\n      'title',\n      'id',\n      'lang',\n      'dir',\n      'role',\n      'src',\n    ],\n    // Allow data-* attributes (DOMPurify will still sanitize dangerous values)\n    ALLOW_DATA_ATTR: true,\n    // Keep relative URLs\n    ALLOW_UNKNOWN_PROTOCOLS: false,\n  });\n\n  // Remove hooks after use to avoid affecting other sanitizations\n  DOMPurify.removeHook('uponSanitizeAttribute');\n  DOMPurify.removeHook('afterSanitizeAttributes');\n\n  return sanitized;\n}\n"],"mappings":"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","ignoreList":[]}