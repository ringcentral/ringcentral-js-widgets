{"version":3,"sources":["integration-test/mock/telephonySessionBuilder.ts"],"names":["sequence","DEFAULT_DIRECTION","callDirections","outbound","DEFAULT_PHONE_NUMBER","DEFAULT_EXTENSION_ID","extensionBody","id","toString","telephonySessionBuildersCache","TelephonySessionBuilder","initParams","_data","_telephonySessionId","_phoneNumber","_direction","_sessionId","_partyStatus","_partyId","_init","telephonySessionId","phoneNumber","direction","sessionId","status","PartyStatusCode","proceeding","toNumber","fromNumber","body","partyId","answered","disconnected","push","data","name","extensionId","telephonySessionMessage","uuid","timestamp","format","subscriptionId","serverId","eventTime","Date","accountId","parties","to","numberData","from","code","mobilePickupData","ccMailboxes","sid","srvLvl","srvLvlExt","missedCall","standAlone","muted","origin","type","createTelephonySession"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;AAiEA,IAAIA,QAAQ,GAAG,EAAf;AACA,IAAMC,iBAAiB,GAAGC,2BAAeC,QAAzC;AACO,IAAMC,oBAAoB,GAAG,cAA7B;;;AAEP,IAAMC,oBAAoB,GAAGC,0BAAcC,EAAd,CAAiBC,QAAjB,EAA7B;;AAmBO,IAAMC,6BAAwD,GAAG,EAAjE;;;IAEDC,uB;AASJ,mCAAYC,UAAZ,EAAqC;AAAA;;AAAA,SAR7BC,KAQ6B;AAAA,SAP7BC,mBAO6B;AAAA,SAN7BC,YAM6B;AAAA,SAL7BC,UAK6B;AAAA,SAJ7BC,UAI6B;AAAA,SAH7BC,YAG6B;AAAA,SAF7BC,QAE6B;;AACnC,SAAKC,KAAL,CAAWR,UAAX;AACD;;;;gCAQc;AAAA,uCALbS,kBAKa;AAAA,UALbA,kBAKa,sCALQ,eAKR;AAAA,kCAJbC,WAIa;AAAA,UAJbA,WAIa,iCAJCjB,oBAID;AAAA,gCAHbkB,SAGa;AAAA,UAHbA,SAGa,+BAHDrB,iBAGC;AAAA,UAFbsB,SAEa,QAFbA,SAEa;AAAA,6BADbC,MACa;AAAA,UADbA,MACa,4BADJC,yBAAgBC,UACZ;AACb,WAAKb,mBAAL,GAA2BO,kBAA3B;AACA,WAAKJ,UAAL,GAAkBO,SAAS,IAAIH,kBAA/B;AACA,WAAKN,YAAL,GAAoBO,WAApB;AACA,WAAKN,UAAL,GAAkBO,SAAlB;AACA,WAAKJ,QAAL,aAAmBE,kBAAnB;AACA,WAAKH,YAAL,GAAoBO,MAApB;AACD;;;8BAESF,U,EAA2B;AACnC,WAAKP,UAAL,GAAkBO,UAAlB;AACA,aAAO,IAAP;AACD;;;2BAEME,O,EAAyB;AAC9B,WAAKP,YAAL,GAAoBO,OAApB;AACA,aAAO,IAAP;AACD;;;uBAEEG,Q,EAAkB;AACnB,WAAKb,YAAL,GAAoBa,QAApB;AACA,aAAO,IAAP;AACD;;;yBAEIC,U,EAAoB;AACvB,WAAKd,YAAL,GAAoBc,UAApB;AACA,aAAO,IAAP;AACD;;;8BAESL,U,EAAmB;AAC3B,WAAKP,UAAL,GAAkBO,UAAlB;AACA,aAAO,IAAP;AACD;;;uCAEkBH,mB,EAA4B;AAC7C,WAAKR,KAAL,CAAWiB,IAAX,CAAgBT,kBAAhB,GAAqCA,mBAArC;AACA,aAAO,IAAP;AACD;;;4BAEOU,Q,EAAiB;AACvB,WAAKZ,QAAL,GAAgBY,QAAhB;AACA,aAAO,IAAP;AACD;;;mCAEc;AACb,aAAO,KAAKN,MAAL,CAAYC,yBAAgBM,QAA5B,CAAP;AACD;;;sCAEiB;AAChB,aAAO,KAAKP,MAAL,CAAYC,yBAAgBO,YAA5B,CAAP;AACD;;;qCAEgB;AACf,aAAO,KAAKV,SAAL,CAAe,SAAf,CAAP;AACD;;;sCAEiB;AAChB,aAAO,KAAKA,SAAL,CAAe,UAAf,CAAP;AACD;;;8BAESD,W,EAAqB;AAC7B,WAAKP,YAAL,GAAoBO,WAApB;AACA,aAAO,IAAP;AACD;;;2BAEM;AACLZ,MAAAA,6BAA6B,CAACwB,IAA9B,CAAmC,IAAnC;AACA,aAAO,KAAKC,IAAZ;AACD;;;wBAEwB;AACvB,aAAO,KAAKrB,mBAAZ;AACD;;;wBAEgB;AACf,aAAO;AACLQ,QAAAA,WAAW,EAAE,KAAKP,YADb;AAELqB,QAAAA,IAAI,EAAE,cAFD;AAGLC,QAAAA,WAAW,EAAE/B;AAHR,OAAP;AAKD;;;wBAEqC;AACpC,6CACKgC,6BADL;AAEEC,QAAAA,IAAI,EAAE,eAFR;AAGEC,QAAAA,SAAS,EAAE,0BAASC,MAAT,EAHb;AAIEC,QAAAA,cAAc,EAAE,eAJlB;AAKEZ,QAAAA,IAAI,kCACCQ,8BAAwBR,IADzB;AAEF7B,UAAAA,QAAQ,EAAEA,QAAQ,EAFhB;AAGFuB,UAAAA,SAAS,EAAE,KAAKP,UAHd;AAIFI,UAAAA,kBAAkB,EAAE,KAAKP,mBAJvB;AAKF6B,UAAAA,QAAQ,EAAE,kBALR;AAMFC,UAAAA,SAAS,EAAEC,IAAI,EANb;AAOFC,UAAAA,SAAS,EAAE,cAPT;AAQFT,UAAAA,WAAW,EAAE/B,oBARX;AASFyC,UAAAA,OAAO,EAAE,CACP;AACEV,YAAAA,WAAW,EAAE/B,oBADf;AAEEE,YAAAA,EAAE,EAAE,KAAKW,QAFX;AAGEI,YAAAA,SAAS,EAAE,KAAKP,UAHlB;AAIEgC,YAAAA,EAAE,EAAE,KAAKC,UAJX;AAKEC,YAAAA,IAAI,EAAE,KAAKD,UALb;AAMExB,YAAAA,MAAM,EAAE;AACN0B,cAAAA,IAAI,EAAE,KAAKjC,YADL;AAENkC,cAAAA,gBAAgB,EAAE;AAChBC,gBAAAA,WAAW,EAAE,CAAC,cAAD,CADG;AAEhBL,gBAAAA,EAAE,EAAE,0CAFY;AAGhBM,gBAAAA,GAAG,EAAE,cAHW;AAIhBC,gBAAAA,MAAM,EAAE,YAJQ;AAKhBC,gBAAAA,SAAS,EAAE;AALK;AAFZ,aANV;AAgBEC,YAAAA,UAAU,EAAE,KAhBd;AAiBEC,YAAAA,UAAU,EAAE,KAjBd;AAkBEC,YAAAA,KAAK,EAAE;AAlBT,WADO,CATP;AA+BFC,UAAAA,MAAM,EAAE;AACNC,YAAAA,IAAI,EAAE;AADA;AA/BN;AALN;AAyCD;;;;;;;;AAGH,SAASC,sBAAT,CAAgClD,UAAhC,EAAyD;AACvD,SAAO,IAAID,uBAAJ,CAA4BC,UAAU,IAAI,EAA1C,CAAP;AACD","sourcesContent":["import { v4 as uuidV4 } from 'uuid';\nimport moment from 'moment';\nimport { PartyStatusCode } from 'ringcentral-call-control/lib/Session';\nimport callDirections from '../../enums/callDirections';\nimport telephonySessionMessage from './data/telephonySessions.json';\nimport extensionBody from './data/extensionInfo.json';\n\n/**\n * Telephony session message boy //https://developers.ringcentral.com/api-reference/Extension-Telephony-Sessions-Event\n * supports:\n * 1. create different telephony status's session;\n * 2. update telephony status;\n * 3. custom sessionId, from, to, direction attribute;\n *\n * @class TelephonySession\n */\nexport type PhoneNumber = {\n  name: string;\n  phoneNumber: string;\n};\n\ntype CallDirectionsKeys = keyof typeof callDirections;\n\ntype CallDirections = typeof callDirections[CallDirectionsKeys];\ntype PartyStatusCodeKeys = keyof typeof PartyStatusCode;\nexport type Party = {\n  extensionId: string;\n  id: string;\n  direction: CallDirections;\n  to: {\n    phoneNumber: string;\n    name: string;\n    extensionId: string;\n  };\n  from: {\n    phoneNumber: string;\n    name: string;\n    extensionId: string;\n  };\n  status: {\n    code: typeof PartyStatusCode[PartyStatusCodeKeys];\n    mobilePickupData: {\n      ccMailboxes: string[];\n      to: string;\n      sid: string;\n      srvLvl: string;\n      srvLvlExt: string;\n    };\n  };\n  missedCall: boolean;\n  standAlone: boolean;\n  muted: boolean;\n};\n\nexport type Origin = {\n  type: string;\n};\n\nexport type Body = {\n  sequence: number;\n  sessionId: string;\n  telephonySessionId: string;\n  serverId: string;\n  eventTime: string;\n  accountId: string;\n  parties: Party[];\n  origin: Origin;\n  extensionId: string;\n};\n\nlet sequence = 10;\nconst DEFAULT_DIRECTION = callDirections.outbound;\nexport const DEFAULT_PHONE_NUMBER = '+16501234567';\n\nconst DEFAULT_EXTENSION_ID = extensionBody.id.toString();\n\nexport interface TelephonySessionInterface {\n  uuid: string;\n  event: string;\n  timestamp: string;\n  subscriptionId: string;\n  ownerId: string;\n  body: Body;\n}\n\ninterface InitParams {\n  telephonySessionId?: string;\n  phoneNumber?: string;\n  direction?: CallDirections;\n  sessionId?: string;\n  status?: PartyStatusCode;\n}\n\nexport const telephonySessionBuildersCache: TelephonySessionBuilder[] = [];\n\nclass TelephonySessionBuilder {\n  private _data: TelephonySessionInterface;\n  private _telephonySessionId: string;\n  private _phoneNumber: string;\n  private _direction: CallDirections;\n  private _sessionId: string;\n  private _partyStatus: PartyStatusCode;\n  private _partyId: string;\n\n  constructor(initParams?: InitParams) {\n    this._init(initParams);\n  }\n\n  _init({\n    telephonySessionId = uuidV4(),\n    phoneNumber = DEFAULT_PHONE_NUMBER,\n    direction = DEFAULT_DIRECTION,\n    sessionId,\n    status = PartyStatusCode.proceeding,\n  }: InitParams) {\n    this._telephonySessionId = telephonySessionId;\n    this._sessionId = sessionId || telephonySessionId;\n    this._phoneNumber = phoneNumber;\n    this._direction = direction;\n    this._partyId = `${telephonySessionId}-1`;\n    this._partyStatus = status;\n  }\n\n  direction(direction: CallDirections) {\n    this._direction = direction;\n    return this;\n  }\n\n  status(status: PartyStatusCode) {\n    this._partyStatus = status;\n    return this;\n  }\n\n  to(toNumber: string) {\n    this._phoneNumber = toNumber;\n    return this;\n  }\n\n  from(fromNumber: string) {\n    this._phoneNumber = fromNumber;\n    return this;\n  }\n\n  sessionId(sessionId: string) {\n    this._sessionId = sessionId;\n    return this;\n  }\n\n  telephonySessionId(telephonySessionId: string) {\n    this._data.body.telephonySessionId = telephonySessionId;\n    return this;\n  }\n\n  partyId(partyId: string) {\n    this._partyId = partyId;\n    return this;\n  }\n\n  setConnected() {\n    return this.status(PartyStatusCode.answered);\n  }\n\n  setDisconnected() {\n    return this.status(PartyStatusCode.disconnected);\n  }\n\n  setInboundCall() {\n    return this.direction('Inbound');\n  }\n\n  setOutboundCall() {\n    return this.direction('Outbound');\n  }\n\n  setNumber(phoneNumber: string) {\n    this._phoneNumber = phoneNumber;\n    return this;\n  }\n\n  done() {\n    telephonySessionBuildersCache.push(this);\n    return this.data;\n  }\n\n  get telephoneSessionId() {\n    return this._telephonySessionId;\n  }\n\n  get numberData() {\n    return {\n      phoneNumber: this._phoneNumber,\n      name: 'Yoda HubSpot',\n      extensionId: DEFAULT_EXTENSION_ID,\n    };\n  }\n\n  get data(): TelephonySessionInterface {\n    return {\n      ...telephonySessionMessage,\n      uuid: uuidV4(),\n      timestamp: moment().format(),\n      subscriptionId: uuidV4(),\n      body: {\n        ...telephonySessionMessage.body,\n        sequence: sequence++,\n        sessionId: this._sessionId,\n        telephonySessionId: this._telephonySessionId,\n        serverId: '10.62.25.111.TAM',\n        eventTime: Date(),\n        accountId: '400144452008',\n        extensionId: DEFAULT_EXTENSION_ID,\n        parties: [\n          {\n            extensionId: DEFAULT_EXTENSION_ID,\n            id: this._partyId,\n            direction: this._direction,\n            to: this.numberData,\n            from: this.numberData,\n            status: {\n              code: this._partyStatus,\n              mobilePickupData: {\n                ccMailboxes: ['400144455008'],\n                to: '#19008@sip-mesdevams.lab.nordigy.ru:5060',\n                sid: '402936472080',\n                srvLvl: '-149699523',\n                srvLvlExt: '390',\n              },\n            },\n            missedCall: false,\n            standAlone: false,\n            muted: false,\n          },\n        ],\n        origin: {\n          type: 'Call',\n        },\n      },\n    };\n  }\n}\n\nfunction createTelephonySession(initParams?: InitParams) {\n  return new TelephonySessionBuilder(initParams || {});\n}\nexport { TelephonySessionBuilder, createTelephonySession, PartyStatusCode };\n"],"file":"telephonySessionBuilder.js"}