{"version":3,"sources":["integration-test/spec-modules/rolesAndPermissions.js"],"names":["mock","authzProfileBody","require","auth","client","rolesAndPermissions","account","alert","describe","timeout","mockClient","isLoginSuccess","clientHistoryRequest","afterEach","loggedIn","logout","it","restore","mockForLogin","console","error","skip","retries","expect","permissions","ReadUserInfo","equal","mockAuthzProfile","authzProfile","filter","p","permission","id","ReadExtensions","undefined","mockForbidden","path","login","state","messages","insufficientPrivilege","to","not"],"mappings":"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","file":"rolesAndPermissions.js","sourcesContent":["import { ensureLogin, containsErrorMessage } from '../utils/HelpUtil';\nimport { waitInSeconds } from '../utils/WaitUtil';\nimport ClientHistoryRequest from '../utils/ClientHistoryRequest';\nimport * as mock from '../mock';\n\nimport permissionsMessages from '../../modules/RolesAndPermissions/permissionsMessages';\n\nconst authzProfileBody = require('../mock/data/authzProfile');\n\nexport default (auth, client, rolesAndPermissions, account, alert) => {\n  describe('AccountExtension:', function () {\n    this.timeout(20000);\n    mock.mockClient(client);\n\n    let isLoginSuccess;\n    const clientHistoryRequest = new ClientHistoryRequest(new Map(), client);\n\n    afterEach(async function () {\n      if (auth.loggedIn) {\n        await auth.logout();\n      }\n      await waitInSeconds(1);\n    });\n\n    it('Should load permissions successfully', async () => {\n      mock.restore();\n      mock.mockForLogin();\n      isLoginSuccess = await ensureLogin(auth, account);\n      if (!isLoginSuccess) {\n        console.error('Skip test case as failed to login with credential ', account);\n        this.skip();\n      }\n      this.retries(2);\n      await waitInSeconds(1);\n      expect(rolesAndPermissions.permissions.ReadUserInfo).equal(true);\n    });\n\n    it('Should not include ReadExtensions permission', async () => {\n      mock.restore();\n      mock.mockForLogin({ mockAuthzProfile: false });\n      mock.authzProfile({\n        permissions: authzProfileBody.permissions.filter(p => p.permission.id !== 'ReadExtensions')\n      });\n      isLoginSuccess = await ensureLogin(auth, account);\n      if (!isLoginSuccess) {\n        console.error('Skip test case as failed to login with credential ', account);\n        this.skip();\n      }\n      this.retries(2);\n      await waitInSeconds(1);\n      expect(rolesAndPermissions.permissions.ReadExtensions).equal(undefined);\n    });\n\n    it('Should show insufficientPrivilege when get 403', async () => {\n      mock.restore();\n      mock.mockForLogin({ mockAuthzProfile: false });\n      mock.mockForbidden({ path: '/restapi/v1.0/account/~/extension/~/authz-profile' });\n      await auth.login({\n        ...account,\n      });\n      await waitInSeconds(3);\n      expect(auth.loggedIn).equal(false);\n      expect(containsErrorMessage(\n        alert.state.messages, permissionsMessages.insufficientPrivilege\n      )).to.not.equal(undefined);\n    });\n  });\n};\n"]}