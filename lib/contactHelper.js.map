{"version":3,"file":"contactHelper.js","names":["_ramda","require","_format","_phoneTypes","_isBlank","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","iter","Symbol","iterator","isArray","len","length","i","arr2","AllContactSourceName","exports","addPhoneToContact","contact","phone","type","isBlank","existedPhone","phoneNumbers","find","number","phoneNumber","phoneType","replace","push","uniqueContactItems","input","arguments","undefined","map","reduce","result","item","itemId","concat","id","NON_ALPHABET_RE","byName","a","b","name1","toLowerCase","name2","isNumber1","isNumber2","localeCompare","sortContactItemsByName","sort","POUND_SIGN","groupByFirstLetterOfName","groups","group","forEach","letter","toLocaleUpperCase","caption","contacts","isSearchHitContact","_ref","lowerSearch","includes","firstName","lastName","x","trim","filter","join","some","email","emails","getFilterContacts","searchFilter","getSearchForPhoneNumbers","_ref2","entityType","searchString","options","isContactHit","_ref3","_contact$profileImage","phoneTypes","extension","isMultipleSiteEnabled","_options$siteCode","formatSameSiteExtension","currentSiteCode","siteCode","contactId","profileImageUrl","profileImage","uri","getMatchContactsByPhoneNumber","_ref4","_ref4$findPhoneNumber","findPhoneNumber","found","matchedContact","assign","isSameSite","_ref5","_ref5$siteCode","extensionNumber","extensionFromContacts","RegExp","isAnExtension","maxExtensionLength","isExtensionExist","_ref6","_options$siteCode2","_ref6$options","getFindPhoneNumber","_ref7","shouldMatchExtension","_ref7$options"],"sources":["lib/contactHelper.ts"],"sourcesContent":["import { reduce } from 'ramda';\n\nimport { formatSameSiteExtension } from '@ringcentral-integration/phone-number/lib/format';\n\nimport { phoneTypes } from '../enums/phoneTypes';\nimport type {\n  ContactGroup,\n  IContact,\n  ContactPhoneNumber,\n  TypedContact,\n  TypedPhoneNumber,\n} from '../interfaces/Contact.model';\nimport { isBlank } from './isBlank';\n\nexport const AllContactSourceName = 'all';\n\nexport function addPhoneToContact(\n  contact: IContact,\n  phone: IContact['phoneNumber'],\n  type: IContact['type'],\n) {\n  if (isBlank(phone)) {\n    return;\n  }\n  const existedPhone = contact.phoneNumbers!.find(\n    (number) => number && number.phoneNumber === phone,\n  );\n  /**\n   * otherFax => fax\n   * businessFax => fax\n   * businessPhone => business\n   * businessPhone2 => business\n   */\n  let phoneType: string;\n  if (/Fax/.test(type)) {\n    phoneType = 'fax';\n  } else {\n    phoneType = type.replace(/Phone2|Phone/, '');\n  }\n  if (existedPhone) {\n    existedPhone.phoneType = phoneType;\n  } else {\n    contact.phoneNumbers!.push({\n      phoneNumber: phone,\n      phoneType,\n    });\n  }\n}\n\nexport function uniqueContactItems(input: IContact[] = []) {\n  const map: Record<string, boolean> = {};\n  return reduce(\n    (result, item) => {\n      const itemId = `${item.type}${item.id}`;\n      if (!map[itemId]) {\n        map[itemId] = true;\n        result.push(item);\n      }\n      return result;\n    },\n    [] as IContact[],\n    input,\n  );\n}\n\nconst NON_ALPHABET_RE = /[^a-z]/i;\nfunction byName(a: IContact, b: IContact) {\n  const name1 = (a.name || '').toLowerCase().replace(/^\\s\\s*/, ''); // trim start\n  const name2 = (b.name || '').toLowerCase().replace(/^\\s\\s*/, ''); // trim start\n  const isNumber1 = /^[0-9]/.test(name1);\n  const isNumber2 = /^[0-9]/.test(name2);\n  // Empty string should be put at the end\n  if (name1.length <= 0 || name2.length <= 0) {\n    return -name1.localeCompare(name2);\n  }\n  if (isNumber1 && isNumber2) {\n    return name1.localeCompare(name2);\n  }\n  if (isNumber1 || isNumber2) {\n    // put number name at last\n    return -name1.localeCompare(name2);\n  }\n  if (NON_ALPHABET_RE.test(name1[0]) && !NON_ALPHABET_RE.test(name2[0])) {\n    return 1;\n  }\n  if (!NON_ALPHABET_RE.test(name1[0]) && NON_ALPHABET_RE.test(name2[0])) {\n    return -1;\n  }\n  return name1.localeCompare(name2);\n}\n\nexport function sortContactItemsByName(input: IContact[] = []) {\n  return input.sort(byName);\n}\n\nconst POUND_SIGN = '#';\nexport function groupByFirstLetterOfName(input: IContact[] = []) {\n  const groups: ContactGroup[] = [];\n  if (input && input.length) {\n    let group: ContactGroup;\n    input.forEach((contact) => {\n      const name = (contact.name || '').replace(/^\\s\\s*/, ''); // trim start\n      let letter = null;\n      if (name.length <= 0 || NON_ALPHABET_RE.test(name[0])) {\n        letter = POUND_SIGN;\n      } else {\n        letter = (name[0] || '').toLocaleUpperCase();\n      }\n      if (!group || group.caption !== letter) {\n        group = {\n          contacts: [],\n          caption: letter,\n          id: letter,\n        };\n        groups.push(group);\n      }\n      group.contacts.push(contact);\n    });\n  }\n  return groups;\n}\n\nexport function isSearchHitContact({\n  lowerSearch,\n  contact,\n}: {\n  lowerSearch: string;\n  contact: IContact;\n}): boolean {\n  return (\n    // search names\n    (!!contact.name && contact.name.toLowerCase().includes(lowerSearch)) ||\n    [contact.firstName, contact.lastName]\n      .map((x) => x && x.trim())\n      .filter((x) => !!x)\n      .join(' ')\n      .toLowerCase()\n      .includes(lowerSearch) ||\n    // search phones\n    (Array.isArray(contact.phoneNumbers) &&\n      contact.phoneNumbers.some(\n        (x) => x.phoneNumber && x.phoneNumber.includes(lowerSearch),\n      )) ||\n    // search emails\n    (!!contact.email && contact.email.toLowerCase() === lowerSearch) ||\n    (Array.isArray(contact.emails) &&\n      contact.emails.map((x) => x && x.toLowerCase()).includes(lowerSearch))\n  );\n}\n\nexport function getFilterContacts(\n  contacts: IContact[],\n  searchFilter: string,\n): IContact[] {\n  if (!searchFilter || isBlank(searchFilter)) {\n    return contacts;\n  }\n  const lowerSearch = searchFilter.toLowerCase();\n  return contacts.filter((contact) =>\n    isSearchHitContact({ lowerSearch, contact }),\n  );\n}\n\nexport function getSearchForPhoneNumbers({\n  contacts,\n  entityType,\n  searchString,\n  options,\n}: {\n  contacts: IContact[];\n  entityType: string;\n  searchString: string;\n  options?: {\n    isMultipleSiteEnabled?: boolean;\n    siteCode?: string;\n  };\n}): TypedPhoneNumber[] {\n  if (!searchString) {\n    return [];\n  }\n  const lowerSearch = searchString.toLowerCase();\n  const result: TypedPhoneNumber[] = [];\n  contacts.forEach((contact) => {\n    if (!Array.isArray(contact.phoneNumbers) || !contact.phoneNumbers.length) {\n      return;\n    }\n    const isContactHit = isSearchHitContact({ lowerSearch, contact });\n    contact.phoneNumbers.forEach(({ phoneType, phoneNumber }) => {\n      if (isContactHit || (phoneNumber && phoneNumber.includes(lowerSearch))) {\n        if (\n          phoneType === phoneTypes.extension &&\n          options?.isMultipleSiteEnabled\n        ) {\n          // Remove site code of same site\n          phoneNumber = formatSameSiteExtension({\n            currentSiteCode: options?.siteCode ?? '',\n            extension: phoneNumber,\n          });\n        }\n        result.push({\n          id: `${contact.id}${phoneNumber}`,\n          contactId: contact.id,\n          name: contact.name || `${contact.firstName} ${contact.lastName}`,\n          type: contact.type,\n          phoneNumber: phoneNumber!,\n          phoneType: phoneType!.replace('Phone', ''),\n          profileImageUrl: contact.profileImage?.uri,\n          entityType,\n        });\n      }\n    });\n  });\n  return result;\n}\n\nexport function getMatchContactsByPhoneNumber({\n  contacts,\n  phoneNumber,\n  entityType,\n  findPhoneNumber = (item: ContactPhoneNumber) =>\n    item.phoneNumber === phoneNumber,\n}: {\n  contacts: IContact[];\n  phoneNumber: string;\n  entityType: string;\n  findPhoneNumber?: (item: ContactPhoneNumber) => boolean;\n}): TypedContact[] {\n  const result: TypedContact[] = [];\n  contacts.forEach((contact) => {\n    const found =\n      contact.phoneNumbers && contact.phoneNumbers.find(findPhoneNumber);\n    if (!found) {\n      return;\n    }\n    const matchedContact = Object.assign({}, contact, {\n      phoneNumbers: [...(contact.phoneNumbers || [])],\n      entityType,\n    });\n    result.push(matchedContact);\n  });\n  return result;\n}\n\nconst isSameSite = ({\n  siteCode = '',\n  extensionNumber,\n  extensionFromContacts,\n}: {\n  siteCode?: string;\n  extensionNumber: string;\n  extensionFromContacts: string;\n}): boolean => {\n  /**\n   * [multiple site number match role]:\n   * Given an account which short extension starts with 0 in the same site, When short extension is equal to 0, it can match.\n   * Otherwise it cannot match.\n   */\n  if (\n    !siteCode ||\n    !/^[0-9]+$/.test(extensionNumber) || // to avoid special character in regular\n    (extensionNumber[0] === '0' && extensionNumber !== '0')\n  ) {\n    return false;\n  }\n\n  /**\n   * [multiple site only]\n   * The full extension number's length is fixed, no need to compute the frequency of 0.\n   * For example, 21022, 210022 would not both exist at the same time\n   */\n  return new RegExp(`^${siteCode}0*${extensionNumber}$`).test(\n    extensionFromContacts,\n  );\n};\n\nexport const isAnExtension = (\n  number: string,\n  maxExtensionLength = 6,\n): boolean => {\n  return number?.length <= maxExtensionLength && number[0] !== '+';\n};\n\n/**\n * check whether an extension is in contacts\n */\nexport const isExtensionExist = ({\n  extensionNumber,\n  extensionFromContacts,\n  options = {},\n}: {\n  /**\n   * extensionNumber need to be checked\n   */\n  extensionNumber: string;\n  /**\n   * extensionNumber from contact\n   */\n  extensionFromContacts: string;\n  options?: {\n    isMultipleSiteEnabled?: boolean;\n    siteCode?: string;\n    maxExtensionLength?: number;\n  };\n}): boolean => {\n  if (extensionFromContacts === extensionNumber) {\n    return true;\n  }\n  if (\n    options.isMultipleSiteEnabled &&\n    isSameSite({\n      siteCode: options?.siteCode ?? '',\n      extensionNumber,\n      extensionFromContacts,\n    })\n  ) {\n    return true;\n  }\n  return false;\n};\n\nexport const getFindPhoneNumber =\n  ({\n    phoneNumber,\n    shouldMatchExtension,\n    options = {},\n  }: {\n    phoneNumber: string;\n    shouldMatchExtension: boolean;\n    options?: {\n      isMultipleSiteEnabled?: boolean;\n      siteCode?: string;\n      maxExtensionLength?: number;\n    };\n  }) =>\n  (item: ContactPhoneNumber) => {\n    if (item.phoneType === phoneTypes.extension && shouldMatchExtension) {\n      return isExtensionExist({\n        extensionNumber: phoneNumber,\n        extensionFromContacts: item.phoneNumber!,\n        options,\n      });\n    }\n    return item.phoneNumber === phoneNumber;\n  };\n"],"mappings":"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"}