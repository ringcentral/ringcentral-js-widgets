{"version":3,"file":"heartBeat.js","names":["HeartBeat","_createClass","key","get","_window","window","localStorage","_getStatusByLocal","_heartBeat","success","working","prefix","_heartBeatIntervalTime","_classCallCheck","concat","intervalId","value","heartBeatOnWorking","_this","_setLocalTime","setInterval","heartBeatOnSuccess","_this2","destroy","clearInterval","setItem","Date","now","toString","statusKey","Number","getItem","exports"],"sources":["lib/heartBeat.ts"],"sourcesContent":["export class HeartBeat {\n  private _heartBeat = {\n    success: {\n      key: `${this.prefix}_success`,\n      intervalId: null,\n    },\n    working: {\n      key: `${this.prefix}_working`,\n      intervalId: null,\n    },\n  };\n\n  get localStorage() {\n    return window?.localStorage;\n  }\n\n  get isSuccessByLocal() {\n    return this._getStatusByLocal(this._heartBeat.success.key);\n  }\n\n  get isWorkingByLocal() {\n    return this._getStatusByLocal(this._heartBeat.working.key);\n  }\n\n  constructor(private prefix: string, private _heartBeatIntervalTime: number) {}\n\n  heartBeatOnWorking() {\n    if (typeof this._heartBeat.working === 'number') return;\n\n    this._setLocalTime(this._heartBeat.working.key);\n\n    this._heartBeat.working.intervalId = setInterval(() => {\n      this._setLocalTime(this._heartBeat.working.key);\n    }, this._heartBeatIntervalTime);\n  }\n\n  heartBeatOnSuccess() {\n    if (typeof this._heartBeat.success === 'number') return;\n\n    this._heartBeat.success.intervalId = setInterval(() => {\n      this._setLocalTime(this._heartBeat.success.key);\n    }, this._heartBeatIntervalTime);\n  }\n\n  destroy() {\n    if (this._heartBeat.success.intervalId) {\n      clearInterval(this._heartBeat.success.intervalId);\n      this._heartBeat.success.intervalId = null;\n    }\n\n    if (this._heartBeat.working.intervalId) {\n      clearInterval(this._heartBeat.working.intervalId);\n      this._heartBeat.working.intervalId = null;\n    }\n  }\n\n  private _setLocalTime(key: string) {\n    this.localStorage.setItem(key, Date.now().toString());\n  }\n\n  private _getStatusByLocal(statusKey: string) {\n    return (\n      this.localStorage &&\n      Date.now() - Number(this.localStorage.getItem(statusKey)) <\n        this._heartBeatIntervalTime * 2 - 100\n    );\n  }\n}\n"],"mappings":"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"}