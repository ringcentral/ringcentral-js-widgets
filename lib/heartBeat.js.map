{"version":3,"file":"heartBeat.js","names":["HeartBeat","exports","prefix","_heartBeatIntervalTime","_classCallCheck","_heartBeat","success","key","concat","intervalId","working","_createClass","get","_window","window","localStorage","_getStatusByLocal","value","heartBeatOnWorking","_this","_setLocalTime","setInterval","heartBeatOnSuccess","_this2","destroy","clearInterval","setItem","Date","now","toString","statusKey","Number","getItem"],"sources":["lib/heartBeat.ts"],"sourcesContent":["export class HeartBeat {\n  private _heartBeat = {\n    success: {\n      key: `${this.prefix}_success`,\n      intervalId: null,\n    },\n    working: {\n      key: `${this.prefix}_working`,\n      intervalId: null,\n    },\n  };\n\n  get localStorage() {\n    return window?.localStorage;\n  }\n\n  get isSuccessByLocal() {\n    return this._getStatusByLocal(this._heartBeat.success.key);\n  }\n\n  get isWorkingByLocal() {\n    return this._getStatusByLocal(this._heartBeat.working.key);\n  }\n\n  constructor(private prefix: string, private _heartBeatIntervalTime: number) {}\n\n  heartBeatOnWorking() {\n    if (typeof this._heartBeat.working === 'number') return;\n\n    this._setLocalTime(this._heartBeat.working.key);\n\n    this._heartBeat.working.intervalId = setInterval(() => {\n      this._setLocalTime(this._heartBeat.working.key);\n    }, this._heartBeatIntervalTime);\n  }\n\n  heartBeatOnSuccess() {\n    if (typeof this._heartBeat.success === 'number') return;\n\n    this._heartBeat.success.intervalId = setInterval(() => {\n      this._setLocalTime(this._heartBeat.success.key);\n    }, this._heartBeatIntervalTime);\n  }\n\n  destroy() {\n    if (this._heartBeat.success.intervalId) {\n      clearInterval(this._heartBeat.success.intervalId);\n      this._heartBeat.success.intervalId = null;\n    }\n\n    if (this._heartBeat.working.intervalId) {\n      clearInterval(this._heartBeat.working.intervalId);\n      this._heartBeat.working.intervalId = null;\n    }\n  }\n\n  private _setLocalTime(key: string) {\n    this.localStorage.setItem(key, Date.now().toString());\n  }\n\n  private _getStatusByLocal(statusKey: string) {\n    return (\n      this.localStorage &&\n      Date.now() - Number(this.localStorage.getItem(statusKey)) <\n        this._heartBeatIntervalTime * 2 - 100\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}