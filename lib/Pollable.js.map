{"version":3,"file":"Pollable.js","names":["_RcModule2","_interopRequireDefault","require","_di","_dec","_class","e","__esModule","ownKeys","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","_objectDestructuringEmpty","TypeError","_classCallCheck","a","n","_defineProperties","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","_setPrototypeOf","Pollable","exports","Library","deps","dep","optional","_RcModule","_ref","_this","options","assign","_tabManager","_timeoutId","get","Error","ttl","fetchData","_clearTimeout","clearTimeout","_startPolling","_this2","undefined","timestamp","pollingInterval","Date","now","setTimeout","active","timeToRetry","_retry","_this3","RcModule"],"sources":["lib/Pollable.ts"],"sourcesContent":["import RcModule from './RcModule';\nimport { Library } from './di';\n\n@Library({\n  deps: [{ dep: 'PollableOptions', optional: true }],\n})\nexport default class Pollable extends RcModule {\n  _tabManager: any;\n  _timeoutId: any;\n  constructor({ ...options }) {\n    super({\n      ...options,\n    });\n    this._timeoutId = null;\n  }\n\n  get timestamp() {\n    throw new Error('timestamp is not defined');\n  }\n\n  get ttl() {\n    throw new Error('ttl is not defined');\n  }\n\n  get pollingInterval() {\n    return this.ttl;\n  }\n\n  get timeToRetry() {\n    throw new Error('timeToRetry is not defined');\n  }\n\n  fetchData() {\n    throw new Error('fetchData is not implemented');\n  }\n\n  _clearTimeout() {\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n\n  // @ts-expect-error TS(2365): Operator '+' cannot be applied to types 'void' and... Remove this comment to see the full error message\n  _startPolling(t = this.timestamp + this.pollingInterval + 10 - Date.now()) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this._tabManager || this._tabManager.active) {\n        // @ts-expect-error TS(1345): An expression of type 'void' cannot be tested for ... Remove this comment to see the full error message\n        if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n          this.fetchData();\n        } else {\n          this._startPolling();\n        }\n        // @ts-expect-error TS(1345): An expression of type 'void' cannot be tested for ... Remove this comment to see the full error message\n      } else if (this.timestamp && Date.now() - this.timestamp < this.ttl) {\n        this._startPolling();\n      } else {\n        // @ts-expect-error TS(2345): Argument of type 'void' is not assignable to param... Remove this comment to see the full error message\n        this._startPolling(this.timeToRetry);\n      }\n    }, t);\n  }\n\n  _retry(t = this.timeToRetry) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      // @ts-expect-error TS(1345): An expression of type 'void' cannot be tested for ... Remove this comment to see the full error message\n      if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n        if (!this._tabManager || this._tabManager.active) {\n          this.fetchData();\n        } else {\n          // continue retry checks in case tab becomes main tab\n          this._retry();\n        }\n      }\n      // @ts-expect-error TS(2769): No overload matches this call.\n    }, t);\n  }\n}\n"],"mappings":"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","ignoreList":[]}