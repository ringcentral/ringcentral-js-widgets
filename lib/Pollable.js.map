{"version":3,"file":"Pollable.js","names":["_RcModule2","_interopRequireDefault","require","_di","_dec","_class","e","__esModule","ownKeys","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","_classCallCheck","a","n","TypeError","_defineProperties","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","Pollable","Library","deps","dep","optional","_RcModule","_super","_ref","_this","options","assign","_tabManager","_timeoutId","fetchData","Error","_clearTimeout","clearTimeout","_startPolling","_this2","undefined","timestamp","pollingInterval","Date","now","setTimeout","active","ttl","timeToRetry","_retry","_this3","get","RcModule","exports"],"sources":["lib/Pollable.ts"],"sourcesContent":["import RcModule from './RcModule';\nimport { Library } from './di';\n\n@Library({\n  deps: [{ dep: 'PollableOptions', optional: true }],\n})\nexport default class Pollable extends RcModule {\n  _tabManager: any;\n  _timeoutId: any;\n  constructor({ ...options }) {\n    super({\n      ...options,\n    });\n    this._timeoutId = null;\n  }\n\n  get timestamp() {\n    throw new Error('timestamp is not defined');\n  }\n\n  get ttl() {\n    throw new Error('ttl is not defined');\n  }\n\n  get pollingInterval() {\n    return this.ttl;\n  }\n\n  get timeToRetry() {\n    throw new Error('timeToRetry is not defined');\n  }\n\n  fetchData() {\n    throw new Error('fetchData is not implemented');\n  }\n\n  _clearTimeout() {\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n\n  // @ts-expect-error TS(2365): Operator '+' cannot be applied to types 'void' and... Remove this comment to see the full error message\n  _startPolling(t = this.timestamp + this.pollingInterval + 10 - Date.now()) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this._tabManager || this._tabManager.active) {\n        // @ts-expect-error TS(1345): An expression of type 'void' cannot be tested for ... Remove this comment to see the full error message\n        if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n          this.fetchData();\n        } else {\n          this._startPolling();\n        }\n        // @ts-expect-error TS(1345): An expression of type 'void' cannot be tested for ... Remove this comment to see the full error message\n      } else if (this.timestamp && Date.now() - this.timestamp < this.ttl) {\n        this._startPolling();\n      } else {\n        // @ts-expect-error TS(2345): Argument of type 'void' is not assignable to param... Remove this comment to see the full error message\n        this._startPolling(this.timeToRetry);\n      }\n    }, t);\n  }\n\n  _retry(t = this.timeToRetry) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      // @ts-expect-error TS(1345): An expression of type 'void' cannot be tested for ... Remove this comment to see the full error message\n      if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n        if (!this._tabManager || this._tabManager.active) {\n          this.fetchData();\n        } else {\n          // continue retry checks in case tab becomes main tab\n          this._retry();\n        }\n      }\n      // @ts-expect-error TS(2769): No overload matches this call.\n    }, t);\n  }\n}\n"],"mappings":"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","ignoreList":[]}