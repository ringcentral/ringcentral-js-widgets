{"version":3,"file":"Pollable.js","names":["_di","require","_RcModule2","_interopRequireDefault","_dec","_class","obj","__esModule","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_toPropertyKey","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","prototype","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","Pollable","Library","deps","dep","optional","_RcModule","_super","_ref","_this","options","assign","_timeoutId","fetchData","Error","_clearTimeout","clearTimeout","_startPolling","_this2","t","timestamp","pollingInterval","Date","now","setTimeout","_tabManager","active","ttl","timeToRetry","_retry","_this3","get","RcModule","exports"],"sources":["lib/Pollable.ts"],"sourcesContent":["import { Library } from './di';\nimport RcModule from './RcModule';\n\n@Library({\n  deps: [{ dep: 'PollableOptions', optional: true }],\n})\nexport default class Pollable extends RcModule {\n  constructor({ ...options }) {\n    super({\n      ...options,\n    });\n    this._timeoutId = null;\n  }\n\n  get timestamp() {\n    throw new Error('timestamp is not defined');\n  }\n\n  get ttl() {\n    throw new Error('ttl is not defined');\n  }\n\n  get pollingInterval() {\n    return this.ttl;\n  }\n\n  get timeToRetry() {\n    throw new Error('timeToRetry is not defined');\n  }\n\n  fetchData() {\n    throw new Error('fetchData is not implemented');\n  }\n\n  _clearTimeout() {\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n\n  _startPolling(t = this.timestamp + this.pollingInterval + 10 - Date.now()) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this._tabManager || this._tabManager.active) {\n        if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n          this.fetchData();\n        } else {\n          this._startPolling();\n        }\n      } else if (this.timestamp && Date.now() - this.timestamp < this.ttl) {\n        this._startPolling();\n      } else {\n        this._startPolling(this.timeToRetry);\n      }\n    }, t);\n  }\n\n  _retry(t = this.timeToRetry) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n        if (!this._tabManager || this._tabManager.active) {\n          this.fetchData();\n        } else {\n          // continue retry checks in case tab becomes main tab\n          this._retry();\n        }\n      }\n    }, t);\n  }\n}\n"],"mappings":"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"}