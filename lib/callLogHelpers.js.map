{"version":3,"file":"callLogHelpers.js","names":["_ObjectMap","require","_phoneNumber","_dayjs","_interopRequireDefault","_ramda","_callActions","_callDirections","_callResults","_telephonyStatus","_terminationTypes","e","__esModule","_typeof","o","Symbol","iterator","constructor","prototype","ownKeys","r","t","Object","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","toPrimitive","call","TypeError","String","Number","isInbound","undefined","direction","callDirections","inbound","isOutbound","outbound","isExtensionCall","callItem","mainCompanyNumbers","_callItem$toMatches","_callItem$fromMatches","isCompanyNumber","phoneInfo","phoneNumber","includes","recipientCallInfo","from","to","toMatches","fromMatches","find","match","_match$phoneNumbers","type","hasExtensionMatch","extensionNumber","phoneMatch","phoneNumbers","some","phone","_match$phoneNumbers2","getWebphoneSessionDisplayName","currentSession","fromUserName","toUserName","getTelephoneDisplayName","fromName","toName","isRinging","telephonyStatus","telephonyStatuses","ringing","isRingingInboundCall","callResultsToMissedMap","ObjectMap","fromObject","reduce","result","key","callResults","item","missed","hangUp","busy","voicemail","rejected","isMissed","hasRingingCalls","calls","isEnded","noCall","terminationType","terminationTypes","hasEndedCalls","isOnHold","onHold","isIntermediateCall","intermediate","isSelfCall","sortBySessionId","a","b","sessionId","sortByStartTime","startTime","normalizeStartTime","dayjs","Date","valueOf","normalizeFromTo","areTwoLegs","Math","abs","parseInt","isSameLocalNumber","action","callActions","phoneCall","ringOutWeb","ringOutPC","ringOutMobile","removeInboundRingOutLegs","output","outbounds","outboundIndex","findIndex","splice","outboundLeg","inboundLeg","_inbound$from","isValidNumber","concat","removeDuplicateIntermediateCalls","resultCalls","indexMap","isIntermediate","index","removeDuplicateSelfCalls","isSelf","getPhoneNumber","isEmpty","_call$to","_call$from","getPhoneNumberMatches","_call$to2","_call$from2","isOutboundCall","isInboundCall","matches"],"sources":["lib/callLogHelpers.ts"],"sourcesContent":["import type ActiveCallInfoWithoutSIP from '@rc-ex/core/lib/definitions/ActiveCallInfoWithoutSIP';\nimport type CallLogRecord from '@rc-ex/core/lib/definitions/CallLogRecord';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\nimport {\n  isSameLocalNumber,\n  isValidNumber,\n} from '@ringcentral-integration/phone-number';\nimport dayjs from 'dayjs';\nimport { find, isEmpty, reduce } from 'ramda';\n\nimport { callActions } from '../enums/callActions';\nimport callDirections from '../enums/callDirections';\nimport type { CallResultsKey } from '../enums/callResults';\nimport { callResults } from '../enums/callResults';\nimport telephonyStatuses from '../enums/telephonyStatus';\nimport { terminationTypes } from '../enums/terminationTypes';\nimport type { Call, CallerInfo } from '../interfaces/Call.interface';\nimport type { ActiveCall } from '../interfaces/Presence.model';\n\n// import i18n from './i18n';\n\n/* call direction helpers */\nexport function isInbound(call: { direction?: string } = {}) {\n  return call.direction === callDirections.inbound;\n}\n\nexport function isOutbound(call: { direction?: string } = {}) {\n  return call.direction === callDirections.outbound;\n}\n\nexport function isExtensionCall(\n  callItem: Call,\n  mainCompanyNumbers: (string | undefined)[],\n): boolean {\n  const isCompanyNumber = (phoneInfo: CallerInfo | undefined): boolean => {\n    if (\n      phoneInfo?.phoneNumber &&\n      mainCompanyNumbers?.includes(phoneInfo.phoneNumber)\n    ) {\n      return true;\n    }\n    return false;\n  };\n\n  const isInbound = (call: Call): boolean => call.direction === 'Inbound';\n  const isOutbound = (call: Call): boolean => call.direction === 'Outbound';\n\n  const recipientCallInfo = isInbound(callItem) ? callItem.from : callItem.to;\n\n  if (isCompanyNumber(recipientCallInfo)) {\n    return true;\n  }\n\n  const toMatches = callItem.toMatches ?? [];\n  const fromMatches = callItem.fromMatches ?? [];\n  const to = callItem.to;\n  const from = callItem.from;\n\n  if (isOutbound(callItem) && toMatches?.length) {\n    return !!toMatches.find((match: any) => {\n      if (match.type !== 'company') {\n        return false;\n      }\n\n      const hasExtensionMatch =\n        match.extensionNumber &&\n        (match.extensionNumber === to?.phoneNumber ||\n          match.extensionNumber === to?.extensionNumber);\n\n      if (hasExtensionMatch) {\n        return true;\n      }\n\n      const phoneMatch = !!match.phoneNumbers?.some(\n        (phone: { phoneNumber: string }) =>\n          phone.phoneNumber === to?.phoneNumber,\n      );\n      return phoneMatch;\n    });\n  } else if (isInbound(callItem) && fromMatches?.length) {\n    return !!fromMatches.find((match: any) => {\n      if (match.type !== 'company') {\n        return false;\n      }\n\n      const hasExtensionMatch =\n        match.extensionNumber &&\n        (match.extensionNumber === from?.phoneNumber ||\n          match.extensionNumber === from?.extensionNumber);\n\n      if (hasExtensionMatch) {\n        return true;\n      }\n\n      const phoneMatch = !!match.phoneNumbers?.some(\n        (phone: { phoneNumber: string }) =>\n          phone.phoneNumber === from?.phoneNumber,\n      );\n      return phoneMatch;\n    });\n  }\n  return false;\n}\n\n// get caller id name for webphone session\nexport function getWebphoneSessionDisplayName(\n  currentSession: Call['webphoneSession'],\n) {\n  if (!currentSession) {\n    return null;\n  }\n\n  return currentSession.direction === callDirections.inbound\n    ? currentSession.fromUserName\n    : currentSession.toUserName;\n}\n\n// get caller id name for telephone\nexport function getTelephoneDisplayName(call: Call) {\n  if (!call) {\n    return null;\n  }\n\n  return call.direction === callDirections.inbound\n    ? call.fromName\n    : call.toName;\n}\n\n/* status helpers */\nexport function isRinging(call: Call) {\n  if (!call) return false;\n\n  return call.telephonyStatus === telephonyStatuses.ringing;\n}\nexport function isRingingInboundCall(call: Call) {\n  return isRinging(call) && isInbound(call);\n}\n\nconst callResultsToMissedMap = ObjectMap.fromObject(\n  reduce<string, Record<string, boolean>>(\n    (result, key) => {\n      const value = callResults[key as CallResultsKey];\n      result[value] = !!find(\n        (item) => item === value,\n        [\n          callResults.missed,\n          callResults.hangUp,\n          // callResults.HangUp,\n          callResults.busy,\n          callResults.voicemail,\n          callResults.rejected,\n        ],\n      );\n      return result;\n    },\n    {},\n    Object.keys(callResults),\n  ),\n);\n\nexport function isMissed(\n  call: Pick<Call, 'result'> | Pick<CallLogRecord, 'result'> = {},\n) {\n  return !!callResultsToMissedMap[call.result!];\n}\n\nexport function hasRingingCalls(calls: Call[] = []) {\n  return !!calls.find(isRinging);\n}\n\nexport function isEnded(call: Partial<ActiveCall> = {}) {\n  return (\n    call.telephonyStatus === telephonyStatuses.noCall &&\n    call.terminationType === terminationTypes.final\n  );\n}\n\nexport function hasEndedCalls(calls: ActiveCall[]) {\n  return !!calls.find(isEnded);\n}\n\nexport function isOnHold(call: { telephonyStatus?: string } = {}) {\n  return call.telephonyStatus === telephonyStatuses.onHold;\n}\n\nexport function isIntermediateCall(call: ActiveCallInfoWithoutSIP) {\n  return call.terminationType === terminationTypes.intermediate;\n}\n\nexport function isSelfCall(call: Partial<ActiveCall> = {}) {\n  if (call.to && call.from) {\n    return call.to.phoneNumber === call.from.phoneNumber;\n  }\n  return false;\n}\n\n/* sort functions */\n\nexport function sortBySessionId(\n  a: { sessionId: string },\n  b: { sessionId: string },\n) {\n  if (a.sessionId === b.sessionId) return 0;\n  return a.sessionId > b.sessionId ? 1 : -1;\n}\n\n// TODO: fix `ActiveCall` startTime optional type\nexport function sortByStartTime(\n  a: { startTime?: number | string },\n  b: { startTime?: number | string },\n) {\n  if (a.startTime === b.startTime) return 0;\n  return a.startTime! > b.startTime! ? -1 : 1;\n}\n\nexport function normalizeStartTime<T extends { startTime?: number | string }>(\n  item: T,\n) {\n  const result: T = {\n    ...item,\n  };\n  if (item.startTime) {\n    // Fix: Safari doesn't support timezone offset\n    // `startTime` might switch between `2019-10-18T08:18:47.972+0000`\n    // and `2019-10-18T08:18:47.972Z`\n    // dayjs construction using a non-iso string is deprecated\n    result.startTime = dayjs(new Date(item.startTime)).valueOf();\n  }\n  return result;\n}\n\nexport function normalizeFromTo(call: ActiveCallInfoWithoutSIP) {\n  return {\n    ...call,\n    from:\n      typeof call.from === 'object' ? call.from : { phoneNumber: call.from },\n    to: typeof call.to === 'object' ? call.to : { phoneNumber: call.to },\n  };\n}\n\n/* ringout leg helpers */\nexport function areTwoLegs(inbound: ActiveCall, outbound: ActiveCall) {\n  if (isInbound(inbound) && isOutbound(outbound)) {\n    switch (\n      Math.abs(\n        parseInt(inbound.sessionId!, 10) - parseInt(outbound.sessionId!, 10),\n      )\n    ) {\n      case 1000:\n      case 2000:\n      case 3000:\n      case 4000: {\n        // presence\n        if (\n          inbound.from &&\n          inbound.to &&\n          outbound.from &&\n          outbound.to &&\n          isSameLocalNumber(\n            inbound.from.phoneNumber,\n            outbound.to.phoneNumber,\n          ) &&\n          isSameLocalNumber(inbound.to.phoneNumber, outbound.from.phoneNumber)\n        ) {\n          return true;\n        }\n        // call-log\n        if (\n          inbound.from &&\n          inbound.to &&\n          outbound.from &&\n          outbound.to &&\n          inbound.action === callActions.phoneCall &&\n          (outbound.action === callActions.ringOutWeb ||\n            outbound.action === callActions.ringOutPC ||\n            outbound.action === callActions.ringOutMobile) &&\n          (inbound.from.phoneNumber === outbound.from.phoneNumber ||\n            inbound.from.extensionNumber === outbound.from.extensionNumber) &&\n          inbound.to.phoneNumber === outbound.to.phoneNumber\n        ) {\n          return true;\n        }\n        break;\n      }\n      default:\n        return false;\n    }\n  }\n  return false;\n}\n\nexport function removeInboundRingOutLegs(calls: ActiveCall[]) {\n  const output: ActiveCall[] = [];\n  const outbounds = calls.filter(isOutbound);\n  calls.filter(isInbound).forEach((inbound) => {\n    const outboundIndex = outbounds.findIndex((call) =>\n      areTwoLegs(inbound, call),\n    );\n    if (outboundIndex > -1) {\n      const outbound = outbounds.splice(outboundIndex, 1)[0];\n\n      if (inbound.action && outbound.action) {\n        // from call-log\n        const call = {\n          ...outbound,\n          outboundLeg: outbound,\n          inboundLeg: inbound,\n          from: {\n            ...inbound.from,\n          },\n          to: {\n            ...inbound.to,\n          },\n          result: inbound.result,\n        };\n        output.push(call);\n      } else {\n        const call = {\n          ...outbound,\n          outboundLeg: outbound,\n          inboundLeg: inbound,\n        };\n        // Handle inboundLeg.from is '+19072028624', but outboundLeg.to is '9072028624'\n        // https://jira_domain/browse/RCINT-3127\n        if (\n          inbound.from &&\n          // TODO: should confirm that type, not met\n          // @ts-expect-error TS(2769): No overload matches this call.\n          isValidNumber(inbound.from?.phoneNumber) &&\n          isSameLocalNumber(\n            inbound.from.phoneNumber,\n            outbound.to && outbound.to.phoneNumber,\n          )\n        ) {\n          call.to = {\n            ...outbound.to,\n            phoneNumber: inbound.from.phoneNumber,\n          };\n          outbound.to.phoneNumber = inbound.from.phoneNumber;\n        }\n        if (isOnHold(inbound)) {\n          call.telephonyStatus = telephonyStatuses.onHold;\n        }\n        output.push(call);\n      }\n\n      // output.push(outbound);\n    } else {\n      output.push(inbound);\n    }\n  });\n  return output.concat(outbounds);\n}\n\nexport function removeDuplicateIntermediateCalls(\n  calls: ActiveCallInfoWithoutSIP[],\n) {\n  const resultCalls: ActiveCallInfoWithoutSIP[] = [];\n  const indexMap: Record<\n    string,\n    {\n      isIntermediate: boolean;\n      index: number;\n    }\n  > = {};\n  calls.forEach((call) => {\n    const isIntermediate = isIntermediateCall(call);\n    const sessionId = call.sessionId!;\n    if (!indexMap[sessionId]) {\n      indexMap[sessionId] = {\n        index: resultCalls.length,\n        isIntermediate,\n      };\n      resultCalls.push(call);\n    } else if (!isIntermediate) {\n      indexMap[sessionId].isIntermediate = false;\n      resultCalls[indexMap[sessionId].index] = call;\n    }\n  });\n  return resultCalls;\n}\n\n// there are two active calls with same sessionId when user call self.\nexport function removeDuplicateSelfCalls(calls: ActiveCall[]) {\n  const resultCalls: ActiveCall[] = [];\n  const indexMap: Record<\n    string,\n    {\n      index: number;\n      isSelf: boolean;\n    }\n  > = {};\n  calls.forEach((call) => {\n    const isSelf = isSelfCall(call);\n    const sessionId = call.sessionId!;\n\n    if (!indexMap[sessionId]) {\n      indexMap[sessionId] = {\n        index: resultCalls.length,\n        isSelf,\n      };\n      resultCalls.push(call);\n    } else if (!isSelf) {\n      indexMap[sessionId].isSelf = false;\n      resultCalls[indexMap[sessionId].index] = call;\n    }\n  });\n  return resultCalls;\n}\n\nexport function getPhoneNumber(call: Partial<Call> = {}) {\n  if (isEmpty(call)) {\n    return undefined;\n  }\n  const { to = {}, from = {} } = call;\n  if (isOutbound(call)) {\n    return to.phoneNumber || to.extensionNumber;\n  }\n  return from.phoneNumber || from.extensionNumber;\n}\n\n// Get phone number and matches.\nexport function getPhoneNumberMatches(call: Partial<Call> = {}) {\n  const {\n    to = {},\n    from = {},\n    // sessionId,\n    toMatches,\n    fromMatches,\n  } = call;\n  if (isEmpty(call)) {\n    return {};\n  }\n  const isOutboundCall = isOutbound(call);\n  const isInboundCall = isInbound(call);\n  let phoneNumber = undefined;\n  let matches = undefined;\n  if (isOutboundCall) {\n    phoneNumber = to.phoneNumber || to.extensionNumber;\n    matches = toMatches;\n  } else if (isInboundCall) {\n    phoneNumber = from.phoneNumber || from.extensionNumber;\n    matches = fromMatches;\n  }\n  // if (!phoneNumber || !matches) {\n  //   console.warn(`Call sessionId: ${sessionId} is abnormal data.`);\n  // }\n  return {\n    phoneNumber,\n    matches,\n  };\n}\n"],"mappings":"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","ignoreList":[]}