{"version":3,"file":"MessageTransport.js","names":["_uuid","require","_TransportBase2","_MessageTransporters","_excluded","_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","_objectWithoutProperties","_objectWithoutPropertiesLoose","indexOf","propertyIsEnumerable","hasOwnProperty","_classCallCheck","_defineProperties","key","_createClass","_toPrimitive","_typeof","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","_assertThisInitialized","ReferenceError","Boolean","valueOf","_inherits","_setPrototypeOf","TRANSPORTER_TYPES","exports","POST_MESSAGE","EVENT_EMITTER","MessageTransport","_TransportBase","_ref","_this","_ref$transporterType","transporterType","_ref$transporterDirec","transporterDirection","TRANSPORTER_DIRECTION","TO_EXTERNAL","_ref$targetWindow","targetWindow","window","origin","options","name","_addReceiver","_createEmitter","_targetWindow","_myRequests","_othersRequests","_transporter","_origin","_postMessage","_onMessage","event","_event$data","data","type","payload","requestId","result","error","_events","emit","response","has","get","reject","Error","request","set","dispose","PostMessageTransporter","EventEmitterTransporter","direction","addReceiver","createEmitter","Map","addListeners","_ref2","on","_request","_callee","_ref3","_this2","promise","timeout","_context","v4","_timeout","setTimeout","undefined","concat","JSON","stringify","clearTimeout","_x","send","_ref4","_ref5","message","TransportBase"],"sources":["lib/MessageTransport/MessageTransport.ts"],"sourcesContent":["import { v4 } from 'uuid';\n\nimport { TransportBase, type TransportBaseProps } from '../TransportBase';\nimport type { TransportResponseData } from '../TransportInteractionBase';\n\nimport type { TransporterDirection } from './MessageTransporters';\nimport {\n  EventEmitterTransporter,\n  PostMessageTransporter,\n  TRANSPORTER_DIRECTION,\n} from './MessageTransporters';\n\ntype MessageTransportListener<T = any, K = {}> = (params: {\n  requestId: string;\n  payload: MessageTransportPayload<T, K>;\n}) => any;\n\ntype MessagePushTransportListener<T = any, K = {}> = (\n  payload: MessageTransportPayload<T, K>,\n) => any;\n\nexport type MessageTransportPayload<T = any, K = {}> = {\n  requestType: string;\n  data?: T;\n} & K;\n\nexport interface MessageTransportResponse {\n  requestId: string;\n  result: any;\n  error?: Error | string;\n}\n\nexport const TRANSPORTER_TYPES = {\n  POST_MESSAGE: 'postMessage',\n  EVENT_EMITTER: 'eventEmitter',\n} as const;\n\nexport type TransporterTypes =\n  (typeof TRANSPORTER_TYPES)[keyof typeof TRANSPORTER_TYPES];\n\nexport interface MessageTransportProps {\n  transporterDirection?: TransporterDirection;\n  targetWindow?: Window;\n  origin?: string;\n  transporterType?: TransporterTypes;\n}\n\ntype MessageTransportRequestData<T = any, K = {}> = {\n  payload: MessageTransportPayload<T, K>;\n};\n\ntype Transporter = EventEmitterTransporter | PostMessageTransporter;\n\nexport default class MessageTransport extends TransportBase {\n  private _addReceiver: Transporter['addReceiver'];\n  private _createEmitter: Transporter['createEmitter'];\n  private _targetWindow: Window;\n  private _myRequests: Map<any, any>;\n  private _othersRequests: Map<any, any>;\n  private _transporter: Transporter;\n  _origin?: string;\n  _postMessage: (args: any) => void;\n\n  constructor({\n    transporterType = TRANSPORTER_TYPES.POST_MESSAGE,\n    transporterDirection = TRANSPORTER_DIRECTION.TO_EXTERNAL,\n    targetWindow = window,\n    origin,\n    ...options\n  }: MessageTransportProps & Omit<TransportBaseProps, 'name'>) {\n    super({\n      ...options,\n      name: 'MessageTransport',\n    });\n    switch (transporterType) {\n      case TRANSPORTER_TYPES.EVENT_EMITTER:\n        this._transporter = new EventEmitterTransporter({\n          direction: transporterDirection,\n        });\n        break;\n      default:\n      case TRANSPORTER_TYPES.POST_MESSAGE:\n        this._transporter = new PostMessageTransporter();\n        break;\n    }\n\n    this._addReceiver = this._transporter.addReceiver;\n    this._createEmitter = this._transporter.createEmitter;\n\n    this._targetWindow = targetWindow;\n    this._origin = origin;\n    this._myRequests = new Map();\n    this._othersRequests = new Map();\n    this._postMessage = this._createEmitter(this._targetWindow);\n    this._addReceiver(this._onMessage);\n  }\n\n  _onMessage = (event: MessageEvent) => {\n    // TODO: confirm if the message is from iframe\n    if (this._origin && event.origin !== this._origin) {\n      return;\n    }\n    const { type, payload, requestId, result, error } = event.data;\n    switch (type) {\n      case this._events.push:\n        if (payload) {\n          this.emit(this._events.push, payload);\n        }\n        break;\n      case this._events.response:\n        if (requestId && this._myRequests.has(requestId)) {\n          if (error) {\n            this._myRequests.get(requestId).reject(new Error(error));\n          } else {\n            this._myRequests.get(requestId).resolve(result);\n          }\n        }\n        break;\n      case this._events.request:\n        if (requestId && payload) {\n          this._othersRequests.set(requestId, payload);\n          this.emit(this._events.request, {\n            requestId,\n            payload,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n  };\n\n  dispose = () => {\n    if (this._transporter instanceof PostMessageTransporter) {\n      this._transporter.dispose(this._onMessage);\n    }\n  };\n\n  addListeners<T = any, K = {}>({\n    push,\n    response,\n    request,\n  }: {\n    push?: MessagePushTransportListener<T, K>;\n    response?: MessageTransportListener<T, K>;\n    request?: MessageTransportListener<T, K>;\n  }) {\n    if (typeof push === 'function') {\n      this.on(this._events.push, push);\n    }\n    if (typeof response === 'function') {\n      this.on(this._events.response, response);\n    }\n    if (typeof request === 'function') {\n      this.on(this._events.request, request);\n    }\n  }\n\n  /** T is request data, K is response data */\n  async request<T = any, K = any>({\n    payload,\n  }: MessageTransportRequestData<T>): Promise<K> {\n    const requestId = v4();\n\n    const promise = new Promise<K>((resolve, reject) => {\n      this._myRequests.set(requestId, {\n        resolve,\n        reject,\n      });\n      this._postMessage({\n        type: this._events.request,\n        requestId,\n        payload,\n      });\n    });\n\n    let timeout: NodeJS.Timeout | undefined;\n    if (typeof this._timeout === 'number' && this._timeout > -1) {\n      timeout = setTimeout(() => {\n        timeout = undefined;\n        this._myRequests\n          .get(requestId)\n          .reject(\n            new Error(`${this._events.timeout}: ${JSON.stringify(payload)}`),\n          );\n      }, this._timeout);\n    }\n\n    return promise\n      .then((result) => {\n        if (timeout) clearTimeout(timeout);\n        this._myRequests.delete(requestId);\n        return Promise.resolve(result);\n      })\n      .catch((error) => {\n        if (timeout) clearTimeout(timeout);\n        this._myRequests.delete(requestId);\n        return Promise.reject(error);\n      });\n  }\n\n  /**\n   * Send message without response\n   * @param {payload}\n   */\n  send<T = any>({ payload }: MessageTransportRequestData<T>): void {\n    this._postMessage({\n      type: this._events.push,\n      payload,\n    });\n  }\n\n  response({\n    requestId,\n    result,\n    error,\n  }: MessageTransportResponse): TransportResponseData {\n    const request = this._othersRequests.get(requestId);\n\n    if (request) {\n      this._othersRequests.delete(requestId);\n      this._postMessage({\n        type: this._events.response,\n        requestId,\n        result,\n        error: error instanceof Error ? error.message : error,\n      });\n    }\n\n    return {\n      result,\n      error,\n      requestId,\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}