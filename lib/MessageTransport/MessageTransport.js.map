{"version":3,"file":"MessageTransport.js","names":["uuid","_interopRequireWildcard","require","_TransportBase2","_interopRequireDefault","_MessageTransporters","obj","__esModule","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","_objectSpread","target","i","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","TRANSPORTER_TYPES","POST_MESSAGE","EVENT_EMITTER","exports","MessageTransport","_TransportBase","_super","_ref","_this","_ref$transporterType","transporterType","_ref$transporterDirec","transporterDirection","TRANSPORTER_DIRECTION","TO_EXTERNAL","_ref$targetWindow","targetWindow","window","origin","options","name","_addReceiver","_createEmitter","_targetWindow","_origin","_myRequests","_othersRequests","_postMessage","_transporter","_onMessage","event","_event$data","data","type","payload","requestId","_events","emit","response","Error","request","dispose","PostMessageTransporter","EventEmitterTransporter","direction","addReceiver","createEmitter","Map","addListeners","_ref2","on","_request","regeneratorRuntime","mark","_callee","_ref3","_this2","promise","timeout","wrap","_callee$","_context","prev","next","v4","setTimeout","concat","JSON","stringify","_timeout","abrupt","clearTimeout","stop","_x","send","_ref4","_ref5","message","TransportBase"],"sources":["lib/MessageTransport/MessageTransport.ts"],"sourcesContent":["import * as uuid from 'uuid';\n\nimport TransportBase from '../TransportBase';\nimport type { TransportBaseProps } from '../TransportBase/TransportBase';\nimport type { TransportResponseData } from '../TransportInteractionBase';\nimport type { TransporterDirection } from './MessageTransporters';\nimport {\n  EventEmitterTransporter,\n  PostMessageTransporter,\n  TRANSPORTER_DIRECTION,\n} from './MessageTransporters';\n\ntype MessageTransportListener<T = any, K = {}> = (params: {\n  requestId: string;\n  payload: MessageTransportPayload<T, K>;\n}) => any;\n\ntype MessagePushTransportListener<T = any, K = {}> = (\n  payload: MessageTransportPayload<T, K>,\n) => any;\n\nexport type MessageTransportPayload<T = any, K = {}> = {\n  requestType: string;\n  data?: T;\n} & K;\n\nexport interface MessageTransportResponse {\n  requestId: string;\n  result: any;\n  error?: Error | string;\n}\n\nexport const TRANSPORTER_TYPES = {\n  POST_MESSAGE: 'postMessage',\n  EVENT_EMITTER: 'eventEmitter',\n} as const;\n\nexport type TransporterTypes =\n  typeof TRANSPORTER_TYPES[keyof typeof TRANSPORTER_TYPES];\n\nexport interface MessageTransportProps {\n  transporterDirection?: TransporterDirection;\n  targetWindow?: Window;\n  origin?: string;\n  transporterType?: TransporterTypes;\n}\n\ntype MessageTransportRequestData<T = any, K = {}> = {\n  payload: MessageTransportPayload<T, K>;\n};\n\ntype Transporter = EventEmitterTransporter | PostMessageTransporter;\n\nexport default class MessageTransport extends TransportBase {\n  private _addReceiver: Transporter['addReceiver'];\n  private _createEmitter: Transporter['createEmitter'];\n  private _targetWindow: Window;\n  private _origin: string;\n  private _myRequests: Map<any, any>;\n  private _othersRequests: Map<any, any>;\n  private _postMessage: any;\n  private _transporter: Transporter;\n\n  constructor({\n    transporterType = TRANSPORTER_TYPES.POST_MESSAGE,\n    transporterDirection = TRANSPORTER_DIRECTION.TO_EXTERNAL,\n    targetWindow = window,\n    origin,\n    ...options\n  }: MessageTransportProps & Omit<TransportBaseProps, 'name'>) {\n    super({\n      ...options,\n      name: 'MessageTransport',\n    });\n    switch (transporterType) {\n      case TRANSPORTER_TYPES.EVENT_EMITTER:\n        this._transporter = new EventEmitterTransporter({\n          direction: transporterDirection,\n        });\n        break;\n      default:\n      case TRANSPORTER_TYPES.POST_MESSAGE:\n        this._transporter = new PostMessageTransporter();\n        break;\n    }\n\n    this._addReceiver = this._transporter.addReceiver;\n    this._createEmitter = this._transporter.createEmitter;\n\n    this._targetWindow = targetWindow;\n    this._origin = origin;\n    this._myRequests = new Map();\n    this._othersRequests = new Map();\n    this._postMessage = this._createEmitter(this._targetWindow);\n    this._addReceiver(this._onMessage);\n  }\n\n  _onMessage = (event: MessageEvent) => {\n    // TODO: confirm if the message is from iframe\n    if (this._origin && event.origin !== this._origin) {\n      return;\n    }\n    const { type, payload, requestId, result, error } = event.data;\n    switch (type) {\n      case this._events.push:\n        if (payload) {\n          this.emit(this._events.push, payload);\n        }\n        break;\n      case this._events.response:\n        if (requestId && this._myRequests.has(requestId)) {\n          if (error) {\n            this._myRequests.get(requestId).reject(new Error(error));\n          } else {\n            this._myRequests.get(requestId).resolve(result);\n          }\n        }\n        break;\n      case this._events.request:\n        if (requestId && payload) {\n          this._othersRequests.set(requestId, payload);\n          this.emit(this._events.request, {\n            requestId,\n            payload,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n  };\n\n  dispose = () => {\n    if (this._transporter instanceof PostMessageTransporter) {\n      this._transporter.dispose(this._onMessage);\n    }\n  };\n\n  addListeners<T = any, K = {}>({\n    push,\n    response,\n    request,\n  }: {\n    push?: MessagePushTransportListener<T, K>;\n    response?: MessageTransportListener<T, K>;\n    request?: MessageTransportListener<T, K>;\n  }) {\n    if (typeof push === 'function') {\n      this.on(this._events.push, push);\n    }\n    if (typeof response === 'function') {\n      this.on(this._events.response, response);\n    }\n    if (typeof request === 'function') {\n      this.on(this._events.request, request);\n    }\n  }\n\n  /** T is request data, K is response data */\n  async request<T = any, K = any>({\n    payload,\n  }: MessageTransportRequestData<T>): Promise<K> {\n    const requestId = uuid.v4();\n\n    const promise = new Promise<K>((resolve, reject) => {\n      this._myRequests.set(requestId, {\n        resolve,\n        reject,\n      });\n      this._postMessage({\n        type: this._events.request,\n        requestId,\n        payload,\n      });\n    });\n\n    let timeout = setTimeout(() => {\n      timeout = null;\n      this._myRequests\n        .get(requestId)\n        .reject(\n          new Error(`${this._events.timeout}: ${JSON.stringify(payload)}`),\n        );\n    }, this._timeout);\n\n    return promise\n      .then((result) => {\n        if (timeout) clearTimeout(timeout);\n        this._myRequests.delete(requestId);\n        return Promise.resolve(result);\n      })\n      .catch((error) => {\n        if (timeout) clearTimeout(timeout);\n        this._myRequests.delete(requestId);\n        return Promise.reject(error);\n      });\n  }\n\n  /**\n   * Send message without response\n   * @param {payload}\n   */\n  send<T = any>({ payload }: MessageTransportRequestData<T>): void {\n    this._postMessage({\n      type: this._events.push,\n      payload,\n    });\n  }\n\n  response({\n    requestId,\n    result,\n    error,\n  }: MessageTransportResponse): TransportResponseData {\n    const request = this._othersRequests.get(requestId);\n\n    if (request) {\n      this._othersRequests.delete(requestId);\n      this._postMessage({\n        type: this._events.response,\n        requestId,\n        result,\n        error: error instanceof Error ? error.message : error,\n      });\n    }\n\n    return {\n      result,\n      error,\n      requestId,\n    };\n  }\n}\n"],"mappings":"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"}