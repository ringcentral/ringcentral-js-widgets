{"version":3,"file":"MessageTransport.js","names":["_uuid","require","_TransportBase2","_MessageTransporters","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","Object","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","enumerable","push","_objectSpread","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","configurable","writable","_objectWithoutProperties","_objectWithoutPropertiesLoose","indexOf","propertyIsEnumerable","call","hasOwnProperty","_classCallCheck","TypeError","_defineProperties","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","TRANSPORTER_TYPES","POST_MESSAGE","EVENT_EMITTER","exports","MessageTransport","_TransportBase","_super","_ref","_this","_ref$transporterType","transporterType","_ref$transporterDirec","transporterDirection","TRANSPORTER_DIRECTION","TO_EXTERNAL","_ref$targetWindow","targetWindow","window","origin","options","name","_addReceiver","_createEmitter","_targetWindow","_myRequests","_othersRequests","_transporter","_origin","_postMessage","_onMessage","event","_event$data","data","type","payload","requestId","result","error","_events","emit","response","has","get","reject","Error","request","set","dispose","PostMessageTransporter","EventEmitterTransporter","direction","addReceiver","createEmitter","Map","addListeners","_ref2","on","_request","regeneratorRuntime","mark","_callee","_ref3","_this2","promise","timeout","wrap","_callee$","_context","prev","next","v4","_timeout","setTimeout","undefined","concat","JSON","stringify","abrupt","clearTimeout","stop","_x","send","_ref4","_ref5","message","TransportBase"],"sources":["lib/MessageTransport/MessageTransport.ts"],"sourcesContent":["import { v4 } from 'uuid';\n\nimport { TransportBase, type TransportBaseProps } from '../TransportBase';\nimport type { TransportResponseData } from '../TransportInteractionBase';\n\nimport type { TransporterDirection } from './MessageTransporters';\nimport {\n  EventEmitterTransporter,\n  PostMessageTransporter,\n  TRANSPORTER_DIRECTION,\n} from './MessageTransporters';\n\ntype MessageTransportListener<T = any, K = {}> = (params: {\n  requestId: string;\n  payload: MessageTransportPayload<T, K>;\n}) => any;\n\ntype MessagePushTransportListener<T = any, K = {}> = (\n  payload: MessageTransportPayload<T, K>,\n) => any;\n\nexport type MessageTransportPayload<T = any, K = {}> = {\n  requestType: string;\n  data?: T;\n} & K;\n\nexport interface MessageTransportResponse {\n  requestId: string;\n  result: any;\n  error?: Error | string;\n}\n\nexport const TRANSPORTER_TYPES = {\n  POST_MESSAGE: 'postMessage',\n  EVENT_EMITTER: 'eventEmitter',\n} as const;\n\nexport type TransporterTypes =\n  (typeof TRANSPORTER_TYPES)[keyof typeof TRANSPORTER_TYPES];\n\nexport interface MessageTransportProps {\n  transporterDirection?: TransporterDirection;\n  targetWindow?: Window;\n  origin?: string;\n  transporterType?: TransporterTypes;\n}\n\ntype MessageTransportRequestData<T = any, K = {}> = {\n  payload: MessageTransportPayload<T, K>;\n};\n\ntype Transporter = EventEmitterTransporter | PostMessageTransporter;\n\nexport default class MessageTransport extends TransportBase {\n  private _addReceiver: Transporter['addReceiver'];\n  private _createEmitter: Transporter['createEmitter'];\n  private _targetWindow: Window;\n  private _myRequests: Map<any, any>;\n  private _othersRequests: Map<any, any>;\n  private _transporter: Transporter;\n  _origin?: string;\n  _postMessage: (args: any) => void;\n\n  constructor({\n    transporterType = TRANSPORTER_TYPES.POST_MESSAGE,\n    transporterDirection = TRANSPORTER_DIRECTION.TO_EXTERNAL,\n    targetWindow = window,\n    origin,\n    ...options\n  }: MessageTransportProps & Omit<TransportBaseProps, 'name'>) {\n    super({\n      ...options,\n      name: 'MessageTransport',\n    });\n    switch (transporterType) {\n      case TRANSPORTER_TYPES.EVENT_EMITTER:\n        this._transporter = new EventEmitterTransporter({\n          direction: transporterDirection,\n        });\n        break;\n      default:\n      case TRANSPORTER_TYPES.POST_MESSAGE:\n        this._transporter = new PostMessageTransporter();\n        break;\n    }\n\n    this._addReceiver = this._transporter.addReceiver;\n    this._createEmitter = this._transporter.createEmitter;\n\n    this._targetWindow = targetWindow;\n    this._origin = origin;\n    this._myRequests = new Map();\n    this._othersRequests = new Map();\n    this._postMessage = this._createEmitter(this._targetWindow);\n    this._addReceiver(this._onMessage);\n  }\n\n  _onMessage = (event: MessageEvent) => {\n    // TODO: confirm if the message is from iframe\n    if (this._origin && event.origin !== this._origin) {\n      return;\n    }\n    const { type, payload, requestId, result, error } = event.data;\n    switch (type) {\n      case this._events.push:\n        if (payload) {\n          this.emit(this._events.push, payload);\n        }\n        break;\n      case this._events.response:\n        if (requestId && this._myRequests.has(requestId)) {\n          if (error) {\n            this._myRequests.get(requestId).reject(new Error(error));\n          } else {\n            this._myRequests.get(requestId).resolve(result);\n          }\n        }\n        break;\n      case this._events.request:\n        if (requestId && payload) {\n          this._othersRequests.set(requestId, payload);\n          this.emit(this._events.request, {\n            requestId,\n            payload,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n  };\n\n  dispose = () => {\n    if (this._transporter instanceof PostMessageTransporter) {\n      this._transporter.dispose(this._onMessage);\n    }\n  };\n\n  addListeners<T = any, K = {}>({\n    push,\n    response,\n    request,\n  }: {\n    push?: MessagePushTransportListener<T, K>;\n    response?: MessageTransportListener<T, K>;\n    request?: MessageTransportListener<T, K>;\n  }) {\n    if (typeof push === 'function') {\n      this.on(this._events.push, push);\n    }\n    if (typeof response === 'function') {\n      this.on(this._events.response, response);\n    }\n    if (typeof request === 'function') {\n      this.on(this._events.request, request);\n    }\n  }\n\n  /** T is request data, K is response data */\n  async request<T = any, K = any>({\n    payload,\n  }: MessageTransportRequestData<T>): Promise<K> {\n    const requestId = v4();\n\n    const promise = new Promise<K>((resolve, reject) => {\n      this._myRequests.set(requestId, {\n        resolve,\n        reject,\n      });\n      this._postMessage({\n        type: this._events.request,\n        requestId,\n        payload,\n      });\n    });\n\n    let timeout: NodeJS.Timeout | undefined;\n    if (typeof this._timeout === 'number' && this._timeout > -1) {\n      timeout = setTimeout(() => {\n        timeout = undefined;\n        this._myRequests\n          .get(requestId)\n          .reject(\n            new Error(`${this._events.timeout}: ${JSON.stringify(payload)}`),\n          );\n      }, this._timeout);\n    }\n\n    return promise\n      .then((result) => {\n        if (timeout) clearTimeout(timeout);\n        this._myRequests.delete(requestId);\n        return Promise.resolve(result);\n      })\n      .catch((error) => {\n        if (timeout) clearTimeout(timeout);\n        this._myRequests.delete(requestId);\n        return Promise.reject(error);\n      });\n  }\n\n  /**\n   * Send message without response\n   * @param {payload}\n   */\n  send<T = any>({ payload }: MessageTransportRequestData<T>): void {\n    this._postMessage({\n      type: this._events.push,\n      payload,\n    });\n  }\n\n  response({\n    requestId,\n    result,\n    error,\n  }: MessageTransportResponse): TransportResponseData {\n    const request = this._othersRequests.get(requestId);\n\n    if (request) {\n      this._othersRequests.delete(requestId);\n      this._postMessage({\n        type: this._events.response,\n        requestId,\n        result,\n        error: error instanceof Error ? error.message : error,\n      });\n    }\n\n    return {\n      result,\n      error,\n      requestId,\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}