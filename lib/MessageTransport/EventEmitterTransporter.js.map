{"version":3,"file":"EventEmitterTransporter.js","names":["_events","require","_BasicTransporter2","_interopRequireDefault","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","writable","configurable","defineProperty","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","call","_typeof","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","TRANSPORTER_DIRECTION","TO_INTERNAL","TO_EXTERNAL","exports","EventEmitterTransporter","_BasicTransporter","_super","_ref","_this","direction","_direction","addReceiver","onMessage","window","_transporterEventEmitter","on","data","createEmitter","emitterData","_ref2","length","undefined","callback","emit","EventEmitter","BasicTransporter"],"sources":["lib/MessageTransport/EventEmitterTransporter.ts"],"sourcesContent":["import { EventEmitter } from 'events';\n\nimport BasicTransporter from './BasicTransporter';\n\ndeclare global {\n  interface Window {\n    _transporterEventEmitter: EventEmitter;\n  }\n}\n\nexport const TRANSPORTER_DIRECTION = {\n  TO_INTERNAL: 'toInternal',\n  TO_EXTERNAL: 'toExternal',\n} as const;\n\nexport type TransporterDirection =\n  typeof TRANSPORTER_DIRECTION[keyof typeof TRANSPORTER_DIRECTION];\n\n/**\n * @param direction if direction is 'toExternal', meaning this instance is created in internal adapter, need in eventEmitter\n */\nexport class EventEmitterTransporter extends BasicTransporter {\n  private _direction: TransporterDirection;\n\n  constructor({ direction }: { direction: TransporterDirection }) {\n    super();\n    if (!window._transporterEventEmitter) {\n      window._transporterEventEmitter = new EventEmitter();\n    }\n    this._direction = direction;\n  }\n\n  addReceiver = (onMessage: any) => {\n    window._transporterEventEmitter.on(\n      this._direction === TRANSPORTER_DIRECTION.TO_EXTERNAL\n        ? TRANSPORTER_DIRECTION.TO_INTERNAL\n        : TRANSPORTER_DIRECTION.TO_EXTERNAL,\n      (data) => {\n        onMessage({\n          data,\n        });\n      },\n    );\n  };\n\n  createEmitter =\n    () =>\n    (emitterData: Object, { callback }: { callback?: () => any } = {}) => {\n      window._transporterEventEmitter.emit(\n        this._direction === TRANSPORTER_DIRECTION.TO_EXTERNAL\n          ? TRANSPORTER_DIRECTION.TO_EXTERNAL\n          : TRANSPORTER_DIRECTION.TO_INTERNAL,\n        emitterData,\n      );\n      if (typeof callback === 'function') callback();\n    };\n}\n"],"mappings":"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"}