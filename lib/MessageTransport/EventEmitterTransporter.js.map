{"version":3,"file":"EventEmitterTransporter.js","names":["_events","require","_BasicTransporter2","_interopRequireDefault","e","__esModule","_defineProperties","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","TypeError","String","Number","_classCallCheck","a","n","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","value","_setPrototypeOf","TRANSPORTER_DIRECTION","exports","TO_INTERNAL","TO_EXTERNAL","EventEmitterTransporter","_BasicTransporter","_ref","_this","direction","_direction","addReceiver","onMessage","window","_transporterEventEmitter","on","data","createEmitter","emitterData","_ref2","arguments","undefined","callback","emit","EventEmitter","BasicTransporter"],"sources":["lib/MessageTransport/EventEmitterTransporter.ts"],"sourcesContent":["import { EventEmitter } from 'events';\n\nimport BasicTransporter from './BasicTransporter';\n\ndeclare global {\n  interface Window {\n    _transporterEventEmitter: EventEmitter;\n  }\n}\n\nexport const TRANSPORTER_DIRECTION = {\n  TO_INTERNAL: 'toInternal',\n  TO_EXTERNAL: 'toExternal',\n} as const;\n\nexport type TransporterDirection =\n  (typeof TRANSPORTER_DIRECTION)[keyof typeof TRANSPORTER_DIRECTION];\n\n/**\n * @param direction if direction is 'toExternal', meaning this instance is created in internal adapter, need in eventEmitter\n */\nexport class EventEmitterTransporter extends BasicTransporter {\n  private _direction: TransporterDirection;\n\n  constructor({ direction }: { direction: TransporterDirection }) {\n    super();\n    if (!window._transporterEventEmitter) {\n      window._transporterEventEmitter = new EventEmitter();\n    }\n    this._direction = direction;\n  }\n\n  addReceiver = (onMessage: any) => {\n    window._transporterEventEmitter.on(\n      this._direction === TRANSPORTER_DIRECTION.TO_EXTERNAL\n        ? TRANSPORTER_DIRECTION.TO_INTERNAL\n        : TRANSPORTER_DIRECTION.TO_EXTERNAL,\n      (data) => {\n        onMessage({\n          data,\n        });\n      },\n    );\n  };\n\n  createEmitter =\n    () =>\n    (emitterData: Object, { callback }: { callback?: () => any } = {}) => {\n      window._transporterEventEmitter.emit(\n        this._direction === TRANSPORTER_DIRECTION.TO_EXTERNAL\n          ? TRANSPORTER_DIRECTION.TO_EXTERNAL\n          : TRANSPORTER_DIRECTION.TO_INTERNAL,\n        emitterData,\n      );\n      if (typeof callback === 'function') callback();\n    };\n}\n"],"mappings":"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","ignoreList":[]}