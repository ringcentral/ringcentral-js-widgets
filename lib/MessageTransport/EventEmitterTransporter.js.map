{"version":3,"file":"EventEmitterTransporter.js","names":["_events","require","_BasicTransporter2","_interopRequireDefault","e","__esModule","_classCallCheck","a","n","TypeError","_inherits","t","prototype","Object","create","constructor","value","writable","configurable","defineProperty","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","r","_isNativeReflectConstruct","o","_getPrototypeOf","s","Reflect","construct","arguments","apply","_possibleConstructorReturn","_typeof","_assertThisInitialized","ReferenceError","Boolean","valueOf","call","getPrototypeOf","TRANSPORTER_DIRECTION","TO_INTERNAL","TO_EXTERNAL","exports","EventEmitterTransporter","_BasicTransporter","_super","_ref","_this","direction","_direction","addReceiver","onMessage","window","_transporterEventEmitter","on","data","createEmitter","emitterData","_ref2","length","undefined","callback","emit","EventEmitter","BasicTransporter"],"sources":["lib/MessageTransport/EventEmitterTransporter.ts"],"sourcesContent":["import { EventEmitter } from 'events';\n\nimport BasicTransporter from './BasicTransporter';\n\ndeclare global {\n  interface Window {\n    _transporterEventEmitter: EventEmitter;\n  }\n}\n\nexport const TRANSPORTER_DIRECTION = {\n  TO_INTERNAL: 'toInternal',\n  TO_EXTERNAL: 'toExternal',\n} as const;\n\nexport type TransporterDirection =\n  (typeof TRANSPORTER_DIRECTION)[keyof typeof TRANSPORTER_DIRECTION];\n\n/**\n * @param direction if direction is 'toExternal', meaning this instance is created in internal adapter, need in eventEmitter\n */\nexport class EventEmitterTransporter extends BasicTransporter {\n  private _direction: TransporterDirection;\n\n  constructor({ direction }: { direction: TransporterDirection }) {\n    super();\n    if (!window._transporterEventEmitter) {\n      window._transporterEventEmitter = new EventEmitter();\n    }\n    this._direction = direction;\n  }\n\n  addReceiver = (onMessage: any) => {\n    window._transporterEventEmitter.on(\n      this._direction === TRANSPORTER_DIRECTION.TO_EXTERNAL\n        ? TRANSPORTER_DIRECTION.TO_INTERNAL\n        : TRANSPORTER_DIRECTION.TO_EXTERNAL,\n      (data) => {\n        onMessage({\n          data,\n        });\n      },\n    );\n  };\n\n  createEmitter =\n    () =>\n    (emitterData: Object, { callback }: { callback?: () => any } = {}) => {\n      window._transporterEventEmitter.emit(\n        this._direction === TRANSPORTER_DIRECTION.TO_EXTERNAL\n          ? TRANSPORTER_DIRECTION.TO_EXTERNAL\n          : TRANSPORTER_DIRECTION.TO_INTERNAL,\n        emitterData,\n      );\n      if (typeof callback === 'function') callback();\n    };\n}\n"],"mappings":"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","ignoreList":[]}