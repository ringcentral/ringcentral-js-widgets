{"version":3,"file":"chunkMessage.js","names":["chunkMessage","text","maxLength","Error","chunks","fromIndex","total","length","toIndex","offset","char","charAt","isWhiteSpace","test","snippet","substring","push"],"sources":["lib/chunkMessage.ts"],"sourcesContent":["/**\n * this module seems better\n * https://www.npmjs.com/package/chunk-text\n * use our own implementation for now.\n */\n\nexport default function chunkMessage(\n  text: string,\n  maxLength: number,\n): string[] {\n  if (!text) {\n    return [];\n  }\n\n  if (typeof maxLength !== 'number') {\n    throw new Error('Should be a integer \"maxLength\"');\n  }\n\n  if (maxLength < 1) {\n    throw new Error('Should greater than 0 \"maxLength\"');\n  }\n\n  const chunks = [];\n  let fromIndex = 0;\n  const total = text.length;\n\n  while (fromIndex < total) {\n    let toIndex = fromIndex + maxLength;\n    let offset = 0;\n    for (; offset < maxLength; offset += 1) {\n      const char = text.charAt(toIndex - offset);\n      if (!char) {\n        break;\n      }\n      const isWhiteSpace = /\\s/.test(char);\n      if (isWhiteSpace) {\n        if (offset > 0) {\n          offset -= 1;\n        }\n        break;\n      }\n    }\n    if (offset !== maxLength) {\n      toIndex -= offset;\n    }\n    const snippet = text.substring(fromIndex, toIndex);\n    fromIndex = toIndex;\n    chunks.push(snippet);\n  }\n\n  return chunks;\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;AAEe,SAASA,YAAYA,CAClCC,IAAY,EACZC,SAAiB,EACP;EACV,IAAI,CAACD,IAAI,EAAE;IACT,OAAO,EAAE;EACX;EAEA,IAAI,OAAOC,SAAS,KAAK,QAAQ,EAAE;IACjC,MAAM,IAAIC,KAAK,CAAC,iCAAiC,CAAC;EACpD;EAEA,IAAID,SAAS,GAAG,CAAC,EAAE;IACjB,MAAM,IAAIC,KAAK,CAAC,mCAAmC,CAAC;EACtD;EAEA,IAAMC,MAAM,GAAG,EAAE;EACjB,IAAIC,SAAS,GAAG,CAAC;EACjB,IAAMC,KAAK,GAAGL,IAAI,CAACM,MAAM;EAEzB,OAAOF,SAAS,GAAGC,KAAK,EAAE;IACxB,IAAIE,OAAO,GAAGH,SAAS,GAAGH,SAAS;IACnC,IAAIO,MAAM,GAAG,CAAC;IACd,OAAOA,MAAM,GAAGP,SAAS,EAAEO,MAAM,IAAI,CAAC,EAAE;MACtC,IAAMC,KAAI,GAAGT,IAAI,CAACU,MAAM,CAACH,OAAO,GAAGC,MAAM,CAAC;MAC1C,IAAI,CAACC,KAAI,EAAE;QACT;MACF;MACA,IAAME,YAAY,GAAG,IAAI,CAACC,IAAI,CAACH,KAAI,CAAC;MACpC,IAAIE,YAAY,EAAE;QAChB,IAAIH,MAAM,GAAG,CAAC,EAAE;UACdA,MAAM,IAAI,CAAC;QACb;QACA;MACF;IACF;IACA,IAAIA,MAAM,KAAKP,SAAS,EAAE;MACxBM,OAAO,IAAIC,MAAM;IACnB;IACA,IAAMK,OAAO,GAAGb,IAAI,CAACc,SAAS,CAACV,SAAS,EAAEG,OAAO,CAAC;IAClDH,SAAS,GAAGG,OAAO;IACnBJ,MAAM,CAACY,IAAI,CAACF,OAAO,CAAC;EACtB;EAEA,OAAOV,MAAM;AACf","ignoreList":[]}