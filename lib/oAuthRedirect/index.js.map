{"version":3,"file":"index.js","names":["_urlParse","_interopRequireDefault","require","obj","__esModule","callbackUri","window","location","href","opener","oAuthCallback","close","error","parsedUri","parse","state","query","hash","split","slice","join","key","concat","addEventListener","e","newValue","localStorage","setItem","setTimeout","removeItem"],"sources":["lib/oAuthRedirect/index.ts"],"sourcesContent":["import parse from 'url-parse';\n\n(() => {\n  const callbackUri = window.location.href;\n  try {\n    if (window.opener && window.opener.oAuthCallback) {\n      window.opener.oAuthCallback(callbackUri);\n      window.close();\n      return;\n    }\n  } catch (error) {\n    /* ignore error */\n  }\n\n  // Use this when redirect page is different domain with app\n  // Update window.origin to app's origin\n  // try {\n  //   if (window.opener && window.opener.postMessage) {\n  //     window.opener.postMessage({ callbackUri }, window.origin);\n  //     window.close();\n  //     return;\n  //   }\n  // } catch (error) {\n  //   /* ignore error */\n  // }\n\n  const parsedUri = parse(callbackUri, true);\n  const state = parsedUri.query.state || '';\n  const hash = state.split('-').slice(1).join('-');\n  if (hash && hash !== '') {\n    const key = `${hash}-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && (!e.newValue || e.newValue === '')) {\n        window.close();\n      }\n    });\n    localStorage.setItem(key, callbackUri);\n    setTimeout(() => {\n      localStorage.removeItem(key);\n    }, 3000);\n  }\n})();\n"],"mappings":";;;;;;;AAAA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AAA8B,SAAAD,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,gBAAAA,GAAA;AAE9B,CAAC,YAAM;EACL,IAAME,WAAW,GAAGC,MAAM,CAACC,QAAQ,CAACC,IAAI;EACxC,IAAI;IACF,IAAIF,MAAM,CAACG,MAAM,IAAIH,MAAM,CAACG,MAAM,CAACC,aAAa,EAAE;MAChDJ,MAAM,CAACG,MAAM,CAACC,aAAa,CAACL,WAAW,CAAC;MACxCC,MAAM,CAACK,KAAK,CAAC,CAAC;MACd;IACF;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACd;EAAA;;EAGF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,IAAMC,SAAS,GAAG,IAAAC,oBAAK,EAACT,WAAW,EAAE,IAAI,CAAC;EAC1C,IAAMU,KAAK,GAAGF,SAAS,CAACG,KAAK,CAACD,KAAK,IAAI,EAAE;EACzC,IAAME,IAAI,GAAGF,KAAK,CAACG,KAAK,CAAC,GAAG,CAAC,CAACC,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;EAChD,IAAIH,IAAI,IAAIA,IAAI,KAAK,EAAE,EAAE;IACvB,IAAMI,GAAG,MAAAC,MAAA,CAAML,IAAI,iBAAc;IACjCX,MAAM,CAACiB,gBAAgB,CAAC,SAAS,EAAE,UAACC,CAAC,EAAK;MACxC,IAAIA,CAAC,CAACH,GAAG,KAAKA,GAAG,KAAK,CAACG,CAAC,CAACC,QAAQ,IAAID,CAAC,CAACC,QAAQ,KAAK,EAAE,CAAC,EAAE;QACvDnB,MAAM,CAACK,KAAK,CAAC,CAAC;MAChB;IACF,CAAC,CAAC;IACFe,YAAY,CAACC,OAAO,CAACN,GAAG,EAAEhB,WAAW,CAAC;IACtCuB,UAAU,CAAC,YAAM;MACfF,YAAY,CAACG,UAAU,CAACR,GAAG,CAAC;IAC9B,CAAC,EAAE,IAAI,CAAC;EACV;AACF,CAAC,EAAE,CAAC"}