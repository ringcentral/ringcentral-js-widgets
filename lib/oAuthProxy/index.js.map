{"version":3,"file":"index.js","names":["_urlParse","_interopRequireDefault","require","_popWindow","_simpleHash","obj","__esModule","loginWindow","_parse","parse","window","location","href","_parse$query","query","_parse$query$prefix","prefix","_parse$query$hash","hash","simpleHash","oAuthCallback","callbackUri","parent","postMessage","addEventListener","_ref","_ref$data","data","oAuthUri","trim","parsedUri","state","concat","set","popWindow","toString","key","e","newValue","localStorage","removeItem","proxyLoaded","error","close"],"sources":["lib/oAuthProxy/index.ts"],"sourcesContent":["import parse from 'url-parse';\n\nimport popWindow from '../popWindow';\nimport simpleHash from '../simpleHash';\n\nlet loginWindow: any = null;\n\nconst {\n  query: { prefix = 'rc', hash = simpleHash() },\n} = parse(window.location.href, true);\n\n/**\n * @function\n * @global\n * @description oAuthCallback allows redirect to call via window.opener.oAuthCallback if window.opener is not blocked.\n * @param {String} callbackUri\n */\nwindow.oAuthCallback = (callbackUri: string) => {\n  window.parent.postMessage(\n    {\n      callbackUri,\n    },\n    '*',\n  );\n};\n\nwindow.addEventListener('message', ({ data = {} }) => {\n  const { oAuthUri } = data;\n  if (oAuthUri && oAuthUri.trim() !== '') {\n    const parsedUri = parse(oAuthUri, true);\n    const { query } = parsedUri;\n    query.state = `${query.state}-${prefix}-${hash}`;\n    parsedUri.set('query', query);\n    loginWindow = popWindow(parsedUri.toString(), `${prefix}-oauth`, 600, 600);\n  }\n});\n\nconst key = `${prefix}-${hash}-callbackUri`;\nwindow.addEventListener('storage', (e) => {\n  if (e.key === key && e.newValue && e.newValue !== '') {\n    const callbackUri = e.newValue;\n    localStorage.removeItem(key);\n    window.parent.postMessage(\n      {\n        callbackUri,\n      },\n      '*',\n    );\n  }\n});\n\ntry {\n  window.parent.postMessage(\n    {\n      proxyLoaded: true,\n    },\n    '*',\n  );\n} catch (error) {\n  /* ignore error */\n}\n\nwindow.addEventListener('beforeunload', () => {\n  if (loginWindow) {\n    try {\n      loginWindow.close();\n    } catch (error) {\n      /* ignore error */\n    }\n  }\n});\n"],"mappings":"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"}