{"version":3,"file":"createApp.js","names":["createApp","main","modules","reduxEnhancer","createStore","Object","values","strict","undefined","handleReducers","reducers","entries","forEach","key","module","RcModuleV2","spawnStorageReducersKey","storage","assign","reducer","globalStorage","combineReducers","_initModule","then"],"sources":["lib/RcModule/createApp.ts"],"sourcesContent":["import { combineReducers, ReducersMapObject, StoreEnhancer } from 'redux';\nimport { createStore, RcModuleV2, spawnStorageReducersKey } from './RcModule';\n\n/**\n * Create app with FactoryModule based on RcModuleV2.\n * !! Please ensure that all dependency injection modules are based on the RcModuleV2 module.\n */\nexport const createApp = ({\n  main,\n  modules = {},\n  reduxEnhancer,\n}: {\n  main: RcModuleV2;\n  modules?: Record<string, RcModuleV2>;\n  reduxEnhancer?: StoreEnhancer;\n}) => {\n  createStore(\n    {\n      modules: [...Object.values(modules), main],\n      // disable AutoFreeze\n      strict: false,\n    },\n    undefined,\n    {\n      reduxEnhancer,\n      handleReducers: (reducers: ReducersMapObject) => {\n        Object.entries(modules).forEach(([key, module]) => {\n          if (\n            key !== 'storage' &&\n            key !== 'globalStorage' &&\n            module instanceof RcModuleV2\n          ) {\n            module[spawnStorageReducersKey]();\n          }\n        });\n        if (modules.storage) {\n          Object.assign(reducers, {\n            storage: modules.storage.reducer,\n          });\n        }\n        if (modules.globalStorage) {\n          Object.assign(reducers, {\n            globalStorage: modules.globalStorage.reducer,\n          });\n        }\n        return combineReducers(reducers);\n      },\n    },\n  );\n  main._initModule().then(() => {\n    // For scenarios without dependency injection\n    Object.values(modules).forEach((module) => module?._initModule?.());\n  });\n  return main;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACO,IAAMA,SAAS,GAAG,SAAZA,SAAY,OAQnB;EAAA,IAPJC,IAOI,QAPJA,IAOI;EAAA,wBANJC,OAMI;EAAA,IANJA,OAMI,6BANM,EAMN;EAAA,IALJC,aAKI,QALJA,aAKI;EACJ,IAAAC,qBAAA,EACE;IACEF,OAAO,+BAAMG,MAAM,CAACC,MAAP,CAAcJ,OAAd,CAAN,IAA8BD,IAA9B,EADT;IAEE;IACAM,MAAM,EAAE;EAHV,CADF,EAMEC,SANF,EAOE;IACEL,aAAa,EAAbA,aADF;IAEEM,cAAc,EAAE,wBAACC,QAAD,EAAiC;MAC/CL,MAAM,CAACM,OAAP,CAAeT,OAAf,EAAwBU,OAAxB,CAAgC,iBAAmB;QAAA;QAAA,IAAjBC,GAAiB;QAAA,IAAZC,MAAY;;QACjD,IACED,GAAG,KAAK,SAAR,IACAA,GAAG,KAAK,eADR,IAEAC,MAAM,YAAYC,oBAHpB,EAIE;UACAD,MAAM,CAACE,iCAAD,CAAN;QACD;MACF,CARD;;MASA,IAAId,OAAO,CAACe,OAAZ,EAAqB;QACnBZ,MAAM,CAACa,MAAP,CAAcR,QAAd,EAAwB;UACtBO,OAAO,EAAEf,OAAO,CAACe,OAAR,CAAgBE;QADH,CAAxB;MAGD;;MACD,IAAIjB,OAAO,CAACkB,aAAZ,EAA2B;QACzBf,MAAM,CAACa,MAAP,CAAcR,QAAd,EAAwB;UACtBU,aAAa,EAAElB,OAAO,CAACkB,aAAR,CAAsBD;QADf,CAAxB;MAGD;;MACD,OAAO,IAAAE,sBAAA,EAAgBX,QAAhB,CAAP;IACD;EAvBH,CAPF;;EAiCAT,IAAI,CAACqB,WAAL,GAAmBC,IAAnB,CAAwB,YAAM;IAC5B;IACAlB,MAAM,CAACC,MAAP,CAAcJ,OAAd,EAAuBU,OAAvB,CAA+B,UAACE,MAAD;MAAA;;MAAA,OAAYA,MAAZ,aAAYA,MAAZ,8CAAYA,MAAM,CAAEQ,WAApB,wDAAY,yBAAAR,MAAM,CAAlB;IAAA,CAA/B;EACD,CAHD;;EAIA,OAAOb,IAAP;AACD,CA/CM"}