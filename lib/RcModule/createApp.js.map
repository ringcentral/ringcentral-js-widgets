{"version":3,"file":"createApp.js","names":["_redux","require","_RcModule","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","Object","done","push","value","length","err","Array","isArray","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","o","minLen","_arrayLikeToArray","n","prototype","toString","slice","constructor","name","from","test","iter","len","arr2","createApp","_ref","main","_ref$modules","modules","reduxEnhancer","createStore","concat","values","strict","undefined","handleReducers","reducers","entries","forEach","_ref2","_ref3","key","module","RcModuleV2","spawnStorageReducersKey","storage","assign","reducer","globalStorage","combineReducers","_initModule","then","_module$_initModule","exports"],"sources":["lib/RcModule/createApp.ts"],"sourcesContent":["import type { ReducersMapObject, StoreEnhancer } from 'redux';\nimport { combineReducers } from 'redux';\nimport { createStore, RcModuleV2, spawnStorageReducersKey } from './RcModule';\n\n/**\n * Create app with FactoryModule based on RcModuleV2.\n * !! Please ensure that all dependency injection modules are based on the RcModuleV2 module.\n */\nexport const createApp = ({\n  main,\n  modules = {},\n  reduxEnhancer,\n}: {\n  main: RcModuleV2;\n  modules?: Record<string, RcModuleV2>;\n  reduxEnhancer?: StoreEnhancer;\n}) => {\n  createStore(\n    {\n      modules: [...Object.values(modules), main],\n      // disable AutoFreeze\n      strict: false,\n    },\n    undefined,\n    {\n      reduxEnhancer,\n      handleReducers: (reducers: ReducersMapObject) => {\n        Object.entries(modules).forEach(([key, module]) => {\n          if (\n            key !== 'storage' &&\n            key !== 'globalStorage' &&\n            module instanceof RcModuleV2\n          ) {\n            module[spawnStorageReducersKey]();\n          }\n        });\n        if (modules.storage) {\n          Object.assign(reducers, {\n            storage: modules.storage.reducer,\n          });\n        }\n        if (modules.globalStorage) {\n          Object.assign(reducers, {\n            globalStorage: modules.globalStorage.reducer,\n          });\n        }\n        return combineReducers(reducers);\n      },\n    },\n  );\n  main._initModule().then(() => {\n    // For scenarios without dependency injection\n    Object.values(modules).forEach((module) => module?._initModule?.());\n  });\n  return main;\n};\n"],"mappings":"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"}