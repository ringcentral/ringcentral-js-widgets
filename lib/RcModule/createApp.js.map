{"version":3,"file":"createApp.js","names":["_redux","require","_RcModule","_slicedToArray","r","e","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","l","t","Symbol","iterator","n","i","u","a","f","o","call","next","Object","done","push","value","length","Array","isArray","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","_arrayLikeToArray","toString","slice","constructor","name","from","test","createApp","exports","_ref","main","_ref$modules","modules","reduxEnhancer","createStore","concat","values","strict","undefined","handleReducers","reducers","entries","forEach","_ref2","_ref3","key","module","RcModuleV2","spawnStorageReducersKey","storage","assign","reducer","globalStorage","combineReducers","_initModule","then","_module$_initModule"],"sources":["lib/RcModule/createApp.ts"],"sourcesContent":["import type { ReducersMapObject, StoreEnhancer } from 'redux';\nimport { combineReducers } from 'redux';\n\nimport { createStore, RcModuleV2, spawnStorageReducersKey } from './RcModule';\n\n/**\n * Create app with FactoryModule based on RcModuleV2.\n * !! Please ensure that all dependency injection modules are based on the RcModuleV2 module.\n */\nexport const createApp = ({\n  main,\n  modules = {},\n  reduxEnhancer,\n}: {\n  main: RcModuleV2;\n  modules?: Record<string, RcModuleV2>;\n  reduxEnhancer?: StoreEnhancer;\n}) => {\n  createStore(\n    {\n      modules: [...Object.values(modules), main],\n      // disable AutoFreeze\n      strict: false,\n    },\n    undefined,\n    {\n      reduxEnhancer,\n      handleReducers: (reducers: ReducersMapObject) => {\n        Object.entries(modules).forEach(([key, module]) => {\n          if (\n            key !== 'storage' &&\n            key !== 'globalStorage' &&\n            module instanceof RcModuleV2\n          ) {\n            module[spawnStorageReducersKey]();\n          }\n        });\n        if (modules.storage) {\n          Object.assign(reducers, {\n            storage: modules.storage.reducer,\n          });\n        }\n        if (modules.globalStorage) {\n          Object.assign(reducers, {\n            globalStorage: modules.globalStorage.reducer,\n          });\n        }\n        return combineReducers(reducers);\n      },\n    },\n  );\n  main._initModule().then(() => {\n    // For scenarios without dependency injection\n    Object.values(modules).forEach((module) => module?._initModule?.());\n  });\n  return main;\n};\n"],"mappings":"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","ignoreList":[]}