{"version":3,"sources":["lib/RcModule/index.js"],"names":["defaultReducer","defaultGetState","store","getState","defaultGetProxyState","RcModule","deps","dep","optional","warn","getProxyState","prefix","actionTypes","_actionTypes","Error","_getState","_getProxyState","_prefix","_prefixedActionTypes","enumMap","_reducer","_proxyReducer","_modulePath","_selectors","name","module","Object","prototype","hasOwnProperty","get","enumerable","modulePath","args","selector","pop","length","_store","_setStore","_initModule","subModule","subscribe","_onStateChange","_suppressInit","_initialized","initialize","status","ready","pending","proxyStatus","bootstrap"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\nimport { Injector, Library } from '../di';\nimport { prefixEnum } from '../Enum';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport proxyStatuses from '../../enums/proxyStatuses';\nimport once from '../once';\nimport required from '../required';\nimport deprecated from '../deprecated';\n\n/**\n * @function\n * @param {Object} state\n * @return {Object}\n * @description Default reducer if module does not has its own reducer.\n */\nfunction defaultReducer() {\n  return null;\n}\n\n/**\n * @function\n * @return any\n * @description Default getState function\n */\nfunction defaultGetState() {\n  return this.store.getState();\n}\n\nfunction defaultGetProxyState() {\n  return {};\n}\n\n/**\n * @class\n * @default\n * @description Base module class.\n */\n@Library({\n  deps: [{ dep: 'ModuleOptions', optional: true }]\n})\nexport default class RcModule {\n  /**\n   * @constructor\n   * @param {Function} options.getState\n   * @param {String} options.prefix\n   * @param {Enum} options.actionTypes,\n   */\n  constructor({\n    getState = defaultGetState,\n    getProxyState = defaultGetProxyState,\n    prefix,\n    actionTypes = this._actionTypes,\n  } = {}) {\n    if (typeof getState !== 'function') {\n      throw new Error(\n        'The `getState` options property must be of type function'\n      );\n    }\n    this._getState = getState;\n    this._getProxyState = getProxyState;\n    if (prefix && typeof prefix !== 'string') {\n      throw new Error('The `prefix` options property must be null, undefined, or a string');\n    }\n    this._prefix = prefix;\n    this._prefixedActionTypes = actionTypes && prefixEnum({ enumMap: actionTypes, prefix });\n    this._reducer = defaultReducer;\n    this._proxyReducer = defaultReducer;\n    this._modulePath = 'root';\n    this._selectors = {};\n  }\n\n  @required.warn\n  get _actionTypes() {\n    /* should be implemented by descendant */\n    return null;\n  }\n\n  /**\n   * @property\n   * @type any\n   * @description The state of the module\n   */\n  get state() {\n    return this._getState();\n  }\n  get proxyState() {\n    return this._getProxyState();\n  }\n\n  /**\n   * @property\n   * @type Function\n   * @description The reducer function of the module\n   */\n  get reducer() {\n    return this._reducer;\n  }\n\n  get proxyReducer() {\n    return this._proxyReducer;\n  }\n\n  /**\n   * @property\n   * @type Object\n   * @description The store object of the module\n   */\n  get store() {\n    if (!this._store) {\n      throw new Error('module has not been initialized...');\n    }\n    return this._store;\n  }\n  /**\n   * @property\n   * @type String\n   * @description The prefix string of this module\n   */\n  get prefix() {\n    return this._prefix;\n  }\n  /**\n   * @property\n   * @type Enum\n   * @description The actionTypes used by the module\n   */\n  get actionTypes() {\n    return this._prefixedActionTypes;\n  }\n  /**\n   * @property\n   * @type String\n   * @description The canonical path of the module from the root module\n   */\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * @function addModule\n   * @param {String} name - Name of the module. Also used for the property name.\n   * @param {any} module - The module to be attached, can be any type.\n   * @description Add the desired module to the\n   */\n  addModule(name, module) {\n    if (this:: Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    // tag submodule with a modulePath for proxying function calls\n    // do nothing if module is already tagged\n    if (this[name]._modulePath === 'root') {\n      this[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @description Add the selector to the internal selector object.\n   *  This is intended to be called with this.addSelector(name, selectorFn) or\n   *  this.addSelector(name, [...dependenciesFns], selectorFn);\n   */\n  @deprecated\n  addSelector(name, ...args) {\n    if (this._selectors:: Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Selector '${name}' already exists...`);\n    }\n    const selector = args.pop();\n    if (args.length > 0) {\n      this._selectors[name] = createSelector(...args, selector);\n    } else {\n      this._selectors[name] = selector;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @return {Function}\n   * @description Returns the named selector function\n   */\n  @deprecated\n  getSelector(name) {\n    return this._selectors[name];\n  }\n\n  /**\n   * @function\n   * @param {Object} store\n   * @description Set the store to the modules and initialize the modules.\n   *   This should only be called once.\n   */\n  setStore(store) {\n    if (this._modulePath !== 'root') {\n      throw new Error('setStore should only be called on root module');\n    }\n    if (!store) {\n      throw new Error('setStore must accept a store object');\n    }\n    if (this._store) {\n      throw new Error('setStore should only be called once');\n    }\n    this._setStore(store);\n    this._initModule();\n  }\n  _setStore(store) {\n    this._store = store;\n    for (const subModule in this) {\n      if (\n        this:: Object.prototype.hasOwnProperty(subModule) &&\n          this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._setStore(store);\n      }\n    }\n  }\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  @once\n  @required.warn\n  _onStateChange() {}\n\n  _initModule() {\n    if (\n      !this._suppressInit &&\n      !this._initialized\n    ) {\n      this._initialized = true;\n      this.initialize();\n    }\n    for (const subModule in this) {\n      if (\n        this:: Object.prototype.hasOwnProperty(subModule) &&\n          this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._initModule();\n      }\n    }\n  }\n\n  static create() {\n    return Injector.bootstrap(this);\n  }\n\n  /**\n   * Represents for module status, should be implemented by child class.\n   */\n  get status() {\n    throw new Error('status should be implemented.');\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get proxyStatus() {\n    return proxyStatuses.ready;\n  }\n\n  get proxyReady() {\n    return this.proxyStatus === proxyStatuses.ready;\n  }\n\n  get proxyPending() {\n    return this.proxyStatus === proxyStatuses.pending;\n  }\n}\n"]}