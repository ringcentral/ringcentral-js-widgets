{"version":3,"sources":["lib/RcModule/RcModule.ts"],"names":["ModuleStatus","onceKey","Symbol","onInitOnceKey","notReadyModulesKey","checkStatusChangeKey","enableCacheKey","enableGlobalCacheKey","storageKey","storageStateKey","globalStorageStateKey","spawnReducersKey","spawnStorageReducersKey","ignoreReadyModulesKey","RcModuleV2","deps","enableCache","enableGlobalCache","options","_transport","Set","_deps","_modulePath","_initialized","_suppressInit","_reducers","_getStateV2","state","key","onStateChange","storage","forEach","stateKey","globalStorage","status","onInitOnce","_shouldInit","_setStatus","Initializing","onInit","Ready","onInitSuccess","_shouldReset","Resetting","onReset","Pending","dep","add","areAllReady","length","pending","areNotReady","ready","descriptors","descriptor","Object","getOwnPropertyDescriptor","initialState","value","storageReducerKey","registerReducer","reducer","action","_usm","usmAction","_state","data","assign","enumerable","configurable","get","stagedState","set","defineProperties","_initModule","storeKey","getState","identifierKey","keys","reduce","serviceReducersMapObject","stateDescriptor","parentModule","subscriptionsKey","subscribe","subModule","subRcModule","name","module","prototype","hasOwnProperty","call","Error","defineProperty","modulePath","modules","values","filter","has","store"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA,6BAAc,KAAd;AACA,gCAAiB,IAAjB;AACA;IAEkBA,Y;;;WAAAA,Y;AAAAA,EAAAA,Y;AAAAA,EAAAA,Y;AAAAA,EAAAA,Y;AAAAA,EAAAA,Y;GAAAA,Y,4BAAAA,Y;;AAOX,IAAMC,OAAsB,GAAGC,MAAM,CAAC,MAAD,CAArC;;AACA,IAAMC,aAA4B,GAAGD,MAAM,CAAC,YAAD,CAA3C;;AACA,IAAME,kBAAiC,GAAGF,MAAM,CAAC,iBAAD,CAAhD;;AACA,IAAMG,oBAAmC,GAAGH,MAAM,CAAC,mBAAD,CAAlD;;AACA,IAAMI,cAA6B,GAAGJ,MAAM,CAAC,aAAD,CAA5C;;AACA,IAAMK,oBAAmC,GAAGL,MAAM,CAAC,mBAAD,CAAlD;;AACA,IAAMM,UAAyB,GAAGN,MAAM,CAAC,SAAD,CAAxC;;AACA,IAAMO,eAA8B,GAAGP,MAAM,CAAC,cAAD,CAA7C;;AACA,IAAMQ,qBAAoC,GAAGR,MAAM,CACxD,oBADwD,CAAnD;;AAGA,IAAMS,gBAA+B,GAAGT,MAAM,CAAC,eAAD,CAA9C;;AACA,IAAMU,uBAAsC,GAAGV,MAAM,CAC1D,sBAD0D,CAArD;;AAGA,IAAMW,qBAAoC,GAAGX,MAAM,CACxD,oBADwD,CAAnD;;AAwBP;IACeY,U;AAuCb,wBAK4B;AAAA;;AAAA,mFAAJ,EAAI;;AAAA,QAJ1BC,IAI0B,QAJ1BA,IAI0B;AAAA,gCAH1BC,WAG0B;AAAA,QAH1BA,WAG0B,iCAHZ,KAGY;AAAA,qCAF1BC,iBAE0B;AAAA,QAF1BA,iBAE0B,sCAFN,KAEM;AAAA,QADvBC,OACuB;;AAAA;;AAAA,SA3CnBjB,OA2CmB,IA3CR,KA2CQ;AAAA,SAzCnBO,UAyCmB;AAAA,SAvCnBF,cAuCmB;AAAA,SArCnBC,oBAqCmB;AAAA,SAhClBY,UAgCkB;AAAA,SA/BnBN,qBA+BmB,IA/BM,IAAIO,GAAJ,EA+BN;AAAA,SAPlBC,KAOkB;;AAAA;;AAAA,SA2MpBC,WA3MoB,GA2MN,MA3MM;AAAA,SA6MpBC,YA7MoB,GA6ML,KA7MK;AAAA,SA+MpBC,aA/MoB;AAAA,SAiNlBC,SAjNkB;;AAAA,SAmNlBC,WAnNkB,GAmNJ,UAACC,KAAD,EAA6BC,GAA7B;AAAA,aACtBD,KAAK,CAACC,GAAD,CADiB;AAAA,KAnNI;;AAC1B,SAAKP,KAAL,GAAaN,IAAb;AACA,SAAKP,UAAL,IAAmBU,OAAO,CAACV,UAA3B;AACA,SAAKF,cAAL,IAAuBU,WAAvB;AACA,SAAKT,oBAAL,IAA6BU,iBAA7B;AACA,6BAAU,IAAV,EAAgB,YAAM;AACpB,UAAI,OAAO,KAAI,CAACY,aAAZ,KAA8B,UAAlC,EAA8C;AAC5C,QAAA,KAAI,CAACA,aAAL;AACD;;AACD,MAAA,KAAI,CAACxB,oBAAD,CAAJ;AACD,KALD;;AAMA,QACE,CAAC,KAAKI,eAAL,CAAD,IACA,CAAC,KAAKH,cAAL,CADD,IAEA,CAAC,KAAKe,KAAL,CAAWS,OAHd,EAIE;AACA,WAAKrB,eAAL,IAAwB,EAAxB;AACD;;AACD,SAAKA,eAAL,EAAsBsB,OAAtB,CAA8B,UAACH,GAAD;AAAA,aAAS,OAAO,KAAI,CAACI,kBAAD,CAAJ,CAAeJ,GAAf,CAAhB;AAAA,KAA9B;;AACA,QACE,CAAC,KAAKlB,qBAAL,CAAD,IACA,CAAC,KAAKH,oBAAL,CADD,IAEA,CAAC,KAAKc,KAAL,CAAWY,aAHd,EAIE;AACA,WAAKvB,qBAAL,IAA8B,EAA9B;AACD;;AACD,SAAKA,qBAAL,EAA4BqB,OAA5B,CAAoC,UAACH,GAAD;AAAA,aAAS,OAAO,KAAI,CAACI,kBAAD,CAAJ,CAAeJ,GAAf,CAAhB;AAAA,KAApC;AACD;;;;+BAMkBM,M,EAAsB;AACvC,WAAKA,MAAL,GAAcA,MAAd;AACD;;SAEc/B,a;;;;;;;oBACR,KAAKF,OAAL,C;;;;;AACH,qBAAKA,OAAL,IAAgB,IAAhB;;sBACI,OAAO,KAAKkC,UAAZ,KAA2B,U;;;;;;uBACvB,KAAKA,UAAL,E;;;;;;;;;;;;;;;;;SAKG9B,oB;;;;;;;qBACT,KAAK+B,WAAL,E;;;;;AACF,qBAAKC,UAAL,CAAgBrC,YAAY,CAACsC,YAA7B;;;uBACM,KAAKnC,aAAL,G;;;sBACF,OAAO,KAAKoC,MAAZ,KAAuB,U;;;;;;uBACnB,KAAKA,MAAL,E;;;AAER,qBAAKF,UAAL,CAAgBrC,YAAY,CAACwC,KAA7B;;sBACI,OAAO,KAAKC,aAAZ,KAA8B,U;;;;;;uBAC1B,KAAKA,aAAL,E;;;;;;;qBAEC,KAAKC,YAAL,E;;;;;AACT,qBAAKL,UAAL,CAAgBrC,YAAY,CAAC2C,SAA7B;;sBACI,OAAO,KAAKC,OAAZ,KAAwB,U;;;;;;uBACpB,KAAKA,OAAL,E;;;AAER,qBAAKP,UAAL,CAAgBrC,YAAY,CAAC6C,OAA7B;;;;;;;;;;;;;;;;;;2CAI6BC,G,EAAiB;AAChD,WAAKjC,qBAAL,EAA4BkC,GAA5B,CAAgCD,GAAhC;AACD;;;kCAaa;AACZ,UAAME,WAAW,GAAG,KAAK5C,kBAAL,EAAyB6C,MAAzB,KAAoC,CAAxD;AACA,aAAOD,WAAW,IAAI,KAAKE,OAA3B;AACD;;;mCAEc;AACb,UAAMC,WAAW,GAAG,KAAK/C,kBAAL,EAAyB6C,MAAzB,GAAkC,CAAtD;AACA,aAAOE,WAAW,IAAI,KAAKC,KAA3B;AACD;;SAsBQxC,uB;4BAA2B;AAAA;;AAClC,UAAMyC,WAAkC,GAAG,EAA3C;AACA;AACJ;AACA;;AACI,WAAK5C,eAAL,EAAsBsB,OAAtB,CAA8B,UAACH,GAAD,EAAS;AACrC,YAAM0B,UAAU,GAAGC,MAAM,CAACC,wBAAP,CAAgC,MAAhC,EAAsC5B,GAAtC,CAAnB;AACA,YAAI,OAAO0B,UAAP,KAAsB,WAA1B,EAAuC;AACvC,YAAMG,YAAY,GAAGH,UAAU,CAACI,KAAhC;AACA,YAAMC,iBAAiB,aAAM,MAAI,CAACnD,UAAD,CAAV,cAA0BoB,GAA1B,CAAvB;;AACA,QAAA,MAAI,CAACP,KAAL,CAAWS,OAAX,CAAmB8B,eAAnB,CAAmC;AACjChC,UAAAA,GAAG,EAAE+B,iBAD4B;AAEjCE,UAAAA,OAAO,EAAE;AAAA,gBAAClC,KAAD,uEAAS8B,YAAT;AAAA,gBAAuBK,MAAvB;AAAA,mBACPA,MAAM,CAACC,IAAP,KAAgBC,aAAhB,GACI,MAAI,CAACtC,WAAL,CAAiBoC,MAAM,CAACG,MAAxB,EAAgC,SAAhC,EAA2CC,IAA3C,CAAgDP,iBAAhD,CADJ,GAEIhC,KAHG;AAAA;AAFwB,SAAnC;;AAOA4B,QAAAA,MAAM,CAACY,MAAP,CAAcd,WAAd,sBACGzB,GADH,EACS;AACLwC,UAAAA,UAAU,EAAE,IADP;AAELC,UAAAA,YAAY,EAAE,KAFT;AAGLC,UAAAA,GAHK,iBAGc;AACjB,gBAAMC,WAAgB,GAAG,+BAAzB;AACA,mBAAOA,WAAW,GACd,KAAK7C,WAAL,CAAiB6C,WAAjB,EAA8B,SAA9B,EAAyCL,IAAzC,CACEP,iBADF,CADc,GAId,KAAKtC,KAAL,CAAWS,OAAX,CAAmBoC,IAAnB,CAAyBP,iBAAzB,CAJJ;AAKD,WAVI;AAWLa,UAAAA,GAXK,eAWcd,KAXd,EAW8B;AACjC,gBAAMa,WAAW,GAAG,+BAApB;;AACA,gBAAIA,WAAJ,EAAiB;AACf,mBAAK7C,WAAL,CAAiB6C,WAAjB,EAA8B,SAA9B,EAAyCL,IAAzC,CACEP,iBADF,IAEID,KAFJ;AAGA;AACD;;AACD,iBAAKrC,KAAL,CAAWS,OAAX,CAAmBoC,IAAnB,CAAyBP,iBAAzB,IAA8CD,KAA9C;AACD;AApBI,SADT;AAwBD,OApCD;AAsCA;AACJ;AACA;;AACI,WAAKhD,qBAAL,EAA4BqB,OAA5B,CAAoC,UAACH,GAAD,EAAS;AAC3C,YAAM0B,UAAU,GAAGC,MAAM,CAACC,wBAAP,CAAgC,MAAhC,EAAsC5B,GAAtC,CAAnB;AACA,YAAI,OAAO0B,UAAP,KAAsB,WAA1B,EAAuC;AACvC,YAAMG,YAAY,GAAGH,UAAU,CAACI,KAAhC;AACA,YAAMC,iBAAiB,aAAM,MAAI,CAACnD,UAAD,CAAV,cAA0BoB,GAA1B,CAAvB;;AACA,QAAA,MAAI,CAACP,KAAL,CAAWY,aAAX,CAAyB2B,eAAzB,CAAyC;AACvChC,UAAAA,GAAG,EAAE+B,iBADkC;AAEvCE,UAAAA,OAAO,EAAE;AAAA,gBAAClC,KAAD,uEAAS8B,YAAT;AAAA,gBAAuBK,MAAvB;AAAA,mBACPA,MAAM,CAACC,IAAP,KAAgBC,aAAhB,GACI,MAAI,CAACtC,WAAL,CAAiBoC,MAAM,CAACG,MAAxB,EAAgC,eAAhC,EAAiDC,IAAjD,CACEP,iBADF,CADJ,GAIIhC,KALG;AAAA;AAF8B,SAAzC;;AASA4B,QAAAA,MAAM,CAACY,MAAP,CAAcd,WAAd,sBACGzB,GADH,EACS;AACLwC,UAAAA,UAAU,EAAE,IADP;AAELC,UAAAA,YAAY,EAAE,KAFT;AAGLC,UAAAA,GAHK,iBAGc;AACjB,gBAAMC,WAAW,GAAG,+BAApB;AACA,mBAAOA,WAAW,GACd,KAAK7C,WAAL,CAAiB6C,WAAjB,EAA8B,eAA9B,EAA+CL,IAA/C,CACEP,iBADF,CADc,GAId,KAAKtC,KAAL,CAAWY,aAAX,CAAyBiC,IAAzB,CAA+BP,iBAA/B,CAJJ;AAKD,WAVI;AAWLa,UAAAA,GAXK,eAWcd,KAXd,EAW8B;AACjC,gBAAMa,WAAW,GAAG,+BAApB;;AACA,gBAAIA,WAAJ,EAAiB;AACf,mBAAK7C,WAAL,CAAiB6C,WAAjB,EAA8B,eAA9B,EAA+CL,IAA/C,CACEP,iBADF,IAEID,KAFJ;AAGA;AACD;;AACD,iBAAKrC,KAAL,CAAWY,aAAX,CAAyBiC,IAAzB,CAA+BP,iBAA/B,IAAoDD,KAApD;AACD;AApBI,SADT;AAwBD,OAtCD;AAwCAH,MAAAA,MAAM,CAACkB,gBAAP,CAAwB,IAAxB,EAA8BpB,WAA9B;AACD,K,CAED;AACA;;;;gCAaoB;AAClB,aAAO,KAAKqB,WAAL,EAAP;AACD;;SAMQ/D,gB;4BAAoB;AAAA;AAAA;;AAC3B,UAAM0C,WAAkC,uBACrCrB,kBADqC,EAC1B;AACVoC,QAAAA,UAAU,EAAE,KADF;AAEVC,QAAAA,YAAY,EAAE,KAFJ;AAGVC,QAAAA,GAHU,iBAGS;AAAA;;AACjB,cAAMC,WAAW,GAAG,+BAApB;AACA,iBAAO,KAAK7C,WAAL,CACL6C,WADK,aACLA,WADK,cACLA,WADK,qBACU,KAAKI,kBAAL,CADV,mDACU,eAAgBC,QAAhB,EADV,EAEL,KAAKC,uBAAL,CAFK,CAAP;AAID;AATS,OAD0B,CAAxC;;AAaA,WAAKpD,SAAL,GAAiB8B,MAAM,CAACuB,IAAP,mBAAY,KAAK9C,kBAAL,CAAZ,2DAA8B,EAA9B,EAAkC+C,MAAlC,CACf,UAACC,wBAAD,EAA8CpD,GAA9C,EAAsD;AACpD,YAAM0B,UAAU,GAAGC,MAAM,CAACC,wBAAP,CAAgC,MAAhC,EAAsC5B,GAAtC,CAAnB;AACA,YAAI,OAAO0B,UAAP,KAAsB,WAA1B,EAAuC,OAAO0B,wBAAP;AACvC,YAAMvB,YAAY,GAAGH,UAAU,CAACI,KAAhC;AACAH,QAAAA,MAAM,CAACY,MAAP,CAAcd,WAAd,sBACGzB,GADH,EACS;AACLwC,UAAAA,UAAU,EAAE,IADP;AAELC,UAAAA,YAAY,EAAE,KAFT;AAGLC,UAAAA,GAHK,iBAGc;AACjB,mBAAO,KAAKtC,kBAAL,EAAeJ,GAAf,CAAP;AACD,WALI;AAML4C,UAAAA,GANK,eAMcd,KANd,EAM8B;AACjC,iBAAK1B,kBAAL,EAAeJ,GAAf,IAAsB8B,KAAtB;AACD;AARI,SADT;AAYA,eAAOH,MAAM,CAACY,MAAP,CAAca,wBAAd,sBACJpD,GADI,EACE;AAAA,cAACD,KAAD,uEAAS8B,YAAT;AAAA,cAAuBK,MAAvB;AAAA,iBACLA,MAAM,CAACC,IAAP,KAAgBC,aAAhB,GACI,MAAI,CAACtC,WAAL,CAAiBoC,MAAM,CAACG,MAAxB,EAAgC,MAAI,CAACY,uBAAD,CAApC,EAAqDjD,GAArD,CADJ,GAEID,KAHC;AAAA,SADF,EAAP;AAMD,OAvBc,EAwBf,EAxBe,CAAjB;AA0BA,UAAMsD,eAAe,GAAG1B,MAAM,CAACC,wBAAP,CAAgC,IAAhC,EAAsCxB,kBAAtC,CAAxB;AACA,UAAIiD,eAAe,IAAI,OAAOA,eAAe,CAACX,GAAvB,KAA+B,UAAtD,EAAkE;AAClEf,MAAAA,MAAM,CAACkB,gBAAP,CAAwB,IAAxB,EAA8BpB,WAA9B;AACD;;;;;;;;;;;AAUC,qBAAK9B,YAAL,GAAoB,IAApB;;AACA,oBACG,KAAK2D,YAAL,IAAqB,EAAE,KAAKA,YAAL,YAA6BpE,UAA/B,CAAtB,IACC,CAAC,KAAKoE,YAAN,IAAsB,EAAE,gBAAgBpE,UAAlB,CAFzB,EAGE;AAAA,kFACwB,KAAKqE,0BAAL,CADxB,yEACkD,EADlD;;AAAA;AACA,wEAAsD;AAA3CC,sBAAAA,UAA2C;;AACpDA,sBAAAA,UAAS;AACV;AAHD;AAAA;AAAA;AAAA;AAAA;;AAIA,uBAAKD,0BAAL,IAAyB,EAAzB;AACD;;;uBACK,KAAK9E,oBAAL,G;;;AACN;AACA,qBAAWgF,SAAX,IAAwB,IAAxB,EAA8B;AACtBC,kBAAAA,WADsB,GACR,KAAKD,SAAL,CADQ;;AAE5B,sBACEC,WAAW,IACX,OAAOA,WAAW,CAACZ,WAAnB,KAAmC,UADnC,IAEA,CAACY,WAAW,CAAC/D,YAFb,IAGA,CAAC+D,WAAW,CAAC9D,aAJf,EAKE;AACA8D,oBAAAA,WAAW,CAACZ,WAAZ;AACD;AACF;;;;;;;;;;;;;;;;;;8BAWea,I,EAAcC,M,EAAiB;AAC/C,UAAIjC,MAAM,CAACkC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC,IAArC,EAA2CJ,IAA3C,CAAJ,EAAsD;AACpD,cAAM,IAAIK,KAAJ,qBAAuBL,IAAvB,yBAAN;AACD;;AACDhC,MAAAA,MAAM,CAACsC,cAAP,CAAsB,IAAtB,EAA4BN,IAA5B,EAAkC;AAChCjB,QAAAA,GADgC,iBAC1B;AACJ,iBAAOkB,MAAP;AACD,SAH+B;AAIhCpB,QAAAA,UAAU,EAAE;AAJoB,OAAlC;;AAMA,UAAK,IAAD,CAAcmB,IAAd,EAAoBjE,WAApB,KAAoC,MAAxC,EAAgD;AAC7C,YAAD,CAAciE,IAAd,EAAoBjE,WAApB,aAAqC,KAAKwE,UAA1C,cAAwDP,IAAxD;AACD;AACF;;;kCAMqB;AACpB,aAAO,EAAP;AACD;;SAnQYnF,kB;wBAAsB;AAAA;;AACjC,UAAM2F,OAAO,GAAGxC,MAAM,CAACyC,MAAP,CAAc,KAAK3E,KAAL,IAAc,EAA5B,EAAgC4E,MAAhC,EACd;AACA,gBAACT,MAAD;AAAA,eAAwBA,MAAM,IAAI,OAAOA,MAAM,CAACpC,KAAd,KAAwB,WAA1D;AAAA,OAFc,CAAhB;AAIA,aAAO2C,OAAO,CAACE,MAAR,CACL,UAACT,MAAD;AAAA,eACE,CAACA,MAAM,CAACpC,KAAR,IAAiB,CAAC,MAAI,CAACvC,qBAAD,CAAJ,CAA4BqF,GAA5B,CAAgCV,MAAhC,CADpB;AAAA,OADK,CAAP;AAID;;;wBAYa;AACZ,aAAO,KAAKtD,MAAL,KAAgBlC,YAAY,CAAC6C,OAApC;AACD;;;wBAEW;AACV,aAAO,KAAKX,MAAL,KAAgBlC,YAAY,CAACwC,KAApC;AACD;;;wBAEe;AACd,aAAO,KAAKN,MAAL,KAAgBlC,YAAY,CAAC2C,SAApC;AACD;;;wBAEkB;AACjB,aAAO,KAAKT,MAAL,KAAgBlC,YAAY,CAACsC,YAApC;AACD;;;wBAEW;AACV,aAAO,KAAKqC,kBAAL,CAAP;AACD;;;wBA6GY;AACX,aAAO,KAAKwB,KAAZ;AACD;;;wBA+Ca;AACZ,UAAI,KAAK1E,SAAT,EAAoB,OAAO,4BAAgB,KAAKA,SAArB,CAAP;AACpB,WAAKb,uBAAL;AACA,WAAKD,gBAAL;AACA,aAAO,4BAAgB,KAAKc,SAArB,CAAP;AACD;;;wBA4BwB;AACvB,aAAO,KAAK2B,KAAZ;AACD;;;wBAEwB;AACvB,aAAO,KAAK9B,WAAZ;AACD;;;wBAiBmB;AAClB,aAAO,KAAKU,kBAAL,CAAP;AACD;;;;2EAxSAL,e;;;;;WACQ3B,YAAY,CAAC6C,O;;+DAErBiB,gB","sourcesContent":["import { combineReducers, ReducersMapObject } from 'redux';\nimport {\n  action,\n  Action,\n  applyPatches,\n  computed,\n  createStore,\n  enableES5,\n  enablePatches,\n  getStagedState,\n  identifierKey,\n  Service,\n  setAutoFreeze,\n  setPatchesToggle,\n  state,\n  stateKey,\n  Store,\n  storeKey,\n  subscribe,\n  Subscription,\n  subscriptionsKey,\n  usm as usmAction,\n  watch,\n  watchEffect,\n} from '../usm-redux';\n\nsetAutoFreeze(false);\nsetPatchesToggle(true);\nenablePatches();\n\nexport const enum ModuleStatus {\n  Pending = 'PENDING',\n  Initializing = 'INITIALIZING',\n  Ready = 'READY',\n  Resetting = 'RESETTING',\n}\n\nexport const onceKey: unique symbol = Symbol('once');\nexport const onInitOnceKey: unique symbol = Symbol('onInitOnce');\nexport const notReadyModulesKey: unique symbol = Symbol('notReadyModules');\nexport const checkStatusChangeKey: unique symbol = Symbol('checkStatusChange');\nexport const enableCacheKey: unique symbol = Symbol('enableCache');\nexport const enableGlobalCacheKey: unique symbol = Symbol('enableGlobalCache');\nexport const storageKey: unique symbol = Symbol('storage');\nexport const storageStateKey: unique symbol = Symbol('storageState');\nexport const globalStorageStateKey: unique symbol = Symbol(\n  'globalStorageState',\n);\nexport const spawnReducersKey: unique symbol = Symbol('spawnReducers');\nexport const spawnStorageReducersKey: unique symbol = Symbol(\n  'spawnStorageReducers',\n);\nexport const ignoreReadyModulesKey: unique symbol = Symbol(\n  'ignoreReadyModules',\n);\n\nexport interface RcModuleOptions<T> {\n  deps?: T & {\n    storage?: any;\n    globalStorage?: any;\n  };\n  enableCache?: boolean;\n  enableGlobalCache?: boolean;\n  storageKey?: string;\n}\n\ninterface RcModuleV2 {\n  parentModule: RcModuleV2;\n  [storageStateKey]?: string[];\n  [globalStorageStateKey]?: string[];\n  [stateKey]: Record<string, any>;\n  [identifierKey]: string;\n  [subscriptionsKey]: Subscription[];\n  [storeKey]: Store;\n}\n\n// eslint-disable-next-line no-redeclare\nabstract class RcModuleV2<T = {}> {\n  private [onceKey] = false;\n\n  private [storageKey]: string;\n\n  private [enableCacheKey]: boolean;\n\n  private [enableGlobalCacheKey]: boolean;\n\n  /**\n   * background/client transport for browser extension\n   */\n  protected _transport?: any; // TODO: add transport type\n  private [ignoreReadyModulesKey] = new Set<RcModuleV2>();\n\n  protected initializeProxy?(): Promise<void> | void;\n  /**\n   * `onInit` life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInit?(): Promise<void> | void;\n  /**\n   * `onInitOnce` once life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInitOnce?(): Promise<void> | void;\n  /**\n   * `onInitSuccess` life cycle for current initialization after this module is ready.\n   */\n  protected onInitSuccess?(): Promise<void> | void;\n  /**\n   * `onReset` life cycle for current reset before one of deps modules is not ready.\n   */\n  protected onReset?(): Promise<void> | void;\n  /**\n   * Each Redux dispatch action will trigger `onStateChange` once.\n   */\n  protected onStateChange?(): Promise<void> | void;\n\n  protected _deps: T & { storage?: any; globalStorage?: any };\n\n  constructor({\n    deps,\n    enableCache = false,\n    enableGlobalCache = false,\n    ...options\n  }: RcModuleOptions<T> = {}) {\n    this._deps = deps;\n    this[storageKey] = options.storageKey;\n    this[enableCacheKey] = enableCache;\n    this[enableGlobalCacheKey] = enableGlobalCache;\n    subscribe(this, () => {\n      if (typeof this.onStateChange === 'function') {\n        this.onStateChange();\n      }\n      this[checkStatusChangeKey]();\n    });\n    if (\n      !this[storageStateKey] ||\n      !this[enableCacheKey] ||\n      !this._deps.storage\n    ) {\n      this[storageStateKey] = [];\n    }\n    this[storageStateKey].forEach((key) => delete this[stateKey][key]);\n    if (\n      !this[globalStorageStateKey] ||\n      !this[enableGlobalCacheKey] ||\n      !this._deps.globalStorage\n    ) {\n      this[globalStorageStateKey] = [];\n    }\n    this[globalStorageStateKey].forEach((key) => delete this[stateKey][key]);\n  }\n\n  @state\n  status = ModuleStatus.Pending;\n\n  @action\n  private _setStatus(status: ModuleStatus) {\n    this.status = status;\n  }\n\n  private async [onInitOnceKey]() {\n    if (!this[onceKey]) {\n      this[onceKey] = true;\n      if (typeof this.onInitOnce === 'function') {\n        await this.onInitOnce();\n      }\n    }\n  }\n\n  private async [checkStatusChangeKey]() {\n    if (this._shouldInit()) {\n      this._setStatus(ModuleStatus.Initializing);\n      await this[onInitOnceKey]();\n      if (typeof this.onInit === 'function') {\n        await this.onInit();\n      }\n      this._setStatus(ModuleStatus.Ready);\n      if (typeof this.onInitSuccess === 'function') {\n        await this.onInitSuccess();\n      }\n    } else if (this._shouldReset()) {\n      this._setStatus(ModuleStatus.Resetting);\n      if (typeof this.onReset === 'function') {\n        await this.onReset();\n      }\n      this._setStatus(ModuleStatus.Pending);\n    }\n  }\n\n  protected _ignoreModuleReadiness(dep: RcModuleV2) {\n    this[ignoreReadyModulesKey].add(dep);\n  }\n\n  private get [notReadyModulesKey]() {\n    const modules = Object.values(this._deps || {}).filter(\n      // In order to be compatible with RcModuleV1\n      (module: RcModuleV2) => module && typeof module.ready !== 'undefined',\n    );\n    return modules.filter(\n      (module: RcModuleV2) =>\n        !module.ready && !this[ignoreReadyModulesKey].has(module),\n    );\n  }\n\n  _shouldInit() {\n    const areAllReady = this[notReadyModulesKey].length === 0;\n    return areAllReady && this.pending;\n  }\n\n  _shouldReset() {\n    const areNotReady = this[notReadyModulesKey].length > 0;\n    return areNotReady && this.ready;\n  }\n\n  get pending() {\n    return this.status === ModuleStatus.Pending;\n  }\n\n  get ready() {\n    return this.status === ModuleStatus.Ready;\n  }\n\n  get resetting() {\n    return this.status === ModuleStatus.Resetting;\n  }\n\n  get initializing() {\n    return this.status === ModuleStatus.Initializing;\n  }\n\n  get store() {\n    return this[storeKey];\n  }\n\n  private [spawnStorageReducersKey]() {\n    const descriptors: PropertyDescriptorMap = {};\n    /**\n     * make storage reducer and state\n     */\n    this[storageStateKey].forEach((key) => {\n      const descriptor = Object.getOwnPropertyDescriptor(this, key);\n      if (typeof descriptor === 'undefined') return;\n      const initialState = descriptor.value;\n      const storageReducerKey = `${this[storageKey]}-${key}`;\n      this._deps.storage.registerReducer({\n        key: storageReducerKey,\n        reducer: (state = initialState, action: Action) =>\n          action._usm === usmAction\n            ? this._getStateV2(action._state, 'storage').data[storageReducerKey]\n            : state,\n      });\n      Object.assign(descriptors, {\n        [key]: {\n          enumerable: true,\n          configurable: false,\n          get(this: Service) {\n            const stagedState: any = getStagedState();\n            return stagedState\n              ? this._getStateV2(stagedState, 'storage').data![\n                  storageReducerKey\n                ]\n              : this._deps.storage.data![storageReducerKey];\n          },\n          set(this: Service, value: unknown) {\n            const stagedState = getStagedState();\n            if (stagedState) {\n              this._getStateV2(stagedState, 'storage').data![\n                storageReducerKey\n              ] = value;\n              return;\n            }\n            this._deps.storage.data![storageReducerKey] = value;\n          },\n        },\n      });\n    });\n\n    /**\n     * make global storage reducer and state\n     */\n    this[globalStorageStateKey].forEach((key) => {\n      const descriptor = Object.getOwnPropertyDescriptor(this, key);\n      if (typeof descriptor === 'undefined') return;\n      const initialState = descriptor.value;\n      const storageReducerKey = `${this[storageKey]}-${key}`;\n      this._deps.globalStorage.registerReducer({\n        key: storageReducerKey,\n        reducer: (state = initialState, action: Action) =>\n          action._usm === usmAction\n            ? this._getStateV2(action._state, 'globalStorage').data[\n                storageReducerKey\n              ]\n            : state,\n      });\n      Object.assign(descriptors, {\n        [key]: {\n          enumerable: true,\n          configurable: false,\n          get(this: Service) {\n            const stagedState = getStagedState();\n            return stagedState\n              ? this._getStateV2(stagedState, 'globalStorage').data![\n                  storageReducerKey\n                ]\n              : this._deps.globalStorage.data![storageReducerKey];\n          },\n          set(this: Service, value: unknown) {\n            const stagedState = getStagedState();\n            if (stagedState) {\n              this._getStateV2(stagedState, 'globalStorage').data![\n                storageReducerKey\n              ] = value;\n              return;\n            }\n            this._deps.globalStorage.data![storageReducerKey] = value;\n          },\n        },\n      });\n    });\n\n    Object.defineProperties(this, descriptors);\n  }\n\n  // TODO: Refactor without RcModuleV1\n  // harmony with RcModule V1 for modules initialization\n\n  private _modulePath = 'root';\n\n  private _initialized = false;\n\n  private _suppressInit?: boolean;\n\n  protected _reducers: ReducersMapObject;\n\n  protected _getStateV2 = (state: Record<string, any>, key: string) =>\n    state[key];\n\n  private _setStore() {\n    return this._initModule();\n  }\n\n  get _store() {\n    return this.store;\n  }\n\n  private [spawnReducersKey]() {\n    const descriptors: PropertyDescriptorMap = {\n      [stateKey]: {\n        enumerable: false,\n        configurable: false,\n        get(this: Service) {\n          const stagedState = getStagedState();\n          return this._getStateV2(\n            stagedState ?? this[storeKey]?.getState(),\n            this[identifierKey],\n          );\n        },\n      },\n    };\n    this._reducers = Object.keys(this[stateKey] ?? {}).reduce(\n      (serviceReducersMapObject: ReducersMapObject, key) => {\n        const descriptor = Object.getOwnPropertyDescriptor(this, key);\n        if (typeof descriptor === 'undefined') return serviceReducersMapObject;\n        const initialState = descriptor.value;\n        Object.assign(descriptors, {\n          [key]: {\n            enumerable: true,\n            configurable: false,\n            get(this: Service) {\n              return this[stateKey][key];\n            },\n            set(this: Service, value: unknown) {\n              this[stateKey][key] = value;\n            },\n          },\n        });\n        return Object.assign(serviceReducersMapObject, {\n          [key]: (state = initialState, action: Action) =>\n            action._usm === usmAction\n              ? this._getStateV2(action._state, this[identifierKey])[key]\n              : state,\n        });\n      },\n      {},\n    );\n    const stateDescriptor = Object.getOwnPropertyDescriptor(this, stateKey);\n    if (stateDescriptor && typeof stateDescriptor.get === 'function') return;\n    Object.defineProperties(this, descriptors);\n  }\n\n  get reducer() {\n    if (this._reducers) return combineReducers(this._reducers);\n    this[spawnStorageReducersKey]();\n    this[spawnReducersKey]();\n    return combineReducers(this._reducers);\n  }\n\n  async _initModule() {\n    this._initialized = true;\n    if (\n      (this.parentModule && !(this.parentModule instanceof RcModuleV2)) ||\n      (!this.parentModule && !(this instanceof RcModuleV2))\n    ) {\n      for (const subscribe of this[subscriptionsKey] ?? []) {\n        subscribe();\n      }\n      this[subscriptionsKey] = [];\n    }\n    await this[checkStatusChangeKey]();\n    // eslint-disable-next-line guard-for-in\n    for (const subModule in this) {\n      const subRcModule = this[subModule] as any;\n      if (\n        subRcModule &&\n        typeof subRcModule._initModule === 'function' &&\n        !subRcModule._initialized &&\n        !subRcModule._suppressInit\n      ) {\n        subRcModule._initModule();\n      }\n    }\n  }\n\n  private get proxyReady() {\n    return this.ready;\n  }\n\n  private get modulePath() {\n    return this._modulePath;\n  }\n\n  private addModule(name: string, module: unknown) {\n    if (Object.prototype.hasOwnProperty.call(this, name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    if ((this as any)[name]._modulePath === 'root') {\n      (this as any)[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  private get state() {\n    return this[stateKey];\n  }\n\n  private actionTypes() {\n    return {};\n  }\n}\n\nexport {\n  RcModuleV2,\n  state,\n  action,\n  subscribe,\n  computed,\n  createStore,\n  watch,\n  watchEffect,\n  stateKey,\n  storeKey,\n  identifierKey,\n  applyPatches,\n  usmAction,\n  enableES5,\n  setAutoFreeze,\n};\n"],"file":"RcModule.js"}