{"version":3,"sources":["lib/getBaseWebpackConfig/getBaseWebpackConfig.ts"],"names":["MD5","input","crypto","createHash","update","digest","getBaseWebpackConfig","analyzeBundle","cacheDirectory","fontFileSizeLimit","imageFileSizeLimit","enableHash","hashPrefix","mode","prefixSvgId","supportedLocales","themeFolder","threadLoaderOptions","useThreadLoader","preferredDevtool","useDevtool","sourceMapLoaderExcludes","babelLoaderExcludes","sassLoaderExcludes","devtool","threadLoader","push","loader","options","plugins","ProvidePlugin","process","Buffer","setImmediate","clearImmediate","DefinePlugin","JSON","stringify","BundleAnalyzerPlugin","rules","test","resolve","fullySpecified","use","search","replace","enforce","exclude","limit","name","esModule","resource","jsx","svgo","removeViewBox","cleanupIDs","prefix","path","basename","modules","localIdentName","autoprefixer","includePaths","cwd","outputStyle","fallback","require","stream","vm","timers","assert","buffer","console","constants","domain","events","http","https","os","punycode","querystring","string_decoder","sys","tty","url","util","zlib","extensions","module"],"mappings":"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","sourcesContent":["import autoprefixer from 'autoprefixer';\nimport crypto from 'crypto';\nimport path from 'path';\nimport { warmup } from 'thread-loader';\nimport type {\n  Configuration,\n  RuleSetRule,\n  RuleSetUseItem,\n  WebpackPluginInstance,\n} from 'webpack';\nimport { DefinePlugin, ProvidePlugin } from 'webpack';\nimport { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer';\n\nfunction MD5(input: string) {\n  return crypto.createHash('MD5').update(input).digest('hex');\n}\n\nexport interface BaseWebpackConfigOptions {\n  analyzeBundle?: boolean;\n  cacheDirectory?: boolean;\n  fontFileSizeLimit?: number;\n  imageFileSizeLimit?: number;\n  hashPrefix?: string;\n  enableHash?: boolean;\n  mode?: Configuration['mode'];\n  prefixSvgId?: boolean;\n  supportedLocales?: string[];\n  themeFolder: string;\n  threadLoaderOptions?: Record<string, any>;\n  useThreadLoader?: boolean;\n  preferredDevtool?: Configuration['devtool'];\n  useDevtool?: boolean;\n  sourceMapLoaderExcludes?: RuleSetRule['exclude'];\n  babelLoaderExcludes?: RuleSetRule['exclude'];\n  sassLoaderExcludes?: (string | RegExp)[];\n}\n\nexport const getBaseWebpackConfig = ({\n  analyzeBundle = false,\n  cacheDirectory = false,\n  fontFileSizeLimit = 15000,\n  imageFileSizeLimit = 20000,\n  enableHash = true,\n  hashPrefix = '',\n  mode = 'production',\n  prefixSvgId = false,\n  supportedLocales = [],\n  themeFolder,\n  threadLoaderOptions = {},\n  useThreadLoader = false,\n  preferredDevtool = 'eval-source-map',\n  useDevtool = mode === 'development',\n  sourceMapLoaderExcludes = /node_modules/,\n  babelLoaderExcludes = /node_modules/,\n  sassLoaderExcludes = [],\n}: BaseWebpackConfigOptions): Configuration => {\n  const devtool = useDevtool ? preferredDevtool : false;\n  const threadLoader: RuleSetUseItem[] = [];\n  if (useThreadLoader) {\n    warmup(threadLoaderOptions, [\n      'source-map-loader',\n      'babel-loader',\n      'sass-loader',\n    ]);\n    threadLoader.push({\n      loader: 'thread-loader',\n      options: threadLoaderOptions,\n    });\n  }\n  const plugins: WebpackPluginInstance[] = [\n    new ProvidePlugin({\n      process: 'process/browser.js',\n      Buffer: ['buffer', 'Buffer'],\n      setImmediate: ['setimmediate', 'setImmedate'],\n      clearImmediate: ['setimmediate', 'clearImmedate'],\n    }),\n    new DefinePlugin({\n      'process.env.NODE_ENV': JSON.stringify(mode),\n    }),\n  ];\n  if (analyzeBundle) {\n    plugins.push(new BundleAnalyzerPlugin());\n  }\n\n  const rules: RuleSetRule[] = [\n    {\n      test: /\\.m?js/,\n      resolve: {\n        fullySpecified: false,\n      },\n    },\n    // material-ui v4.0 issue:\n    // Multiple modules with names that only differ in casing in Popper module.\n    // https://github.com/mui-org/material-ui/issues/14711\n    {\n      test: /node_modules\\/@material-ui\\/core\\/esm\\/Popper\\/Popper\\.js$/,\n      use: {\n        loader: 'string-replace-loader',\n        options: {\n          search: \"import PopperJS from 'popper.js';\",\n          replace:\n            'import PopperJS from \"../../../../popper.js/dist/esm/popper\";',\n        },\n      },\n    },\n  ];\n\n  // source-map-loader\n  if (useDevtool) {\n    rules.push({\n      enforce: 'pre',\n      test: /\\.(js|jsx|ts|tsx)$/,\n      exclude: sourceMapLoaderExcludes,\n      use: ['source-map-loader', ...threadLoader],\n    });\n  }\n  // babel-loader\n  rules.push({\n    test: /\\.(js|jsx|ts|tsx)$/,\n    use: [\n      {\n        loader: 'babel-loader',\n        options: {\n          cacheDirectory,\n        },\n      },\n      {\n        loader: '@ringcentral-integration/locale-loader',\n        options: {\n          supportedLocales,\n        },\n      },\n      ...threadLoader,\n    ],\n    exclude: babelLoaderExcludes,\n  });\n\n  // css\n  rules.push({\n    test: /\\.css$/i,\n    use: ['style-loader', 'css-loader', ...threadLoader],\n  });\n\n  // font\n  rules.push({\n    test: /\\.woff|\\.woff2|.eot|\\.ttf/,\n    use: {\n      loader: 'url-loader',\n      options: {\n        limit: fontFileSizeLimit,\n        name: `fonts/[name]${enableHash ? '_[hash]' : ''}.[ext]`,\n        // TODO: it should be upgrade css-loader and update config\n        esModule: false,\n      },\n    },\n  });\n\n  // svg\n  rules.push({\n    test: /\\.svg/,\n    exclude: /fonts/,\n    use: ({ resource }: { resource: string }) => [\n      'babel-loader',\n      {\n        loader: 'react-svg-loader',\n        options: {\n          jsx: true,\n          svgo: {\n            plugins: [\n              {\n                removeViewBox: false,\n              },\n              ...(prefixSvgId\n                ? [\n                    {\n                      cleanupIDs: {\n                        prefix: `${MD5(path.basename(resource, '.svg'))}-`,\n                      },\n                    },\n                  ]\n                : []),\n            ],\n          },\n        },\n      },\n    ],\n  });\n  // images and svg font\n  rules.push({\n    test: /\\.png|\\.jpg|\\.gif|fonts(\\/|\\\\).*\\.svg/,\n    use: `url-loader?limit=${imageFileSizeLimit}&name=images/[name]${\n      enableHash ? '_[hash]' : ''\n    }.[ext]`,\n  });\n\n  // sass & scss\n  rules.push({\n    test: /\\.sass|\\.scss/,\n    exclude: sassLoaderExcludes,\n    use: [\n      {\n        loader: 'style-loader',\n      },\n      {\n        loader: 'css-loader',\n        options: {\n          modules: true,\n          localIdentName: `${hashPrefix}_[path]_[name]_[local]_[hash:base64:5]`,\n        },\n      },\n      {\n        loader: 'postcss-loader',\n        options: {\n          plugins: () => [autoprefixer],\n        },\n      },\n      {\n        loader: 'sass-loader',\n        options: {\n          includePaths: [\n            themeFolder,\n            path.resolve(process.cwd(), 'node_modules'),\n            path.resolve(process.cwd(), '../../node_modules'),\n          ],\n          outputStyle: 'expanded',\n        },\n      },\n      ...threadLoader,\n    ],\n  });\n\n  // audio\n  rules.push({\n    test: /\\.ogg$|\\.wav$/,\n    use: `file-loader?name=audio/[name]${enableHash ? '_[hash]' : ''}.[ext]`,\n  });\n\n  return {\n    mode,\n    devtool,\n    plugins,\n    resolve: {\n      // webpack < 5 used to include polyfills for node.js core modules by default.\n      // This is no longer the case. Verify if you need this module and configure a polyfill for it.\n      //\n      // more doc: https://webpack.js.org/configuration/resolve/#resolvefallback\n      //\n      fallback: {\n        crypto: require.resolve('crypto-browserify'),\n        stream: require.resolve('stream-browserify'),\n        vm: require.resolve('vm-browserify'),\n        timers: require.resolve('timers-browserify'),\n        process: require.resolve('process/browser'),\n        assert: require.resolve('assert'),\n        buffer: require.resolve('buffer'),\n        console: require.resolve('console-browserify'),\n        constants: require.resolve('constants-browserify'),\n        domain: require.resolve('domain-browser'),\n        events: require.resolve('events'),\n        http: require.resolve('stream-http'),\n        https: require.resolve('https-browserify'),\n        os: require.resolve('os-browserify/browser'),\n        path: require.resolve('path-browserify'),\n        punycode: require.resolve('punycode'),\n        querystring: require.resolve('querystring-es3'),\n        string_decoder: require.resolve('string_decoder'),\n        sys: require.resolve('util'),\n        tty: require.resolve('tty-browserify'),\n        url: require.resolve('url'),\n        util: require.resolve('util'),\n        zlib: require.resolve('browserify-zlib'),\n      },\n      extensions: ['.ts', '.tsx', '.js', '.jsx'],\n    },\n    module: {\n      rules,\n    },\n  };\n};\n"],"file":"getBaseWebpackConfig.js"}