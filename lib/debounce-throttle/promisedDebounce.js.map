{"version":3,"sources":["lib/debounce-throttle/promisedDebounce.ts"],"names":["promisedDebounce","fn","options","promise","reject","resolve","wrappedFn","result","lastResolve","lastReject","args","apply","setTimeout","error","debounced","debouncePromiseFn","Promise","promiseResolve","promiseReject","cancel","Error","flush"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;AAUO,SAASA,gBAAT,OAG6C;AAAA,MAFlDC,EAEkD,QAFlDA,EAEkD;AAAA,MAD/CC,OAC+C;;AAClD,MAAIC,OAA+B,GAAG,IAAtC;AACA,MAAIC,MAA8B,GAAG,IAArC;AACA,MAAIC,OAA8B,GAAG,IAArC;;AAEA,WAASC,SAAT,GAAsD;AACpD,QAAIC,MAAJ;AACA,QAAMC,WAAW,GAAGH,OAApB;AACA,QAAMI,UAAU,GAAGL,MAAnB;AAEAD,IAAAA,OAAO,GAAG,IAAV;AACAC,IAAAA,MAAM,GAAG,IAAT;AACAC,IAAAA,OAAO,GAAG,IAAV;;AAEA,QAAI;AAAA,wCAT2BK,IAS3B;AAT2BA,QAAAA,IAS3B;AAAA;;AACFH,MAAAA,MAAM,GAAGN,EAAE,CAACU,KAAH,CAAS,IAAT,EAAeD,IAAf,CAAT;AACAE,MAAAA,UAAU,CAAC,YAAM;AACfJ,QAAAA,WAAW,CAACD,MAAD,CAAX;AACD,OAFS,EAEP,CAFO,CAAV;AAGA,aAAOA,MAAP;AACD,KAND,CAME,OAAOM,KAAP,EAAc;AACdD,MAAAA,UAAU,CAAC,YAAM;AACfH,QAAAA,UAAU,CAACI,KAAD,CAAV;AACD,OAFS,EAEP,CAFO,CAAV;AAGA,YAAMA,KAAN;AACD;AACF;;AAED,MAAMC,SAAS,GAAG;AAChBb,IAAAA,EAAE,EAAEK;AADY,KAEbJ,OAFa,EAAlB;;AAKA,WAASa,iBAAT,GAG0B;AACxB,QAAI,CAACZ,OAAL,EAAc;AACZA,MAAAA,OAAO,GAAG,IAAIa,OAAJ,CAAY,UAACC,cAAD,EAAiBC,aAAjB,EAAmC;AACvDb,QAAAA,OAAO,GAAGY,cAAV;AACAb,QAAAA,MAAM,GAAGc,aAAT;AACD,OAHS,CAAV;AAID;;AANuB,uCADrBR,IACqB;AADrBA,MAAAA,IACqB;AAAA;;AAOxBI,IAAAA,SAAS,CAACH,KAAV,CAAgB,IAAhB,EAAsBD,IAAtB;AACA,WAAOP,OAAP;AACD;;AAED,WAASgB,MAAT,GAAkB;AAChB,QAAMZ,MAAM,GAAGO,SAAS,CAACK,MAAV,EAAf;;AACA,QAAIhB,OAAJ,EAAa;AACX,UAAMM,UAAU,GAAGL,MAAnB;AACAD,MAAAA,OAAO,GAAG,IAAV;AACAE,MAAAA,OAAO,GAAG,IAAV;AACAD,MAAAA,MAAM,GAAG,IAAT;AACAQ,MAAAA,UAAU,CAAC;AAAA,eAAMH,UAAU,CAAC,IAAIW,KAAJ,CAAU,WAAV,CAAD,CAAhB;AAAA,OAAD,EAA2C,CAA3C,CAAV;AACD;;AACD,WAAOb,MAAP;AACD;;AAEDQ,EAAAA,iBAAiB,CAACI,MAAlB,GAA2BA,MAA3B;AACAJ,EAAAA,iBAAiB,CAACM,KAAlB,GAA0BP,SAAS,CAACO,KAApC;AAEA,SAAON,iBAAP;AACD","sourcesContent":["import { debounce, DebouncedFunction, DebounceOptions } from './debounce';\n\nexport interface PromisedDebounceFunction<\n  F extends (this: any, ...args: any) => any,\n> {\n  (this: any, ...args: Parameters<F>): Promise<ReturnType<F>>;\n  cancel: DebouncedFunction<F>['cancel'];\n  flush: DebouncedFunction<F>['flush'];\n}\n\nexport function promisedDebounce<F extends (...args: any) => any>({\n  fn,\n  ...options\n}: DebounceOptions<F>): PromisedDebounceFunction<F> {\n  let promise: Promise<ReturnType<F>> = null;\n  let reject: (reason?: any) => void = null;\n  let resolve: (value?: any) => void = null;\n\n  function wrappedFn(this: any, ...args: Parameters<F>) {\n    let result: ReturnType<F>;\n    const lastResolve = resolve;\n    const lastReject = reject;\n\n    promise = null;\n    reject = null;\n    resolve = null;\n\n    try {\n      result = fn.apply(this, args);\n      setTimeout(() => {\n        lastResolve(result);\n      }, 0);\n      return result;\n    } catch (error) {\n      setTimeout(() => {\n        lastReject(error);\n      }, 0);\n      throw error;\n    }\n  }\n\n  const debounced = debounce({\n    fn: wrappedFn,\n    ...options,\n  });\n\n  function debouncePromiseFn(\n    this: any,\n    ...args: Parameters<F>\n  ): Promise<ReturnType<F>> {\n    if (!promise) {\n      promise = new Promise((promiseResolve, promiseReject) => {\n        resolve = promiseResolve;\n        reject = promiseReject;\n      });\n    }\n    debounced.apply(this, args);\n    return promise;\n  }\n\n  function cancel() {\n    const result = debounced.cancel();\n    if (promise) {\n      const lastReject = reject;\n      promise = null;\n      resolve = null;\n      reject = null;\n      setTimeout(() => lastReject(new Error('cancelled')), 0);\n    }\n    return result;\n  }\n\n  debouncePromiseFn.cancel = cancel;\n  debouncePromiseFn.flush = debounced.flush;\n\n  return debouncePromiseFn;\n}\n"],"file":"promisedDebounce.js"}