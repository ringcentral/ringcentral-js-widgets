{"version":3,"sources":["lib/processI18n.ts"],"names":["processI18n","input","locale","DEFAULT_LOCALE","defaultLocale","parentKey","Array","isArray","item","I18nFlag","PSEUDO_LOCALE","str","translations","padRatio","I18n","acc","key","Object","hasOwnProperty","call"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AAIA;;AACA;;AAGA;;;;;;;;;;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,WAAT,CACLC,KADK,EAKmB;AAAA,MAHxBC,MAGwB,uEAHHC,oBAGG;AAAA,MAFxBC,aAEwB,uEAFID,oBAEJ;AAAA,MADxBE,SACwB;;AACxB,MAAIC,KAAK,CAACC,OAAN,CAAcN,KAAd,CAAJ,EAA0B;AACxB,WAAO,gBACL,UAACO,IAAD;AAAA,aAAUR,WAAW,CAACQ,IAAD,EAAON,MAAP,EAAeE,aAAf,CAArB;AAAA,KADK,EAELH,KAFK,CAAP;AAID;;AACD,MAAIA,KAAK,IAAI,QAAOA,KAAP,MAAiB,QAA9B,EAAwC;AACtC,QAAKA,KAAD,CAAuBQ,qBAAvB,CAAJ,EAAsC;AAAA;;AACpC,UAAIP,MAAM,KAAKQ,mBAAf,EAA8B;AAAA;;AAC5B,eAAO,gCAAe;AACpBC,UAAAA,GAAG,2BAAGV,KAAD,CAAuBW,YAAvB,CAAoCR,aAApC,CAAF,yEAAwDC,SADvC;AAEpBQ,UAAAA,QAAQ,EAAEC,iBAAKD;AAFK,SAAf,CAAP;AAID;;AACD,6CAASZ,KAAD,CAAuBW,YAAvB,CAAoCV,MAApC,CAAR,uEACGD,KAAD,CAAuBW,YAAvB,CAAoC,kDAAsBV,MAAtB,CAApC,CADF,uCAEGD,KAAD,CAAuBW,YAAvB,CACER,aADF,CAFF;AAKD;;AACD,WAAO,mBACL,UAACW,GAAD,EAAMC,GAAN,EAAc;AACZ,UAAIC,MAAM,CAACC,cAAP,CAAsBC,IAAtB,CAA2BlB,KAA3B,EAAkCe,GAAlC,CAAJ,EAA4C;AAC1CD,QAAAA,GAAG,CAACC,GAAD,CAAH,GAAWhB,WAAW,CAACC,KAAK,CAACe,GAAD,CAAN,EAAad,MAAb,EAAqBE,aAArB,EAAoCY,GAApC,CAAtB;AACD;;AACD,aAAOD,GAAP;AACD,KANI,EAOL,EAPK,EAQL,iBAAKd,KAAL,CARK,CAAP;AAUD;;AAED,SAAOA,KAAP;AACD","sourcesContent":["import { keys, map, reduce } from 'ramda';\n\nimport I18n, {\n  DEFAULT_LOCALE,\n  PSEUDO_LOCALE,\n} from '@ringcentral-integration/i18n';\nimport { getLanguageFromLocale } from '@ringcentral-integration/i18n/lib/getLanguageFromLocale';\nimport toPseudoString from '@ringcentral-integration/i18n/lib/toPseudoString';\nimport { LocaleCode } from '@ringcentral-integration/locale-settings';\n\nimport { I18nFlag, I18nStrings } from '../modules/Brand/BrandConfig.interface';\n\n// TODO: find a better place to put this file\n\nexport type ConvertI18nToString<T> = T extends Array<infer D>\n  ? Array<ConvertI18nToString<D>>\n  : T extends object\n  ? {\n      [K in keyof T]: T[K] extends string | I18nStrings\n        ? string\n        : ConvertI18nToString<T[K]>;\n    }\n  : T;\n\n/**\n * processI18n takes brandConfigs with I18nStrings objects and based on the locale, return brandConfig without the I18nStrings.\n * @param config BrandConfig\n * @param locale\n * @param defaultLocale\n * @param parentKey parent key of object\n * @returns BrandConfig without I18nStrings structure\n */\nexport function processI18n<T extends unknown>(\n  input: T,\n  locale: LocaleCode = DEFAULT_LOCALE,\n  defaultLocale: LocaleCode = DEFAULT_LOCALE,\n  parentKey?: string,\n): ConvertI18nToString<T> {\n  if (Array.isArray(input)) {\n    return map(\n      (item) => processI18n(item, locale, defaultLocale),\n      input,\n    ) as ConvertI18nToString<T>;\n  }\n  if (input && typeof input === 'object') {\n    if ((input as I18nStrings)[I18nFlag]) {\n      if (locale === PSEUDO_LOCALE) {\n        return toPseudoString({\n          str: (input as I18nStrings).translations[defaultLocale] ?? parentKey,\n          padRatio: I18n.padRatio,\n        }) as ConvertI18nToString<T>;\n      }\n      return ((input as I18nStrings).translations[locale] ??\n        (input as I18nStrings).translations[getLanguageFromLocale(locale)] ??\n        (input as I18nStrings).translations[\n          defaultLocale\n        ]) as ConvertI18nToString<T>;\n    }\n    return reduce(\n      (acc, key) => {\n        if (Object.hasOwnProperty.call(input, key)) {\n          acc[key] = processI18n(input[key], locale, defaultLocale, key);\n        }\n        return acc;\n      },\n      {} as Partial<T>,\n      keys(input as object),\n    ) as ConvertI18nToString<T>;\n  }\n\n  return input as ConvertI18nToString<T>;\n}\n"],"file":"processI18n.js"}