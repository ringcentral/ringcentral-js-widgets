{"version":3,"file":"index.js","names":["_dedent","_interopRequireDefault","require","_formatLocale","obj","__esModule","_templateObject","data","_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","value","getBaseName","f","replace","returnLoadLocaleCode","chunk","locale","basename","padding","code","concat","generateLoaderContent","_ref","files","_ref$chunk","_ref$supportedLocales","supportedLocales","sortIdx","forEach","idx","formatLocale","byLocale","a","b","_sortIdx$ta","_sortIdx$tb","ta","tb","aIdx","bIdx","usedLang","cases","sort","map","lang","split","isChunk","returnCode","langDefaultCase","dedent","join"],"sources":["lib/generateLoaderContent/index.js"],"sourcesContent":["import dedent from 'dedent';\nimport formatLocale from '@ringcentral-integration/i18n/lib/formatLocale';\n\nfunction getBaseName(f) {\n  return f.replace(/\\.(js|json|ts)$/i, '');\n}\n\nfunction returnLoadLocaleCode(chunk, locale, basename) {\n  const padding = chunk ? '    ' : '  ';\n  let code = `\n          ${padding}const data = require('./${basename}');\n          ${padding}return resolve(data.__esModule === true ? data.default : data);`;\n  if (chunk) {\n    code = `\n          if (typeof require.ensure === 'function') {\n            return require.ensure('./${basename}', (require) => {${code}\n            }, '${locale}');\n          } else {${code}\n          }`;\n  }\n  return code;\n}\n\n/**\n * @typedef GLCOptions\n * @property {String[]} files\n * @property {Boolean} [chunk]\n *\n */\n/**\n * @function\n * @description Generate js code for localeLoader according the files listed.\n * @param {GLCOptions} options\n */\nexport default function generateLoaderContent(\n  /** @type {GLCOptions} */ { files, chunk = true, supportedLocales = [] },\n) {\n  // create sort function\n  const sortIdx = {};\n  supportedLocales.forEach((locale, idx) => {\n    sortIdx[formatLocale(locale)] = idx;\n  });\n  const byLocale = (a, b) => {\n    const ta = formatLocale(getBaseName(a));\n    const tb = formatLocale(getBaseName(b));\n    const aIdx = sortIdx[ta] ?? -1;\n    const bIdx = sortIdx[tb] ?? -1;\n    if (aIdx === bIdx) {\n      // -1 or ta === tb\n      if (ta === tb) {\n        return 0;\n      }\n      return ta > tb ? 1 : -1;\n    }\n    // smaller index has priority\n    return aIdx > bIdx ? 1 : -1;\n  };\n\n  const usedLang = {};\n  const cases = files.sort(byLocale).map((f) => {\n    const basename = getBaseName(f);\n    const locale = formatLocale(basename);\n    const lang = locale.split('-')[0];\n    const isChunk = typeof chunk === 'function' ? chunk(locale) : chunk;\n    const returnCode = returnLoadLocaleCode(isChunk, locale, basename);\n    let langDefaultCase = '';\n    if (!usedLang[lang]) {\n      usedLang[lang] = true;\n      langDefaultCase = `\n        case '${lang}':\n      `;\n    }\n    return `${langDefaultCase}\n          case '${locale}': {${returnCode}\n          }`;\n  });\n\n  return dedent`export default function loadLocale(locale) {\n      return new Promise((resolve) => {\n        switch (locale) {${cases.join('')}\n          default:\n            return resolve(null);\n        }\n      });\n    }\\n`;\n}\n"],"mappings":"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"}