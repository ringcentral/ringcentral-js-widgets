{"version":3,"file":"index.js","names":["getBaseName","f","replace","returnLoadLocaleCode","chunk","locale","basename","padding","code","generateLoaderContent","files","supportedLocales","sortIdx","forEach","idx","formatLocale","byLocale","a","b","ta","tb","aIdx","bIdx","usedLang","cases","sort","map","lang","split","returnCode","langDefaultCase","dedent","join"],"sources":["lib/generateLoaderContent/index.js"],"sourcesContent":["import dedent from 'dedent';\nimport formatLocale from '@ringcentral-integration/i18n/lib/formatLocale';\n\nfunction getBaseName(f) {\n  return f.replace(/\\.(js|json|ts)$/i, '');\n}\n\nfunction returnLoadLocaleCode(chunk, locale, basename) {\n  const padding = chunk ? '    ' : '  ';\n  let code = `\n          ${padding}const data = require('./${basename}');\n          ${padding}return resolve(data.__esModule === true ? data.default : data);`;\n  if (chunk) {\n    code = `\n          if (typeof require.ensure === 'function') {\n            return require.ensure(['./${basename}'], (require) => {${code}\n            }, '${locale}');\n          } else {${code}\n          }`;\n  }\n  return code;\n}\n\n/**\n * @typedef GLCOptions\n * @property {String[]} files\n * @property {Boolean} [chunk]\n *\n */\n/**\n * @function\n * @description Generate js code for localeLoader according the files listed.\n * @param {GLCOptions} options\n */\nexport default function generateLoaderContent(\n  /** @type {GLCOptions} */ { files, chunk = true, supportedLocales = [] },\n) {\n  // create sort function\n  const sortIdx = {};\n  supportedLocales.forEach((locale, idx) => {\n    sortIdx[formatLocale(locale)] = idx;\n  });\n  const byLocale = (a, b) => {\n    const ta = formatLocale(getBaseName(a));\n    const tb = formatLocale(getBaseName(b));\n    const aIdx = sortIdx[ta] ?? -1;\n    const bIdx = sortIdx[tb] ?? -1;\n    if (aIdx === bIdx) {\n      // -1 or ta === tb\n      if (ta === tb) {\n        return 0;\n      }\n      return ta > tb ? 1 : -1;\n    }\n    // smaller index has priority\n    return aIdx > bIdx ? 1 : -1;\n  };\n\n  const usedLang = {};\n  const cases = files.sort(byLocale).map((f) => {\n    const basename = getBaseName(f);\n    const locale = formatLocale(basename);\n    const lang = locale.split('-')[0];\n    const returnCode = returnLoadLocaleCode(chunk, locale, basename);\n    let langDefaultCase = '';\n    if (!usedLang[lang]) {\n      usedLang[lang] = true;\n      langDefaultCase = `\n        case '${lang}':\n      `;\n    }\n    return `${langDefaultCase}\n          case '${locale}': {${returnCode}\n          }`;\n  });\n\n  return dedent`export default function loadLocale(locale) {\n      return new Promise((resolve) => {\n        switch (locale) {${cases.join('')}\n          default:\n            return resolve(null);\n        }\n      });\n    }\\n`;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;AAEA,SAASA,WAAT,CAAqBC,CAArB,EAAwB;EACtB,OAAOA,CAAC,CAACC,OAAF,CAAU,kBAAV,EAA8B,EAA9B,CAAP;AACD;;AAED,SAASC,oBAAT,CAA8BC,KAA9B,EAAqCC,MAArC,EAA6CC,QAA7C,EAAuD;EACrD,IAAMC,OAAO,GAAGH,KAAK,GAAG,MAAH,GAAY,IAAjC;EACA,IAAII,IAAI,yBACED,OADF,qCACoCD,QADpC,4BAEEC,OAFF,oEAAR;;EAGA,IAAIH,KAAJ,EAAW;IACTI,IAAI,4GAEgCF,QAFhC,+BAE6DE,IAF7D,+BAGUH,MAHV,oCAIYG,IAJZ,kBAAJ;EAMD;;EACD,OAAOA,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;;;AACe,SAASC,qBAAT;AACb;AADa,MAEb;EAAA,IAD4BC,KAC5B,QAD4BA,KAC5B;EAAA,sBADmCN,KACnC;EAAA,IADmCA,KACnC,2BAD2C,IAC3C;EAAA,iCADiDO,gBACjD;EAAA,IADiDA,gBACjD,sCADoE,EACpE;EACA;EACA,IAAMC,OAAO,GAAG,EAAhB;EACAD,gBAAgB,CAACE,OAAjB,CAAyB,UAACR,MAAD,EAASS,GAAT,EAAiB;IACxCF,OAAO,CAAC,IAAAG,wBAAA,EAAaV,MAAb,CAAD,CAAP,GAAgCS,GAAhC;EACD,CAFD;;EAGA,IAAME,QAAQ,GAAG,SAAXA,QAAW,CAACC,CAAD,EAAIC,CAAJ,EAAU;IAAA;;IACzB,IAAMC,EAAE,GAAG,IAAAJ,wBAAA,EAAaf,WAAW,CAACiB,CAAD,CAAxB,CAAX;IACA,IAAMG,EAAE,GAAG,IAAAL,wBAAA,EAAaf,WAAW,CAACkB,CAAD,CAAxB,CAAX;IACA,IAAMG,IAAI,kBAAGT,OAAO,CAACO,EAAD,CAAV,qDAAkB,CAAC,CAA7B;IACA,IAAMG,IAAI,kBAAGV,OAAO,CAACQ,EAAD,CAAV,qDAAkB,CAAC,CAA7B;;IACA,IAAIC,IAAI,KAAKC,IAAb,EAAmB;MACjB;MACA,IAAIH,EAAE,KAAKC,EAAX,EAAe;QACb,OAAO,CAAP;MACD;;MACD,OAAOD,EAAE,GAAGC,EAAL,GAAU,CAAV,GAAc,CAAC,CAAtB;IACD,CAXwB,CAYzB;;;IACA,OAAOC,IAAI,GAAGC,IAAP,GAAc,CAAd,GAAkB,CAAC,CAA1B;EACD,CAdD;;EAgBA,IAAMC,QAAQ,GAAG,EAAjB;EACA,IAAMC,KAAK,GAAGd,KAAK,CAACe,IAAN,CAAWT,QAAX,EAAqBU,GAArB,CAAyB,UAACzB,CAAD,EAAO;IAC5C,IAAMK,QAAQ,GAAGN,WAAW,CAACC,CAAD,CAA5B;IACA,IAAMI,MAAM,GAAG,IAAAU,wBAAA,EAAaT,QAAb,CAAf;IACA,IAAMqB,IAAI,GAAGtB,MAAM,CAACuB,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAb;IACA,IAAMC,UAAU,GAAG1B,oBAAoB,CAACC,KAAD,EAAQC,MAAR,EAAgBC,QAAhB,CAAvC;IACA,IAAIwB,eAAe,GAAG,EAAtB;;IACA,IAAI,CAACP,QAAQ,CAACI,IAAD,CAAb,EAAqB;MACnBJ,QAAQ,CAACI,IAAD,CAAR,GAAiB,IAAjB;MACAG,eAAe,6BACLH,IADK,eAAf;IAGD;;IACD,iBAAUG,eAAV,+BACczB,MADd,iBAC2BwB,UAD3B;EAGD,CAfa,CAAd;EAiBA,WAAOE,kBAAP,qBAEyBP,KAAK,CAACQ,IAAN,CAAW,EAAX,CAFzB;AAQD"}