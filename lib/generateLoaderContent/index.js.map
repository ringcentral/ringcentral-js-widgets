{"version":3,"file":"index.js","names":["_formatLocale","_interopRequireDefault","require","_dedent","e","__esModule","_templateObject","data","_taggedTemplateLiteral","t","slice","Object","freeze","defineProperties","raw","value","getBaseName","f","replace","returnLoadLocaleCode","chunk","locale","basename","code","concat","generateLoaderContent","_ref","files","_ref$chunk","_ref$supportedLocales","supportedLocales","sortIdx","forEach","idx","formatLocale","byLocale","a","b","_sortIdx$ta","_sortIdx$tb","ta","tb","aIdx","bIdx","usedLang","cases","sort","map","lang","split","isChunk","returnCode","langDefaultCase","dedent","join"],"sources":["lib/generateLoaderContent/index.js"],"sourcesContent":["import formatLocale from '@ringcentral-integration/i18n/lib/formatLocale';\nimport dedent from 'dedent';\n\nfunction getBaseName(f) {\n  return f.replace(/\\.(js|json|ts)$/i, '');\n}\n\nfunction returnLoadLocaleCode(chunk, locale, basename) {\n  let code = `require('./${basename}')`;\n  if (chunk) {\n    return `import(/* webpackChunkName: \"${locale}\" */'./${basename}')`;\n  }\n  return code;\n}\n\n/**\n * @typedef GLCOptions\n * @property {String[]} files\n * @property {Boolean} [chunk]\n *\n */\n/**\n * @function\n * @description Generate js code for localeLoader according the files listed.\n * @param {GLCOptions} options\n */\nexport default function generateLoaderContent(\n  /** @type {GLCOptions} */ { files, chunk = true, supportedLocales = [] },\n) {\n  // create sort function\n  const sortIdx = {};\n  supportedLocales.forEach((locale, idx) => {\n    sortIdx[formatLocale(locale)] = idx;\n  });\n  const byLocale = (a, b) => {\n    const ta = formatLocale(getBaseName(a));\n    const tb = formatLocale(getBaseName(b));\n    const aIdx = sortIdx[ta] ?? -1;\n    const bIdx = sortIdx[tb] ?? -1;\n    if (aIdx === bIdx) {\n      // -1 or ta === tb\n      if (ta === tb) {\n        return 0;\n      }\n      return ta > tb ? 1 : -1;\n    }\n    // smaller index has priority\n    return aIdx > bIdx ? 1 : -1;\n  };\n\n  const usedLang = {};\n  const cases = files.sort(byLocale).map((f) => {\n    const basename = getBaseName(f);\n    const locale = formatLocale(basename);\n    const lang = locale.split('-')[0];\n    const isChunk = typeof chunk === 'function' ? chunk(locale) : chunk;\n    const returnCode = returnLoadLocaleCode(isChunk, locale, basename);\n    let langDefaultCase = '';\n    if (!usedLang[lang]) {\n      usedLang[lang] = true;\n      langDefaultCase = `locale==='${lang}'||`;\n    }\n    return `${langDefaultCase}\n    locale==='${locale}'? ${returnCode}:`;\n  });\n\n  const value = dedent`export default function loadLocale(locale) {\n          return ${cases.join('')}null;\n    }\\n`;\n  return value;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAF,sBAAA,CAAAC,OAAA;AAA4B,SAAAD,uBAAAG,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,gBAAAA,CAAA;AAAA,SAAAE,gBAAA;EAAA,IAAAC,IAAA,GAAAC,sBAAA;EAAAF,eAAA,YAAAA,gBAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAAA,SAAAC,uBAAAJ,CAAA,EAAAK,CAAA,WAAAA,CAAA,KAAAA,CAAA,GAAAL,CAAA,CAAAM,KAAA,MAAAC,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAE,gBAAA,CAAAT,CAAA,IAAAU,GAAA,IAAAC,KAAA,EAAAJ,MAAA,CAAAC,MAAA,CAAAH,CAAA;AAE5B,SAASO,WAAWA,CAACC,CAAC,EAAE;EACtB,OAAOA,CAAC,CAACC,OAAO,CAAC,kBAAkB,EAAE,EAAE,CAAC;AAC1C;AAEA,SAASC,oBAAoBA,CAACC,KAAK,EAAEC,MAAM,EAAEC,QAAQ,EAAE;EACrD,IAAIC,IAAI,iBAAAC,MAAA,CAAiBF,QAAQ,OAAI;EACrC,IAAIF,KAAK,EAAE;IACT,wCAAAI,MAAA,CAAuCH,MAAM,cAAAG,MAAA,CAAUF,QAAQ;EACjE;EACA,OAAOC,IAAI;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASE,qBAAqBA,CAAA,CAC3C,yBAAAC,IAAA,EACA;EAAA,IAD4BC,KAAK,GAAAD,IAAA,CAALC,KAAK;IAAAC,UAAA,GAAAF,IAAA,CAAEN,KAAK;IAALA,KAAK,GAAAQ,UAAA,cAAG,IAAI,GAAAA,UAAA;IAAAC,qBAAA,GAAAH,IAAA,CAAEI,gBAAgB;IAAhBA,gBAAgB,GAAAD,qBAAA,cAAG,EAAE,GAAAA,qBAAA;EAEtE;EACA,IAAME,OAAO,GAAG,CAAC,CAAC;EAClBD,gBAAgB,CAACE,OAAO,CAAC,UAACX,MAAM,EAAEY,GAAG,EAAK;IACxCF,OAAO,CAAC,IAAAG,wBAAY,EAACb,MAAM,CAAC,CAAC,GAAGY,GAAG;EACrC,CAAC,CAAC;EACF,IAAME,QAAQ,GAAG,SAAXA,QAAQA,CAAIC,CAAC,EAAEC,CAAC,EAAK;IAAA,IAAAC,WAAA,EAAAC,WAAA;IACzB,IAAMC,EAAE,GAAG,IAAAN,wBAAY,EAAClB,WAAW,CAACoB,CAAC,CAAC,CAAC;IACvC,IAAMK,EAAE,GAAG,IAAAP,wBAAY,EAAClB,WAAW,CAACqB,CAAC,CAAC,CAAC;IACvC,IAAMK,IAAI,IAAAJ,WAAA,GAAGP,OAAO,CAACS,EAAE,CAAC,cAAAF,WAAA,cAAAA,WAAA,GAAI,CAAC,CAAC;IAC9B,IAAMK,IAAI,IAAAJ,WAAA,GAAGR,OAAO,CAACU,EAAE,CAAC,cAAAF,WAAA,cAAAA,WAAA,GAAI,CAAC,CAAC;IAC9B,IAAIG,IAAI,KAAKC,IAAI,EAAE;MACjB;MACA,IAAIH,EAAE,KAAKC,EAAE,EAAE;QACb,OAAO,CAAC;MACV;MACA,OAAOD,EAAE,GAAGC,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;IACzB;IACA;IACA,OAAOC,IAAI,GAAGC,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;EAC7B,CAAC;EAED,IAAMC,QAAQ,GAAG,CAAC,CAAC;EACnB,IAAMC,KAAK,GAAGlB,KAAK,CAACmB,IAAI,CAACX,QAAQ,CAAC,CAACY,GAAG,CAAC,UAAC9B,CAAC,EAAK;IAC5C,IAAMK,QAAQ,GAAGN,WAAW,CAACC,CAAC,CAAC;IAC/B,IAAMI,MAAM,GAAG,IAAAa,wBAAY,EAACZ,QAAQ,CAAC;IACrC,IAAM0B,IAAI,GAAG3B,MAAM,CAAC4B,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACjC,IAAMC,OAAO,GAAG,OAAO9B,KAAK,KAAK,UAAU,GAAGA,KAAK,CAACC,MAAM,CAAC,GAAGD,KAAK;IACnE,IAAM+B,UAAU,GAAGhC,oBAAoB,CAAC+B,OAAO,EAAE7B,MAAM,EAAEC,QAAQ,CAAC;IAClE,IAAI8B,eAAe,GAAG,EAAE;IACxB,IAAI,CAACR,QAAQ,CAACI,IAAI,CAAC,EAAE;MACnBJ,QAAQ,CAACI,IAAI,CAAC,GAAG,IAAI;MACrBI,eAAe,gBAAA5B,MAAA,CAAgBwB,IAAI,QAAK;IAC1C;IACA,UAAAxB,MAAA,CAAU4B,eAAe,sBAAA5B,MAAA,CACbH,MAAM,SAAAG,MAAA,CAAM2B,UAAU;EACpC,CAAC,CAAC;EAEF,IAAMpC,KAAK,OAAGsC,kBAAM,EAAA/C,eAAA,IACHuC,KAAK,CAACS,IAAI,CAAC,EAAE,CAAC,CACzB;EACN,OAAOvC,KAAK;AACd","ignoreList":[]}