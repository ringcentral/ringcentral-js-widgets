{"version":3,"file":"TransportInteractionBase.js","names":["TransportInteractionBase","_transport","_classCallCheck","_transportEvents","_createClass","key","value","registerTransportEvent","_ref","func","Error","registerTransportEvents","events","_iterator","_createForOfIteratorHelper","_step","s","n","done","_step$value","err","e","f","_fetchAndResponse2","_asyncToGenerator","regeneratorRuntime","mark","_callee","_ref2","requestId","fetchFunc","emitData","wrap","_callee$","_context","prev","next","result","sent","t0","console","log","error","response","abrupt","stop","_fetchAndResponse","_x","apply","arguments","get","exports"],"sources":["lib/TransportInteractionBase/TransportInteractionBase.ts"],"sourcesContent":["import type {\n  FetchOption,\n  Transport,\n  TransportEvent,\n  transportEvents,\n  TransportResponseData,\n} from './TransportInteractionBase.interface';\n\nexport class TransportInteractionBase {\n  _transportEvents: transportEvents = {};\n\n  constructor(public _transport: Transport) {}\n\n  registerTransportEvent({ key, func }: TransportEvent) {\n    if (this._transportEvents[key]) {\n      throw new Error('transport event has already registered');\n    }\n    this._transportEvents[key] = func;\n  }\n\n  registerTransportEvents(events: TransportEvent[]) {\n    for (const { key, func } of events) {\n      this.registerTransportEvent({ key, func });\n    }\n  }\n\n  async _fetchAndResponse({\n    requestId,\n    fetchFunc,\n  }: FetchOption): Promise<TransportResponseData> {\n    if (!fetchFunc || typeof fetchFunc !== 'function') {\n      // throw new Error('Parameter `fetchFunc` is invalid!');\n    }\n\n    const emitData: TransportResponseData = {\n      requestId,\n      result: null,\n      // error: undefined,\n    };\n\n    try {\n      emitData.result = await fetchFunc();\n    } catch (error: any /** TODO: confirm with instanceof */) {\n      console.log('FetchAndResponse|error', error);\n      emitData.error = error;\n    }\n\n    this._transport.response(emitData);\n\n    return emitData;\n  }\n\n  get transportEvents() {\n    return this._transportEvents;\n  }\n}\n"],"mappings":"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","ignoreList":[]}