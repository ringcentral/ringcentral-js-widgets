{"version":3,"file":"dataTransport.js","names":["_ramda","require","_dataTransport","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","_typeof","o","Symbol","iterator","constructor","_regenerator","e","t","r","n","toStringTag","i","c","Generator","u","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","_regeneratorDefine","_invoke","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","_toPrimitive","toPrimitive","String","Number","listen","target","descriptor","_target$listeners","fn","process","env","NODE_ENV","console","warn","concat","listeners","_callee","_context","Error","bindListeners","instance","transport","_listeners","forEachObjIndexed","func","name"],"sources":["lib/dataTransport.ts"],"sourcesContent":["import type { Transport } from 'data-transport';\nimport { forEachObjIndexed } from 'ramda';\n\nexport * from 'data-transport';\n\n/**\n * `@listen` decorator, that will auto binding event with `data-transport`\n */\nconst listen = (\n  target: any,\n  key: string,\n  descriptor: TypedPropertyDescriptor<(...args: any) => Promise<any>>,\n) => {\n  const fn = descriptor.value;\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof fn !== 'function') {\n      console.warn(\n        `The decorator '@listen' can only decorate methods, '${key}' is NOT a methods.`,\n      );\n      return descriptor;\n    }\n  }\n  target.listeners = target.listeners ?? {};\n  target.listeners[key] = fn;\n  return {\n    ...descriptor,\n    async value(this: Transport) {\n      if (process.env.NODE_ENV !== 'production') {\n        throw new Error(\n          `The method '${key}' is a listen function that can NOT be actively called.`,\n        );\n      }\n    },\n  };\n};\n\n/**\n * bind current class listenable,\n * that your class `@listen` work\n *\n * @example\n *\n  ```ts\n\n  class Adapter implements ToExternal {\n\n    transport?: Transport<{ emit: ToInternal; listen: ToExternal }>;\n\n    constructor(){\n      this.transport = createTransport('IFrameMain', {\n        iframe: this.appIFrame,\n      });\n      bindListeners(this, this.transport);\n    }\n\n    @listen\n    async fetchIsMatchCaseId(caseId: string): Promise<string> {\n      return this.visualforceRequest('fetchIsMatchCaseId', caseId);\n    }\n  }\n * ```\n */\nconst bindListeners = (instance: object, transport: Transport<any>) => {\n  forEachObjIndexed(\n    (func, name) => {\n      transport.listen(name, func.bind(instance));\n    },\n    (\n      instance as {\n        listeners?: Record<string, (...args: any) => any>;\n      }\n    ).listeners ?? {},\n  );\n};\n\nexport { bindListeners, listen };\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,cAAA,GAAAD,OAAA;AAAAE,MAAA,CAAAC,IAAA,CAAAF,cAAA,EAAAG,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAJ,cAAA,CAAAI,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,IAAA;MAAA,OAAAZ,cAAA,CAAAI,GAAA;IAAA;EAAA;AAAA;AAA+B,SAAAS,QAAAC,CAAA,sCAAAD,OAAA,wBAAAE,MAAA,uBAAAA,MAAA,CAAAC,QAAA,aAAAF,CAAA,kBAAAA,CAAA,gBAAAA,CAAA,WAAAA,CAAA,yBAAAC,MAAA,IAAAD,CAAA,CAAAG,WAAA,KAAAF,MAAA,IAAAD,CAAA,KAAAC,MAAA,CAAAV,SAAA,qBAAAS,CAAA,KAAAD,OAAA,CAAAC,CAAA;AAAA,SAAAI,aAAA,IAF/B,uKAAAC,CAAA,EAAAC,CAAA,EAAAC,CAAA,wBAAAN,MAAA,GAAAA,MAAA,OAAAO,CAAA,GAAAD,CAAA,CAAAL,QAAA,kBAAAF,CAAA,GAAAO,CAAA,CAAAE,WAAA,8BAAAC,EAAAH,CAAA,EAAAC,CAAA,EAAAR,CAAA,EAAAU,CAAA,QAAAC,CAAA,GAAAH,CAAA,IAAAA,CAAA,CAAAjB,SAAA,YAAAqB,SAAA,GAAAJ,CAAA,GAAAI,SAAA,EAAAC,CAAA,GAAA1B,MAAA,CAAA2B,MAAA,CAAAH,CAAA,CAAApB,SAAA,UAAAwB,mBAAA,CAAAF,CAAA,uBAAAN,CAAA,EAAAC,CAAA,EAAAR,CAAA,QAAAU,CAAA,EAAAC,CAAA,EAAAE,CAAA,EAAAG,CAAA,MAAAC,CAAA,GAAAjB,CAAA,QAAAkB,CAAA,OAAAC,CAAA,KAAAF,CAAA,KAAAT,CAAA,KAAAY,CAAA,EAAAf,CAAA,EAAAgB,CAAA,EAAAC,CAAA,EAAAN,CAAA,EAAAM,CAAA,CAAAC,IAAA,CAAAlB,CAAA,MAAAiB,CAAA,WAAAA,EAAAhB,CAAA,EAAAC,CAAA,WAAAG,CAAA,GAAAJ,CAAA,EAAAK,CAAA,MAAAE,CAAA,GAAAR,CAAA,EAAAc,CAAA,CAAAX,CAAA,GAAAD,CAAA,EAAAc,CAAA,gBAAAC,EAAAf,CAAA,EAAAC,CAAA,SAAAG,CAAA,GAAAJ,CAAA,EAAAM,CAAA,GAAAL,CAAA,EAAAF,CAAA,OAAAY,CAAA,IAAAF,CAAA,KAAAhB,CAAA,IAAAM,CAAA,GAAAW,CAAA,CAAAO,MAAA,EAAAlB,CAAA,UAAAN,CAAA,EAAAU,CAAA,GAAAO,CAAA,CAAAX,CAAA,GAAAgB,CAAA,GAAAH,CAAA,CAAAF,CAAA,EAAAQ,CAAA,GAAAf,CAAA,KAAAH,CAAA,QAAAP,CAAA,GAAAyB,CAAA,KAAAjB,CAAA,MAAAK,CAAA,GAAAH,CAAA,EAAAC,CAAA,GAAAD,CAAA,YAAAC,CAAA,WAAAD,CAAA,MAAAA,CAAA,MAAAL,CAAA,IAAAK,CAAA,OAAAY,CAAA,MAAAtB,CAAA,GAAAO,CAAA,QAAAe,CAAA,GAAAZ,CAAA,QAAAC,CAAA,MAAAQ,CAAA,CAAAC,CAAA,GAAAZ,CAAA,EAAAW,CAAA,CAAAX,CAAA,GAAAE,CAAA,OAAAY,CAAA,GAAAG,CAAA,KAAAzB,CAAA,GAAAO,CAAA,QAAAG,CAAA,MAAAF,CAAA,IAAAA,CAAA,GAAAiB,CAAA,MAAAf,CAAA,MAAAH,CAAA,EAAAG,CAAA,MAAAF,CAAA,EAAAW,CAAA,CAAAX,CAAA,GAAAiB,CAAA,EAAAd,CAAA,cAAAX,CAAA,IAAAO,CAAA,aAAAc,CAAA,QAAAH,CAAA,OAAAV,CAAA,qBAAAR,CAAA,EAAAiB,CAAA,EAAAQ,CAAA,QAAAT,CAAA,YAAAU,SAAA,uCAAAR,CAAA,UAAAD,CAAA,IAAAK,CAAA,CAAAL,CAAA,EAAAQ,CAAA,GAAAd,CAAA,GAAAM,CAAA,EAAAJ,CAAA,GAAAY,CAAA,GAAAnB,CAAA,GAAAK,CAAA,OAAAN,CAAA,GAAAQ,CAAA,MAAAK,CAAA,KAAAR,CAAA,KAAAC,CAAA,GAAAA,CAAA,QAAAA,CAAA,SAAAQ,CAAA,CAAAX,CAAA,QAAAc,CAAA,CAAAX,CAAA,EAAAE,CAAA,KAAAM,CAAA,CAAAX,CAAA,GAAAK,CAAA,GAAAM,CAAA,CAAAC,CAAA,GAAAP,CAAA,aAAAG,CAAA,MAAAN,CAAA,QAAAC,CAAA,KAAAX,CAAA,YAAAM,CAAA,GAAAI,CAAA,CAAAV,CAAA,WAAAM,CAAA,GAAAA,CAAA,CAAAb,IAAA,CAAAiB,CAAA,EAAAG,CAAA,UAAAa,SAAA,2CAAApB,CAAA,CAAAqB,IAAA,SAAArB,CAAA,EAAAO,CAAA,GAAAP,CAAA,CAAAsB,KAAA,EAAAjB,CAAA,SAAAA,CAAA,oBAAAA,CAAA,KAAAL,CAAA,GAAAI,CAAA,eAAAJ,CAAA,CAAAb,IAAA,CAAAiB,CAAA,GAAAC,CAAA,SAAAE,CAAA,GAAAa,SAAA,uCAAA1B,CAAA,gBAAAW,CAAA,OAAAD,CAAA,GAAAL,CAAA,cAAAC,CAAA,IAAAY,CAAA,GAAAC,CAAA,CAAAX,CAAA,QAAAK,CAAA,GAAAN,CAAA,CAAAd,IAAA,CAAAe,CAAA,EAAAW,CAAA,OAAAE,CAAA,kBAAAf,CAAA,IAAAI,CAAA,GAAAL,CAAA,EAAAM,CAAA,MAAAE,CAAA,GAAAP,CAAA,cAAAU,CAAA,mBAAAY,KAAA,EAAAtB,CAAA,EAAAqB,IAAA,EAAAT,CAAA,SAAAX,CAAA,EAAAP,CAAA,EAAAU,CAAA,QAAAG,CAAA,QAAAQ,CAAA,gBAAAT,UAAA,cAAAiB,kBAAA,cAAAC,2BAAA,KAAAxB,CAAA,GAAAnB,MAAA,CAAA4C,cAAA,MAAApB,CAAA,MAAAH,CAAA,IAAAF,CAAA,CAAAA,CAAA,IAAAE,CAAA,SAAAO,mBAAA,CAAAT,CAAA,OAAAE,CAAA,iCAAAF,CAAA,GAAAO,CAAA,GAAAiB,0BAAA,CAAAvC,SAAA,GAAAqB,SAAA,CAAArB,SAAA,GAAAJ,MAAA,CAAA2B,MAAA,CAAAH,CAAA,YAAAK,EAAAX,CAAA,WAAAlB,MAAA,CAAA6C,cAAA,GAAA7C,MAAA,CAAA6C,cAAA,CAAA3B,CAAA,EAAAyB,0BAAA,KAAAzB,CAAA,CAAA4B,SAAA,GAAAH,0BAAA,EAAAf,mBAAA,CAAAV,CAAA,EAAAL,CAAA,yBAAAK,CAAA,CAAAd,SAAA,GAAAJ,MAAA,CAAA2B,MAAA,CAAAD,CAAA,GAAAR,CAAA,WAAAwB,iBAAA,CAAAtC,SAAA,GAAAuC,0BAAA,EAAAf,mBAAA,CAAAF,CAAA,iBAAAiB,0BAAA,GAAAf,mBAAA,CAAAe,0BAAA,iBAAAD,iBAAA,GAAAA,iBAAA,CAAAK,WAAA,wBAAAnB,mBAAA,CAAAe,0BAAA,EAAA9B,CAAA,wBAAAe,mBAAA,CAAAF,CAAA,GAAAE,mBAAA,CAAAF,CAAA,EAAAb,CAAA,gBAAAe,mBAAA,CAAAF,CAAA,EAAAL,CAAA,iCAAAO,mBAAA,CAAAF,CAAA,8DAAAT,YAAA,YAAAA,aAAA,aAAA+B,CAAA,EAAAzB,CAAA,EAAA0B,CAAA,EAAApB,CAAA;AAAA,SAAAD,oBAAAV,CAAA,EAAAE,CAAA,EAAAC,CAAA,EAAAF,CAAA,QAAAI,CAAA,GAAAvB,MAAA,CAAAS,cAAA,QAAAc,CAAA,uBAAAL,CAAA,IAAAK,CAAA,QAAAK,mBAAA,YAAAsB,mBAAAhC,CAAA,EAAAE,CAAA,EAAAC,CAAA,EAAAF,CAAA,aAAAN,EAAAO,CAAA,EAAAC,CAAA,IAAAO,mBAAA,CAAAV,CAAA,EAAAE,CAAA,YAAAF,CAAA,gBAAAiC,OAAA,CAAA/B,CAAA,EAAAC,CAAA,EAAAH,CAAA,SAAAE,CAAA,GAAAG,CAAA,GAAAA,CAAA,CAAAL,CAAA,EAAAE,CAAA,IAAAqB,KAAA,EAAApB,CAAA,EAAAX,UAAA,GAAAS,CAAA,EAAAiC,YAAA,GAAAjC,CAAA,EAAAkC,QAAA,GAAAlC,CAAA,MAAAD,CAAA,CAAAE,CAAA,IAAAC,CAAA,IAAAR,CAAA,aAAAA,CAAA,cAAAA,CAAA,mBAAAe,mBAAA,CAAAV,CAAA,EAAAE,CAAA,EAAAC,CAAA,EAAAF,CAAA;AAAA,SAAAmC,mBAAAjC,CAAA,EAAAF,CAAA,EAAAD,CAAA,EAAAE,CAAA,EAAAP,CAAA,EAAAqB,CAAA,EAAAV,CAAA,cAAAD,CAAA,GAAAF,CAAA,CAAAa,CAAA,EAAAV,CAAA,GAAAE,CAAA,GAAAH,CAAA,CAAAkB,KAAA,WAAApB,CAAA,gBAAAH,CAAA,CAAAG,CAAA,KAAAE,CAAA,CAAAiB,IAAA,GAAArB,CAAA,CAAAO,CAAA,IAAA6B,OAAA,CAAAC,OAAA,CAAA9B,CAAA,EAAA+B,IAAA,CAAArC,CAAA,EAAAP,CAAA;AAAA,SAAA6C,kBAAArC,CAAA,6BAAAF,CAAA,SAAAD,CAAA,GAAAyC,SAAA,aAAAJ,OAAA,WAAAnC,CAAA,EAAAP,CAAA,QAAAqB,CAAA,GAAAb,CAAA,CAAAuC,KAAA,CAAAzC,CAAA,EAAAD,CAAA,YAAA2C,MAAAxC,CAAA,IAAAiC,kBAAA,CAAApB,CAAA,EAAAd,CAAA,EAAAP,CAAA,EAAAgD,KAAA,EAAAC,MAAA,UAAAzC,CAAA,cAAAyC,OAAAzC,CAAA,IAAAiC,kBAAA,CAAApB,CAAA,EAAAd,CAAA,EAAAP,CAAA,EAAAgD,KAAA,EAAAC,MAAA,WAAAzC,CAAA,KAAAwC,KAAA;AAAA,SAAAE,QAAA7C,CAAA,EAAAE,CAAA,QAAAD,CAAA,GAAAnB,MAAA,CAAAC,IAAA,CAAAiB,CAAA,OAAAlB,MAAA,CAAAgE,qBAAA,QAAAnD,CAAA,GAAAb,MAAA,CAAAgE,qBAAA,CAAA9C,CAAA,GAAAE,CAAA,KAAAP,CAAA,GAAAA,CAAA,CAAAoD,MAAA,WAAA7C,CAAA,WAAApB,MAAA,CAAAkE,wBAAA,CAAAhD,CAAA,EAAAE,CAAA,EAAAV,UAAA,OAAAS,CAAA,CAAAgD,IAAA,CAAAP,KAAA,CAAAzC,CAAA,EAAAN,CAAA,YAAAM,CAAA;AAAA,SAAAiD,cAAAlD,CAAA,aAAAE,CAAA,MAAAA,CAAA,GAAAuC,SAAA,CAAAtB,MAAA,EAAAjB,CAAA,UAAAD,CAAA,WAAAwC,SAAA,CAAAvC,CAAA,IAAAuC,SAAA,CAAAvC,CAAA,QAAAA,CAAA,OAAA2C,OAAA,CAAA/D,MAAA,CAAAmB,CAAA,OAAAjB,OAAA,WAAAkB,CAAA,IAAAiD,eAAA,CAAAnD,CAAA,EAAAE,CAAA,EAAAD,CAAA,CAAAC,CAAA,SAAApB,MAAA,CAAAsE,yBAAA,GAAAtE,MAAA,CAAAuE,gBAAA,CAAArD,CAAA,EAAAlB,MAAA,CAAAsE,yBAAA,CAAAnD,CAAA,KAAA4C,OAAA,CAAA/D,MAAA,CAAAmB,CAAA,GAAAjB,OAAA,WAAAkB,CAAA,IAAApB,MAAA,CAAAS,cAAA,CAAAS,CAAA,EAAAE,CAAA,EAAApB,MAAA,CAAAkE,wBAAA,CAAA/C,CAAA,EAAAC,CAAA,iBAAAF,CAAA;AAAA,SAAAmD,gBAAAnD,CAAA,EAAAE,CAAA,EAAAD,CAAA,YAAAC,CAAA,GAAAoD,cAAA,CAAApD,CAAA,MAAAF,CAAA,GAAAlB,MAAA,CAAAS,cAAA,CAAAS,CAAA,EAAAE,CAAA,IAAAqB,KAAA,EAAAtB,CAAA,EAAAT,UAAA,MAAA0C,YAAA,MAAAC,QAAA,UAAAnC,CAAA,CAAAE,CAAA,IAAAD,CAAA,EAAAD,CAAA;AAAA,SAAAsD,eAAArD,CAAA,QAAAI,CAAA,GAAAkD,YAAA,CAAAtD,CAAA,gCAAAP,OAAA,CAAAW,CAAA,IAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAkD,aAAAtD,CAAA,EAAAC,CAAA,oBAAAR,OAAA,CAAAO,CAAA,MAAAA,CAAA,SAAAA,CAAA,MAAAD,CAAA,GAAAC,CAAA,CAAAL,MAAA,CAAA4D,WAAA,kBAAAxD,CAAA,QAAAK,CAAA,GAAAL,CAAA,CAAAZ,IAAA,CAAAa,CAAA,EAAAC,CAAA,gCAAAR,OAAA,CAAAW,CAAA,UAAAA,CAAA,YAAAgB,SAAA,yEAAAnB,CAAA,GAAAuD,MAAA,GAAAC,MAAA,EAAAzD,CAAA;AAIA;AACA;AACA;AACA,IAAM0D,MAAM,GAAArE,OAAA,CAAAqE,MAAA,GAAG,SAATA,MAAMA,CACVC,MAAW,EACX3E,GAAW,EACX4E,UAAmE,EAChE;EAAA,IAAAC,iBAAA;EACH,IAAMC,EAAE,GAAGF,UAAU,CAACtC,KAAK;EAC3B,IAAIyC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;IACzC,IAAI,OAAOH,EAAE,KAAK,UAAU,EAAE;MAC5BI,OAAO,CAACC,IAAI,wDAAAC,MAAA,CAC6CpF,GAAG,wBAC5D,CAAC;MACD,OAAO4E,UAAU;IACnB;EACF;EACAD,MAAM,CAACU,SAAS,IAAAR,iBAAA,GAAGF,MAAM,CAACU,SAAS,cAAAR,iBAAA,cAAAA,iBAAA,GAAI,CAAC,CAAC;EACzCF,MAAM,CAACU,SAAS,CAACrF,GAAG,CAAC,GAAG8E,EAAE;EAC1B,OAAAb,aAAA,CAAAA,aAAA,KACKW,UAAU;IACPtC,KAAK,WAALA,KAAKA,CAAA,EAAkB;MAAA,OAAAiB,iBAAA,cAAAzC,YAAA,GAAAgC,CAAA,UAAAwC,QAAA;QAAA,OAAAxE,YAAA,GAAA+B,CAAA,WAAA0C,QAAA;UAAA,kBAAAA,QAAA,CAAArE,CAAA;YAAA;cAAA,MACvB6D,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY;gBAAAM,QAAA,CAAArE,CAAA;gBAAA;cAAA;cAAA,MACjC,IAAIsE,KAAK,gBAAAJ,MAAA,CACEpF,GAAG,4DACpB,CAAC;YAAA;cAAA,OAAAuF,QAAA,CAAAxD,CAAA;UAAA;QAAA,GAAAuD,OAAA;MAAA;IAEL;EAAC;AAEL,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMG,aAAa,GAAApF,OAAA,CAAAoF,aAAA,GAAG,SAAhBA,aAAaA,CAAIC,QAAgB,EAAEC,SAAyB,EAAK;EAAA,IAAAC,UAAA;EACrE,IAAAC,wBAAiB,EACf,UAACC,IAAI,EAAEC,IAAI,EAAK;IACdJ,SAAS,CAACjB,MAAM,CAACqB,IAAI,EAAED,IAAI,CAAC7D,IAAI,CAACyD,QAAQ,CAAC,CAAC;EAC7C,CAAC,GAAAE,UAAA,GAECF,QAAQ,CAGRL,SAAS,cAAAO,UAAA,cAAAA,UAAA,GAAI,CAAC,CAClB,CAAC;AACH,CAAC","ignoreList":[]}