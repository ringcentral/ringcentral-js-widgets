{"version":3,"file":"dataTransport.js","names":["_ramda","require","_dataTransport","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","_typeof","o","Symbol","iterator","constructor","asyncGeneratorStep","n","t","e","r","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread","length","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_toPrimitive","toPrimitive","TypeError","String","Number","listen","target","descriptor","_target$listeners","fn","process","env","NODE_ENV","console","warn","concat","listeners","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","Error","stop","bindListeners","instance","transport","_listeners","forEachObjIndexed","func","name","bind"],"sources":["lib/dataTransport.ts"],"sourcesContent":["import type { Transport } from 'data-transport';\nimport { forEachObjIndexed } from 'ramda';\n\nexport * from 'data-transport';\n\n/**\n * `@listen` decorator, that will auto binding event with `data-transport`\n */\nconst listen = (\n  target: any,\n  key: string,\n  descriptor: TypedPropertyDescriptor<(...args: any) => Promise<any>>,\n) => {\n  const fn = descriptor.value;\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof fn !== 'function') {\n      console.warn(\n        `The decorator '@listen' can only decorate methods, '${key}' is NOT a methods.`,\n      );\n      return descriptor;\n    }\n  }\n  target.listeners = target.listeners ?? {};\n  target.listeners[key] = fn;\n  return {\n    ...descriptor,\n    async value(this: Transport) {\n      if (process.env.NODE_ENV !== 'production') {\n        throw new Error(\n          `The method '${key}' is a listen function that can NOT be actively called.`,\n        );\n      }\n    },\n  };\n};\n\n/**\n * bind current class listenable,\n * that your class `@listen` work\n *\n * @example\n *\n  ```ts\n\n  class Adapter implements ToExternal {\n\n    transport?: Transport<{ emit: ToInternal; listen: ToExternal }>;\n\n    constructor(){\n      this.transport = createTransport('IFrameMain', {\n        iframe: this.appIFrame,\n      });\n      bindListeners(this, this.transport);\n    }\n\n    @listen\n    async fetchIsMatchCaseId(caseId: string): Promise<string> {\n      return this.visualforceRequest('fetchIsMatchCaseId', caseId);\n    }\n  }\n * ```\n */\nconst bindListeners = (instance: object, transport: Transport<any>) => {\n  forEachObjIndexed(\n    (func, name) => {\n      transport.listen(name, func.bind(instance));\n    },\n    (\n      instance as {\n        listeners?: Record<string, (...args: any) => any>;\n      }\n    ).listeners ?? {},\n  );\n};\n\nexport { bindListeners, listen };\n"],"mappings":"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","ignoreList":[]}