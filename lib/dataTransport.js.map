{"version":3,"file":"dataTransport.js","names":["_ramda","require","_dataTransport","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","_typeof","obj","Symbol","iterator","constructor","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","ownKeys","object","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","_objectSpread","target","i","length","source","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_toPrimitive","String","input","hint","prim","toPrimitive","res","TypeError","Number","listen","descriptor","_target$listeners","process","env","NODE_ENV","console","warn","concat","listeners","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","Error","stop","bindListeners","instance","transport","_listeners","forEachObjIndexed","func","name","bind"],"sources":["lib/dataTransport.ts"],"sourcesContent":["import type { Transport } from 'data-transport';\nimport { forEachObjIndexed } from 'ramda';\n\nexport * from 'data-transport';\n\n/**\n * `@listen` decorator, that will auto binding event with `data-transport`\n */\nconst listen = (\n  target: any,\n  key: string,\n  descriptor: TypedPropertyDescriptor<(...args: any) => Promise<any>>,\n) => {\n  const fn = descriptor.value;\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof fn !== 'function') {\n      console.warn(\n        `The decorator '@listen' can only decorate methods, '${key}' is NOT a methods.`,\n      );\n      return descriptor;\n    }\n  }\n  target.listeners = target.listeners ?? {};\n  target.listeners[key] = fn;\n  return {\n    ...descriptor,\n    async value(this: Transport) {\n      if (process.env.NODE_ENV !== 'production') {\n        throw new Error(\n          `The method '${key}' is a listen function that can NOT be actively called.`,\n        );\n      }\n    },\n  };\n};\n\n/**\n * bind current class listenable,\n * that your class `@listen` work\n *\n * @example\n *\n  ```ts\n\n  class Adapter implements ToExternal {\n\n    transport?: Transport<{ emit: ToInternal; listen: ToExternal }>;\n\n    constructor(){\n      this.transport = createTransport('IFrameMain', {\n        iframe: this.appIFrame,\n      });\n      bindListeners(this, this.transport);\n    }\n\n    @listen\n    async fetchIsMatchCaseId(caseId: string): Promise<string> {\n      return this.visualforceRequest('fetchIsMatchCaseId', caseId);\n    }\n  }\n * ```\n */\nconst bindListeners = (instance: object, transport: Transport<any>) => {\n  forEachObjIndexed(\n    (func, name) => {\n      transport.listen(name, func.bind(instance));\n    },\n    (\n      instance as {\n        listeners?: Record<string, (...args: any) => any>;\n      }\n    ).listeners ?? {},\n  );\n};\n\nexport { bindListeners, listen };\n"],"mappings":"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"}