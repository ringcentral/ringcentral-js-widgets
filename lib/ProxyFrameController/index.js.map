{"version":3,"file":"index.js","names":["_url","_interopRequireDefault","require","_popWindow","obj","__esModule","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","prototype","propertyIsEnumerable","sourceKeys","_classCallCheck","instance","Constructor","ProxyFrameController","_ref","prefix","_url$parse","url","parse","window","location","href","_url$parse$query$uuid","query","uuid","oAuthCallback","callbackUri","parent","postMessage","addEventListener","_ref2","data","oAuthUri","_url$parse2","parsedUri","uri","format","state","concat","search","popWindow","e","newValue","localStorage","removeItem","proxyLoaded","exports"],"sources":["lib/ProxyFrameController/index.ts"],"sourcesContent":["import url from 'url';\n\nimport popWindow from '../popWindow';\n\ntype ProxyFrameControllerParams = {\n  prefix?: string;\n};\n\nexport default class ProxyFrameController {\n  constructor({ prefix }: ProxyFrameControllerParams = {}) {\n    const {\n      query: { uuid = '' },\n    } = url.parse(window.location.href, true);\n\n    // TODO: should find where to call that\n    window.oAuthCallback = (callbackUri: string) => {\n      window.parent.postMessage(\n        {\n          callbackUri,\n        },\n        '*',\n      );\n    };\n\n    window.addEventListener('message', ({ data }) => {\n      if (data) {\n        const { oAuthUri } = data;\n\n        if (oAuthUri != null) {\n          const { query, ...parsedUri } = url.parse(oAuthUri, true);\n          const uri = url.format({\n            ...parsedUri,\n            query: {\n              ...query,\n              state: `${query.state}-${uuid}`,\n            },\n            search: undefined,\n          });\n          popWindow(uri, `${prefix}-oauth`, 600, 600);\n        }\n      }\n    });\n\n    const key = `${prefix}-${uuid}-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && e.newValue && e.newValue !== '') {\n        const callbackUri = e.newValue;\n        window.parent.postMessage(\n          {\n            callbackUri,\n          },\n          '*',\n        );\n        localStorage.removeItem(key);\n      }\n    });\n\n    // loaded\n    window.parent.postMessage(\n      {\n        proxyLoaded: true,\n      },\n      '*',\n    );\n  }\n}\n"],"mappings":"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"}