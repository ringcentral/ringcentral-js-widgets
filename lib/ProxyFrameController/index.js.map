{"version":3,"file":"index.js","names":["_popWindow","require","_defineProperties","e","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","TypeError","String","Number","_classCallCheck","a","n","ProxyFrameController","exports","_ref","arguments","undefined","prefix","urlParams","URLSearchParams","location","search","uuid","get","window","oAuthCallback","callbackUri","parent","postMessage","addEventListener","_ref2","data","oAuthUri","toURL","URL","searchParams","set","concat","popWindow","href","newValue","localStorage","removeItem","proxyLoaded"],"sources":["lib/ProxyFrameController/index.ts"],"sourcesContent":["import { popWindow } from '../popWindow';\n\ntype ProxyFrameControllerParams = {\n  prefix?: string;\n};\n\nexport default class ProxyFrameController {\n  constructor({ prefix }: ProxyFrameControllerParams = {}) {\n    const urlParams = new URLSearchParams(location.search);\n    const uuid = urlParams.get('uuid') || '';\n\n    // TODO: should find where to call that\n    window.oAuthCallback = (callbackUri: string) => {\n      window.parent.postMessage(\n        {\n          callbackUri,\n        },\n        '*',\n      );\n    };\n\n    window.addEventListener('message', ({ data }) => {\n      if (data) {\n        const { oAuthUri } = data;\n\n        if (oAuthUri != null) {\n          const toURL = new URL(oAuthUri);\n\n          toURL.searchParams.set(\n            'state',\n            `${toURL.searchParams.get('state')}-${uuid}`,\n          );\n\n          popWindow(toURL.href, `${prefix}-oauth`, 700, 700);\n        }\n      }\n    });\n\n    const key = `${prefix}-${uuid}-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && e.newValue && e.newValue !== '') {\n        const callbackUri = e.newValue;\n        window.parent.postMessage(\n          {\n            callbackUri,\n          },\n          '*',\n        );\n        localStorage.removeItem(key);\n      }\n    });\n\n    // loaded\n    window.parent.postMessage(\n      {\n        proxyLoaded: true,\n      },\n      '*',\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}