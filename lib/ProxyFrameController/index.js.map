{"version":3,"file":"index.js","names":["_popWindow","require","_classCallCheck","a","n","TypeError","ProxyFrameController","_ref","arguments","length","undefined","prefix","urlParams","URLSearchParams","window","location","search","uuid","get","oAuthCallback","callbackUri","parent","postMessage","addEventListener","_ref2","data","oAuthUri","toURL","URL","searchParams","set","concat","popWindow","href","key","e","newValue","localStorage","removeItem","proxyLoaded","exports"],"sources":["lib/ProxyFrameController/index.ts"],"sourcesContent":["import { popWindow } from '../popWindow';\n\ntype ProxyFrameControllerParams = {\n  prefix?: string;\n};\n\nexport default class ProxyFrameController {\n  constructor({ prefix }: ProxyFrameControllerParams = {}) {\n    const urlParams = new URLSearchParams(window.location.search);\n    const uuid = urlParams.get('uuid') || '';\n\n    // TODO: should find where to call that\n    window.oAuthCallback = (callbackUri: string) => {\n      window.parent.postMessage(\n        {\n          callbackUri,\n        },\n        '*',\n      );\n    };\n\n    window.addEventListener('message', ({ data }) => {\n      if (data) {\n        const { oAuthUri } = data;\n\n        if (oAuthUri != null) {\n          const toURL = new URL(oAuthUri);\n\n          toURL.searchParams.set(\n            'state',\n            `${toURL.searchParams.get('state')}-${uuid}`,\n          );\n\n          popWindow(toURL.href, `${prefix}-oauth`, 700, 700);\n        }\n      }\n    });\n\n    const key = `${prefix}-${uuid}-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && e.newValue && e.newValue !== '') {\n        const callbackUri = e.newValue;\n        window.parent.postMessage(\n          {\n            callbackUri,\n          },\n          '*',\n        );\n        localStorage.removeItem(key);\n      }\n    });\n\n    // loaded\n    window.parent.postMessage(\n      {\n        proxyLoaded: true,\n      },\n      '*',\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AAAyC,SAAAC,gBAAAC,CAAA,EAAAC,CAAA,UAAAD,CAAA,YAAAC,CAAA,aAAAC,SAAA;AAAA,IAMpBC,oBAAoB,GACvC,SAAAA,qBAAA,EAAyD;EAAA,IAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAJ,CAAC,CAAC;IAAzCG,MAAM,GAAAJ,IAAA,CAANI,MAAM;EAAAT,eAAA,OAAAI,oBAAA;EAClB,IAAMM,SAAS,GAAG,IAAIC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC;EAC7D,IAAMC,IAAI,GAAGL,SAAS,CAACM,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE;;EAExC;EACAJ,MAAM,CAACK,aAAa,GAAG,UAACC,WAAmB,EAAK;IAC9CN,MAAM,CAACO,MAAM,CAACC,WAAW,CACvB;MACEF,WAAW,EAAXA;IACF,CAAC,EACD,GACF,CAAC;EACH,CAAC;EAEDN,MAAM,CAACS,gBAAgB,CAAC,SAAS,EAAE,UAAAC,KAAA,EAAc;IAAA,IAAXC,IAAI,GAAAD,KAAA,CAAJC,IAAI;IACxC,IAAIA,IAAI,EAAE;MAAA,IACAC,QAAQ,GAAKD,IAAI,CAAjBC,QAAQ;MAEhB,IAAIA,QAAQ,IAAI,IAAI,EAAE;QACpB,IAAMC,KAAK,GAAG,IAAIC,GAAG,CAACF,QAAQ,CAAC;QAE/BC,KAAK,CAACE,YAAY,CAACC,GAAG,CACpB,OAAO,KAAAC,MAAA,CACJJ,KAAK,CAACE,YAAY,CAACX,GAAG,CAAC,OAAO,CAAC,OAAAa,MAAA,CAAId,IAAI,CAC5C,CAAC;QAED,IAAAe,oBAAS,EAACL,KAAK,CAACM,IAAI,KAAAF,MAAA,CAAKpB,MAAM,aAAU,GAAG,EAAE,GAAG,CAAC;MACpD;IACF;EACF,CAAC,CAAC;EAEF,IAAMuB,GAAG,MAAAH,MAAA,CAAMpB,MAAM,OAAAoB,MAAA,CAAId,IAAI,iBAAc;EAC3CH,MAAM,CAACS,gBAAgB,CAAC,SAAS,EAAE,UAACY,CAAC,EAAK;IACxC,IAAIA,CAAC,CAACD,GAAG,KAAKA,GAAG,IAAIC,CAAC,CAACC,QAAQ,IAAID,CAAC,CAACC,QAAQ,KAAK,EAAE,EAAE;MACpD,IAAMhB,WAAW,GAAGe,CAAC,CAACC,QAAQ;MAC9BtB,MAAM,CAACO,MAAM,CAACC,WAAW,CACvB;QACEF,WAAW,EAAXA;MACF,CAAC,EACD,GACF,CAAC;MACDiB,YAAY,CAACC,UAAU,CAACJ,GAAG,CAAC;IAC9B;EACF,CAAC,CAAC;;EAEF;EACApB,MAAM,CAACO,MAAM,CAACC,WAAW,CACvB;IACEiB,WAAW,EAAE;EACf,CAAC,EACD,GACF,CAAC;AACH,CAAC;AAAAC,OAAA,cAAAlC,oBAAA","ignoreList":[]}