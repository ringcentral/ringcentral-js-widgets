{"version":3,"file":"track.js","names":["_RcModule","require","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","track","trackEvent","target","descriptor","initializer","Error","concat","fn","trackedFn","_ref","parentModule","analytics","_len","arguments","args","_key","result","apply","trackReturn","_trackReturn","_trackReturn2","event","trackProps","e","console","warn","identifierKey","error","enumerable","configurable","exports"],"sources":["lib/track.ts"],"sourcesContent":["import type { Descriptor, RcModuleV2 } from './RcModule';\nimport { identifierKey } from './RcModule';\n\nexport interface IAnalytics {\n  track(event: string, data?: any): void;\n}\n\ntype TrackEvent =\n  | string\n  | ((\n      ...args: any\n    ) =>\n      | (\n          | [string, object?]\n          | ((analytics: IAnalytics) => [string, object?] | void)\n        )\n      | void);\n\n/**\n * decorate a method with `Analytics` Module\n *\n * @param trackEvent define trackEvent for tracking\n */\nexport const track = (trackEvent: TrackEvent) => {\n  return (target: RcModuleV2, name: string, descriptor?: Descriptor<any>) => {\n    if (\n      typeof descriptor?.value !== 'function' &&\n      typeof descriptor?.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor?.value;\n    const initializer = descriptor.initializer;\n    // eslint-disable-next-line func-names\n    const trackedFn = function (this: RcModuleV2, ...args: any) {\n      const { analytics }: { analytics: IAnalytics } = this.parentModule as any;\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      if (typeof fn !== 'function') {\n        throw new Error(`@track decorated '${name}' is not a function`);\n      }\n      const result = fn.apply(this, args);\n      try {\n        if (typeof analytics?.track === 'function') {\n          if (typeof trackEvent === 'string') {\n            analytics.track(trackEvent);\n          } else {\n            let trackReturn = trackEvent(this, ...args);\n            if (typeof trackReturn === 'function') {\n              trackReturn = trackReturn(analytics);\n            }\n            if (Array.isArray(trackReturn)) {\n              const [event, trackProps] = trackReturn;\n              if (event) {\n                analytics.track(event, trackProps);\n              }\n            }\n          }\n        }\n      } catch (e) {\n        console.warn(`Analytics Error: ${target[identifierKey]}.${name}`);\n        console.error(e);\n      }\n      return result;\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n};\n"],"mappings":"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"}