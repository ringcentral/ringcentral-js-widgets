{"version":3,"file":"track.js","names":["track","trackEvent","target","name","descriptor","value","initializer","Error","fn","trackedFn","parentModule","analytics","call","args","result","apply","trackReturn","Array","isArray","event","trackProps","e","console","warn","identifierKey","error","enumerable","configurable"],"sources":["lib/track.ts"],"sourcesContent":["import { Descriptor, identifierKey, RcModuleV2 } from './RcModule';\n\nexport interface IAnalytics {\n  track(event: string, data?: any): void;\n}\n\ntype TrackEvent =\n  | string\n  | ((\n      ...args: any\n    ) =>\n      | (\n          | [string, object?]\n          | ((analytics: IAnalytics) => [string, object?] | void)\n        )\n      | void);\n\n/**\n * decorate a method with `Analytics` Module\n *\n * @param trackEvent define trackEvent for tracking\n */\nexport const track = (trackEvent: TrackEvent) => {\n  return (target: RcModuleV2, name: string, descriptor?: Descriptor<any>) => {\n    if (\n      typeof descriptor?.value !== 'function' &&\n      typeof descriptor?.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor?.value;\n    const initializer = descriptor.initializer;\n    // eslint-disable-next-line func-names\n    const trackedFn = function (this: RcModuleV2, ...args: any) {\n      const { analytics }: { analytics: IAnalytics } = this.parentModule as any;\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      if (typeof fn !== 'function') {\n        throw new Error(`@track decorated '${name}' is not a function`);\n      }\n      const result = fn.apply(this, args);\n      try {\n        if (typeof analytics?.track === 'function') {\n          if (typeof trackEvent === 'string') {\n            analytics.track(trackEvent);\n          } else {\n            let trackReturn = trackEvent(this, ...args);\n            if (typeof trackReturn === 'function') {\n              trackReturn = trackReturn(analytics);\n            }\n            if (Array.isArray(trackReturn)) {\n              const [event, trackProps] = trackReturn;\n              if (event) {\n                analytics.track(event, trackProps);\n              }\n            }\n          }\n        }\n      } catch (e) {\n        console.warn(`Analytics Error: ${target[identifierKey]}.${name}`);\n        console.error(e);\n      }\n      return result;\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n};\n"],"mappings":";;;;;;;;;;;AAAA;;;;;;;;;;;;;;AAiBA;AACA;AACA;AACA;AACA;AACO,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAACC,UAAD,EAA4B;EAC/C,OAAO,UAACC,MAAD,EAAqBC,IAArB,EAAmCC,UAAnC,EAAoE;IACzE,IACE,QAAOA,UAAP,aAAOA,UAAP,uBAAOA,UAAU,CAAEC,KAAnB,MAA6B,UAA7B,IACA,QAAOD,UAAP,aAAOA,UAAP,uBAAOA,UAAU,CAAEE,WAAnB,MAAmC,UAFrC,EAGE;MACA,MAAM,IAAIC,KAAJ,6BAA+BJ,IAA/B,uBAAN;IACD;;IACD,IAAIK,EAAyB,GAAGJ,UAAH,aAAGA,UAAH,uBAAGA,UAAU,CAAEC,KAA5C;IACA,IAAMC,WAAW,GAAGF,UAAU,CAACE,WAA/B,CARyE,CASzE;;IACA,IAAMG,SAAS,GAAG,SAAZA,SAAY,GAA0C;MAAA,WACT,KAAKC,YADI;MAAA,IAClDC,SADkD,QAClDA,SADkD;;MAE1D,IAAI,OAAOL,WAAP,KAAuB,UAA3B,EAAuC;QACrCE,EAAE,GAAGF,WAAW,CAACM,IAAZ,CAAiB,IAAjB,CAAL;MACD;;MACD,IAAI,OAAOJ,EAAP,KAAc,UAAlB,EAA8B;QAC5B,MAAM,IAAID,KAAJ,6BAA+BJ,IAA/B,yBAAN;MACD;;MAPyD,kCAAXU,IAAW;QAAXA,IAAW;MAAA;;MAQ1D,IAAMC,MAAM,GAAGN,EAAE,CAACO,KAAH,CAAS,IAAT,EAAeF,IAAf,CAAf;;MACA,IAAI;QACF,IAAI,QAAOF,SAAP,aAAOA,SAAP,uBAAOA,SAAS,CAAEX,KAAlB,MAA4B,UAAhC,EAA4C;UAC1C,IAAI,OAAOC,UAAP,KAAsB,QAA1B,EAAoC;YAClCU,SAAS,CAACX,KAAV,CAAgBC,UAAhB;UACD,CAFD,MAEO;YACL,IAAIe,WAAW,GAAGf,UAAU,MAAV,UAAW,IAAX,SAAoBY,IAApB,EAAlB;;YACA,IAAI,OAAOG,WAAP,KAAuB,UAA3B,EAAuC;cACrCA,WAAW,GAAGA,WAAW,CAACL,SAAD,CAAzB;YACD;;YACD,IAAIM,KAAK,CAACC,OAAN,CAAcF,WAAd,CAAJ,EAAgC;cAAA,mBACFA,WADE;cAAA;cAAA,IACvBG,MADuB;cAAA,IAChBC,UADgB;;cAE9B,IAAID,MAAJ,EAAW;gBACTR,SAAS,CAACX,KAAV,CAAgBmB,MAAhB,EAAuBC,UAAvB;cACD;YACF;UACF;QACF;MACF,CAjBD,CAiBE,OAAOC,CAAP,EAAU;QACVC,OAAO,CAACC,IAAR,4BAAiCrB,MAAM,CAACsB,uBAAD,CAAvC,cAA0DrB,IAA1D;QACAmB,OAAO,CAACG,KAAR,CAAcJ,CAAd;MACD;;MACD,OAAOP,MAAP;IACD,CA/BD,CAVyE,CA0CzE;;;IACA,OAAO;MACLY,UAAU,EAAE,IADP;MAELC,YAAY,EAAE,IAFT;MAGLtB,KAAK,EAAEI;IAHF,CAAP;EAKD,CAhDD;AAiDD,CAlDM"}