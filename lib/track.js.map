{"version":3,"file":"track.js","names":["_RcModule","require","_slicedToArray","r","e","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","track","trackEvent","target","descriptor","initializer","Error","concat","fn","trackedFn","_ref","parentModule","analytics","_len","arguments","args","_key","result","apply","trackReturn","_trackReturn","_trackReturn2","event","trackProps","console","warn","identifierKey","error","enumerable","configurable","exports"],"sources":["lib/track.ts"],"sourcesContent":["import type { Descriptor, RcModuleV2 } from './RcModule';\nimport { identifierKey } from './RcModule';\n\nexport interface IAnalytics {\n  track(event: string, data?: any): void;\n}\n\ntype TrackEvent =\n  | string\n  | ((\n      ...args: any\n    ) =>\n      | (\n          | [string, object?]\n          | ((analytics: IAnalytics) => [string, object?] | void)\n        )\n      | void);\n\n/**\n * decorate a method with `Analytics` Module\n *\n * @param trackEvent define trackEvent for tracking\n */\nexport const track = (trackEvent: TrackEvent) => {\n  return (target: RcModuleV2, name: string, descriptor?: Descriptor<any>) => {\n    if (\n      typeof descriptor?.value !== 'function' &&\n      typeof descriptor?.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor?.value;\n    const initializer = descriptor.initializer;\n    // eslint-disable-next-line func-names\n    const trackedFn = function (this: RcModuleV2, ...args: any) {\n      const { analytics }: { analytics: IAnalytics } = this.parentModule as any;\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      if (typeof fn !== 'function') {\n        throw new Error(`@track decorated '${name}' is not a function`);\n      }\n      const result = fn.apply(this, args);\n      try {\n        if (typeof analytics?.track === 'function') {\n          if (typeof trackEvent === 'string') {\n            analytics.track(trackEvent);\n          } else {\n            let trackReturn = trackEvent(this, ...args);\n            if (typeof trackReturn === 'function') {\n              trackReturn = trackReturn(analytics);\n            }\n            if (Array.isArray(trackReturn)) {\n              const [event, trackProps] = trackReturn;\n              if (event) {\n                analytics.track(event, trackProps);\n              }\n            }\n          }\n        }\n      } catch (e) {\n        console.warn(`Analytics Error: ${target[identifierKey]}.${name}`);\n        console.error(e);\n      }\n      return result;\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n};\n"],"mappings":"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","ignoreList":[]}