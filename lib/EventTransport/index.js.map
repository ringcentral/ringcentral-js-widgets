{"version":3,"sources":["lib/EventTransport/index.ts"],"names":["EventTransport","options","name","_deferred","Map","payload","requestId","uuid","v4","promise","Promise","resolve","reject","set","timeoutId","setTimeout","get","Error","_events","timeout","_timeout","then","result","clearTimeout","error","emit","request","deferred","push","TransportBase"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEqBA,c;;;;;AACnB,0BAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AACnB,8DACKA,OADL;AAEEC,MAAAA,IAAI,EAAE;AAFR;AAIA,UAAKC,SAAL,GAAiB,IAAIC,GAAJ,EAAjB;AALmB;AAMpB;;;;;;;;;;;;;AAEeC,gBAAAA,O,QAAAA,O;AACRC,gBAAAA,S,GAAYC,IAAI,CAACC,EAAL,E;AACZC,gBAAAA,O,GAAU,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/C,kBAAA,MAAI,CAACT,SAAL,CAAeU,GAAf,CAAmBP,SAAnB,EAA8B;AAC5BK,oBAAAA,OAAO,EAAPA,OAD4B;AAE5BC,oBAAAA,MAAM,EAANA;AAF4B,mBAA9B;AAID,iBALe,C;AAMZE,gBAAAA,S,GAAYC,UAAU,CAAC,YAAM;AAC/BD,kBAAAA,SAAS,GAAG,IAAZ;;AACA,kBAAA,MAAI,CAACX,SAAL,CAAea,GAAf,CAAmBV,SAAnB,EAA8BM,MAA9B,CAAqC,IAAIK,KAAJ,CAAU,MAAI,CAACC,OAAL,CAAaC,OAAvB,CAArC;AACD,iBAHyB,EAGvB,KAAKC,QAHkB,C;AAI1BX,gBAAAA,OAAO,CACJY,IADH,CACQ,UAACC,MAAD,EAAY;AAChB,sBAAIR,SAAJ,EAAeS,YAAY,CAACT,SAAD,CAAZ;;AACf,kBAAA,MAAI,CAACX,SAAL,WAAsBG,SAAtB;;AACA,yBAAOI,OAAO,CAACC,OAAR,CAAgBW,MAAhB,CAAP;AACD,iBALH,WAMS,UAACE,KAAD,EAAW;AAChB,sBAAIV,SAAJ,EAAeS,YAAY,CAACT,SAAD,CAAZ;;AACf,kBAAA,MAAI,CAACX,SAAL,WAAsBG,SAAtB;;AACA,yBAAOI,OAAO,CAACE,MAAR,CAAeY,KAAf,CAAP;AACD,iBAVH;AAWA,qBAAKC,IAAL,CAAU,KAAKP,OAAL,CAAaQ,OAAvB,EAAgC;AAC9BpB,kBAAAA,SAAS,EAATA,SAD8B;AAE9BD,kBAAAA,OAAO,EAAPA;AAF8B,iBAAhC;iDAIOI,O;;;;;;;;;;;;;;;;;;oCAG8B;AAAA,UAA5BH,SAA4B,SAA5BA,SAA4B;AAAA,UAAjBgB,MAAiB,SAAjBA,MAAiB;AAAA,UAATE,KAAS,SAATA,KAAS;;AACrC,UAAMG,QAAQ,GAAG,KAAKxB,SAAL,CAAea,GAAf,CAAmBV,SAAnB,CAAjB;;AACA,UAAIqB,QAAJ,EAAc;AACZ,YAAIH,KAAJ,EAAW;AACTG,UAAAA,QAAQ,CAACf,MAAT,CAAgBY,KAAhB;AACD,SAFD,MAEO;AACLG,UAAAA,QAAQ,CAAChB,OAAT,CAAiBW,MAAjB;AACD;AACF;AACF;;;gCAEiB;AAAA,UAAXjB,OAAW,SAAXA,OAAW;AAChB,WAAKoB,IAAL,CAAU,KAAKP,OAAL,CAAaU,IAAvB,EAA6BvB,OAA7B;AACD;;;;EApDyCwB,0B","sourcesContent":["import * as uuid from 'uuid';\n\nimport TransportBase from '../TransportBase';\n\nexport default class EventTransport extends TransportBase {\n  constructor(options) {\n    super({\n      ...options,\n      name: 'EventTransport',\n    });\n    this._deferred = new Map();\n  }\n\n  async request({ payload }) {\n    const requestId = uuid.v4();\n    const promise = new Promise((resolve, reject) => {\n      this._deferred.set(requestId, {\n        resolve,\n        reject,\n      });\n    });\n    let timeoutId = setTimeout(() => {\n      timeoutId = null;\n      this._deferred.get(requestId).reject(new Error(this._events.timeout));\n    }, this._timeout);\n    promise\n      .then((result) => {\n        if (timeoutId) clearTimeout(timeoutId);\n        this._deferred.delete(requestId);\n        return Promise.resolve(result);\n      })\n      .catch((error) => {\n        if (timeoutId) clearTimeout(timeoutId);\n        this._deferred.delete(requestId);\n        return Promise.reject(error);\n      });\n    this.emit(this._events.request, {\n      requestId,\n      payload,\n    });\n    return promise;\n  }\n\n  response({ requestId, result, error }) {\n    const deferred = this._deferred.get(requestId);\n    if (deferred) {\n      if (error) {\n        deferred.reject(error);\n      } else {\n        deferred.resolve(result);\n      }\n    }\n  }\n\n  push({ payload }) {\n    this.emit(this._events.push, payload);\n  }\n}\n"],"file":"index.js"}