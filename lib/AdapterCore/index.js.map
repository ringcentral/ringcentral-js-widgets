{"version":3,"sources":["lib/AdapterCore/index.ts"],"names":["SANDBOX_ATTRIBUTE_VALUE","join","ALLOW_ATTRIBUTE_VALUE","urlRegex","clickEvent","test","window","location","href","ON_HOLD_CALLS","RINGING_CALLS","CURRENT_CALL","OTHER_DEVICE_CALLS","ROTATE_LENGTH","ROTATE_INTERVAL","AdapterCore","prefix","styles","container","root","messageTypes","baseMessageTypes","defaultDirection","defaultPadding","currentState","callInfoMap","_otherDeviceCallsLength","_onHoldCallsLength","_ringingCallsLength","_currentStartTime","_otherDeviceCallsEl","_onHoldCallsEl","_ringingCallsEl","_durationEl","_currentCallEl","_viewCallsEl","_scrollable","_strings","_hoverBar","lastState","_onAllCallsPath","_onCurrentCallPath","_prefix","_messageTypes","_container","_root","_styles","_defaultDirection","_padding","_minTranslateX","_minTranslateY","_translateX","_translateY","_appWidth","_appHeight","_dragStartPosition","_closed","_minimized","_dragging","_hover","_hoverHeader","_loading","_userStatus","_dndStatus","_telephonyStatus","_presenceOption","_scrollale","_headerEl","_logoEl","_contentFrameContainerEl","_toggleEl","_closeEl","_presenceEl","_presenceItemEls","_dropdownPresence","_contentFrameEl","_isClick","_resizeTimeout","_resizeTick","_messageTransport","_logoUrl","_appUrl","_ringing","_hasActiveCalls","_locale","rotateInterval","durationInterval","_onWindowResize","clearTimeout","setTimeout","_renderRestrictedPosition","Date","now","_onWindowMouseMove","evt","buttons","_renderMainClass","factor","_calculateFactor","delta","x","clientX","y","clientY","minTranslateX","minTranslateY","translateX","translateY","_syncPosition","_debouncedPostMessage","_postMessage","ObjectMap","prefixValues","ensureExist","call","msg","type","syncClosed","_onSyncClosed","closed","syncMinimized","_onSyncMinimized","minimized","syncSize","_onSyncSize","size","syncPresence","_onPushPresence","pushAdapterState","_onPushAdapterState","pushLocale","_onPushLocale","pushRingState","_onPushRingState","pushCalls","_onPushCallsInfo","pushOnCurrentCallPath","_onPushOnCurrentCallPath","pushOnAllCallsPath","_onPushOnAllCallsPath","sanboxAttributeValue","allowAttributeValue","header","presence","noPresence","presenceBar","button","toggle","minimizeIcon","minimizeIconBar","close","closeIcon","logo","duration","ringingCalls","onHoldCalls","otherDeviceCalls","currentCallBtn","viewCallsBtn","dropdownPresence","line","presenceItem","statusIcon","Available","availableBtn","Busy","busyBtn","DoNotAcceptAnyCalls","doNotAcceptAnyCallsBtn","Offline","offlineBtn","frameContainer","contentFrame","innerHTML","_getContentDOM","querySelector","addEventListener","stopPropagation","toggleMinimized","setClosed","togglePresenceDropdown","querySelectorAll","forEach","itemEl","dataPresence","getAttribute","presenceItemClicked","presenceType","presenceStatus","dndStatus","navigateToCurrentCall","navigateToViewCalls","_renderCallsBar","_onHeaderClicked","document","readyState","body","appendChild","_beforeRender","_render","classList","showDropdown","setMinimized","data","messageTransport","postMessage","logoUrl","src","setAttribute","visible","appUrl","contentFrameEl","renderAdapterSize","remove","maximumX","innerWidth","clientWidth","maximumY","innerHeight","clientHeight","minimumX","minimumY","width","height","style","ringing","ringingCallsLength","onHoldCallsLength","otherDeviceCallsLength","currentStartTime","renderCallsBar","onCurrentCallPath","onAllCallsPath","userStatus","telephonyStatus","presenceOption","renderPresence","locale","strings","_renderString","_renderCallBarBtn","_renderRingingCalls","_renderOnHoldCalls","_renderOtherDevicesCalls","_renderPresenceItem","syncPosition","position","_calculateMinMaxPosition","newMinTranslateX","Math","max","min","newMinTranslateY","newTranslateX","newTranslateY","renderPosition","dragging","hover","loading","selected","startTime","round","getTime","clearInterval","_renderCallDuration","rotateCallInfo","setInterval","increment","state","newState","_renderMinimizedBar","showDuration","centerDuration","center","moveOutDuration","moveOut","moveInDuration","moveIn","showRingingCalls","centerCallInfo","moveOutRingingInfo","moveInRingingInfo","showOnHoldCalls","moveOutOnHoldInfo","moveInOnHoldInfo","showOtherDeviceCalls","isInMoveOutStatus","isInMoveInStatus","showCurrentCallBtn","moveOutCurrentCallBtn","moveInCurrentCallBtn","showViewCallsBtn","moveInViewCallsBtn","moveOutViewCallsBtn","calculateState","ringCallsInfo","title","onHoldCallsInfo","otherDeviceCallsInfo","removeEventListener"],"mappings":"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","sourcesContent":["import classnames from 'classnames';\n\nimport { presenceStatus } from '@ringcentral-integration/commons/enums/presenceStatus.enum';\nimport debounce from '@ringcentral-integration/commons/lib/debounce';\nimport ensureExist from '@ringcentral-integration/commons/lib/ensureExist';\nimport dndStatus from '@ringcentral-integration/commons/modules/Presence/dndStatus';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\n\nimport formatDuration from '../formatDuration';\nimport { baseMessageTypes } from './baseMessageTypes';\n\nconst SANDBOX_ATTRIBUTE_VALUE = [\n  'allow-same-origin',\n  'allow-scripts',\n  'allow-forms',\n  'allow-popups',\n  // For Google Chrome v83 new feature:\n  // https://www.chromestatus.com/feature/5706745674465280\n  'allow-downloads',\n].join(' ');\n\n// chrome 63 mandate the declaration of this attribute for getUserMedia to work in iframes\nconst ALLOW_ATTRIBUTE_VALUE = [\n  'microphone',\n  'autoplay',\n  // 'camera',\n].join('; ');\n\nconst urlRegex =\n  /(https:\\/\\/)?(?:www\\.)?outlook\\.office(?:365)?\\.com\\/(mail)\\/(deeplink)/;\nconst clickEvent = urlRegex.test(window.location.href) ? 'mousedown' : 'click';\nconst ON_HOLD_CALLS = 0;\nconst RINGING_CALLS = 1;\nconst CURRENT_CALL = 2;\nconst OTHER_DEVICE_CALLS = 3;\n\nconst ROTATE_LENGTH = 4;\nconst ROTATE_INTERVAL = 5000;\n\nexport default class AdapterCore {\n  currentState: number;\n  callInfoMap: Record<number, boolean>;\n  private _otherDeviceCallsLength: number;\n  private _onHoldCallsLength: number;\n  private _ringingCallsLength: number;\n  private _currentStartTime: number;\n  private _otherDeviceCallsEl: HTMLElement;\n  private _onHoldCallsEl: HTMLElement;\n  private _ringingCallsEl: HTMLElement;\n  private _durationEl: HTMLElement;\n  private _currentCallEl: HTMLElement;\n  private _viewCallsEl: HTMLElement;\n  private _scrollable: boolean;\n  private _strings: any;\n  private _hoverBar: any;\n  lastState: number;\n  private _onAllCallsPath: any;\n  private _onCurrentCallPath: any;\n  _prefix: any;\n  _messageTypes: any;\n  _container: any;\n  _root: any;\n  _styles: any;\n  _defaultDirection: string;\n  _padding: number;\n  _minTranslateX: number;\n  _minTranslateY: number;\n  _translateX: number;\n  _translateY: number;\n  _appWidth: number;\n  _appHeight: number;\n  _dragStartPosition: any;\n  _closed: boolean;\n  _minimized: boolean;\n  _dragging: boolean;\n  _hover: boolean;\n  _hoverHeader: boolean;\n  _loading: boolean;\n  _userStatus: any;\n  _dndStatus: any;\n  _telephonyStatus: any;\n  _presenceOption: any;\n  _scrollale: boolean;\n  _headerEl: any;\n  _logoEl: any;\n  _contentFrameContainerEl: any;\n  _toggleEl: any;\n  _closeEl: any;\n  _presenceEl: any;\n  _presenceItemEls: any;\n  _dropdownPresence: any;\n  _contentFrameEl: any;\n  _isClick: boolean;\n  _resizeTimeout: any;\n  _resizeTick: any;\n  _messageTransport: any;\n  _logoUrl: any;\n  _appUrl: any;\n  _ringing: any;\n  _hasActiveCalls: boolean;\n  _locale: any;\n  rotateInterval: any;\n  durationInterval: any;\n\n  // life cycle\n  protected _beforeRender() {}\n\n  constructor({\n    prefix,\n    styles,\n    container,\n    root = container,\n    messageTypes = baseMessageTypes,\n    defaultDirection = 'left',\n    defaultPadding = 15,\n  }) {\n    this._prefix = prefix;\n    this._messageTypes = ObjectMap.prefixValues(messageTypes, prefix);\n    this._container = ensureExist.call(this, container, 'container');\n    this._root = root;\n    this._styles = styles;\n    this._defaultDirection = defaultDirection;\n\n    this._padding = defaultPadding;\n    this._minTranslateX = 0;\n    this._minTranslateY = 0;\n    this._translateX = 0;\n    this._translateY = 0;\n    this._appWidth = 0;\n    this._appHeight = 0;\n    this._dragStartPosition = null;\n\n    this._closed = true;\n    this._minimized = true;\n    this._dragging = false;\n    this._hover = false;\n    this._hoverHeader = false;\n    this._loading = true;\n    this._userStatus = null;\n    this._dndStatus = null;\n    this._telephonyStatus = null;\n    this._presenceOption = null;\n\n    this.currentState = -1;\n    this._scrollale = false;\n\n    this._strings = {};\n  }\n\n  _onMessage(msg) {\n    if (msg) {\n      switch (msg.type) {\n        case this._messageTypes.syncClosed:\n          this._onSyncClosed(msg.closed);\n          break;\n        case this._messageTypes.syncMinimized:\n          this._onSyncMinimized(msg.minimized);\n          break;\n        case this._messageTypes.syncSize:\n          this._onSyncSize(msg.size);\n          break;\n        case this._messageTypes.syncPresence:\n          this._onPushPresence(msg);\n          break;\n        case this._messageTypes.pushAdapterState:\n          this._onPushAdapterState(msg);\n          break;\n        case this._messageTypes.pushLocale:\n          this._onPushLocale(msg);\n          break;\n        case this._messageTypes.pushRingState:\n          this._onPushRingState(msg);\n          break;\n        case this._messageTypes.pushCalls:\n          this._onPushCallsInfo(msg);\n          break;\n        case this._messageTypes.pushOnCurrentCallPath:\n          this._onPushOnCurrentCallPath(msg);\n          break;\n        case this._messageTypes.pushOnAllCallsPath:\n          this._onPushOnAllCallsPath(msg);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  _getContentDOM(sanboxAttributeValue, allowAttributeValue) {\n    return `\n      <header class=\"${this._styles.header}\" draggable=\"false\">\n        <div class=\"${this._styles.presence} ${this._styles.noPresence}\">\n          <div class=\"${this._styles.presenceBar}\">\n          </div>\n        </div>\n        <div class=\"${this._styles.button} ${this._styles.toggle}\">\n          <div class=\"${this._styles.minimizeIcon}\">\n            <div class=\"${this._styles.minimizeIconBar}\"></div>\n          </div>\n        </div>\n        <div class=\"${this._styles.button} ${this._styles.close}\">\n          <div class=\"${this._styles.closeIcon}\">\n            <div></div><div></div>\n          </div>\n        </div>\n        <img class=\"${this._styles.logo}\" draggable=\"false\"></img>\n        <div class=\"${this._styles.duration}\"></div>\n        <div class=\"${this._styles.ringingCalls}\"></div>\n        <div class=\"${this._styles.onHoldCalls}\"></div>\n        <div class=\"${this._styles.otherDeviceCalls}\"></div>\n        <div class=\"${this._styles.currentCallBtn}\">${this._strings.currentCallBtn}</div>\n        <div class=\"${this._styles.viewCallsBtn}\">${this._strings.viewCallsBtn}</div>\n      </header>\n      <div class=\"${this._styles.dropdownPresence}\">\n        <div class=\"${this._styles.line}\">\n          <a class=\"${this._styles.presenceItem}\" data-presence=\"available\">\n            <div class=\"${this._styles.presence} ${this._styles.statusIcon} ${this._styles.Available}\">\n            </div>\n            <span>${this._strings.availableBtn}</span>\n          </a>\n          <a class=\"${this._styles.presenceItem}\" data-presence=\"busy\">\n            <div class=\"${this._styles.presence} ${this._styles.statusIcon} ${this._styles.Busy}\">\n            </div>\n            <span>${this._strings.busyBtn}</span>\n          </a>\n          <a class=\"${this._styles.presenceItem}\" data-presence=\"doNotAcceptAnyCalls\">\n            <div class=\"${this._styles.presence} ${this._styles.statusIcon} ${this._styles.DoNotAcceptAnyCalls}\">\n              <div class=\"${this._styles.presenceBar}\"></div>\n            </div>\n            <span>${this._strings.doNotAcceptAnyCallsBtn}</span>\n          </a>\n          <a class=\"${this._styles.presenceItem}\" data-presence=\"offline\">\n            <div class=\"${this._styles.presence} ${this._styles.statusIcon} ${this._styles.Offline}\">\n            </div>\n            <span>${this._strings.offlineBtn}</span>\n          </a>\n        </div>\n      </div>\n      <div class=\"${this._styles.frameContainer}\">\n        <iframe class=\"${this._styles.contentFrame}\" sandbox=\"${sanboxAttributeValue}\" allow=\"${allowAttributeValue}\" >\n        </iframe>\n      </div>`;\n  }\n\n  _generateContentDOM() {\n    this._root.innerHTML = this._getContentDOM(\n      SANDBOX_ATTRIBUTE_VALUE,\n      ALLOW_ATTRIBUTE_VALUE,\n    );\n    this._headerEl = this._root.querySelector(`.${this._styles.header}`);\n    this._logoEl = this._root.querySelector(`.${this._styles.logo}`);\n    this._logoEl.addEventListener('dragstart', () => false);\n\n    this._contentFrameContainerEl = this._root.querySelector(\n      `.${this._styles.frameContainer}`,\n    );\n\n    // toggle button\n    this._toggleEl = this._root.querySelector(`.${this._styles.toggle}`);\n    this._toggleEl.addEventListener(clickEvent, (evt) => {\n      evt.stopPropagation();\n      this.toggleMinimized();\n    });\n\n    // close button\n    this._closeEl = this._root.querySelector(`.${this._styles.close}`);\n    if (this._closeEl) {\n      this._closeEl.addEventListener(clickEvent, () => {\n        this.setClosed(true);\n      });\n    }\n\n    this._presenceEl = this._root.querySelector(`.${this._styles.presence}`);\n    this._presenceEl.addEventListener(clickEvent, (evt) => {\n      evt.stopPropagation();\n      this.togglePresenceDropdown();\n    });\n\n    this._presenceItemEls = this._root.querySelectorAll(\n      `.${this._styles.presenceItem}`,\n    );\n\n    this._presenceItemEls.forEach((itemEl) => {\n      const dataPresence = itemEl.getAttribute('data-presence');\n      itemEl.addEventListener(clickEvent, (evt) => {\n        evt.stopPropagation();\n        this.togglePresenceDropdown();\n        this._postMessage({\n          type: this._messageTypes.presenceItemClicked,\n          presenceType: presenceStatus[dataPresence] || dndStatus[dataPresence],\n        });\n      });\n    });\n\n    this._dropdownPresence = this._root.querySelector(\n      `.${this._styles.dropdownPresence}`,\n    );\n    if (this._dropdownPresence) {\n      this._dropdownPresence.addEventListener(clickEvent, (evt) => {\n        evt.stopPropagation();\n        this.togglePresenceDropdown();\n      });\n    }\n\n    this._contentFrameEl = this._root.querySelector(\n      `.${this._styles.contentFrame}`,\n    );\n\n    this._durationEl = this._root.querySelector(`.${this._styles.duration}`);\n    this._durationEl.addEventListener(clickEvent, (evt) => {\n      evt.stopPropagation();\n      this._postMessage({\n        type: this._messageTypes.navigateToCurrentCall,\n      });\n    });\n\n    this._currentCallEl = this._root.querySelector(\n      `.${this._styles.currentCallBtn}`,\n    );\n    this._currentCallEl.addEventListener(clickEvent, (evt) => {\n      evt.stopPropagation();\n      this._postMessage({\n        type: this._messageTypes.navigateToCurrentCall,\n      });\n    });\n\n    this._viewCallsEl = this._root.querySelector(\n      `.${this._styles.viewCallsBtn}`,\n    );\n    this._viewCallsEl.addEventListener(clickEvent, (evt) => {\n      evt.stopPropagation();\n      this._postMessage({\n        type: this._messageTypes.navigateToViewCalls,\n      });\n    });\n\n    this._ringingCallsEl = this._root.querySelector(\n      `.${this._styles.ringingCalls}`,\n    );\n\n    this._onHoldCallsEl = this._root.querySelector(\n      `.${this._styles.onHoldCalls}`,\n    );\n\n    this._otherDeviceCallsEl = this._root.querySelector(\n      `.${this._styles.otherDeviceCalls}`,\n    );\n\n    this._headerEl.addEventListener('mousedown', (evt) => {\n      this._dragging = true;\n      this._isClick = true;\n      this._dragStartPosition = {\n        x: evt.clientX,\n        y: evt.clientY,\n        translateX: this._translateX,\n        translateY: this._translateY,\n        minTranslateX: this._minTranslateX,\n        minTranslateY: this._minTranslateY,\n      };\n      this._renderMainClass();\n    });\n    this._headerEl.addEventListener('mouseup', () => {\n      this._dragging = false;\n      this._renderMainClass();\n    });\n    window.addEventListener('mousemove', this._onWindowMouseMove);\n\n    this._headerEl.addEventListener('mouseenter', () => {\n      if (!this._minimized) {\n        if (this._currentStartTime > 0) {\n          this._hoverBar = true;\n          this._scrollable = false;\n          this._renderCallsBar();\n        }\n        return;\n      }\n      this._hoverHeader = true;\n      this._renderMainClass();\n    });\n    this._headerEl.addEventListener('mouseleave', () => {\n      this._hoverHeader = false;\n      this._hoverBar = false;\n      this._scrollable = false;\n      this._renderCallsBar();\n      this._renderMainClass();\n    });\n\n    this._isClick = true;\n    this._headerEl.addEventListener(clickEvent, (evt) => {\n      if (this._isClick) {\n        this._onHeaderClicked(evt);\n      }\n    });\n\n    this._resizeTimeout = null;\n    this._resizeTick = null;\n    window.addEventListener('resize', this._onWindowResize);\n\n    // hover detection for ie\n    this._container.addEventListener('mouseenter', () => {\n      this._hover = true;\n      this._renderMainClass();\n    });\n    this._container.addEventListener('mouseleave', () => {\n      this._hover = false;\n      this._renderMainClass();\n    });\n\n    if (document.readyState === 'loading') {\n      window.addEventListener('load', () => {\n        document.body.appendChild(this._container);\n      });\n    } else {\n      document.body.appendChild(this._container);\n    }\n\n    this._beforeRender();\n\n    this._render();\n  }\n\n  _onHeaderClicked() {\n    if (this._minimized) {\n      this.toggleMinimized();\n    }\n  }\n\n  _onWindowResize = () => {\n    if (this._dragging) {\n      return;\n    }\n    if (this._resizeTimeout) {\n      clearTimeout(this._resizeTimeout);\n    }\n    this._resizeTimeout = setTimeout(\n      () => this._renderRestrictedPosition(),\n      100,\n    );\n    if (!this._resizeTick || Date.now() - this._resizeTick > 50) {\n      this._resizeTick = Date.now();\n      this._renderRestrictedPosition();\n    }\n  };\n\n  _onWindowMouseMove = (evt) => {\n    if (this._dragging) {\n      if (evt.buttons === 0) {\n        this._dragging = false;\n        this._renderMainClass();\n        return;\n      }\n      const factor = this._calculateFactor();\n      const delta = {\n        x: evt.clientX - this._dragStartPosition.x,\n        y: evt.clientY - this._dragStartPosition.y,\n      };\n      if (this._minimized) {\n        this._minTranslateX =\n          this._dragStartPosition.minTranslateX + delta.x * factor;\n        this._minTranslateY = this._dragStartPosition.minTranslateY + delta.y;\n      } else {\n        this._translateX =\n          this._dragStartPosition.translateX + delta.x * factor;\n        this._translateY = this._dragStartPosition.translateY + delta.y;\n      }\n      if (delta.x !== 0 || delta.y !== 0) {\n        this._isClick = false;\n      }\n      this._syncPosition();\n      this._renderRestrictedPosition();\n    }\n  };\n\n  togglePresenceDropdown() {\n    if (this._dropdownPresence) {\n      this._dropdownPresence.classList.toggle(`${this._styles.showDropdown}`);\n      this.setMinimized(false);\n    }\n  }\n\n  get messageTransport() {\n    return this._messageTransport;\n  }\n\n  _postMessage(data) {\n    this.messageTransport.postMessage(data);\n  }\n\n  _setLogoUrl(logoUrl) {\n    this._logoUrl = logoUrl;\n    this._logoEl.src = logoUrl;\n    this._logoEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.logo,\n        this._logoUrl && this._logoUrl !== '' && this._styles.visible,\n      ),\n    );\n  }\n\n  _setAppUrl(appUrl) {\n    this._appUrl = appUrl;\n    if (appUrl) {\n      this.contentFrameEl.src = appUrl;\n    }\n  }\n\n  _onSyncMinimized(minimized) {\n    this._minimized = !!minimized;\n    this._renderMainClass();\n    this.renderAdapterSize();\n    this._renderRestrictedPosition();\n  }\n\n  setMinimized(minimized) {\n    this._onSyncMinimized(minimized);\n    this._postMessage({\n      type: this._messageTypes.syncMinimized,\n      minimized: this._minimized,\n    });\n    if (minimized && this._dropdownPresence) {\n      this._dropdownPresence.classList.remove(`${this._styles.showDropdown}`);\n    }\n  }\n\n  toggleMinimized() {\n    this.setMinimized(!this._minimized);\n  }\n\n  _calculateMinMaxPosition() {\n    const maximumX =\n      window.innerWidth -\n      (this._minimized ? this._headerEl.clientWidth : this._appWidth) -\n      2 * this._padding;\n    const maximumY =\n      window.innerHeight -\n      (this._minimized\n        ? this._headerEl.clientHeight\n        : this._headerEl.clientHeight + this._appHeight) -\n      this._padding;\n    return {\n      minimumX: this._padding,\n      minimumY: this._padding,\n      maximumX,\n      maximumY,\n    };\n  }\n\n  _onSyncClosed(closed) {\n    this._closed = !!closed;\n    this._renderMainClass();\n  }\n\n  setClosed(closed) {\n    this._onSyncClosed(closed);\n    this._postMessage({\n      type: this._messageTypes.syncClosed,\n      closed: this.closed,\n    });\n  }\n\n  toggleClosed() {\n    this.setClosed(!this.closed);\n  }\n\n  _onSyncSize({ width, height }) {\n    this._appWidth = width;\n    this._appHeight = height;\n    this._contentFrameEl.style.width = `${width}px`;\n    this._contentFrameEl.style.height = `${height}px`;\n    this.renderAdapterSize();\n  }\n\n  setSize(size) {\n    this._onSyncSize(size);\n    this._postMessage({\n      type: this._messageTypes.syncSize,\n      size,\n    });\n  }\n\n  _onPushRingState({ ringing }) {\n    this._ringing = ringing;\n    this._render();\n  }\n\n  _onPushCallsInfo({\n    ringingCallsLength,\n    onHoldCallsLength,\n    otherDeviceCallsLength,\n    currentStartTime,\n  }) {\n    this._currentStartTime = currentStartTime;\n    this._ringingCallsLength = ringingCallsLength;\n    this._onHoldCallsLength = onHoldCallsLength;\n    this._otherDeviceCallsLength = otherDeviceCallsLength;\n    this._hasActiveCalls =\n      this._currentStartTime > 0 ||\n      this._ringingCallsLength > 0 ||\n      this._onHoldCallsLength > 0 ||\n      this._otherDeviceCallsLength > 0;\n    this.renderCallsBar();\n  }\n\n  _onPushOnCurrentCallPath({ onCurrentCallPath }) {\n    this._onCurrentCallPath = onCurrentCallPath;\n    this._render();\n  }\n\n  _onPushOnAllCallsPath({ onAllCallsPath }) {\n    this._onAllCallsPath = onAllCallsPath;\n    this._render();\n  }\n\n  _onPushPresence({ dndStatus, userStatus, telephonyStatus, presenceOption }) {\n    if (\n      dndStatus !== this._dndStatus ||\n      userStatus !== this._userStatus ||\n      telephonyStatus !== this._telephonyStatus\n    ) {\n      this._dndStatus = dndStatus;\n      this._userStatus = userStatus;\n      this._telephonyStatus = telephonyStatus;\n      this._presenceOption = presenceOption;\n      this.renderPresence();\n    }\n  }\n\n  _onPushLocale({ locale, strings = {} }) {\n    this._locale = locale;\n    this._strings = strings;\n    this._renderString();\n  }\n\n  _renderString() {\n    this._renderCallBarBtn();\n    this._renderRingingCalls();\n    this._renderOnHoldCalls();\n    this._renderOtherDevicesCalls();\n    this._renderPresenceItem();\n  }\n\n  _debouncedPostMessage = debounce(this._postMessage, 100);\n\n  _syncPosition() {\n    this._debouncedPostMessage.call(this, {\n      type: this._messageTypes.syncPosition,\n      position: {\n        translateX: this._translateX,\n        translateY: this._translateY,\n        minTranslateX: this._minTranslateX,\n        minTranslateY: this._minTranslateY,\n      },\n    });\n  }\n\n  _onPushAdapterState({\n    size: { width, height },\n    minimized,\n    closed,\n    position: { translateX, translateY, minTranslateX, minTranslateY },\n    dndStatus,\n    userStatus,\n    telephonyStatus,\n  }) {\n    this._minimized = minimized;\n    this._closed = closed;\n    if (!this._dragging) {\n      this._translateX = translateX;\n      this._translateY = translateY;\n      this._minTranslateX = minTranslateX;\n      this._minTranslateY = minTranslateY;\n    }\n    this._appWidth = width;\n    this._appHeight = height;\n    this._dndStatus = dndStatus;\n    this._userStatus = userStatus;\n    this._telephonyStatus = telephonyStatus;\n    this._loading = false;\n    this._render();\n  }\n\n  _calculateFactor() {\n    return this._defaultDirection === 'right' ? -1 : 1;\n  }\n\n  renderPosition() {\n    const factor = this._calculateFactor();\n    if (this._minimized) {\n      this._container.setAttribute(\n        'style',\n        `transform: translate( ${this._minTranslateX * factor}px, ${-this\n          ._padding}px)!important;`,\n      );\n    } else {\n      this._container.setAttribute(\n        'style',\n        `transform: translate( ${this._translateX * factor}px, ${\n          this._translateY\n        }px)!important;`,\n      );\n    }\n  }\n\n  _renderRestrictedPosition() {\n    const { minimumX, minimumY, maximumX, maximumY } =\n      this._calculateMinMaxPosition();\n\n    if (this._minimized) {\n      const newMinTranslateX = Math.max(\n        Math.min(this._minTranslateX, maximumX),\n        minimumX,\n      );\n      if (newMinTranslateX !== this._minTranslateX) {\n        this._minTranslateX = newMinTranslateX;\n      }\n      const newMinTranslateY = Math.max(\n        Math.min(this._minTranslateY, -minimumY),\n        -maximumY,\n      );\n      if (newMinTranslateY !== this._minTranslateY) {\n        this._minTranslateY = newMinTranslateY;\n      }\n    } else {\n      const newTranslateX = Math.max(\n        Math.min(this._translateX, maximumX),\n        minimumX,\n      );\n      const newTranslateY = Math.max(\n        Math.min(this._translateY, -minimumY),\n        -maximumY,\n      );\n      if (\n        this._translateX !== newTranslateX ||\n        this._translateY !== newTranslateY\n      ) {\n        this._translateX = newTranslateX;\n        this._translateY = newTranslateY;\n      }\n    }\n    this.renderPosition();\n  }\n\n  renderAdapterSize() {\n    if (this._minimized) {\n      this._contentFrameContainerEl.style.width = 0;\n      this._contentFrameContainerEl.style.height = 0;\n    } else {\n      this._contentFrameContainerEl.style.width = `${this._appWidth}px`;\n      this._contentFrameContainerEl.style.height = `${this._appHeight}px`;\n      this._contentFrameEl.style.width = `${this._appWidth}px`;\n      this._contentFrameEl.style.height = `${this._appHeight}px`;\n    }\n  }\n\n  _renderMainClass() {\n    this._container.setAttribute(\n      'class',\n      classnames(\n        this._styles.root,\n        this._styles[this._defaultDirection],\n        this._closed && this._styles.closed,\n        this._minimized && this._styles.minimized,\n        this._dragging && this._styles.dragging,\n        this._hover && this._styles.hover,\n        this._loading && this._styles.loading,\n      ),\n    );\n    this._headerEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.header,\n        this._minimized && this._styles.minimized,\n        this._ringing && this._styles.ringing,\n      ),\n    );\n  }\n\n  renderPresence() {\n    this._presenceEl.setAttribute(\n      'class',\n      classnames(\n        this._minimized && this._styles.minimized,\n        this._styles.presence,\n        this._userStatus && this._styles[this._userStatus],\n        this._dndStatus && this._styles[this._dndStatus],\n      ),\n    );\n\n    this._presenceItemEls.forEach((presenceItem) => {\n      const dataPresence = presenceItem.getAttribute('data-presence');\n      if (\n        presenceStatus[dataPresence] === this._presenceOption ||\n        dndStatus[dataPresence] === this._presenceOption\n      ) {\n        presenceItem.setAttribute(\n          'class',\n          classnames(this._styles.presenceItem, this._styles.selected),\n        );\n      } else {\n        presenceItem.setAttribute(\n          'class',\n          classnames(this._styles.presenceItem),\n        );\n      }\n    });\n  }\n\n  calculateState() {\n    const startTime = this._currentStartTime;\n    return Math.round((new Date().getTime() - startTime) / 1000);\n  }\n\n  renderCallsBar() {\n    // should clean up rotate duration when call info changed\n    if (this.rotateInterval) {\n      clearInterval(this.rotateInterval);\n      this.rotateInterval = null;\n    }\n    // when there is no call\n    if (!this._hasActiveCalls) {\n      this.currentState = -1;\n      this._scrollable = false;\n      this._hoverBar = false;\n      if (this.durationInterval) {\n        clearInterval(this.durationInterval);\n        this.durationInterval = null;\n      }\n      this._renderCallsBar();\n      return;\n    }\n    // when there is only one active call, only need to display call duration\n    if (\n      this._currentStartTime > 0 &&\n      this._ringingCallsLength === 0 &&\n      this._onHoldCallsLength === 0 &&\n      this._otherDeviceCallsLength === 0\n    ) {\n      this.currentState = CURRENT_CALL;\n      this._scrollable = false;\n      this._renderCallDuration();\n      this._renderCallsBar();\n      return;\n    }\n    // when there are only ringing calls(no onhold or active calls)\n    // only need to display incoming call icon\n    if (\n      this._currentStartTime === 0 &&\n      this._otherDeviceCallsLength === 0 &&\n      this._ringingCallsLength > 0\n    ) {\n      this.currentState = RINGING_CALLS;\n      this._scrollable = false;\n      this._hoverBar = false;\n      if (this.durationInterval) {\n        clearInterval(this.durationInterval);\n        this.durationInterval = null;\n      }\n      this._renderRingingCalls();\n      this._renderCallsBar();\n      return;\n    }\n    if (\n      this._currentStartTime === 0 &&\n      this._ringingCallsLength === 0 &&\n      this._onHoldCallsLength === 0 &&\n      this._otherDeviceCallsLength > 0\n    ) {\n      this.currentState = OTHER_DEVICE_CALLS;\n      this._scrollable = false;\n      this._renderOtherDevicesCalls();\n      this._renderCallsBar();\n      return;\n    }\n    this.callInfoMap = {\n      [CURRENT_CALL]: this._currentStartTime > 0,\n      [RINGING_CALLS]: this._ringingCallsLength > 0,\n      [ON_HOLD_CALLS]: this._onHoldCallsLength > 0,\n      [OTHER_DEVICE_CALLS]: this._otherDeviceCallsLength > 0,\n    };\n    // when multiple calls, should scroll with call info\n    this.rotateCallInfo();\n    this.rotateInterval = setInterval(() => {\n      this.rotateCallInfo();\n    }, ROTATE_INTERVAL);\n  }\n\n  rotateCallInfo() {\n    if (this._hoverBar && this.callInfoMap[this.currentState]) {\n      return;\n    }\n    this.lastState = this.currentState;\n    this.currentState = this.increment(this.currentState);\n    while (!this.callInfoMap[this.currentState]) {\n      this.currentState = this.increment(this.currentState);\n    }\n    switch (this.currentState) {\n      case ON_HOLD_CALLS:\n        this._renderOnHoldCalls();\n        break;\n      case RINGING_CALLS:\n        this._renderRingingCalls();\n        break;\n      case CURRENT_CALL:\n        this._renderCallDuration();\n        break;\n      case OTHER_DEVICE_CALLS:\n        this._renderOtherDevicesCalls();\n        break;\n      default:\n        break;\n    }\n    this._scrollable = true;\n    this._renderCallsBar();\n    this._scrollable = false;\n  }\n\n  increment(state: number) {\n    const newState = state + 1;\n    if (state >= ROTATE_LENGTH - 1) {\n      return 0;\n    }\n    return newState;\n  }\n\n  _renderMinimizedBar() {\n    this._logoEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.logo,\n        this._logoUrl && this._logoUrl !== '' && this._styles.visible,\n      ),\n    );\n    this._durationEl.setAttribute('class', classnames(this._styles.duration));\n    this._ringingCallsEl.setAttribute(\n      'class',\n      classnames(this._styles.ringingCalls),\n    );\n    this._onHoldCallsEl.setAttribute(\n      'class',\n      classnames(this._styles.onHoldCalls),\n    );\n    this._otherDeviceCallsEl?.setAttribute(\n      'class',\n      classnames(this._styles.otherDeviceCalls),\n    );\n    this._currentCallEl.setAttribute(\n      'class',\n      classnames(this._styles.currentCallBtn),\n    );\n    this._viewCallsEl.setAttribute(\n      'class',\n      classnames(this._styles.viewCallsBtn),\n    );\n  }\n\n  _renderCallsBar() {\n    if (this._minimized) {\n      this._renderMinimizedBar();\n      return;\n    }\n    this._logoEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.logo,\n        !this._hasActiveCalls &&\n          this._logoUrl &&\n          this._logoUrl !== '' &&\n          this._styles.visible,\n      ),\n    );\n    this._durationEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.duration,\n        this.showDuration && this._styles.visible,\n        this.centerDuration && this._styles.center,\n        this.moveOutDuration && this._styles.moveOut,\n        this.moveInDuration && this._styles.moveIn,\n      ),\n    );\n    this._ringingCallsEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.ringingCalls,\n        this.showRingingCalls && this._styles.visible,\n        this.centerCallInfo && this._styles.center,\n        this.moveOutRingingInfo && this._styles.moveOut,\n        this.moveInRingingInfo && this._styles.moveIn,\n      ),\n    );\n    this._onHoldCallsEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.onHoldCalls,\n        this.showOnHoldCalls && this._styles.visible,\n        this.centerCallInfo && this._styles.center,\n        this.moveOutOnHoldInfo && this._styles.moveOut,\n        this.moveInOnHoldInfo && this._styles.moveIn,\n      ),\n    );\n\n    this._otherDeviceCallsEl?.setAttribute(\n      'class',\n      classnames(\n        this._styles.otherDeviceCalls,\n        this.showOtherDeviceCalls && this._styles.visible,\n        this.centerCallInfo && this._styles.center,\n        this.isInMoveOutStatus(OTHER_DEVICE_CALLS) && this._styles.moveOut,\n        this.isInMoveInStatus(OTHER_DEVICE_CALLS) && this._styles.moveIn,\n      ),\n    );\n    this._currentCallEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.currentCallBtn,\n        this.showCurrentCallBtn && this._styles.visible,\n        this.moveOutCurrentCallBtn && this._styles.moveOut,\n        this.moveInCurrentCallBtn && this._styles.moveIn,\n      ),\n    );\n    this._viewCallsEl.setAttribute(\n      'class',\n      classnames(\n        this._styles.viewCallsBtn,\n        this.showViewCallsBtn && this._styles.visible,\n        !this.moveInViewCallsBtn &&\n          this.moveOutViewCallsBtn &&\n          this._styles.moveOut,\n        this.moveInViewCallsBtn && this._styles.moveIn,\n      ),\n    );\n  }\n\n  _renderCallDuration() {\n    if (this.durationInterval) {\n      clearInterval(this.durationInterval);\n      this.durationInterval = null;\n    }\n    const duration = formatDuration(this.calculateState());\n    this._durationEl.innerHTML = duration;\n    this.durationInterval = setInterval(() => {\n      const duration = formatDuration(this.calculateState());\n      this._durationEl.innerHTML = duration;\n    }, 1000);\n  }\n\n  _renderRingingCalls() {\n    if (!this._ringingCallsLength || !this._strings) {\n      return;\n    }\n    this._ringingCallsEl.innerHTML = this._strings.ringCallsInfo;\n    this._ringingCallsEl.title = this._strings.ringCallsInfo;\n  }\n\n  _renderOnHoldCalls() {\n    if (!this._onHoldCallsLength || !this._strings) {\n      return;\n    }\n    this._onHoldCallsEl.innerHTML = this._strings.onHoldCallsInfo;\n    this._onHoldCallsEl.title = this._strings.onHoldCallsInfo;\n  }\n\n  _renderOtherDevicesCalls() {\n    if (\n      !this._otherDeviceCallsLength ||\n      !this._strings ||\n      !this._otherDeviceCallsEl\n    ) {\n      return;\n    }\n    this._otherDeviceCallsEl.innerHTML = this._strings.otherDeviceCallsInfo;\n    this._otherDeviceCallsEl.title = this._strings.otherDeviceCallsInfo;\n  }\n\n  _renderCallBarBtn() {\n    if (!this._strings) {\n      return;\n    }\n    this._currentCallEl.innerHTML = this._strings.currentCallBtn;\n    this._viewCallsEl.innerHTML = this._strings.viewCallsBtn;\n  }\n\n  _renderPresenceItem() {\n    if (!this._strings) {\n      return;\n    }\n    this._presenceItemEls.forEach((presenceItem) => {\n      const dataPresence = presenceItem.getAttribute('data-presence');\n      presenceItem.querySelector('span').innerHTML =\n        this._strings[`${dataPresence}Btn`];\n    });\n  }\n\n  _render() {\n    this.renderPresence();\n    this.renderAdapterSize();\n    this._renderRestrictedPosition();\n    this._renderMainClass();\n    this._renderCallsBar();\n  }\n\n  dispose() {\n    // TODO clean up\n    window.removeEventListener('mousemove', this._onWindowMouseMove);\n    window.removeEventListener('resize', this._onWindowResize);\n    if (this._resizeTimeout) {\n      clearTimeout(this._resizeTick);\n    }\n    this._container.remove();\n  }\n\n  isInMoveInStatus(state: number) {\n    return !this._hoverBar && this.currentState === state && this._scrollable;\n  }\n\n  isInMoveOutStatus(state: number) {\n    return !this._hoverBar && this._scrollable && this.lastState === state;\n  }\n\n  get container() {\n    return this._container;\n  }\n\n  get root() {\n    return this._root;\n  }\n\n  get headerEl() {\n    return this._headerEl;\n  }\n\n  get contentFrameContainerEl() {\n    return this._contentFrameContainerEl;\n  }\n\n  get toggleEl() {\n    return this._toggleEl;\n  }\n\n  get closeEl() {\n    return this._closeEl;\n  }\n\n  get presenceEl() {\n    return this._presenceEl;\n  }\n\n  get contentFrameEl() {\n    return this._contentFrameEl;\n  }\n\n  get minTranslateX() {\n    return this._minTranslateX;\n  }\n\n  get minTranslateY() {\n    return this._minTranslateY;\n  }\n\n  get translateX() {\n    return this._translateX;\n  }\n\n  get translateY() {\n    return this._translateY;\n  }\n\n  get appWidth() {\n    return this._appWidth;\n  }\n\n  get appHeight() {\n    return this._appHeight;\n  }\n\n  get dragStartPosition() {\n    return this._dragStartPosition;\n  }\n\n  get closed() {\n    return this._closed;\n  }\n\n  get minimized() {\n    return this._minimized;\n  }\n\n  get dragging() {\n    return this._dragging;\n  }\n\n  get hover() {\n    return this._hover;\n  }\n\n  get loading() {\n    return this._loading;\n  }\n\n  get userStatus() {\n    return this._userStatus;\n  }\n\n  get dndStatus() {\n    return this._dndStatus;\n  }\n\n  get ringing() {\n    return this._ringing;\n  }\n\n  get showDuration() {\n    return !this._scrollable && this.currentState === CURRENT_CALL;\n  }\n\n  get showRingingCalls() {\n    return !this._scrollable && this.currentState === RINGING_CALLS;\n  }\n\n  get showOnHoldCalls() {\n    return !this._scrollable && this.currentState === ON_HOLD_CALLS;\n  }\n\n  get showOtherDeviceCalls() {\n    return !this._scrollable && this.currentState === OTHER_DEVICE_CALLS;\n  }\n\n  get showCurrentCallBtn() {\n    return !this._onCurrentCallPath && this.showDuration;\n  }\n\n  get showViewCallsBtn() {\n    return (\n      !this._onAllCallsPath &&\n      (this.showOnHoldCalls ||\n        this.showRingingCalls ||\n        this.showOtherDeviceCalls)\n    );\n  }\n\n  get centerDuration() {\n    return this._onCurrentCallPath;\n  }\n\n  get centerCallInfo() {\n    return this._onAllCallsPath;\n  }\n\n  get moveInDuration() {\n    return (\n      !this._hoverBar && this.currentState === CURRENT_CALL && this._scrollable\n    );\n  }\n\n  get moveOutDuration() {\n    return (\n      !this._hoverBar && this._scrollable && this.lastState === CURRENT_CALL\n    );\n  }\n\n  get moveInRingingInfo() {\n    return (\n      !this._hoverBar && this.currentState === RINGING_CALLS && this._scrollable\n    );\n  }\n\n  get moveOutRingingInfo() {\n    return (\n      !this._hoverBar && this._scrollable && this.lastState === RINGING_CALLS\n    );\n  }\n\n  get moveInOnHoldInfo() {\n    return (\n      !this._hoverBar && this.currentState === ON_HOLD_CALLS && this._scrollable\n    );\n  }\n\n  get moveOutOnHoldInfo() {\n    return (\n      !this._hoverBar && this._scrollable && this.lastState === ON_HOLD_CALLS\n    );\n  }\n\n  get moveInCurrentCallBtn() {\n    return !this._onCurrentCallPath && this.moveInDuration;\n  }\n\n  get moveOutCurrentCallBtn() {\n    return !this._onCurrentCallPath && this.moveOutDuration;\n  }\n\n  get moveInViewCallsBtn() {\n    return (\n      !this._onAllCallsPath &&\n      (this.moveInRingingInfo ||\n        this.moveInOnHoldInfo ||\n        this.isInMoveInStatus(OTHER_DEVICE_CALLS))\n    );\n  }\n\n  get moveOutViewCallsBtn() {\n    return (\n      !this._onAllCallsPath &&\n      (this.moveOutRingingInfo ||\n        this.moveOutOnHoldInfo ||\n        this.isInMoveOutStatus(OTHER_DEVICE_CALLS))\n    );\n  }\n}\n"],"file":"index.js"}