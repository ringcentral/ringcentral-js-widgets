{"version":3,"sources":["lib/AdapterCore/index.js"],"names":["SANDBOX_ATTRIBUTE_VALUE","join","ALLOW_ATTRIBUTE_VALUE","AdapterCore","prefix","styles","container","root","messageTypes","defaultDirection","defaultPadding","_onWindowResize","_dragging","_resizeTimeout","clearTimeout","setTimeout","_renderRestrictedPosition","_resizeTick","Date","now","_onWindowMouseMove","e","buttons","_renderMainClass","factor","_calculateFactor","delta","x","clientX","_dragStartPosition","y","clientY","_minimized","_minTranslateX","minTranslateX","_translateX","translateX","_translateY","translateY","_syncPosition","_debouncedPostMessage","_postMessage","_prefix","_messageTypes","enumMap","_container","_root","_styles","_defaultDirection","_padding","_appWidth","_appHeight","_closed","_hover","_loading","_userStatus","_dndStatus","_telephonyStatus","msg","type","syncClosed","_onSyncClosed","closed","syncMinimized","_onSyncMinimized","minimized","syncSize","_onSyncSize","size","syncPresence","_onPushPresence","pushAdapterState","_onPushAdapterState","pushLocale","_onPushLocale","pushRingState","_onPushRingState","innerHTML","header","presence","NoPresence","presenceBar","button","toggle","minimizeIcon","minimizeIconBar","close","closeIcon","logo","frameContainer","contentFrame","_headerEl","querySelector","_logoEl","addEventListener","_contentFrameContainerEl","_toggleEl","toggleMinimized","_closeEl","setClosed","_presenceEl","presenceClicked","_contentFrameEl","window","document","readyState","body","appendChild","_render","data","messageTransport","postMessage","logoUrl","_logoUrl","src","setAttribute","visible","appUrl","_appUrl","contentFrameEl","renderAdapterSize","setMinimized","maximumX","innerWidth","clientWidth","maximumY","innerHeight","clientHeight","minimumX","minimumY","width","height","style","ringing","_ringing","dndStatus","userStatus","telephonyStatus","renderPresence","locale","strings","_locale","_strings","call","syncPosition","position","_calculateMinMaxPosition","newMinTranslateX","Math","max","min","newTranslateX","newTranslateY","renderPosition","dragging","hover","loading","removeEventListener","remove","_messageTransport"],"mappings":"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","file":"index.js","sourcesContent":["import classnames from 'classnames';\r\nimport { prefixEnum } from 'ringcentral-integration/lib/Enum';\r\nimport ensureExist from 'ringcentral-integration/lib/ensureExist';\r\nimport debounce from 'ringcentral-integration/lib/debounce';\r\nimport baseMessageTypes from './baseMessageTypes';\r\n\r\nconst SANDBOX_ATTRIBUTE_VALUE = [\r\n  'allow-same-origin',\r\n  'allow-scripts',\r\n  'allow-forms',\r\n  'allow-popups',\r\n].join(' ');\r\n\r\n// chrome 63 mandate the declaration of this attribute for getUserMedia to work in iframes\r\nconst ALLOW_ATTRIBUTE_VALUE = [\r\n  'microphone',\r\n  // 'camera',\r\n].join(' ');\r\n\r\nexport default class AdapterCore {\r\n  constructor({\r\n    prefix,\r\n    styles,\r\n    container,\r\n    root = container,\r\n    messageTypes = baseMessageTypes,\r\n    defaultDirection = 'left',\r\n    defaultPadding = 15,\r\n  }) {\r\n    this._prefix = prefix;\r\n    this._messageTypes = prefixEnum({ enumMap: messageTypes, prefix });\r\n    this._container = this::ensureExist(container, 'container');\r\n    this._root = root;\r\n    this._styles = styles;\r\n    this._defaultDirection = defaultDirection;\r\n\r\n    this._padding = defaultPadding;\r\n    this._minTranslateX = 0;\r\n    this._translateX = 0;\r\n    this._translateY = 0;\r\n    this._appWidth = 0;\r\n    this._appHeight = 0;\r\n    this._dragStartPosition = null;\r\n\r\n    this._closed = true;\r\n    this._minimized = true;\r\n    this._dragging = false;\r\n    this._hover = false;\r\n    this._loading = false;\r\n    this._userStatus = null;\r\n    this._dndStatus = null;\r\n    this._telephonyStatus = null;\r\n  }\r\n  _onMessage(msg) {\r\n    if (msg) {\r\n      switch (msg.type) {\r\n        case this._messageTypes.syncClosed:\r\n          this._onSyncClosed(msg.closed);\r\n          break;\r\n        case this._messageTypes.syncMinimized:\r\n          this._onSyncMinimized(msg.minimized);\r\n          break;\r\n        case this._messageTypes.syncSize:\r\n          this._onSyncSize(msg.size);\r\n          break;\r\n        case this._messageTypes.syncPresence:\r\n          this._onPushPresence(msg);\r\n          break;\r\n        case this._messageTypes.pushAdapterState:\r\n          this._onPushAdapterState(msg);\r\n          break;\r\n        case this._messageTypes.pushLocale:\r\n          this._onPushLocale(msg);\r\n          break;\r\n        case this._messageTypes.pushRingState:\r\n          this._onPushRingState(msg);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n  _generateContentDOM() {\r\n    this._root.innerHTML = `\r\n      <header class=\"${this._styles.header}\" draggable=\"false\">\r\n        <div class=\"${this._styles.presence} ${this._styles.NoPresence}\">\r\n          <div class=\"${this._styles.presenceBar}\">\r\n          </div>\r\n        </div>\r\n        <div class=\"${this._styles.button} ${this._styles.toggle}\">\r\n          <div class=\"${this._styles.minimizeIcon}\">\r\n            <div class=\"${this._styles.minimizeIconBar}\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"${this._styles.button} ${this._styles.close}\">\r\n          <div class=\"${this._styles.closeIcon}\">\r\n            <div></div><div></div>\r\n          </div>\r\n        </div>\r\n        <img class=\"${this._styles.logo}\" draggable=\"false\"></img>\r\n      </header>\r\n      <div class=\"${this._styles.frameContainer}\">\r\n        <iframe class=\"${this._styles.contentFrame}\" sandbox=\"${SANDBOX_ATTRIBUTE_VALUE}\" allow=\"${ALLOW_ATTRIBUTE_VALUE}\" >\r\n        </iframe>\r\n      </div>\r\n    `;\r\n    this._headerEl = this._root.querySelector(\r\n      `.${this._styles.header}`\r\n    );\r\n    this._logoEl = this._root.querySelector(\r\n      `.${this._styles.logo}`\r\n    );\r\n    this._logoEl.addEventListener('dragstart', () => false);\r\n\r\n    this._contentFrameContainerEl = this._root.querySelector(\r\n      `.${this._styles.frameContainer}`\r\n    );\r\n\r\n    // toggle button\r\n    this._toggleEl = this._root.querySelector(\r\n      `.${this._styles.toggle}`\r\n    );\r\n    this._toggleEl.addEventListener('click', () => {\r\n      this.toggleMinimized();\r\n    });\r\n\r\n    // close button\r\n    this._closeEl = this._root.querySelector(\r\n      `.${this._styles.close}`\r\n    );\r\n    this._closeEl.addEventListener('click', () => {\r\n      this.setClosed(true);\r\n    });\r\n\r\n    this._presenceEl = this._root.querySelector(\r\n      `.${this._styles.presence}`\r\n    );\r\n    this._presenceEl.addEventListener('click', () => {\r\n      this._postMessage({\r\n        type: this._messageTypes.presenceClicked,\r\n      });\r\n    });\r\n    this._contentFrameEl = this._root.querySelector(\r\n      `.${this._styles.contentFrame}`\r\n    );\r\n\r\n    this._headerEl.addEventListener('mousedown', (e) => {\r\n      this._dragging = true;\r\n      this._dragStartPosition = {\r\n        x: e.clientX,\r\n        y: e.clientY,\r\n        translateX: this._translateX,\r\n        translateY: this._translateY,\r\n        minTranslateX: this._minTranslateX,\r\n      };\r\n      this._renderMainClass();\r\n    });\r\n    this._headerEl.addEventListener('mouseup', () => {\r\n      this._dragging = false;\r\n      this._renderMainClass();\r\n    });\r\n    window.addEventListener('mousemove', this._onWindowMouseMove);\r\n\r\n    this._resizeTimeout = null;\r\n    this._resizeTick = null;\r\n    window.addEventListener('resize', this._onWindowResize);\r\n\r\n    // hover detection for ie\r\n    this._container.addEventListener('mouseenter', () => {\r\n      this._hover = true;\r\n      this._renderMainClass();\r\n    });\r\n    this._container.addEventListener('mouseleave', () => {\r\n      this._hover = false;\r\n      this._renderMainClass();\r\n    });\r\n    if (document.readyState === 'loading') {\r\n      window.addEventListener('load', () => {\r\n        document.body.appendChild(this._container);\r\n      });\r\n    } else {\r\n      document.body.appendChild(this._container);\r\n    }\r\n\r\n    this._render();\r\n  }\r\n  _onWindowResize = () => {\r\n    if (this._dragging) { return; }\r\n    if (this._resizeTimeout) { clearTimeout(this._resizeTimeout); }\r\n    this._resizeTimeout = setTimeout(() => this._renderRestrictedPosition(), 100);\r\n    if (!this._resizeTick || Date.now() - this._resizeTick > 50) {\r\n      this._resizeTick = Date.now();\r\n      this._renderRestrictedPosition();\r\n    }\r\n  }\r\n  _onWindowMouseMove = (e) => {\r\n    if (this._dragging) {\r\n      if (e.buttons === 0) {\r\n        this._dragging = false;\r\n        this._renderMainClass();\r\n        return;\r\n      }\r\n      const factor = this._calculateFactor();\r\n      const delta = {\r\n        x: e.clientX - this._dragStartPosition.x,\r\n        y: e.clientY - this._dragStartPosition.y,\r\n      };\r\n      if (this._minimized) {\r\n        this._minTranslateX = this._dragStartPosition.minTranslateX + delta.x * factor;\r\n      } else {\r\n        this._translateX = this._dragStartPosition.translateX + delta.x * factor;\r\n        this._translateY = this._dragStartPosition.translateY + delta.y;\r\n      }\r\n      this._syncPosition();\r\n      this._renderRestrictedPosition();\r\n    }\r\n  }\r\n\r\n  get messageTransport() {\r\n    return this._messageTransport;\r\n  }\r\n\r\n  _postMessage(data) {\r\n    this.messageTransport.postMessage(data);\r\n  }\r\n\r\n  _setLogoUrl(logoUrl) {\r\n    this._logoUrl = logoUrl;\r\n    this._logoEl.src = logoUrl;\r\n    this._logoEl.setAttribute('class', classnames(\r\n      this._styles.logo,\r\n      this._logoUrl && this._logoUrl !== '' && this._styles.visible,\r\n    ));\r\n  }\r\n\r\n  _setAppUrl(appUrl) {\r\n    this._appUrl = appUrl;\r\n    if (appUrl) {\r\n      this.contentFrameEl.src = appUrl;\r\n    }\r\n  }\r\n\r\n  _onSyncMinimized(minimized) {\r\n    this._minimized = !!minimized;\r\n    this._renderMainClass();\r\n    this.renderAdapterSize();\r\n    this._renderRestrictedPosition();\r\n  }\r\n  setMinimized(minimized) {\r\n    this._onSyncMinimized(minimized);\r\n    this._postMessage({\r\n      type: this._messageTypes.syncMinimized,\r\n      minimized: this._minimized,\r\n    });\r\n  }\r\n  toggleMinimized() {\r\n    this.setMinimized(!this._minimized);\r\n  }\r\n\r\n  _calculateMinMaxPosition() {\r\n    const maximumX = window.innerWidth -\r\n      (this._minimized ? this._headerEl.clientWidth : this._appWidth) - 2 * this._padding;\r\n    const maximumY = window.innerHeight -\r\n      (this._minimized ?\r\n        this._headerEl.clientHeight :\r\n        this._headerEl.clientHeight + this._appHeight) - this._padding;\r\n    return {\r\n      minimumX: this._padding,\r\n      minimumY: this._padding,\r\n      maximumX,\r\n      maximumY,\r\n    };\r\n  }\r\n\r\n  _onSyncClosed(closed) {\r\n    this._closed = !!closed;\r\n    this._renderMainClass();\r\n  }\r\n  setClosed(closed) {\r\n    this._onSyncClosed(closed);\r\n    this._postMessage({\r\n      type: this._messageTypes.syncClosed,\r\n      closed: this.closed,\r\n    });\r\n  }\r\n  toggleClosed() {\r\n    this.setClosed(!this.closed);\r\n  }\r\n\r\n  _onSyncSize({ width, height }) {\r\n    this._appWidth = width;\r\n    this._appHeight = height;\r\n    this._contentFrameEl.style.width = `${width}px`;\r\n    this._contentFrameEl.style.height = `${height}px`;\r\n    this.renderAdapterSize();\r\n  }\r\n  setSize(size) {\r\n    this._onSyncSize(size);\r\n    this._postMessage({\r\n      type: this._messageTypes.syncSize,\r\n      size,\r\n    });\r\n  }\r\n\r\n  _onPushRingState({ ringing }) {\r\n    this._ringing = ringing;\r\n    this._render();\r\n  }\r\n\r\n  _onPushPresence({ dndStatus, userStatus, telephonyStatus }) {\r\n    if (\r\n      dndStatus !== this._dndStatus ||\r\n      userStatus !== this._userStatus ||\r\n      telephonyStatus !== this._telephonyStatus\r\n    ) {\r\n      this._dndStatus = dndStatus;\r\n      this._userStatus = userStatus;\r\n      this._telephonyStatus = telephonyStatus;\r\n      this.renderPresence();\r\n    }\r\n  }\r\n  _onPushLocale({\r\n    locale,\r\n    strings = {},\r\n  }) {\r\n    this._locale = locale;\r\n    this._strings = strings;\r\n  }\r\n\r\n  _debouncedPostMessage = debounce(this._postMessage, 200)\r\n\r\n  _syncPosition() {\r\n    this._debouncedPostMessage.call(this, {\r\n      type: this._messageTypes.syncPosition,\r\n      position: {\r\n        translateX: this._translateX,\r\n        translateY: this._translateY,\r\n        minTranslateX: this._minTranslateX,\r\n      },\r\n    });\r\n  }\r\n  _onPushAdapterState({\r\n    size: {\r\n      width,\r\n      height\r\n    },\r\n    minimized,\r\n    closed,\r\n    position: { translateX, translateY, minTranslateX },\r\n    dndStatus,\r\n    userStatus,\r\n    telephonyStatus,\r\n  }) {\r\n    this._minimized = minimized;\r\n    this._closed = closed;\r\n    if (!this._dragging) {\r\n      this._translateX = translateX;\r\n      this._translateY = translateY;\r\n      this._minTranslateX = minTranslateX;\r\n    }\r\n    this._appWidth = width;\r\n    this._appHeight = height;\r\n    this._dndStatus = dndStatus;\r\n    this._userStatus = userStatus;\r\n    this._telephonyStatus = telephonyStatus;\r\n    this._loading = false;\r\n    this._render();\r\n  }\r\n  _calculateFactor() {\r\n    return this._defaultDirection === 'right' ?\r\n      -1 :\r\n      1;\r\n  }\r\n  renderPosition() {\r\n    const factor = this._calculateFactor();\r\n    if (this._minimized) {\r\n      this._container.setAttribute(\r\n        'style',\r\n        `transform: translate( ${this._minTranslateX * factor}px, ${-this._padding}px)!important;`\r\n      );\r\n    } else {\r\n      this._container.setAttribute(\r\n        'style',\r\n        `transform: translate( ${this._translateX * factor}px, ${this._translateY}px)!important;`\r\n      );\r\n    }\r\n  }\r\n  _renderRestrictedPosition() {\r\n    const {\r\n      minimumX,\r\n      minimumY,\r\n      maximumX,\r\n      maximumY,\r\n    } = this._calculateMinMaxPosition();\r\n\r\n    if (this._minimized) {\r\n      const newMinTranslateX = Math.max(Math.min(this._minTranslateX, maximumX), minimumX);\r\n      if (newMinTranslateX !== this._minTranslateX) {\r\n        this._minTranslateX = newMinTranslateX;\r\n      }\r\n    } else {\r\n      const newTranslateX = Math.max(Math.min(this._translateX, maximumX), minimumX);\r\n      const newTranslateY = Math.max(Math.min(this._translateY, -minimumY), -maximumY);\r\n      if (this._translateX !== newTranslateX || this._translateY !== newTranslateY) {\r\n        this._translateX = newTranslateX;\r\n        this._translateY = newTranslateY;\r\n      }\r\n    }\r\n    this.renderPosition();\r\n  }\r\n  renderAdapterSize() {\r\n    if (this._minimized) {\r\n      this._contentFrameContainerEl.style.width = 0;\r\n      this._contentFrameContainerEl.style.height = 0;\r\n    } else {\r\n      this._contentFrameContainerEl.style.width = `${this._appWidth}px`;\r\n      this._contentFrameContainerEl.style.height = `${this._appHeight}px`;\r\n      this._contentFrameEl.style.width = `${this._appWidth}px`;\r\n      this._contentFrameEl.style.height = `${this._appHeight}px`;\r\n    }\r\n  }\r\n  _renderMainClass() {\r\n    this._container.setAttribute('class', classnames(\r\n      this._styles.root,\r\n      this._styles[this._defaultDirection],\r\n      this._closed && this._styles.closed,\r\n      this._minimized && this._styles.minimized,\r\n      this._dragging && this._styles.dragging,\r\n      this._hover && this._styles.hover,\r\n      this._loading && this._styles.loading,\r\n    ));\r\n    this._headerEl.setAttribute('class', classnames(\r\n      this._styles.header,\r\n      this._minimized && this._styles.minimized,\r\n      this._ringing && this._styles.ringing,\r\n    ));\r\n  }\r\n  renderPresence() {\r\n    this._presenceEl.setAttribute('class', classnames(\r\n      this._minimized && this._styles.minimized,\r\n      this._styles.presence,\r\n      this._userStatus && this._styles[this._userStatus],\r\n      this._dndStatus && this._styles[this._dndStatus],\r\n    ));\r\n  }\r\n  _render() {\r\n    this._renderMainClass();\r\n    this.renderPresence();\r\n    this.renderAdapterSize();\r\n    this._renderRestrictedPosition();\r\n  }\r\n\r\n  dispose() {\r\n    // TODO clean up\r\n    window.removeEventListener('mousemove', this._onWindowMouseMove);\r\n    window.removeEventListener('resize', this._onWindowResize);\r\n    if (this._resizeTimeout) {\r\n      clearTimeout(this._resizeTick);\r\n    }\r\n    this._container.remove();\r\n  }\r\n\r\n  get container() {\r\n    return this._container;\r\n  }\r\n  get root() {\r\n    return this._root;\r\n  }\r\n  get headerEl() {\r\n    return this._headerEl;\r\n  }\r\n  get contentFrameContainerEl() {\r\n    return this._contentFrameContainerEl;\r\n  }\r\n  get toggleEl() {\r\n    return this._toggleEl;\r\n  }\r\n  get closeEl() {\r\n    return this._closeEl;\r\n  }\r\n  get presenceEl() {\r\n    return this._presenceEl;\r\n  }\r\n  get contentFrameEl() {\r\n    return this._contentFrameEl;\r\n  }\r\n  get minTranslateX() {\r\n    return this._minTranslateX;\r\n  }\r\n  get translateX() {\r\n    return this._translateX;\r\n  }\r\n  get translateY() {\r\n    return this._translateY;\r\n  }\r\n  get appWidth() {\r\n    return this._appWidth;\r\n  }\r\n  get appHeight() {\r\n    return this._appHeight;\r\n  }\r\n  get dragStartPosition() {\r\n    return this._dragStartPosition;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n  get minimized() {\r\n    return this._minimized;\r\n  }\r\n  get dragging() {\r\n    return this._dragging;\r\n  }\r\n  get hover() {\r\n    return this._hover;\r\n  }\r\n  get loading() {\r\n    return this._loading;\r\n  }\r\n  get userStatus() {\r\n    return this._userStatus;\r\n  }\r\n  get dndStatus() {\r\n    return this._dndStatus;\r\n  }\r\n  get ringing() {\r\n    return this._ringing;\r\n  }\r\n}\r\n"]}