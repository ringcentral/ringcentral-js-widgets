{"version":3,"file":"lockRefresh.js","names":["lockRefresh","sdk","navigator","locks","platform","_$$refresh","_refresh","refreshWithLock","_navigator$locks","request","mode","_asyncToGenerator","regeneratorRuntime","mark","_callee","isRefreshed","authData","res","wrap","_callee$","_context","prev","next","_auth","accessTokenValid","sent","data","abrupt","Response","JSON","stringify","status","stop"],"sources":["lib/lockRefresh.ts"],"sourcesContent":["export function lockRefresh(sdk: any) {\n  if (!navigator.locks) {\n    return sdk;\n  }\n\n  const platform = sdk.platform();\n  platform._$$refresh = platform._refresh;\n  const refreshWithLock = () => {\n    return navigator.locks?.request(\n      'token_refresh',\n      { mode: 'exclusive' },\n      async () => {\n        const isRefreshed = await platform._auth.accessTokenValid();\n        if (isRefreshed) {\n          const authData = await platform._auth.data();\n          // response body should be a json string\n          return new Response(JSON.stringify(authData), {\n            status: 200,\n          });\n        }\n        const res = await platform._$$refresh();\n        return res;\n      },\n    );\n  };\n  platform._refresh = refreshWithLock;\n  return sdk;\n}\n"],"mappings":";;;;;;;;;;;AAAO,SAASA,WAAWA,CAACC,GAAQ,EAAE;EACpC,IAAI,CAACC,SAAS,CAACC,KAAK,EAAE;IACpB,OAAOF,GAAG;EACZ;EAEA,IAAMG,QAAQ,GAAGH,GAAG,CAACG,QAAQ,CAAC,CAAC;EAC/BA,QAAQ,CAACC,UAAU,GAAGD,QAAQ,CAACE,QAAQ;EACvC,IAAMC,eAAe,GAAG,SAAlBA,eAAeA,CAAA,EAAS;IAAA,IAAAC,gBAAA;IAC5B,QAAAA,gBAAA,GAAON,SAAS,CAACC,KAAK,cAAAK,gBAAA,uBAAfA,gBAAA,CAAiBC,OAAO,CAC7B,eAAe,EACf;MAAEC,IAAI,EAAE;IAAY,CAAC,eAAAC,iBAAA,eAAAC,kBAAA,CAAAC,IAAA,CACrB,SAAAC,QAAA;MAAA,IAAAC,WAAA,EAAAC,QAAA,EAAAC,GAAA;MAAA,OAAAL,kBAAA,CAAAM,IAAA,UAAAC,SAAAC,QAAA;QAAA;UAAA,QAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAE,IAAA;cAAA,OAC4BlB,QAAQ,CAACmB,KAAK,CAACC,gBAAgB,CAAC,CAAC;YAAA;cAArDT,WAAW,GAAAK,QAAA,CAAAK,IAAA;cAAA,KACbV,WAAW;gBAAAK,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAAF,QAAA,CAAAE,IAAA;cAAA,OACUlB,QAAQ,CAACmB,KAAK,CAACG,IAAI,CAAC,CAAC;YAAA;cAAtCV,QAAQ,GAAAI,QAAA,CAAAK,IAAA;cAAA,OAAAL,QAAA,CAAAO,MAAA,WAEP,IAAIC,QAAQ,CAACC,IAAI,CAACC,SAAS,CAACd,QAAQ,CAAC,EAAE;gBAC5Ce,MAAM,EAAE;cACV,CAAC,CAAC;YAAA;cAAAX,QAAA,CAAAE,IAAA;cAAA,OAEclB,QAAQ,CAACC,UAAU,CAAC,CAAC;YAAA;cAAjCY,GAAG,GAAAG,QAAA,CAAAK,IAAA;cAAA,OAAAL,QAAA,CAAAO,MAAA,WACFV,GAAG;YAAA;YAAA;cAAA,OAAAG,QAAA,CAAAY,IAAA;UAAA;QAAA;MAAA,GAAAlB,OAAA;IAAA,CACX,EACH,CAAC;EACH,CAAC;EACDV,QAAQ,CAACE,QAAQ,GAAGC,eAAe;EACnC,OAAON,GAAG;AACZ","ignoreList":[]}