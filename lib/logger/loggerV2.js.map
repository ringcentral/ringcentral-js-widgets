{"version":3,"file":"loggerV2.js","names":["_mfeLogger","require","_reactantShare","_global$localStorage","_typeof","o","Symbol","iterator","constructor","prototype","_toConsumableArray","r","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","a","_arrayLikeToArray","t","toString","call","slice","name","Array","from","test","isArray","length","e","n","asyncGeneratorStep","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_classCallCheck","_defineProperties","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","_toPrimitive","toPrimitive","String","Number","isSharedWorker","global","SharedWorkerGlobalScope","SharedWorkerTransport","_options","undefined","type","transport","_init","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","enabled","createTransport","prefix","stop","init","_write","_callee2","_ref","_this$transport","payload","_callee2$","_context2","emit","respond","write","_x","exports","MemoryStorage","_data","getItem","setItem","removeItem","toggleKey","loggerEnabled","localStorage","toggleLogger","_global$localStorage2","loggerV2","useLogger","concat","Date","now","transports","ConsoleTransport","storage","ROARR_LOG","process","env","NODE_ENV","StorageTransport","integrations","ScriptErrorIntegration","ConsoleIntegration"],"sources":["lib/logger/loggerV2.ts"],"sourcesContent":["import {\n  ConsoleTransport,\n  StorageTransport,\n  useLogger,\n  type ITransport,\n  type SerializedMessage,\n  ScriptErrorIntegration,\n  ConsoleIntegration,\n} from '@ringcentral/mfe-logger';\nimport { type Transport, createTransport } from 'reactant-share';\n\nconst isSharedWorker = !!global.SharedWorkerGlobalScope;\ninterface SharedWorkerTransportOptions {\n  /**\n   * enable transport\n   */\n  enabled?: boolean;\n}\n\nexport class SharedWorkerTransport implements ITransport {\n  type = 'storage';\n\n  private transport?: Transport;\n\n  constructor(protected _options: SharedWorkerTransportOptions = {}) {}\n\n  async init() {\n    if (isSharedWorker && this._options.enabled) {\n      this.transport = createTransport('SharedWorkerInternal', {\n        prefix: 'logger',\n      });\n    }\n  }\n\n  async write({ payload }: SerializedMessage) {\n    this.transport?.emit(\n      {\n        name: 'syncLog',\n        respond: false,\n      },\n      { payload },\n    );\n  }\n}\n\nexport class MemoryStorage {\n  constructor(protected _data: Record<string, any> = {}) {}\n\n  getItem(key: string) {\n    return this._data[key];\n  }\n\n  setItem(key: string, value: unknown) {\n    this._data[key] = value;\n  }\n\n  removeItem(key: string) {\n    delete this._data[key];\n  }\n}\n\nconst toggleKey = 'RC_MFE_LOGGER';\n\nexport const loggerEnabled = global.localStorage?.getItem(toggleKey) === 'true';\n\nexport const toggleLogger = (enabled: boolean) => {\n  global.localStorage?.setItem(toggleKey, String(enabled));\n};\n\n/**\n * new logger\n */\n// eslint-disable-next-line react-hooks/rules-of-hooks\nexport const loggerV2 = useLogger({\n  name: isSharedWorker ? `worker-${Date.now()}` : 'root',\n  transports: isSharedWorker\n    ? [\n        new ConsoleTransport({\n          enabled: true,\n          storage: new MemoryStorage({\n            ROARR_LOG: true,\n          }),\n        }),\n        new SharedWorkerTransport({\n          enabled: true,\n        }),\n      ]\n    : [\n        ...(process.env.NODE_ENV === 'test'\n          ? []\n          : [\n              new ConsoleTransport({\n                enabled: true,\n                storage: new MemoryStorage({\n                  ROARR_LOG: true,\n                }),\n              }),\n              new StorageTransport({\n                enabled: true,\n              }),\n            ]),\n      ],\n  integrations:\n    process.env.NODE_ENV === 'test'\n      ? []\n      : [\n          new ScriptErrorIntegration({\n            enabled: true,\n          }),\n          ...(process.env.NODE_ENV === 'production'\n            ? [\n                new ConsoleIntegration({\n                  enabled: true,\n                }),\n              ]\n            : []),\n        ],\n  enabled: isSharedWorker ? isSharedWorker : loggerEnabled,\n});\n"],"mappings":"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","ignoreList":[]}