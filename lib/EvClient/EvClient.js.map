{"version":3,"sources":["lib/EvClient/EvClient.ts"],"names":["EvClient","name","deps","_sdk","_onOpen","_onClose","_Sdk","AgentLibrary","_options","_eventEmitter","EventEmitter","_callbacks","_deps","evClientOptions","options","callbacks","closeResponse","openResponse","res","setAppStatus","evStatus","CONNECTED","emit","EvCallbackTypes","OPEN_SOCKET","terminateStats","console","log","CLOSED","CLOSE_SOCKET","window","localStorage","authHost","getItem","type","listener","addListener","once","removeListener","Promise","resolve","loadCurrentCall","status","appStatus","setItem","location","reload","initSDK","Sdk","ACK","eventType","callback","_callback","setCallbacks","getCallback","getRefreshedToken","engageAccessToken","LOGIN","authenticateAgentWithEngageAccessToken","response","dialDest","queueIds","chatIds","skillProfileId","dialGroupId","updateFromAdminUI","isForce","loginAgent","messageTypes","CONFIGURE_AGENT","data","dispId","notes","callbackDTS","leadId","requestId","externId","dispositionManualPass","uii","contactForwardNumber","survey","dispositionCall","decodeUii","rcAccessToken","tokenType","authenticateAgentWithRcAccessToken","accessToken","LOGINED","_agents","agents","map","agent","agentId","agentType","AGENT_TYPES","hasSupportWebSocket","EvTypeError","INVALID_BROWSER","addListenerOnce","openSocket","getAgentConfig","authenticateAgent","timeout","onTimeout","authenticateResponse","CONNECT_TIMEOUT","message","CONNECT_ERROR","length","NO_AGENT","UNEXPECTED_AGENT","closeSocket","sessionId","resetPendingDisp","hangup","logoutAgent","result","destination","callerId","ringTime","countryId","queueId","manualOutdial","manualOutdialCancel","offhookInit","offhookTerm","holdState","hold","isRecord","reject","pauseRecord","formattedResponse","pause","Number","state","record","holdSession","sipHeaders","coldXfer","warmXfer","internationalColdXfer","internationalWarmXfer","warmXferCancel","skillId","maintain","requeueCall","directAgentXferList","_encodeSymbol","encodeUii","split","rejectDirectAgentXfer","targetAgentId","coldDirectAgentXfer","warmDirectAgentXfer","voicemailDirectAgentXfer","cancelDirectAgentXfer","agentState","agentAuxState","setAgentState","multiLoginRequest","on","GENERIC_NOTIFICATION","messageCode","_multiLoginRequest","rej","Error","sipInit","sipAnswer","sipRegister","sipTerminate","sipHangUp","sipReject","dtmf","sipSendDTMF","sipToggleMute","scriptId","version","getScript","jsonResult","saveScriptResult","knowledgeBaseGroupIds","uiModel","_getUIModel","getInstance","HttpService","_HttpService","agentSettings","getAgentSettings","authenticateRequest","httpGet","accountId","headers","Authorization","queryParams","guid","JSON","parse","getCurrentCall","socket","RcModuleV2","START","action"],"mappings":"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","sourcesContent":["import { EventEmitter } from 'events';\n\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport { raceTimeout } from '@ringcentral-integration/commons/lib/raceTimeout';\nimport { action, RcModuleV2, state } from '@ringcentral-integration/core';\n// eslint-disable-next-line import/no-unresolved\nimport AgentLibrary from '@SDK';\n\nimport { AGENT_TYPES, messageTypes } from '../../enums';\nimport { _encodeSymbol } from '../constant';\nimport { EvTypeError } from '../EvTypeError';\nimport { evStatus } from './enums';\nimport { EvCallbackTypes } from './enums/callbackTypes';\nimport {\n  Deps,\n  EvACKResponse,\n  EvAddSessionNotification,\n  EvAgentConfig,\n  EvAgentOptions,\n  EvAgentScriptResult,\n  EvAgentSettings,\n  EvAuthenticateAgentWithEngageAccessTokenRes,\n  EvAuthenticateAgentWithRcAccessTokenRes,\n  EvBaseCall,\n  EvClientCallMapping,\n  EvColdTransferCallResponse,\n  EvColdTransferIntlCallResponse,\n  EvConfigureAgentOptions,\n  EvDirectAgentListResponse,\n  EvDispositionCallOptions,\n  EvDispositionManualPassOptions,\n  EvLogoutAgentResponse,\n  EvMessageRes,\n  EvOpenSocketResult,\n  EvRequeueCallResponse,\n  EvRequeueOption,\n  EvScriptResponse,\n  EvTokenType,\n  EvWarmTransferCallResponse,\n  EvWarmTransferIntlCallResponse,\n  PauseRecord,\n  PauseRecordResponse,\n  RawEvAuthenticateAgentWithRcAccessTokenRes,\n  RecordResponse,\n} from './interfaces';\n\ntype ListenerType = typeof EvCallbackTypes['OPEN_SOCKET' | 'CLOSE_SOCKET'];\n\ntype Listener<\n  T extends keyof EvClientCallMapping,\n  U extends EvClientCallMapping = EvClientCallMapping,\n> = (res: U[T]) => void;\n\nexport type EvClientTransferParams = {\n  dialDest: string;\n  callerId?: string;\n  sipHeaders?: string[];\n  countryId?: string;\n};\n\nexport type EvClientHandUpParams = {\n  sessionId: string;\n  resetPendingDisp?: boolean;\n};\n\nexport type EvClientHoldSessionParams = {\n  state: boolean;\n  sessionId: string;\n};\n\nexport type EvClientManualOutdialParams = {\n  destination: string;\n  callerId: string;\n  ringTime: number;\n  queueId: string;\n  countryId: string;\n};\n\n@Module({\n  name: 'EvClient',\n  deps: ['EvClientOptions'],\n})\nclass EvClient extends RcModuleV2<Deps> {\n  /** SDK instance */\n  private _sdk: any;\n\n  private _onOpen: (response: EvClientCallMapping['openResponse']) => void;\n\n  private _onClose: () => void;\n\n  private _Sdk = AgentLibrary;\n\n  private _options: EvAgentOptions;\n\n  private _eventEmitter = new EventEmitter();\n\n  private _callbacks: Record<string, Function> = {};\n\n  @state\n  appStatus: string = evStatus.START;\n\n  constructor(deps: Deps) {\n    super({ deps });\n    this._options = this._deps.evClientOptions.options;\n    const { closeResponse, openResponse } =\n      this._deps.evClientOptions.callbacks;\n    this._onOpen = (res) => {\n      this.setAppStatus(evStatus.CONNECTED);\n      openResponse(res);\n      this._eventEmitter.emit(EvCallbackTypes.OPEN_SOCKET, res);\n      // ensure for WebSocket keep-alive connection\n      this._sdk.terminateStats();\n    };\n    this._onClose = () => {\n      console.log('EvCallbackTypes.CLOSE_SOCKET~');\n      this.setAppStatus(evStatus.CLOSED);\n      closeResponse();\n      this._eventEmitter.emit(EvCallbackTypes.CLOSE_SOCKET);\n    };\n    // Used for toggle auth host about Engage Voice backend.\n    if (window.localStorage) {\n      const authHost = window.localStorage.getItem('__authHost__');\n      if (authHost) {\n        this._options.authHost = authHost;\n      }\n    }\n  }\n\n  addListener<T extends ListenerType>(type: T, listener: Listener<T>) {\n    this._eventEmitter.addListener(type, listener);\n  }\n\n  addListenerOnce<T extends ListenerType>(type: T, listener: Listener<T>) {\n    this._eventEmitter.once(type, listener);\n  }\n\n  removeListener<T extends ListenerType>(\n    type: ListenerType,\n    listener: Listener<T>,\n  ) {\n    this._eventEmitter.removeListener(type, listener);\n  }\n\n  loadCurrentCall() {\n    return new Promise<EvBaseCall | void>((resolve) => {\n      this._sdk.loadCurrentCall(resolve);\n    });\n  }\n\n  get currentCall(): EvBaseCall {\n    return this._sdk.getCurrentCall();\n  }\n\n  @action\n  setAppStatus(status: string) {\n    this.appStatus = status;\n  }\n\n  setEnv(authHost: string) {\n    if (window.localStorage) {\n      window.localStorage.setItem('__authHost__', authHost);\n      window.location.reload();\n    }\n  }\n\n  setSIPNoLog(authHost: string) {\n    if (window.localStorage) {\n      window.localStorage.setItem('__SIP_NO_LOG__', authHost);\n      window.location.reload();\n    }\n  }\n\n  onInitOnce() {\n    this.initSDK();\n  }\n\n  initSDK() {\n    console.log('initSDK');\n    const { _Sdk: Sdk } = this;\n    this._sdk = new Sdk({\n      callbacks: {\n        ...this._callbacks,\n        [EvCallbackTypes.CLOSE_SOCKET]: this._onClose,\n        [EvCallbackTypes.OPEN_SOCKET]: this._onOpen,\n        [EvCallbackTypes.ACK]: (res: EvACKResponse) => {\n          this._eventEmitter.emit(EvCallbackTypes.ACK, res);\n        },\n      },\n      ...this._options,\n    });\n  }\n\n  on(eventType: string, callback: (...args: any[]) => void) {\n    const _callback = {\n      [eventType]: (...args: any[]) => callback(...args),\n    };\n\n    this._sdk.setCallbacks(_callback);\n    this._callbacks = {\n      ...this._callbacks,\n      ..._callback,\n    };\n  }\n\n  getEventCallback(eventType: string) {\n    return this._sdk.getCallback(eventType);\n  }\n\n  getRefreshedToken() {\n    this._sdk.getRefreshedToken();\n  }\n\n  authenticateAgentWithEngageAccessToken(engageAccessToken: string) {\n    return new Promise<EvAuthenticateAgentWithEngageAccessTokenRes>(\n      (resolve) => {\n        this.setAppStatus(evStatus.LOGIN);\n        this._sdk.authenticateAgentWithEngageAccessToken(\n          engageAccessToken,\n          (response: EvAuthenticateAgentWithEngageAccessTokenRes) => {\n            resolve(response);\n          },\n        );\n      },\n    );\n  }\n\n  configureAgent({\n    dialDest,\n    queueIds,\n    chatIds,\n    skillProfileId,\n    dialGroupId,\n    updateFromAdminUI = false,\n    isForce = false,\n  }: EvConfigureAgentOptions) {\n    return new Promise<EvMessageRes>((resolve) => {\n      this._sdk.loginAgent(\n        dialDest,\n        queueIds,\n        chatIds,\n        skillProfileId,\n        dialGroupId,\n        updateFromAdminUI,\n        isForce,\n        (res: any) => {\n          resolve({\n            type: messageTypes.CONFIGURE_AGENT,\n            data: res,\n          });\n        },\n      );\n    });\n  }\n\n  dispositionManualPass({\n    dispId,\n    notes,\n    callbackDTS,\n    leadId,\n    requestId,\n    externId,\n  }: EvDispositionManualPassOptions) {\n    return new Promise<EvDispositionManualPassOptions>((resolve) => {\n      this._sdk.dispositionManualPass(\n        dispId,\n        notes,\n        (response: EvDispositionManualPassOptions) => {\n          resolve(response);\n        },\n        callbackDTS,\n        leadId,\n        requestId,\n        externId,\n      );\n    });\n  }\n\n  dispositionCall({\n    uii,\n    dispId = '',\n    notes = '',\n    callback,\n    callbackDTS,\n    contactForwardNumber,\n    survey,\n    externId,\n    leadId,\n    requestId = '',\n  }: EvDispositionCallOptions) {\n    return this._sdk.dispositionCall(\n      this.decodeUii(uii),\n      dispId,\n      notes,\n      callback,\n      callbackDTS,\n      contactForwardNumber,\n      survey,\n      externId,\n      leadId,\n      requestId,\n    );\n  }\n\n  authenticateAgent(rcAccessToken: string, tokenType: EvTokenType) {\n    return new Promise<EvAuthenticateAgentWithRcAccessTokenRes>((resolve) => {\n      this.setAppStatus(evStatus.LOGIN);\n      this._sdk.authenticateAgentWithRcAccessToken(\n        rcAccessToken,\n        tokenType,\n        async (res: RawEvAuthenticateAgentWithRcAccessTokenRes) => {\n          // here just auth with engage access token, not need handle response data, that handle by Agent SDK.\n          await this.authenticateAgentWithEngageAccessToken(res.accessToken);\n\n          this.setAppStatus(evStatus.LOGINED);\n          const _agents = (res || {}).agents || [];\n          const agents = _agents.map((agent) => ({\n            ...agent,\n            agentId: agent && agent.agentId ? `${agent.agentId}` : '',\n            agentType: AGENT_TYPES[agent.agentType],\n          }));\n          resolve({\n            ...res,\n            agents,\n          });\n        },\n      );\n    });\n  }\n\n  openSocket(agentId: string) {\n    const hasSupportWebSocket = 'WebSocket' in window;\n\n    if (!hasSupportWebSocket) {\n      throw new EvTypeError({\n        type: messageTypes.INVALID_BROWSER,\n      });\n    }\n\n    return new Promise<EvOpenSocketResult>((resolve) => {\n      this.addListenerOnce(EvCallbackTypes.OPEN_SOCKET, (res) => {\n        resolve(res);\n      });\n      this._sdk.openSocket(agentId);\n    });\n  }\n\n  getAgentConfig() {\n    return new Promise<EvAgentConfig>((resolve) => {\n      this._sdk.getAgentConfig((res: EvAgentConfig) => {\n        resolve(res);\n      });\n    });\n  }\n\n  async getAndHandleAuthenticateResponse(\n    rcAccessToken: string,\n    tokenType: EvTokenType,\n  ) {\n    const authenticateResponse = await raceTimeout(\n      this.authenticateAgent(rcAccessToken, tokenType),\n      {\n        timeout: 120 * 1000,\n        onTimeout: (resolve) => resolve(null),\n      },\n    );\n    if (!authenticateResponse) {\n      throw new EvTypeError({\n        type: messageTypes.CONNECT_TIMEOUT,\n      });\n    }\n    if (\n      authenticateResponse.type === 'Authenticate Error' ||\n      authenticateResponse.message\n    ) {\n      throw new EvTypeError({\n        type: messageTypes.CONNECT_ERROR,\n        data: authenticateResponse.message,\n      });\n    }\n    if (\n      !authenticateResponse ||\n      !authenticateResponse.agents ||\n      !authenticateResponse.agents.length\n    ) {\n      throw new EvTypeError({\n        type: messageTypes.NO_AGENT,\n      });\n    }\n    if (\n      !authenticateResponse.agents[0] ||\n      !authenticateResponse.agents[0].agentId\n    ) {\n      throw new EvTypeError({\n        type: messageTypes.UNEXPECTED_AGENT,\n      });\n    }\n    return authenticateResponse;\n  }\n\n  /**\n   * when manual close socket, that closeSocket will auto reconnected by agent SDK\n   */\n  closeSocket() {\n    this._sdk.closeSocket();\n  }\n\n  get ifSocketExist() {\n    return !!this._sdk.socket;\n  }\n\n  hangup({ sessionId, resetPendingDisp = false }: EvClientHandUpParams) {\n    return this._sdk.hangup(sessionId, resetPendingDisp);\n  }\n\n  logoutAgent(agentId: string) {\n    return new Promise<EvLogoutAgentResponse>((resolve) => {\n      this._sdk.logoutAgent(agentId, (result: EvLogoutAgentResponse) => {\n        resolve(result);\n      });\n    });\n  }\n\n  manualOutdial({\n    destination,\n    callerId,\n    ringTime,\n    countryId,\n    queueId,\n  }: EvClientManualOutdialParams) {\n    return this._sdk.manualOutdial(\n      destination,\n      callerId,\n      ringTime,\n      countryId,\n      queueId,\n    );\n  }\n\n  manualOutdialCancel(uii: string) {\n    this._sdk.manualOutdialCancel(uii);\n  }\n\n  offhookInit() {\n    // we using EvCallbackTypes.OFFHOOK_INIT to catch data, do not pass callback,\n    // that will make the message not come back\n    this._sdk.offhookInit();\n  }\n\n  offhookTerm() {\n    this._sdk.offhookTerm();\n  }\n\n  hold(holdState: boolean) {\n    this._sdk.hold(holdState);\n  }\n\n  pauseRecord(isRecord: boolean) {\n    return new Promise<PauseRecord>((resolve, reject) => {\n      return this._sdk.pauseRecord(\n        isRecord,\n        (response: PauseRecordResponse) => {\n          const formattedResponse = {\n            ...response,\n            pause: response.pause ? Number(response.pause) : null,\n          };\n          if (response.status === 'OK') {\n            resolve(formattedResponse);\n          } else {\n            reject(formattedResponse);\n          }\n        },\n      );\n    });\n  }\n\n  // toggle call recording on/off base on true|false boolean\n  record(state: boolean) {\n    return new Promise<RecordResponse>((resolve, reject) => {\n      return this._sdk.record(state, (response: RecordResponse) => {\n        if (response.status === 'OK') {\n          resolve(response);\n        } else {\n          reject(response);\n        }\n      });\n    });\n  }\n\n  holdSession({ state, sessionId }: EvClientHoldSessionParams) {\n    this._sdk.holdSession(state, sessionId);\n  }\n\n  coldTransferCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n  }: EvClientTransferParams) {\n    return new Promise<EvColdTransferCallResponse>((resolve, reject) => {\n      this._sdk.coldXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        (data: EvColdTransferCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  warmTransferCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n  }: EvClientTransferParams) {\n    return new Promise<EvWarmTransferCallResponse>((resolve, reject) => {\n      this._sdk.warmXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        (data: EvWarmTransferCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  coldTransferIntlCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n    countryId = '',\n  }: EvClientTransferParams) {\n    return new Promise<EvColdTransferIntlCallResponse>((resolve, reject) => {\n      this._sdk.internationalColdXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        countryId,\n        (data: EvColdTransferIntlCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  warmTransferIntlCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n    countryId = '',\n  }: EvClientTransferParams) {\n    return new Promise<EvWarmTransferIntlCallResponse>((resolve, reject) => {\n      this._sdk.internationalWarmXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        countryId,\n        (data: EvWarmTransferIntlCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  cancelWarmTransferCall(dialDest: string) {\n    this._sdk.warmXferCancel(dialDest);\n  }\n\n  requeueCall({ queueId, skillId = '', maintain = false }: EvRequeueOption) {\n    return new Promise<EvRequeueCallResponse>((resolve, reject) => {\n      this._sdk.requeueCall(\n        queueId,\n        skillId,\n        maintain,\n        (data: EvRequeueCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  fetchDirectAgentList() {\n    return new Promise<EvDirectAgentListResponse>((resolve) => {\n      this._sdk.directAgentXferList((data: EvDirectAgentListResponse) => {\n        resolve(data);\n      });\n    });\n  }\n\n  encodeUii({ uii, sessionId }: Partial<EvAddSessionNotification>) {\n    return `${uii}${_encodeSymbol}${sessionId}`;\n  }\n\n  /**\n   * replace sessionId with _encodeSymbol when ringing\n   * @param _encodeSymbol '$'\n   */\n  encodeRingingUii({ uii }: EvBaseCall) {\n    return this.encodeUii({\n      uii: this.decodeUii(uii),\n      sessionId: _encodeSymbol,\n    });\n  }\n\n  decodeUii(uii: string) {\n    return uii.split(_encodeSymbol)[0];\n  }\n\n  /**\n   * get a main call session in some call session with some uii\n   * @param uii call uii\n   */\n  getMainId(uii: string) {\n    return this.encodeUii({\n      sessionId: '1',\n      uii,\n    });\n  }\n\n  rejectDirectAgentTransferCall(uii: string) {\n    this._sdk.rejectDirectAgentXfer(this.decodeUii(uii));\n  }\n\n  coldDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.coldDirectAgentXfer(targetAgentId);\n  }\n\n  warmDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.warmDirectAgentXfer(targetAgentId);\n  }\n\n  sendVoicemailDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.voicemailDirectAgentXfer(targetAgentId);\n  }\n\n  cancelDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.cancelDirectAgentXfer(targetAgentId);\n  }\n\n  setAgentState(agentState: string, agentAuxState: string) {\n    return this._sdk.setAgentState(agentState, agentAuxState);\n  }\n\n  private _multiLoginRequest() {\n    return new Promise<any>((resolve, reject) => {\n      this._sdk.multiLoginRequest();\n      this.on(EvCallbackTypes.LOGIN, (data) => {\n        if (data.status === 'SUCCESS') {\n          resolve(data);\n        } else {\n          reject(data);\n        }\n      });\n      this.on(EvCallbackTypes.GENERIC_NOTIFICATION, (data) => {\n        if (data.messageCode === '-99') {\n          reject(data);\n        }\n      });\n    });\n  }\n\n  async multiLoginRequest() {\n    // temp solution, and wait for ev backend enhancement.\n    try {\n      await raceTimeout(this._multiLoginRequest(), {\n        onTimeout: (res, rej) => rej(),\n      });\n    } catch (error) {\n      throw new Error('_multiLoginRequest fail or 30s timeout');\n    }\n  }\n\n  /**\n   * WebRTC related method\n   */\n  sipInit() {\n    this._sdk.sipInit();\n  }\n\n  sipAnswer() {\n    this._sdk.sipAnswer();\n  }\n\n  sipRegister() {\n    this._sdk.sipRegister();\n  }\n\n  sipTerminate() {\n    this._sdk.sipTerminate();\n  }\n\n  sipHangUp() {\n    this._sdk.sipHangUp();\n  }\n\n  sipReject() {\n    this._sdk.sipReject();\n  }\n\n  sipSendDTMF(dtmf: string) {\n    this._sdk.sipSendDTMF(dtmf);\n  }\n\n  sipToggleMute(state: boolean) {\n    this._sdk.sipToggleMute(state);\n  }\n\n  /**\n   * AgentScript related method\n   */\n  getScript(scriptId: string, version: string) {\n    return new Promise<EvScriptResponse>((resolve, reject) => {\n      this._sdk.getScript(scriptId, version, (res: EvScriptResponse) => {\n        if (res.status) {\n          resolve(res);\n        }\n      });\n    });\n  }\n\n  async saveScriptResult(\n    uii: string,\n    scriptId: string,\n    jsonResult: EvAgentScriptResult,\n  ) {\n    this._sdk.saveScriptResult(uii, scriptId, jsonResult);\n\n    return jsonResult;\n  }\n\n  /**\n   * GET - /voice/api/v1/agent/:accountId/knowledgeBaseGroups\n      params:\n      accountId: AgentSvc.agentSettings.accountId,\n      guid: AgentSvc.agentSettings.guid,\n      knowledgeBaseGroupIds: knowledgeBaseGroupIds\n\n      knowledgeBaseGroupIds = comma list of all groups you care about\n   */\n  async getKnowledgeBaseGroups(knowledgeBaseGroupIds: number[]) {\n    this.getRefreshedToken();\n\n    const uiModel = this._sdk._getUIModel().getInstance();\n    const HttpService = this._sdk._HttpService;\n\n    const agentSettings: EvAgentSettings = this._sdk.getAgentSettings();\n    const engageAccessToken = `Bearer ${uiModel.authenticateRequest.engageAccessToken}`;\n\n    try {\n      const { status, response } = await new HttpService(\n        `${uiModel.authHost}/voice/api/v1/`,\n      ).httpGet(`agent/${agentSettings.accountId}/knowledgeBaseGroups`, {\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: engageAccessToken,\n        },\n        queryParams: {\n          guid: agentSettings.guid,\n          knowledgeBaseGroupIds,\n        },\n      });\n\n      if (status === 200) {\n        return JSON.parse(response);\n      }\n    } catch (error) {\n      console.log('getKnowledgeBaseGroups fail');\n    }\n    return null;\n  }\n}\n\nexport { EvClient };\n"],"file":"EvClient.js"}