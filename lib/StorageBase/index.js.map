{"version":3,"sources":["lib/StorageBase/index.ts"],"names":["StorageBase","deps","dep","optional","name","actionTypes","ObjectMap","prefixKeys","keys","actionTypesBase","StorageProvider","SynchronizedStorage","options","Error","_StorageProvider","_reducers","_reducer","types","reducers","key","reducer","_initialized","state","data","status","storageKey","moduleStatuses","ready","_storage","driver","RcModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAUqBA,W;AARrB;AACA;AACA;AACA;AACA;OACC,iBAAQ;AACPC,EAAAA,IAAI,EAAE,CAAC;AAAEC,IAAAA,GAAG,EAAE,oBAAP;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GAAD;AADC,CAAR,C;;;;;AAIC,6BAQG;AAAA;;AAAA,QAPDC,IAOC,QAPDA,IAOC;AAAA,gCANDC,WAMC;AAAA,QANDA,WAMC,iCANaC,qBAAUC,UAAV,oBACRD,qBAAUE,IAAV,CAAeC,gCAAf,CADQ,GAEZL,IAFY,CAMb;AAAA,oCAFDM,eAEC;AAAA,QAFDA,eAEC,qCAFiBC,wCAEjB;AAAA,QADEC,OACF;;AAAA;;AACD,QAAI,CAACR,IAAL,EAAW;AACT,YAAM,IAAIS,KAAJ,CAAU,sBAAV,CAAN;AACD;;AACD,8DACKD,OADL;AAEEP,MAAAA,WAAW,EAAXA;AAFF;AAIA,UAAKS,gBAAL,GAAwBJ,eAAxB;AACA,UAAKK,SAAL,GAAiB,EAAjB;AACA,UAAKC,QAAL,GAAgB,mCAAkB;AAChCC,MAAAA,KAAK,EAAE,MAAKZ,WADoB;AAEhCa,MAAAA,QAAQ,EAAE,MAAKH;AAFiB,KAAlB,CAAhB;AAVC;AAcF;;;;2CAEiC;AAAA,UAAhBI,GAAgB,SAAhBA,GAAgB;AAAA,UAAXC,OAAW,SAAXA,OAAW;;AAChC,UAAI,KAAKC,YAAT,EAAuB;AACrB,cAAM,IAAIR,KAAJ,CAAU,+CAAV,CAAN;AACD;;AACD,UAAI,KAAKE,SAAL,CAAeI,GAAf,CAAJ,EAAyB;AACvB,cAAM,IAAIN,KAAJ,4BAA8BM,GAA9B,sBAAN;AACD;;AACD,WAAKJ,SAAL,CAAeI,GAAf,IAAsBC,OAAtB;AACD;;;4BAEOD,G,EAAK;AACX,aAAO,KAAKG,KAAL,CAAWC,IAAX,CAAgBJ,GAAhB,CAAP;AACD;;;wBAEU;AACT,aAAO,KAAKG,KAAL,CAAWC,IAAlB;AACD;;;wBAEY;AACX,aAAO,KAAKD,KAAL,CAAWE,MAAlB;AACD;;;wBAEgB;AACf,aAAO,KAAKF,KAAL,CAAWG,UAAlB;AACD;;;wBAEW;AACV,aAAO,KAAKD,MAAL,KAAgBE,2BAAeC,KAAtC;AACD;;;wBAEY;AACX,UAAI,KAAKA,KAAT,EAAgB;AACd,eAAO,KAAKC,QAAL,CAAcC,MAArB;AACD;;AACD,aAAO,IAAP;AACD;;;;EA5DsCC,qB","sourcesContent":["import { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\n\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport { Library } from '../di';\nimport RcModule from '../RcModule';\nimport { SynchronizedStorage } from '../SynchronizedStorage';\nimport { actionTypesBase } from './actionTypesBase';\nimport getStorageReducer from './getStorageReducer';\n\n/**\n * @class\n * @description Alternative implementation of the Storage class.\n *  Allows registration of reducers so that persisted states can be computed with reducers.\n */\n@Library({\n  deps: [{ dep: 'StorageBaseOptions', optional: true }],\n})\nexport default class StorageBase extends RcModule {\n  constructor({\n    name,\n    actionTypes = ObjectMap.prefixKeys(\n      [...ObjectMap.keys(actionTypesBase)],\n      name,\n    ),\n    StorageProvider = SynchronizedStorage,\n    ...options\n  }) {\n    if (!name) {\n      throw new Error('name must be defined');\n    }\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._StorageProvider = StorageProvider;\n    this._reducers = {};\n    this._reducer = getStorageReducer({\n      types: this.actionTypes,\n      reducers: this._reducers,\n    });\n  }\n\n  registerReducer({ key, reducer }) {\n    if (this._initialized) {\n      throw new Error('Reducers must be registered before initialize');\n    }\n    if (this._reducers[key]) {\n      throw new Error(`Reducer of key: '${key}' already exists`);\n    }\n    this._reducers[key] = reducer;\n  }\n\n  getItem(key) {\n    return this.state.data[key];\n  }\n\n  get data() {\n    return this.state.data;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get storageKey() {\n    return this.state.storageKey;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get driver() {\n    if (this.ready) {\n      return this._storage.driver;\n    }\n    return null;\n  }\n}\n"],"file":"index.js"}