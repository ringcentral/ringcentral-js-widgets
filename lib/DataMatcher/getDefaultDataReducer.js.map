{"version":3,"sources":["lib/DataMatcher/getDefaultDataReducer.ts"],"names":["getDefaultDataReducer","actionTypes","state","type","data","name","ttl","timestamp","queries","shouldCleanUpAll","matchSuccess","insertMatchEntries","newState","forEach","query","length","_t","cleanUp","hasChanges","queriesMap","Object","keys","resetSuccess"],"mappings":"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","sourcesContent":["export default function getDefaultDataReducer(actionTypes) {\n  return (\n    state = {},\n    { type, data, name, ttl, timestamp, queries, shouldCleanUpAll = false },\n  ) => {\n    switch (type) {\n      case actionTypes.matchSuccess:\n      case actionTypes.insertMatchEntries: {\n        const newState = { ...state };\n        queries.forEach((query) => {\n          if (data[query] && data[query].length) {\n            newState[query] = {\n              ...newState[query],\n              [name]: {\n                data: data[query],\n                _t: timestamp,\n              },\n            };\n          } else {\n            // assume match not found if not in data\n            newState[query] = {\n              ...newState[query],\n              [name]: {\n                _t: timestamp, // for noMatchTtl check\n                data: [],\n              },\n            };\n          }\n        });\n        return newState;\n      }\n      case actionTypes.cleanUp: {\n        if (shouldCleanUpAll) {\n          return {};\n        }\n        const newState = {};\n        let hasChanges = false;\n\n        // optimize for large queries list\n        const queriesMap = {};\n        queries.forEach((query) => {\n          queriesMap[query] = true;\n        });\n        Object.keys(state).forEach((query) => {\n          if (!queriesMap[query]) {\n            if (!state[query]._t) {\n              // mark for deletion\n              newState[query] = {\n                ...state[query],\n                _t: timestamp,\n              };\n              hasChanges = true;\n            } else if (timestamp - state[query]._t < ttl) {\n              // not expired yet\n              newState[query] = state[query];\n            } else {\n              // entry is removed\n              hasChanges = true;\n            }\n          } else if (state[query]._t) {\n            // if entry shows up in queries again\n            // remove the timestamp\n            newState[query] = {\n              ...state[query],\n            };\n            delete newState[query]._t;\n            hasChanges = true;\n          } else {\n            newState[query] = state[query];\n          }\n        });\n        return hasChanges ? newState : state;\n      }\n      case actionTypes.resetSuccess:\n        return {};\n      default:\n        return state;\n    }\n  };\n}\n"],"file":"getDefaultDataReducer.js"}