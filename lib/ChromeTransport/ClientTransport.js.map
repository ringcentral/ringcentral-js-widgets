{"version":3,"file":"ClientTransport.js","names":["uuid","_interopRequireWildcard","require","_TransportBase2","_interopRequireDefault","obj","__esModule","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","_objectSpread","target","i","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","ClientTransport","_TransportBase","_super","options","_this","name","_requests","Map","_port","chrome","runtime","connect","onMessage","addListener","_ref","type","payload","requestId","_events","emit","response","Error","_request","regeneratorRuntime","mark","_callee","_ref2","_this2","promise","timeout","wrap","_callee$","_context","prev","next","v4","postMessage","request","setTimeout","_timeout","clearTimeout","concat","functionPath","message","abrupt","stop","_x","TransportBase","exports"],"sources":["lib/ChromeTransport/ClientTransport.ts"],"sourcesContent":["import * as uuid from 'uuid';\n\nimport TransportBase from '../TransportBase';\n\n/* global chrome */\n\nexport class ClientTransport extends TransportBase {\n  constructor(options) {\n    super({\n      ...options,\n      name: 'ChromeTransport',\n    });\n    this._requests = new Map();\n    this._port = chrome.runtime.connect({ name: 'transport' });\n    this._port.onMessage.addListener(\n      ({ type, payload, requestId, result, error }) => {\n        switch (type) {\n          case this._events.push:\n            if (payload) {\n              this.emit(this._events.push, payload);\n            }\n            break;\n          case this._events.response:\n            if (requestId && this._requests.has(requestId)) {\n              if (error) {\n                this._requests.get(requestId).reject(new Error(error));\n              } else {\n                this._requests.get(requestId).resolve(result);\n              }\n            }\n            break;\n          default:\n            break;\n        }\n      },\n    );\n  }\n\n  async request({ payload }) {\n    const requestId = uuid.v4();\n    let promise = new Promise((resolve, reject) => {\n      this._requests.set(requestId, {\n        resolve,\n        reject,\n      });\n      this._port.postMessage({\n        type: this._events.request,\n        requestId,\n        payload,\n      });\n    });\n    let timeout = setTimeout(() => {\n      timeout = null;\n      this._requests.get(requestId).reject(new Error(this._events.timeout));\n    }, this._timeout);\n    promise = promise\n      .then((result) => {\n        if (timeout) clearTimeout(timeout);\n        this._requests.delete(requestId);\n        return Promise.resolve(result);\n      })\n      .catch((error) => {\n        if (timeout) clearTimeout(timeout);\n        this._requests.delete(requestId);\n        return Promise.reject(\n          new Error(`${payload.functionPath}: ${error.message}`),\n        );\n      });\n    return promise;\n  }\n}\n"],"mappings":"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"}