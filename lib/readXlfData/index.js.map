{"version":3,"file":"index.js","names":["extractKey","str","substring","length","extractXlfData","locale","content","data","xml","xml2js","compact","xliff","file","files","Array","isArray","reduce","output","fileData","_attributes","body","fileName","original","units","fileOutput","unit","id","target","_text","value","source","readXlfData","localizationFolder","translationLocales","filePath","path","resolve","fs","existsSync","statSync","isFile","readFileSync"],"sources":["lib/readXlfData/index.js"],"sourcesContent":["import xml from 'xml-js';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport { reduce } from 'ramda';\n\nfunction extractKey(str) {\n  return str.substring(1, str.length - 1);\n}\n\nfunction extractXlfData({ locale, content }) {\n  const data = xml.xml2js(content, { compact: true });\n  if (data.xliff && data.xliff.file) {\n    const files = Array.isArray(data.xliff.file)\n      ? data.xliff.file\n      : [data.xliff.file];\n    return reduce(\n      (output, fileData) => {\n        if (\n          fileData._attributes &&\n          fileData._attributes['target-language'] === locale &&\n          fileData.body &&\n          fileData.body['trans-unit']\n        ) {\n          const fileName = fileData._attributes.original;\n\n          const units = Array.isArray(fileData.body['trans-unit'])\n            ? fileData.body['trans-unit']\n            : [fileData.body['trans-unit']];\n          output[fileName] = reduce(\n            (fileOutput, unit) => {\n              if (\n                unit._attributes &&\n                unit._attributes.id &&\n                unit.target &&\n                unit.target._text\n              ) {\n                fileOutput[extractKey(unit._attributes.id)] = {\n                  value: unit.target._text,\n                  source: unit.source._text,\n                };\n              }\n              return fileOutput;\n            },\n            {},\n            units,\n          );\n        }\n        return output;\n      },\n      {},\n      files,\n    );\n  }\n  return {};\n}\n\nexport default function readXlfData({\n  localizationFolder,\n  translationLocales,\n}) {\n  return reduce(\n    (data, locale) => {\n      const fileName = `${locale}.xlf`;\n      const filePath = path.resolve(localizationFolder, fileName);\n      if (fs.existsSync(filePath) && fs.statSync(filePath).isFile()) {\n        const content = fs.readFileSync(filePath, 'utf8');\n        data[locale] = extractXlfData({ locale, content });\n      }\n      return data;\n    },\n    {},\n    translationLocales,\n  );\n}\n"],"mappings":"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"}