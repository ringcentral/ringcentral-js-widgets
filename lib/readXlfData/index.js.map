{"version":3,"file":"index.js","names":["_path","_interopRequireDefault","require","_xmlJs","_fsExtra","_ramda","obj","__esModule","extractKey","str","substring","length","extractXlfData","_ref","locale","content","data","xml","xml2js","compact","xliff","file","files","Array","isArray","reduce","output","fileData","_attributes","body","fileName","original","units","fileOutput","unit","id","target","_text","value","source","readXlfData","_ref2","localizationFolder","translationLocales","concat","filePath","path","resolve","fs","existsSync","statSync","isFile","readFileSync"],"sources":["lib/readXlfData/index.js"],"sourcesContent":["import path from 'path';\nimport xml from 'xml-js';\nimport fs from 'fs-extra';\nimport { reduce } from 'ramda';\n\nfunction extractKey(str) {\n  return str.substring(1, str.length - 1);\n}\n\nfunction extractXlfData({ locale, content }) {\n  const data = xml.xml2js(content, { compact: true });\n  if (data.xliff && data.xliff.file) {\n    const files = Array.isArray(data.xliff.file)\n      ? data.xliff.file\n      : [data.xliff.file];\n    return reduce(\n      (output, fileData) => {\n        if (\n          fileData._attributes &&\n          fileData._attributes['target-language'] === locale &&\n          fileData.body &&\n          fileData.body['trans-unit']\n        ) {\n          const fileName = fileData._attributes.original;\n\n          const units = Array.isArray(fileData.body['trans-unit'])\n            ? fileData.body['trans-unit']\n            : [fileData.body['trans-unit']];\n          output[fileName] = reduce(\n            (fileOutput, unit) => {\n              if (\n                unit._attributes &&\n                unit._attributes.id &&\n                unit.target &&\n                unit.target._text\n              ) {\n                fileOutput[extractKey(unit._attributes.id)] = {\n                  value: unit.target._text,\n                  source: unit.source._text,\n                };\n              }\n              return fileOutput;\n            },\n            {},\n            units,\n          );\n        }\n        return output;\n      },\n      {},\n      files,\n    );\n  }\n  return {};\n}\n\nexport default function readXlfData({\n  localizationFolder,\n  translationLocales,\n}) {\n  return reduce(\n    (data, locale) => {\n      const fileName = `${locale}.xlf`;\n      const filePath = path.resolve(localizationFolder, fileName);\n      if (fs.existsSync(filePath) && fs.statSync(filePath).isFile()) {\n        const content = fs.readFileSync(filePath, 'utf8');\n        data[locale] = extractXlfData({ locale, content });\n      }\n      return data;\n    },\n    {},\n    translationLocales,\n  );\n}\n"],"mappings":"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"}