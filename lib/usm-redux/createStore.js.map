{"version":3,"file":"createStore.js","names":["_immer","_interopRequireWildcard","require","_redux","_constant","_index","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","toString","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","apply","_objectSpread","target","arguments","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","Number","enablePatches","getPatchesToggle","exports","setPatchesToggle","toggle","createStore","options","preloadedState","_options$strict","_config$enablePatches","config","reduxEnhancer","_config$handleReducer","handleReducers","reducers","combineReducers","modules","Error","enableAutoFreeze","strict","process","env","NODE_ENV","enablePatchesWithImmer","setAutoFreeze","identifiers","Set","subscriptions","store","module","index","_service$identifierKe","_Object$assign7","service","className","getPrototypeOf","stateKey","bootstrappedKey","console","warn","concat","identifier","identifierKey","Math","random","error","add","descriptors","_loop","descriptor","assign","_ret","initState","produce","serviceReducers","entries","reduce","serviceReducersMapObject","_ref","_ref2","reducer","state","action","_usm","usm","_getLastState","_state","type","_reducers","_this$storeKey","stagedState","getStagedState","__identifier","__state","currentState","storeKey","getState","isFrozen","freeze","subscriptionsKey","storeWithRedux","createStoreWithRedux","dispatch","subscribe","_i2","_subscriptions"],"sources":["lib/usm-redux/createStore.ts"],"sourcesContent":["import produce, {\n  setAutoFreeze,\n  enablePatches as enablePatchesWithImmer,\n} from 'immer';\nimport type {\n  ReducersMapObject,\n  PreloadedState,\n  Store as ReduxStore,\n} from 'redux';\nimport { createStore as createStoreWithRedux, combineReducers } from 'redux';\nimport {\n  stateKey,\n  storeKey,\n  bootstrappedKey,\n  identifierKey,\n  subscriptionsKey,\n  usm,\n} from './constant';\nimport { getStagedState } from './utils/index';\nimport type {\n  Action,\n  StoreOptions,\n  Store,\n  Subscription,\n  Config,\n  Service,\n} from './interface';\n\nlet enablePatches: boolean;\n\nexport const getPatchesToggle = () => enablePatches;\n\nexport const setPatchesToggle = (toggle: boolean) => {\n  enablePatches = toggle;\n};\n\nexport const createStore = (\n  options: StoreOptions,\n  preloadedState?: PreloadedState<any>,\n  config: Config = {},\n) => {\n  const {\n    reduxEnhancer,\n    handleReducers = (reducers) => combineReducers(reducers),\n  } = config;\n  if (typeof options !== 'object' || !Array.isArray(options.modules)) {\n    throw new Error(\n      `'createStore' options should be a object with a property 'modules'`,\n    );\n  }\n  const enableAutoFreeze =\n    options.strict ?? process.env.NODE_ENV === 'development';\n  enablePatches = config.enablePatches ?? false;\n  if (enablePatches) enablePatchesWithImmer();\n  setAutoFreeze(enableAutoFreeze);\n  const identifiers = new Set<string>();\n  const reducers: ReducersMapObject = {};\n  const subscriptions: Subscription[] = [];\n  let store: Store;\n  options.modules.forEach((module, index) => {\n    if (typeof module !== 'object' || module === null) return;\n    const service: Service = module;\n    const className = Object.getPrototypeOf(service).constructor.name;\n    if (typeof service[stateKey] === 'undefined' || service[bootstrappedKey]) {\n      if (process.env.NODE_ENV === 'development') {\n        if (service[bootstrappedKey]) {\n          console.warn(\n            `The module with an index of ${index} and a name of ${className} in the module list is a duplicate module.`,\n          );\n        }\n      }\n    }\n    let identifier = service[identifierKey] ?? service.name;\n    if (identifier === null || typeof identifier === 'undefined') {\n      identifier = `@@usm-redux/${className}/${Math.random().toString(36)}`;\n    }\n    if (typeof identifier !== 'string') {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(`\n          Since '${className}' module has set the module state, '${className}' module must set a unique and valid class property 'name' to be used as the module index.\n          Example:\n            class FooBar {\n              name = 'FooBar'; // <- add the 'name' property.\n            }\n        `);\n      } else {\n        throw new Error(\n          `'${className}' module 'name' property should be defined as a valid 'string'.`,\n        );\n      }\n    }\n    if (identifiers.has(identifier)) {\n      identifier += `${index}`;\n    }\n    identifiers.add(identifier);\n    const descriptors: Record<string, PropertyDescriptor> = {\n      [bootstrappedKey]: {\n        enumerable: false,\n        configurable: false,\n        value: true,\n      },\n    };\n    if (service[stateKey]) {\n      // eslint-disable-next-line guard-for-in\n      for (const key in service[stateKey]) {\n        const descriptor = Object.getOwnPropertyDescriptor(service, key);\n        // eslint-disable-next-line no-continue\n        if (typeof descriptor === 'undefined') continue;\n        Object.assign(service[stateKey], {\n          [key]: descriptor.value,\n        });\n        Object.assign(descriptors, {\n          [key]: {\n            enumerable: true,\n            configurable: false,\n            get(this: typeof service) {\n              return this[stateKey][key];\n            },\n            set(this: typeof service, value: unknown) {\n              this[stateKey][key] = value;\n            },\n          },\n        });\n      }\n      const initState = enableAutoFreeze\n        ? produce({ ...service[stateKey] }, () => {})\n        : service[stateKey];\n\n      const serviceReducers = Object.entries(initState).reduce(\n        (serviceReducersMapObject: ReducersMapObject, [key, value]) => {\n          // support pure reducer\n          if (typeof value === 'function') {\n            return Object.assign(serviceReducersMapObject, {\n              [key]: value,\n            });\n          }\n          const reducer = (state = value, action: Action) => {\n            if (action._usm !== usm) return state;\n            if (!service._getLastState) return action._state[identifier][key];\n            return identifier === action.type &&\n              Object.hasOwnProperty.call(action._state, key)\n              ? action._state[key]\n              : state;\n          };\n          return Object.assign(serviceReducersMapObject, {\n            [key]: reducer,\n          });\n        },\n        {},\n      );\n      // support custom reducers\n      service._reducers = serviceReducers;\n      const reducer = combineReducers(serviceReducers);\n      Object.assign(reducers, {\n        [identifier]: reducer,\n      });\n\n      Object.assign(descriptors, {\n        [stateKey]: {\n          enumerable: false,\n          configurable: false,\n          get(this: typeof service) {\n            const stagedState = getStagedState();\n            if (stagedState)\n              return this._getLastState &&\n                stagedState?.__identifier === identifier\n                ? stagedState.__state\n                : stagedState[identifier];\n            const currentState = this[storeKey]?.getState()[identifier];\n            if (enableAutoFreeze && !Object.isFrozen(currentState)) {\n              return Object.freeze(currentState);\n            }\n            return currentState;\n          },\n        },\n      });\n    }\n    Object.assign(descriptors, {\n      [identifierKey]: {\n        configurable: false,\n        enumerable: false,\n        value: identifier,\n      },\n      [storeKey]: {\n        configurable: false,\n        enumerable: false,\n        get() {\n          return store;\n        },\n      },\n    });\n    Object.defineProperties(service, descriptors);\n    if (Array.isArray(service[subscriptionsKey])) {\n      Array.prototype.push.apply(subscriptions, service[subscriptionsKey]);\n    }\n  });\n  const storeWithRedux = createStoreWithRedux(\n    handleReducers(reducers),\n    preloadedState,\n    reduxEnhancer,\n  );\n  store = {\n    dispatch: storeWithRedux.dispatch,\n    getState: storeWithRedux.getState,\n    subscribe: storeWithRedux.subscribe,\n  };\n  for (const subscribe of subscriptions) {\n    subscribe();\n  }\n  return store as ReduxStore;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,MAAA,GAAAC,uBAAA,CAAAC,OAAA;AASA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AAQA,IAAAG,MAAA,GAAAH,OAAA;AAA+C,SAAAI,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,yBAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAN,wBAAAU,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,aAAAE,OAAA,CAAAF,GAAA,yBAAAA,GAAA,uCAAAA,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,cAAAN,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAW,eAAAC,GAAA,EAAAC,CAAA,WAAAC,eAAA,CAAAF,GAAA,KAAAG,qBAAA,CAAAH,GAAA,EAAAC,CAAA,KAAAG,2BAAA,CAAAJ,GAAA,EAAAC,CAAA,KAAAI,gBAAA;AAAA,SAAAA,iBAAA,cAAAC,SAAA;AAAA,SAAAF,4BAAAG,CAAA,EAAAC,MAAA,SAAAD,CAAA,qBAAAA,CAAA,sBAAAE,iBAAA,CAAAF,CAAA,EAAAC,MAAA,OAAAE,CAAA,GAAApB,MAAA,CAAAI,SAAA,CAAAiB,QAAA,CAAAf,IAAA,CAAAW,CAAA,EAAAK,KAAA,aAAAF,CAAA,iBAAAH,CAAA,CAAAM,WAAA,EAAAH,CAAA,GAAAH,CAAA,CAAAM,WAAA,CAAAC,IAAA,MAAAJ,CAAA,cAAAA,CAAA,mBAAAK,KAAA,CAAAC,IAAA,CAAAT,CAAA,OAAAG,CAAA,+DAAAO,IAAA,CAAAP,CAAA,UAAAD,iBAAA,CAAAF,CAAA,EAAAC,MAAA;AAAA,SAAAC,kBAAAT,GAAA,EAAAkB,GAAA,QAAAA,GAAA,YAAAA,GAAA,GAAAlB,GAAA,CAAAmB,MAAA,EAAAD,GAAA,GAAAlB,GAAA,CAAAmB,MAAA,WAAAlB,CAAA,MAAAmB,IAAA,OAAAL,KAAA,CAAAG,GAAA,GAAAjB,CAAA,GAAAiB,GAAA,EAAAjB,CAAA,MAAAmB,IAAA,CAAAnB,CAAA,IAAAD,GAAA,CAAAC,CAAA,YAAAmB,IAAA;AAAA,SAAAjB,sBAAAH,GAAA,EAAAC,CAAA,QAAAoB,EAAA,WAAArB,GAAA,gCAAAsB,MAAA,IAAAtB,GAAA,CAAAsB,MAAA,CAAAC,QAAA,KAAAvB,GAAA,4BAAAqB,EAAA,QAAAG,EAAA,EAAAC,EAAA,EAAAC,EAAA,EAAAC,EAAA,EAAAC,IAAA,OAAAC,EAAA,OAAAC,EAAA,iBAAAJ,EAAA,IAAAL,EAAA,GAAAA,EAAA,CAAAzB,IAAA,CAAAI,GAAA,GAAA+B,IAAA,QAAA9B,CAAA,QAAAX,MAAA,CAAA+B,EAAA,MAAAA,EAAA,UAAAQ,EAAA,uBAAAA,EAAA,IAAAL,EAAA,GAAAE,EAAA,CAAA9B,IAAA,CAAAyB,EAAA,GAAAW,IAAA,MAAAJ,IAAA,CAAAK,IAAA,CAAAT,EAAA,CAAAU,KAAA,GAAAN,IAAA,CAAAT,MAAA,KAAAlB,CAAA,GAAA4B,EAAA,sBAAAM,GAAA,IAAAL,EAAA,OAAAL,EAAA,GAAAU,GAAA,yBAAAN,EAAA,YAAAR,EAAA,eAAAM,EAAA,GAAAN,EAAA,cAAA/B,MAAA,CAAAqC,EAAA,MAAAA,EAAA,2BAAAG,EAAA,QAAAL,EAAA,aAAAG,IAAA;AAAA,SAAA1B,gBAAAF,GAAA,QAAAe,KAAA,CAAAqB,OAAA,CAAApC,GAAA,UAAAA,GAAA;AAAA,SAAAqC,QAAAC,MAAA,EAAAC,cAAA,QAAAC,IAAA,GAAAlD,MAAA,CAAAkD,IAAA,CAAAF,MAAA,OAAAhD,MAAA,CAAAmD,qBAAA,QAAAC,OAAA,GAAApD,MAAA,CAAAmD,qBAAA,CAAAH,MAAA,GAAAC,cAAA,KAAAG,OAAA,GAAAA,OAAA,CAAAC,MAAA,WAAAC,GAAA,WAAAtD,MAAA,CAAAE,wBAAA,CAAA8C,MAAA,EAAAM,GAAA,EAAAC,UAAA,OAAAL,IAAA,CAAAP,IAAA,CAAAa,KAAA,CAAAN,IAAA,EAAAE,OAAA,YAAAF,IAAA;AAAA,SAAAO,cAAAC,MAAA,aAAA/C,CAAA,MAAAA,CAAA,GAAAgD,SAAA,CAAA9B,MAAA,EAAAlB,CAAA,UAAAiD,MAAA,WAAAD,SAAA,CAAAhD,CAAA,IAAAgD,SAAA,CAAAhD,CAAA,QAAAA,CAAA,OAAAoC,OAAA,CAAA/C,MAAA,CAAA4D,MAAA,OAAAC,OAAA,WAAA1D,GAAA,IAAA2D,eAAA,CAAAJ,MAAA,EAAAvD,GAAA,EAAAyD,MAAA,CAAAzD,GAAA,SAAAH,MAAA,CAAA+D,yBAAA,GAAA/D,MAAA,CAAAgE,gBAAA,CAAAN,MAAA,EAAA1D,MAAA,CAAA+D,yBAAA,CAAAH,MAAA,KAAAb,OAAA,CAAA/C,MAAA,CAAA4D,MAAA,GAAAC,OAAA,WAAA1D,GAAA,IAAAH,MAAA,CAAAC,cAAA,CAAAyD,MAAA,EAAAvD,GAAA,EAAAH,MAAA,CAAAE,wBAAA,CAAA0D,MAAA,EAAAzD,GAAA,iBAAAuD,MAAA;AAAA,SAAAI,gBAAAtE,GAAA,EAAAW,GAAA,EAAAyC,KAAA,IAAAzC,GAAA,GAAA8D,cAAA,CAAA9D,GAAA,OAAAA,GAAA,IAAAX,GAAA,IAAAQ,MAAA,CAAAC,cAAA,CAAAT,GAAA,EAAAW,GAAA,IAAAyC,KAAA,EAAAA,KAAA,EAAAW,UAAA,QAAAW,YAAA,QAAAC,QAAA,oBAAA3E,GAAA,CAAAW,GAAA,IAAAyC,KAAA,WAAApD,GAAA;AAAA,SAAAyE,eAAAG,GAAA,QAAAjE,GAAA,GAAAkE,YAAA,CAAAD,GAAA,oBAAA1E,OAAA,CAAAS,GAAA,iBAAAA,GAAA,GAAAmE,MAAA,CAAAnE,GAAA;AAAA,SAAAkE,aAAAE,KAAA,EAAAC,IAAA,QAAA9E,OAAA,CAAA6E,KAAA,kBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAvC,MAAA,CAAA0C,WAAA,OAAAD,IAAA,KAAAE,SAAA,QAAAC,GAAA,GAAAH,IAAA,CAAAnE,IAAA,CAAAiE,KAAA,EAAAC,IAAA,oBAAA9E,OAAA,CAAAkF,GAAA,uBAAAA,GAAA,YAAA5D,SAAA,4DAAAwD,IAAA,gBAAAF,MAAA,GAAAO,MAAA,EAAAN,KAAA;AAAA,SAAA7E,QAAAF,GAAA,sCAAAE,OAAA,wBAAAsC,MAAA,uBAAAA,MAAA,CAAAC,QAAA,aAAAzC,GAAA,kBAAAA,GAAA,gBAAAA,GAAA,WAAAA,GAAA,yBAAAwC,MAAA,IAAAxC,GAAA,CAAA+B,WAAA,KAAAS,MAAA,IAAAxC,GAAA,KAAAwC,MAAA,CAAA5B,SAAA,qBAAAZ,GAAA,KAAAE,OAAA,CAAAF,GAAA;AAU/C,IAAIsF,aAAsB;AAEnB,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAA;EAAA,OAASD,aAAa;AAAA;AAACE,OAAA,CAAAD,gBAAA,GAAAA,gBAAA;AAE7C,IAAME,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIC,MAAe,EAAK;EACnDJ,aAAa,GAAGI,MAAM;AACxB,CAAC;AAACF,OAAA,CAAAC,gBAAA,GAAAA,gBAAA;AAEK,IAAME,WAAW,GAAG,SAAdA,WAAWA,CACtBC,OAAqB,EACrBC,cAAoC,EAEjC;EAAA,IAAAC,eAAA,EAAAC,qBAAA;EAAA,IADHC,MAAc,GAAA7B,SAAA,CAAA9B,MAAA,QAAA8B,SAAA,QAAAgB,SAAA,GAAAhB,SAAA,MAAG,CAAC,CAAC;EAAA,IAGjB8B,aAAa,GAEXD,MAAM,CAFRC,aAAa;IAAAC,qBAAA,GAEXF,MAAM,CADRG,cAAc;IAAdA,cAAc,GAAAD,qBAAA,cAAG,UAACE,QAAQ;MAAA,OAAK,IAAAC,sBAAe,EAACD,QAAQ,CAAC;IAAA,IAAAF,qBAAA;EAE1D,IAAIhG,OAAA,CAAO0F,OAAO,MAAK,QAAQ,IAAI,CAAC3D,KAAK,CAACqB,OAAO,CAACsC,OAAO,CAACU,OAAO,CAAC,EAAE;IAClE,MAAM,IAAIC,KAAK,qEAEf,CAAC;EACH;EACA,IAAMC,gBAAgB,IAAAV,eAAA,GACpBF,OAAO,CAACa,MAAM,cAAAX,eAAA,cAAAA,eAAA,GAAIY,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;EAC1DtB,aAAa,IAAAS,qBAAA,GAAGC,MAAM,CAACV,aAAa,cAAAS,qBAAA,cAAAA,qBAAA,GAAI,KAAK;EAC7C,IAAIT,aAAa,EAAE,IAAAuB,oBAAsB,EAAC,CAAC;EAC3C,IAAAC,oBAAa,EAACN,gBAAgB,CAAC;EAC/B,IAAMO,WAAW,GAAG,IAAIC,GAAG,CAAS,CAAC;EACrC,IAAMZ,QAA2B,GAAG,CAAC,CAAC;EACtC,IAAMa,aAA6B,GAAG,EAAE;EACxC,IAAIC,KAAY;EAChBtB,OAAO,CAACU,OAAO,CAACjC,OAAO,CAAC,UAAC8C,MAAM,EAAEC,KAAK,EAAK;IAAA,IAAAC,qBAAA,EAAAC,eAAA;IACzC,IAAIpH,OAAA,CAAOiH,MAAM,MAAK,QAAQ,IAAIA,MAAM,KAAK,IAAI,EAAE;IACnD,IAAMI,OAAgB,GAAGJ,MAAM;IAC/B,IAAMK,SAAS,GAAGhH,MAAM,CAACiH,cAAc,CAACF,OAAO,CAAC,CAACxF,WAAW,CAACC,IAAI;IACjE,IAAI,OAAOuF,OAAO,CAACG,kBAAQ,CAAC,KAAK,WAAW,IAAIH,OAAO,CAACI,yBAAe,CAAC,EAAE;MACxE,IAAIjB,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;QAC1C,IAAIW,OAAO,CAACI,yBAAe,CAAC,EAAE;UAC5BC,OAAO,CAACC,IAAI,gCAAAC,MAAA,CACqBV,KAAK,qBAAAU,MAAA,CAAkBN,SAAS,+CACjE,CAAC;QACH;MACF;IACF;IACA,IAAIO,UAAU,IAAAV,qBAAA,GAAGE,OAAO,CAACS,uBAAa,CAAC,cAAAX,qBAAA,cAAAA,qBAAA,GAAIE,OAAO,CAACvF,IAAI;IACvD,IAAI+F,UAAU,KAAK,IAAI,IAAI,OAAOA,UAAU,KAAK,WAAW,EAAE;MAC5DA,UAAU,kBAAAD,MAAA,CAAkBN,SAAS,OAAAM,MAAA,CAAIG,IAAI,CAACC,MAAM,CAAC,CAAC,CAACrG,QAAQ,CAAC,EAAE,CAAC,CAAE;IACvE;IACA,IAAI,OAAOkG,UAAU,KAAK,QAAQ,EAAE;MAClC,IAAIrB,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;QAC1CgB,OAAO,CAACO,KAAK,uBAAAL,MAAA,CACFN,SAAS,0CAAAM,MAAA,CAAuCN,SAAS,uOAKnE,CAAC;MACJ,CAAC,MAAM;QACL,MAAM,IAAIjB,KAAK,KAAAuB,MAAA,CACTN,SAAS,oEACf,CAAC;MACH;IACF;IACA,IAAIT,WAAW,CAAC3G,GAAG,CAAC2H,UAAU,CAAC,EAAE;MAC/BA,UAAU,OAAAD,MAAA,CAAOV,KAAK,CAAE;IAC1B;IACAL,WAAW,CAACqB,GAAG,CAACL,UAAU,CAAC;IAC3B,IAAMM,WAA+C,GAAA/D,eAAA,KAClDqD,yBAAe,EAAG;MACjB5D,UAAU,EAAE,KAAK;MACjBW,YAAY,EAAE,KAAK;MACnBtB,KAAK,EAAE;IACT,CAAC,CACF;IACD,IAAImE,OAAO,CAACG,kBAAQ,CAAC,EAAE;MAAA,IAAAY,KAAA,YAAAA,MAEV3H,GAAG;QACZ,IAAM4H,UAAU,GAAG/H,MAAM,CAACE,wBAAwB,CAAC6G,OAAO,EAAE5G,GAAG,CAAC;QAChE;QACA,IAAI,OAAO4H,UAAU,KAAK,WAAW,EAAE;QACvC/H,MAAM,CAACgI,MAAM,CAACjB,OAAO,CAACG,kBAAQ,CAAC,EAAApD,eAAA,KAC5B3D,GAAG,EAAG4H,UAAU,CAACnF,KAAK,CACxB,CAAC;QACF5C,MAAM,CAACgI,MAAM,CAACH,WAAW,EAAA/D,eAAA,KACtB3D,GAAG,EAAG;UACLoD,UAAU,EAAE,IAAI;UAChBW,YAAY,EAAE,KAAK;UACnBrE,GAAG,WAAAA,IAAA,EAAuB;YACxB,OAAO,IAAI,CAACqH,kBAAQ,CAAC,CAAC/G,GAAG,CAAC;UAC5B,CAAC;UACDK,GAAG,WAAAA,IAAuBoC,KAAc,EAAE;YACxC,IAAI,CAACsE,kBAAQ,CAAC,CAAC/G,GAAG,CAAC,GAAGyC,KAAK;UAC7B;QACF,CAAC,CACF,CAAC;MAAC;MAnBL;MACA,KAAK,IAAMzC,GAAG,IAAI4G,OAAO,CAACG,kBAAQ,CAAC,EAAE;QAAA,IAAAe,IAAA,GAAAH,KAAA,CAA1B3H,GAAG;QAAA,IAAA8H,IAAA,iBAG2B;MAgBzC;MACA,IAAMC,SAAS,GAAGlC,gBAAgB,GAC9B,IAAAmC,iBAAO,EAAA1E,aAAA,KAAMsD,OAAO,CAACG,kBAAQ,CAAC,GAAI,YAAM,CAAC,CAAC,CAAC,GAC3CH,OAAO,CAACG,kBAAQ,CAAC;MAErB,IAAMkB,eAAe,GAAGpI,MAAM,CAACqI,OAAO,CAACH,SAAS,CAAC,CAACI,MAAM,CACtD,UAACC,wBAA2C,EAAAC,IAAA,EAAmB;QAAA,IAAAC,KAAA,GAAAhI,cAAA,CAAA+H,IAAA;UAAhBrI,GAAG,GAAAsI,KAAA;UAAE7F,KAAK,GAAA6F,KAAA;QACvD;QACA,IAAI,OAAO7F,KAAK,KAAK,UAAU,EAAE;UAC/B,OAAO5C,MAAM,CAACgI,MAAM,CAACO,wBAAwB,EAAAzE,eAAA,KAC1C3D,GAAG,EAAGyC,KAAK,CACb,CAAC;QACJ;QACA,IAAM8F,OAAO,GAAG,SAAVA,OAAOA,CAAA,EAAsC;UAAA,IAAlCC,KAAK,GAAAhF,SAAA,CAAA9B,MAAA,QAAA8B,SAAA,QAAAgB,SAAA,GAAAhB,SAAA,MAAGf,KAAK;UAAA,IAAEgG,MAAc,GAAAjF,SAAA,CAAA9B,MAAA,OAAA8B,SAAA,MAAAgB,SAAA;UAC5C,IAAIiE,MAAM,CAACC,IAAI,KAAKC,aAAG,EAAE,OAAOH,KAAK;UACrC,IAAI,CAAC5B,OAAO,CAACgC,aAAa,EAAE,OAAOH,MAAM,CAACI,MAAM,CAACzB,UAAU,CAAC,CAACpH,GAAG,CAAC;UACjE,OAAOoH,UAAU,KAAKqB,MAAM,CAACK,IAAI,IAC/BjJ,MAAM,CAACK,cAAc,CAACC,IAAI,CAACsI,MAAM,CAACI,MAAM,EAAE7I,GAAG,CAAC,GAC5CyI,MAAM,CAACI,MAAM,CAAC7I,GAAG,CAAC,GAClBwI,KAAK;QACX,CAAC;QACD,OAAO3I,MAAM,CAACgI,MAAM,CAACO,wBAAwB,EAAAzE,eAAA,KAC1C3D,GAAG,EAAGuI,OAAO,CACf,CAAC;MACJ,CAAC,EACD,CAAC,CACH,CAAC;MACD;MACA3B,OAAO,CAACmC,SAAS,GAAGd,eAAe;MACnC,IAAMM,OAAO,GAAG,IAAA7C,sBAAe,EAACuC,eAAe,CAAC;MAChDpI,MAAM,CAACgI,MAAM,CAACpC,QAAQ,EAAA9B,eAAA,KACnByD,UAAU,EAAGmB,OAAO,CACtB,CAAC;MAEF1I,MAAM,CAACgI,MAAM,CAACH,WAAW,EAAA/D,eAAA,KACtBoD,kBAAQ,EAAG;QACV3D,UAAU,EAAE,KAAK;QACjBW,YAAY,EAAE,KAAK;QACnBrE,GAAG,WAAAA,IAAA,EAAuB;UAAA,IAAAsJ,cAAA;UACxB,IAAMC,WAAW,GAAG,IAAAC,qBAAc,EAAC,CAAC;UACpC,IAAID,WAAW,EACb,OAAO,IAAI,CAACL,aAAa,IACvB,CAAAK,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEE,YAAY,MAAK/B,UAAU,GACtC6B,WAAW,CAACG,OAAO,GACnBH,WAAW,CAAC7B,UAAU,CAAC;UAC7B,IAAMiC,YAAY,IAAAL,cAAA,GAAG,IAAI,CAACM,kBAAQ,CAAC,cAAAN,cAAA,uBAAdA,cAAA,CAAgBO,QAAQ,CAAC,CAAC,CAACnC,UAAU,CAAC;UAC3D,IAAIvB,gBAAgB,IAAI,CAAChG,MAAM,CAAC2J,QAAQ,CAACH,YAAY,CAAC,EAAE;YACtD,OAAOxJ,MAAM,CAAC4J,MAAM,CAACJ,YAAY,CAAC;UACpC;UACA,OAAOA,YAAY;QACrB;MACF,CAAC,CACF,CAAC;IACJ;IACAxJ,MAAM,CAACgI,MAAM,CAACH,WAAW,GAAAf,eAAA,OAAAhD,eAAA,CAAAgD,eAAA,EACtBU,uBAAa,EAAG;MACftD,YAAY,EAAE,KAAK;MACnBX,UAAU,EAAE,KAAK;MACjBX,KAAK,EAAE2E;IACT,CAAC,GAAAzD,eAAA,CAAAgD,eAAA,EACA2C,kBAAQ,EAAG;MACVvF,YAAY,EAAE,KAAK;MACnBX,UAAU,EAAE,KAAK;MACjB1D,GAAG,WAAAA,IAAA,EAAG;QACJ,OAAO6G,KAAK;MACd;IACF,CAAC,GAAAI,eAAA,CACF,CAAC;IACF9G,MAAM,CAACgE,gBAAgB,CAAC+C,OAAO,EAAEc,WAAW,CAAC;IAC7C,IAAIpG,KAAK,CAACqB,OAAO,CAACiE,OAAO,CAAC8C,0BAAgB,CAAC,CAAC,EAAE;MAC5CpI,KAAK,CAACrB,SAAS,CAACuC,IAAI,CAACa,KAAK,CAACiD,aAAa,EAAEM,OAAO,CAAC8C,0BAAgB,CAAC,CAAC;IACtE;EACF,CAAC,CAAC;EACF,IAAMC,cAAc,GAAG,IAAAC,kBAAoB,EACzCpE,cAAc,CAACC,QAAQ,CAAC,EACxBP,cAAc,EACdI,aACF,CAAC;EACDiB,KAAK,GAAG;IACNsD,QAAQ,EAAEF,cAAc,CAACE,QAAQ;IACjCN,QAAQ,EAAEI,cAAc,CAACJ,QAAQ;IACjCO,SAAS,EAAEH,cAAc,CAACG;EAC5B,CAAC;EACD,SAAAC,GAAA,MAAAC,cAAA,GAAwB1D,aAAa,EAAAyD,GAAA,GAAAC,cAAA,CAAAtI,MAAA,EAAAqI,GAAA,IAAE;IAAlC,IAAMD,SAAS,GAAAE,cAAA,CAAAD,GAAA;IAClBD,SAAS,CAAC,CAAC;EACb;EACA,OAAOvD,KAAK;AACd,CAAC;AAAC1B,OAAA,CAAAG,WAAA,GAAAA,WAAA"}