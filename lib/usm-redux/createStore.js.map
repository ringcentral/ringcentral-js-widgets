{"version":3,"file":"createStore.js","names":["_immer","_interopRequireWildcard","require","_redux","_constant","_index","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","u","next","done","push","value","isArray","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","apply","_objectSpread","arguments","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_toPrimitive","toPrimitive","String","Number","prototype","enablePatches","getPatchesToggle","exports","setPatchesToggle","toggle","createStore","options","preloadedState","_options$strict","_config$enablePatches","config","undefined","reduxEnhancer","_config$handleReducer","handleReducers","reducers","combineReducers","modules","Error","enableAutoFreeze","strict","process","env","NODE_ENV","enablePatchesWithImmer","setAutoFreeze","identifiers","Set","subscriptions","store","module","index","_service$identifierKe","service","className","getPrototypeOf","stateKey","bootstrappedKey","console","warn","concat","identifier","identifierKey","Math","random","error","add","descriptors","_loop","key","descriptor","assign","initState","produce","serviceReducers","entries","reduce","serviceReducersMapObject","_ref","_ref2","reducer","state","action","_usm","usm","_getLastState","_state","type","_reducers","_this$storeKey","stagedState","getStagedState","__identifier","__state","currentState","storeKey","getState","isFrozen","freeze","subscriptionsKey","storeWithRedux","createStoreWithRedux","dispatch","subscribe","_i","_subscriptions"],"sources":["lib/usm-redux/createStore.ts"],"sourcesContent":["import produce, {\n  setAutoFreeze,\n  enablePatches as enablePatchesWithImmer,\n} from 'immer';\nimport type {\n  ReducersMapObject,\n  PreloadedState,\n  Store as ReduxStore,\n} from 'redux';\nimport { createStore as createStoreWithRedux, combineReducers } from 'redux';\n\nimport {\n  stateKey,\n  storeKey,\n  bootstrappedKey,\n  identifierKey,\n  subscriptionsKey,\n  usm,\n} from './constant';\nimport type {\n  Action,\n  StoreOptions,\n  Store,\n  Subscription,\n  Config,\n  Service,\n} from './interface';\nimport { getStagedState } from './utils/index';\n\nlet enablePatches: boolean;\n\nexport const getPatchesToggle = () => enablePatches;\n\nexport const setPatchesToggle = (toggle: boolean) => {\n  enablePatches = toggle;\n};\n\nexport const createStore = (\n  options: StoreOptions,\n  preloadedState?: PreloadedState<any>,\n  config: Config = {},\n) => {\n  const {\n    reduxEnhancer,\n    handleReducers = (reducers) => combineReducers(reducers),\n  } = config;\n  if (typeof options !== 'object' || !Array.isArray(options.modules)) {\n    throw new Error(\n      `'createStore' options should be a object with a property 'modules'`,\n    );\n  }\n  const enableAutoFreeze =\n    options.strict ?? process.env.NODE_ENV === 'development';\n  enablePatches = config.enablePatches ?? false;\n  if (enablePatches) enablePatchesWithImmer();\n  setAutoFreeze(enableAutoFreeze);\n  const identifiers = new Set<string>();\n  const reducers: ReducersMapObject = {};\n  const subscriptions: Subscription[] = [];\n  let store: Store;\n  options.modules.forEach((module, index) => {\n    if (typeof module !== 'object' || module === null) return;\n    const service: Service = module;\n    const className = Object.getPrototypeOf(service).constructor.name;\n    if (typeof service[stateKey] === 'undefined' || service[bootstrappedKey]) {\n      if (process.env.NODE_ENV === 'development') {\n        if (service[bootstrappedKey]) {\n          console.warn(\n            `The module with an index of ${index} and a name of ${className} in the module list is a duplicate module.`,\n          );\n        }\n      }\n    }\n    let identifier = service[identifierKey] ?? service.name;\n    if (identifier === null || typeof identifier === 'undefined') {\n      identifier = `@@usm-redux/${className}/${Math.random().toString(36)}`;\n    }\n    if (typeof identifier !== 'string') {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(`\n          Since '${className}' module has set the module state, '${className}' module must set a unique and valid class property 'name' to be used as the module index.\n          Example:\n            class FooBar {\n              name = 'FooBar'; // <- add the 'name' property.\n            }\n        `);\n      } else {\n        throw new Error(\n          `'${className}' module 'name' property should be defined as a valid 'string'.`,\n        );\n      }\n    }\n    if (identifiers.has(identifier)) {\n      identifier += `${index}`;\n    }\n    identifiers.add(identifier);\n    const descriptors: Record<string, PropertyDescriptor> = {\n      [bootstrappedKey]: {\n        enumerable: false,\n        configurable: false,\n        value: true,\n      },\n    };\n    if (service[stateKey]) {\n      // eslint-disable-next-line guard-for-in\n      for (const key in service[stateKey]) {\n        const descriptor = Object.getOwnPropertyDescriptor(service, key);\n        // eslint-disable-next-line no-continue\n        if (typeof descriptor === 'undefined') continue;\n        Object.assign(service[stateKey], {\n          [key]: descriptor.value,\n        });\n        Object.assign(descriptors, {\n          [key]: {\n            enumerable: true,\n            configurable: false,\n            get(this: typeof service) {\n              return this[stateKey][key];\n            },\n            set(this: typeof service, value: unknown) {\n              this[stateKey][key] = value;\n            },\n          },\n        });\n      }\n      const initState = enableAutoFreeze\n        ? produce({ ...service[stateKey] }, () => {})\n        : service[stateKey];\n\n      const serviceReducers = Object.entries(initState).reduce(\n        (serviceReducersMapObject: ReducersMapObject, [key, value]) => {\n          // support pure reducer\n          if (typeof value === 'function') {\n            return Object.assign(serviceReducersMapObject, {\n              [key]: value,\n            });\n          }\n          const reducer = (state = value, action: Action) => {\n            if (action._usm !== usm) return state;\n            if (!service._getLastState) return action._state[identifier][key];\n            return identifier === action.type &&\n              Object.hasOwnProperty.call(action._state, key)\n              ? action._state[key]\n              : state;\n          };\n          return Object.assign(serviceReducersMapObject, {\n            [key]: reducer,\n          });\n        },\n        {},\n      );\n      // support custom reducers\n      service._reducers = serviceReducers;\n      const reducer = combineReducers(serviceReducers);\n      Object.assign(reducers, {\n        [identifier]: reducer,\n      });\n\n      Object.assign(descriptors, {\n        [stateKey]: {\n          enumerable: false,\n          configurable: false,\n          get(this: typeof service) {\n            const stagedState = getStagedState();\n            if (stagedState)\n              return this._getLastState &&\n                stagedState?.__identifier === identifier\n                ? stagedState.__state\n                : stagedState[identifier];\n            const currentState = this[storeKey]?.getState()[identifier];\n            if (enableAutoFreeze && !Object.isFrozen(currentState)) {\n              return Object.freeze(currentState);\n            }\n            return currentState;\n          },\n        },\n      });\n    }\n    Object.assign(descriptors, {\n      [identifierKey]: {\n        configurable: false,\n        enumerable: false,\n        value: identifier,\n      },\n      [storeKey]: {\n        configurable: false,\n        enumerable: false,\n        get() {\n          return store;\n        },\n      },\n    });\n    Object.defineProperties(service, descriptors);\n    if (Array.isArray(service[subscriptionsKey])) {\n      Array.prototype.push.apply(subscriptions, service[subscriptionsKey]);\n    }\n  });\n  const storeWithRedux = createStoreWithRedux(\n    handleReducers(reducers),\n    preloadedState,\n    reduxEnhancer,\n  );\n  store = {\n    dispatch: storeWithRedux.dispatch,\n    getState: storeWithRedux.getState,\n    subscribe: storeWithRedux.subscribe,\n  };\n  for (const subscribe of subscriptions) {\n    subscribe();\n  }\n  return store as ReduxStore;\n};\n"],"mappings":"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","ignoreList":[]}