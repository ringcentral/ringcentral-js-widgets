{"version":3,"file":"createStore.js","names":["_immer","_interopRequireWildcard","require","_redux","_constant","_index","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","f","o","next","done","push","value","isArray","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","apply","_objectSpread","arguments","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_toPrimitive","toPrimitive","String","Number","prototype","enablePatches","getPatchesToggle","exports","setPatchesToggle","toggle","createStore","options","preloadedState","_options$strict","_config$enablePatches","config","undefined","reduxEnhancer","_config$handleReducer","handleReducers","reducers","combineReducers","modules","Error","enableAutoFreeze","strict","process","env","NODE_ENV","enablePatchesWithImmer","setAutoFreeze","identifiers","Set","subscriptions","store","module","index","_service$identifierKe","_Object$assign7","service","className","getPrototypeOf","stateKey","bootstrappedKey","console","warn","concat","identifier","identifierKey","Math","random","error","add","descriptors","_loop","key","descriptor","assign","_ret","initState","produce","serviceReducers","entries","reduce","serviceReducersMapObject","_ref","_ref2","reducer","state","action","_usm","usm","_getLastState","_state","type","_reducers","_this$storeKey","stagedState","getStagedState","__identifier","__state","currentState","storeKey","getState","isFrozen","freeze","subscriptionsKey","storeWithRedux","createStoreWithRedux","dispatch","subscribe","_i","_subscriptions"],"sources":["lib/usm-redux/createStore.ts"],"sourcesContent":["import produce, {\n  setAutoFreeze,\n  enablePatches as enablePatchesWithImmer,\n} from 'immer';\nimport type {\n  ReducersMapObject,\n  PreloadedState,\n  Store as ReduxStore,\n} from 'redux';\nimport { createStore as createStoreWithRedux, combineReducers } from 'redux';\n\nimport {\n  stateKey,\n  storeKey,\n  bootstrappedKey,\n  identifierKey,\n  subscriptionsKey,\n  usm,\n} from './constant';\nimport type {\n  Action,\n  StoreOptions,\n  Store,\n  Subscription,\n  Config,\n  Service,\n} from './interface';\nimport { getStagedState } from './utils/index';\n\nlet enablePatches: boolean;\n\nexport const getPatchesToggle = () => enablePatches;\n\nexport const setPatchesToggle = (toggle: boolean) => {\n  enablePatches = toggle;\n};\n\nexport const createStore = (\n  options: StoreOptions,\n  preloadedState?: PreloadedState<any>,\n  config: Config = {},\n) => {\n  const {\n    reduxEnhancer,\n    handleReducers = (reducers) => combineReducers(reducers),\n  } = config;\n  if (typeof options !== 'object' || !Array.isArray(options.modules)) {\n    throw new Error(\n      `'createStore' options should be a object with a property 'modules'`,\n    );\n  }\n  const enableAutoFreeze =\n    options.strict ?? process.env.NODE_ENV === 'development';\n  enablePatches = config.enablePatches ?? false;\n  if (enablePatches) enablePatchesWithImmer();\n  setAutoFreeze(enableAutoFreeze);\n  const identifiers = new Set<string>();\n  const reducers: ReducersMapObject = {};\n  const subscriptions: Subscription[] = [];\n  let store: Store;\n  options.modules.forEach((module, index) => {\n    if (typeof module !== 'object' || module === null) return;\n    const service: Service = module;\n    const className = Object.getPrototypeOf(service).constructor.name;\n    if (typeof service[stateKey] === 'undefined' || service[bootstrappedKey]) {\n      if (process.env.NODE_ENV === 'development') {\n        if (service[bootstrappedKey]) {\n          console.warn(\n            `The module with an index of ${index} and a name of ${className} in the module list is a duplicate module.`,\n          );\n        }\n      }\n    }\n    let identifier = service[identifierKey] ?? service.name;\n    if (identifier === null || typeof identifier === 'undefined') {\n      identifier = `@@usm-redux/${className}/${Math.random().toString(36)}`;\n    }\n    if (typeof identifier !== 'string') {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(`\n          Since '${className}' module has set the module state, '${className}' module must set a unique and valid class property 'name' to be used as the module index.\n          Example:\n            class FooBar {\n              name = 'FooBar'; // <- add the 'name' property.\n            }\n        `);\n      } else {\n        throw new Error(\n          `'${className}' module 'name' property should be defined as a valid 'string'.`,\n        );\n      }\n    }\n    if (identifiers.has(identifier)) {\n      identifier += `${index}`;\n    }\n    identifiers.add(identifier);\n    const descriptors: Record<string, PropertyDescriptor> = {\n      [bootstrappedKey]: {\n        enumerable: false,\n        configurable: false,\n        value: true,\n      },\n    };\n    if (service[stateKey]) {\n      // eslint-disable-next-line guard-for-in\n      for (const key in service[stateKey]) {\n        const descriptor = Object.getOwnPropertyDescriptor(service, key);\n        // eslint-disable-next-line no-continue\n        if (typeof descriptor === 'undefined') continue;\n        Object.assign(service[stateKey], {\n          [key]: descriptor.value,\n        });\n        Object.assign(descriptors, {\n          [key]: {\n            enumerable: true,\n            configurable: false,\n            get(this: typeof service) {\n              return this[stateKey][key];\n            },\n            set(this: typeof service, value: unknown) {\n              this[stateKey][key] = value;\n            },\n          },\n        });\n      }\n      const initState = enableAutoFreeze\n        ? produce({ ...service[stateKey] }, () => {})\n        : service[stateKey];\n\n      const serviceReducers = Object.entries(initState).reduce(\n        (serviceReducersMapObject: ReducersMapObject, [key, value]) => {\n          // support pure reducer\n          if (typeof value === 'function') {\n            return Object.assign(serviceReducersMapObject, {\n              [key]: value,\n            });\n          }\n          const reducer = (state = value, action: Action) => {\n            if (action._usm !== usm) return state;\n            if (!service._getLastState) return action._state[identifier][key];\n            return identifier === action.type &&\n              Object.hasOwnProperty.call(action._state, key)\n              ? action._state[key]\n              : state;\n          };\n          return Object.assign(serviceReducersMapObject, {\n            [key]: reducer,\n          });\n        },\n        {},\n      );\n      // support custom reducers\n      service._reducers = serviceReducers;\n      const reducer = combineReducers(serviceReducers);\n      Object.assign(reducers, {\n        [identifier]: reducer,\n      });\n\n      Object.assign(descriptors, {\n        [stateKey]: {\n          enumerable: false,\n          configurable: false,\n          get(this: typeof service) {\n            const stagedState = getStagedState();\n            if (stagedState)\n              return this._getLastState &&\n                stagedState?.__identifier === identifier\n                ? stagedState.__state\n                : stagedState[identifier];\n            const currentState = this[storeKey]?.getState()[identifier];\n            if (enableAutoFreeze && !Object.isFrozen(currentState)) {\n              return Object.freeze(currentState);\n            }\n            return currentState;\n          },\n        },\n      });\n    }\n    Object.assign(descriptors, {\n      [identifierKey]: {\n        configurable: false,\n        enumerable: false,\n        value: identifier,\n      },\n      [storeKey]: {\n        configurable: false,\n        enumerable: false,\n        get() {\n          return store;\n        },\n      },\n    });\n    Object.defineProperties(service, descriptors);\n    if (Array.isArray(service[subscriptionsKey])) {\n      Array.prototype.push.apply(subscriptions, service[subscriptionsKey]);\n    }\n  });\n  const storeWithRedux = createStoreWithRedux(\n    handleReducers(reducers),\n    preloadedState,\n    reduxEnhancer,\n  );\n  store = {\n    dispatch: storeWithRedux.dispatch,\n    getState: storeWithRedux.getState,\n    subscribe: storeWithRedux.subscribe,\n  };\n  for (const subscribe of subscriptions) {\n    subscribe();\n  }\n  return store as ReduxStore;\n};\n"],"mappings":"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","ignoreList":[]}