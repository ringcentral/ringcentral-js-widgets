{"version":3,"file":"computed.js","names":["computed","depsCallback","target","key","descriptor","process","env","NODE_ENV","get","Error","depsCallbackSelector","createSelectorWithArray","that","storeKey","getState","selector","call"],"sources":["lib/usm-redux/decorators/computed.ts"],"sourcesContent":["import { createSelectorWithArray } from '../utils/index';\nimport { storeKey } from '../constant';\nimport { Service } from '../interface';\n\nexport const computed =\n  (depsCallback: (instance: any) => any[]) =>\n  (target: object, key: string, descriptor: TypedPropertyDescriptor<any>) => {\n    if (process.env.NODE_ENV === 'development') {\n      if (typeof descriptor.get !== 'function') {\n        throw new Error(`'@computed' should decorate a getter.`);\n      }\n      if (typeof depsCallback !== 'function') {\n        throw new Error(\n          `@computed() parameter should be a selector function for dependencies collection.`,\n        );\n      }\n    }\n    const depsCallbackSelector = createSelectorWithArray(\n      // This check will be skipped if the store has not been created yet.\n      (that: Service) => [that[storeKey]?.getState() ?? {}],\n      // eslint-disable-next-line func-names\n      function (this: Service) {\n        return depsCallback(this);\n      },\n    );\n    const selector = createSelectorWithArray(\n      (that: Service) => depsCallbackSelector.call(that),\n      descriptor.get!,\n    );\n    return {\n      ...descriptor,\n      get(this: Service) {\n        return selector.call(this);\n      },\n    };\n  };\n"],"mappings":";;;;;;;;;AAAA;;AACA;;;;;;;;AAGO,IAAMA,QAAQ,GACnB,SADWA,QACX,CAACC,YAAD;EAAA,OACA,UAACC,MAAD,EAAiBC,GAAjB,EAA8BC,UAA9B,EAA2E;IACzE,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;MAC1C,IAAI,OAAOH,UAAU,CAACI,GAAlB,KAA0B,UAA9B,EAA0C;QACxC,MAAM,IAAIC,KAAJ,yCAAN;MACD;;MACD,IAAI,OAAOR,YAAP,KAAwB,UAA5B,EAAwC;QACtC,MAAM,IAAIQ,KAAJ,oFAAN;MAGD;IACF;;IACD,IAAMC,oBAAoB,GAAG,IAAAC,8BAAA,GAC3B;IACA,UAACC,IAAD;MAAA;;MAAA,OAAmB,4CAACA,IAAI,CAACC,kBAAD,CAAL,mDAAC,eAAgBC,QAAhB,EAAD,yEAA+B,EAA/B,CAAnB;IAAA,CAF2B,EAG3B;IACA,YAAyB;MACvB,OAAOb,YAAY,CAAC,IAAD,CAAnB;IACD,CAN0B,CAA7B;IAQA,IAAMc,QAAQ,GAAG,IAAAJ,8BAAA,EACf,UAACC,IAAD;MAAA,OAAmBF,oBAAoB,CAACM,IAArB,CAA0BJ,IAA1B,CAAnB;IAAA,CADe,EAEfR,UAAU,CAACI,GAFI,CAAjB;IAIA,uCACKJ,UADL;MAEEI,GAFF,iBAEqB;QACjB,OAAOO,QAAQ,CAACC,IAAT,CAAc,IAAd,CAAP;MACD;IAJH;EAMD,CA9BD;AAAA,CADK"}