{"version":3,"file":"index.js","names":["DEFAULT_LOCALE","PSEUDO_LOCALE","RUNTIME","locale","defaultLocale","instances","Set","padRatio","fallbackLocale","languageDefaults","setLocale","reloadLocales","i","load","setDefaultLocale","setLanguageDefaults","defaults","checkDefaults","I18n","loadLocale","Error","_loadLocale","_cache","add","data","lang","getLanguageFromLocale","_load","key","Object","prototype","hasOwnProperty","call","toPseudoString","str","_getString","ratio","Number","isNaN","console","log","parseFloat"],"sources":["index.js"],"sourcesContent":["import { getLanguageFromLocale } from './lib/getLanguageFromLocale';\nimport toPseudoString from './lib/toPseudoString';\n\nexport const DEFAULT_LOCALE = 'en-US';\nexport const PSEUDO_LOCALE = 'en-ZZ';\nexport const RUNTIME = {\n  locale: DEFAULT_LOCALE,\n  defaultLocale: DEFAULT_LOCALE,\n  instances: new Set(),\n  padRatio: 0.3,\n  fallbackLocale: DEFAULT_LOCALE,\n  languageDefaults: null,\n};\n\n/**\n * @function\n * @description Set current runtime locale and load the locale files accordingly\n * @param {String} locale - The desired locale.\n * @return Promise<undefined>\n */\nasync function setLocale(locale) {\n  RUNTIME.locale = locale;\n  await reloadLocales();\n}\n\nasync function reloadLocales() {\n  for (const i of RUNTIME.instances) {\n    await i.load();\n  }\n}\n\nasync function setDefaultLocale(locale) {\n  RUNTIME.defaultLocale = locale;\n  await reloadLocales();\n}\n\nasync function setLanguageDefaults(defaults) {\n  RUNTIME.languageDefaults = defaults;\n  await reloadLocales();\n}\n\nfunction checkDefaults(locale) {\n  return (\n    (RUNTIME.languageDefaults && RUNTIME.languageDefaults[locale]) || locale\n  );\n}\n\n/**\n * @class\n * @description I18n is a simple localizations helper class that represents a set of locale files.\n */\nexport default class I18n {\n  /**\n   * @constructor\n   * @description Accepts a loadLocale function that should be async and resolve to the locale\n   *  object when invoked.\n   * @param {String => Promise<Object>} loadLocale - Asynchronous locale loader function.\n   */\n  constructor(loadLocale) {\n    if (typeof loadLocale !== 'function') {\n      throw new Error('loadLocale must be a function');\n    }\n    this._loadLocale = loadLocale;\n    this._cache = {};\n    RUNTIME.instances.add(this);\n    this.load();\n  }\n  async _load(locale) {\n    if (locale !== PSEUDO_LOCALE && !this._cache[locale]) {\n      let data;\n      try {\n        data = await this._loadLocale(locale);\n        if (!data) {\n          const lang = getLanguageFromLocale(locale);\n          if (lang) {\n            data = await this._loadLocale(lang);\n          }\n        }\n      } catch (error) {\n        /* ignore error */\n      }\n      if (!data) {\n        data = {};\n      }\n      this._cache[locale] = data;\n    }\n  }\n  async load() {\n    await this._load(checkDefaults(RUNTIME.fallbackLocale));\n    await this._load(checkDefaults(RUNTIME.defaultLocale));\n    await this._load(checkDefaults(RUNTIME.locale));\n  }\n  _getString(key, locale) {\n    if (\n      this._cache[locale] &&\n      Object.prototype.hasOwnProperty.call(this._cache[locale], key)\n    ) {\n      return this._cache[locale][key];\n    }\n    const lang = getLanguageFromLocale(locale);\n    if (\n      this._cache[lang] &&\n      Object.prototype.hasOwnProperty.call(this._cache[lang], key)\n    ) {\n      return this._cache[lang][key];\n    }\n    if (\n      this._cache[RUNTIME.defaultLocale] &&\n      Object.prototype.hasOwnProperty.call(\n        this._cache[RUNTIME.defaultLocale],\n        key,\n      )\n    ) {\n      return this._cache[RUNTIME.defaultLocale][key];\n    }\n    if (\n      this._cache[RUNTIME.fallbackLocale] &&\n      Object.prototype.hasOwnProperty.call(\n        this._cache[RUNTIME.fallbackLocale],\n        key,\n      )\n    ) {\n      return this._cache[RUNTIME.fallbackLocale][key];\n    }\n\n    return key;\n  }\n  getString(key, locale = RUNTIME.locale) {\n    if (locale === PSEUDO_LOCALE) {\n      return toPseudoString({\n        str: this._getString(key, RUNTIME.fallbackLocale),\n        padRatio: RUNTIME.padRatio,\n      });\n    }\n    return this._getString(key, checkDefaults(locale));\n  }\n\n  static checkDefaults(locale) {\n    return checkDefaults(locale);\n  }\n\n  checkDefaults(locale) {\n    return checkDefaults(locale);\n  }\n\n  get currentLocale() {\n    return RUNTIME.locale;\n  }\n\n  get setLocale() {\n    return setLocale;\n  }\n\n  static get currentLocale() {\n    return RUNTIME.locale;\n  }\n\n  static get setLocale() {\n    return setLocale;\n  }\n\n  static get padRatio() {\n    return RUNTIME.padRatio;\n  }\n\n  static set padRatio(ratio) {\n    if (Number.isNaN(ratio)) {\n      console.log('ratio must be a number');\n      return;\n    }\n    RUNTIME.padRatio = Number.parseFloat(ratio);\n  }\n\n  static setDefaultLocale(locale) {\n    RUNTIME.defaultLocale = locale;\n  }\n\n  static async setDefaultLocale(locale) {\n    return setDefaultLocale(locale);\n  }\n\n  async setDefaultLocale(locale) {\n    return setDefaultLocale(locale);\n  }\n\n  static async setLanguageDefaults(defaults) {\n    return setLanguageDefaults(defaults);\n  }\n\n  async setLanguageDefaults(defaults) {\n    return setLanguageDefaults(defaults);\n  }\n}\n"],"mappings":"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"}