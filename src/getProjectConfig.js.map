{"version":3,"file":"getProjectConfig.js","names":["_getArgs3","require","_cliTable","_interopRequireDefault","_fsExtra","_os","_path","_excluded","e","__esModule","_toConsumableArray","r","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","Symbol","iterator","Array","from","isArray","_arrayLikeToArray","ownKeys","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","_typeof","toPrimitive","call","String","Number","_objectWithoutProperties","_objectWithoutPropertiesLoose","n","indexOf","propertyIsEnumerable","hasOwnProperty","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","a","toString","slice","constructor","name","test","l","u","f","next","done","defaultMode","defaultPort","_getArgs","getArgs","ci","buildEnv","_getArgs$brand","brand","pages","excludePages","getRawProjectConfig","exports","rootPath","undefined","process","cwd","projectConfigPath","path","resolve","projectConfigFileSchema","fs","readJSONSync","getBrands","env","projectConfig","environmentConfig","environment","Error","concat","map","defaultPrint","_projectConfig$useDev","_projectConfig$prefer","_mfeConfig","_getArgs2","buildHash","tag","appMode","table","Table","head","mode","useDevtool","preferredDevtool","JSON","stringify","appConfig","mfeConfig","mainEntries","join","os","EOL","console","log","getProjectConfig","_projectConfigFileSch","_projectConfigFileSch2","_projectConfigFileSch3","_projectConfigFileSch4","_projectConfigFileSch5","print","appConfigPath","getBuildEnv","_environment","brands","config","envConfig","item","_ref","_envConfig$mode","assetsEntries","assets","asset","fromPath","to","relative","includeUpgradePage","main","__dirname","index","includeHiddenDownloadPage","originalPages","page","includes","parse","exit","reduce","acc","curr","entryName","basename","split","distPath","buildPath","themePath","devServerPort","useStyleTransform","runtimeEnvironment","themeSystem","_projectConfigFileSch6"],"sources":["src/getProjectConfig.ts"],"sourcesContent":["/* eslint-disable no-console */\n\n/* eslint-disable @typescript-eslint/no-var-requires */\nimport type {\n  BaseAppConfig,\n  EnvironmentType,\n} from '@ringcentral-integration/next-integration/interfaces';\nimport { getArgs } from '@ringcentral-integration/next-integration/lib/getArgs';\nimport Table from 'cli-table';\nimport fs from 'fs-extra';\nimport os from 'os';\nimport path from 'path';\n\nexport type Mode = 'development' | 'production';\n\nconst defaultMode = 'development';\nconst defaultPort = 8080;\n\nconst {\n  ci,\n  buildEnv,\n  brand: [brand],\n  pages,\n  excludePages,\n} = getArgs();\n\ntype ProjectPages = {\n  /**\n   * html file entry\n   */\n  index?: string;\n  /**\n   * script file entry\n   */\n  main: string;\n  /**\n   * filename for webpack output in `production` mode\n   * https://webpack.js.org/configuration/output/#output-filename\n   *\n   * by default, it will use the `[name].js` of main entry,\n   *\n   * if you have set `index` html page, it will use `[name]-[contenthash].js`\n   *\n   * if you not want default behavior, you can set it manually\n   */\n  filename?: string;\n  /**\n   * some comment for this entry page, like filename reason, use is some where\n   */\n  description?: string;\n  // * more with HtmlWebpackPlugin.Options\n  /**\n   * extra params for HtmlWebpackPlugin of this page entry\n   */\n  params?: {\n    /**\n     * List all entries which should be injected\n     */\n    chunks?: 'all' | string[];\n    /**\n     * List all entries which should not be injected\n     */\n    excludeChunks?: string[];\n  };\n} & { [key: string]: string };\n\ninterface BaseEnvironmentConfig {\n  /**\n   * build mode for webpack\n   * https://webpack.js.org/configuration/mode/\n   */\n  mode: Mode;\n  /**\n   * use devtool for webpack\n   */\n  useDevtool?: boolean;\n  /**\n   * preferred devtool for webpack\n   * https://webpack.js.org/configuration/devtool/\n   */\n  preferredDevtool?: string;\n  /**\n   * enable style transform for shared worker mode\n   */\n  useStyleTransform?: boolean;\n}\n\ninterface EnvironmentConfig extends BaseEnvironmentConfig {\n  /**\n   * brand code\n   */\n  brand: (string | [string, BaseEnvironmentConfig])[];\n}\n\ninterface ProjectConfigFileSchema {\n  /**\n   * build path with webpack\n   * https://webpack.js.org/configuration/output/\n   */\n  buildPath: string;\n  /**\n   * distribution path\n   */\n  distPath?: string;\n  /**\n   * pages for webpack entry config\n   */\n  pages: ProjectPages[];\n  /**\n   * chunk filename for webpack, in `production` mode\n   *\n   * This option determines the name of non-initial chunk files.\n   *\n   * @default \"[id]-[contenthash].js\"\n   *\n   * you can use map to set different chunk filename for different files\n   * @example\n   * ```json\n   * \"chunkFilenames\": {\n   *   \"worker\": \"[name].js\",\n   *   \"dynamic\": \"[name]-[contenthash].js\"\n   *   \"vendor\": \"[name]-[contenthash].js\" // all vendor will use this filename\n   * }\n   * ```\n   *\n   * https://webpack.js.org/configuration/output/#outputchunkfilename\n   */\n  chunkFilenames?: string | Record<string, string>;\n  /**\n   * assets path for webpack copy plugin\n   */\n  assets?: (string | { from: string; to: string })[];\n  /**\n   * environment config with build mode and brand\n   */\n  environment: Record<EnvironmentType, EnvironmentConfig>;\n  /**\n   * app config path\n   */\n  appConfigPath: string;\n  /**\n   * theme path\n   */\n  themePath?: string;\n  /**\n   * dev server port for webpack dev server\n   * https://webpack.js.org/configuration/dev-server/\n   */\n  devServerPort: number;\n  /**\n   * runtime environment\n   *\n   * - `web` for web application\n   * - `extension` for extension application\n   *\n   * @default web\n   */\n  runtimeEnvironment?: 'web' | 'extension';\n  /**\n   * by default, our builder will split chunks for all entries `node_modules` and `ringcentral-js-widgets`, to ensure file size is smaller than 10MB\n   *\n   * if you not want that behavior, you can set `disabledAutoSplitChunks` to `true`\n   *\n   * @default false\n   */\n  disabledAutoSplitChunks?: boolean;\n  /**\n   * include upgrade page\n   *\n   * file name: `{host_domain}/upgrade.html`\n   *\n   * enable this will include upgrade page in final build folder,\n   * then you can use it when your iframe app need user reload page manually\n   *\n   * @example\n   * ```ts\n   * location.href = 'https://your-app.com/upgrade.html'\n   * ```\n   */\n  includeUpgradePage?: boolean;\n  /**\n   * include hidden-download page\n   *\n   * file name: `{host_domain}/hidden-download.html`\n   *\n   * enable this will include hidden-download page in final build folder,\n   * then you can `downloadFileWithIframeCors` when you need download file in hidden way but need to avoid same origin policy\n   *\n   * @example\n   * ```ts\n   * location.href = 'https://your-app.com/hidden-download.html'\n   * ```\n   */\n  includeHiddenDownloadPage?: boolean;\n  /**\n   * which styled system to use\n   *\n   * @default 'juno'\n   */\n  themeSystem?: 'juno' | 'spring-ui';\n}\n\nexport type ProjectConfig<T = BaseAppConfig> = {\n  env: string;\n  brand: string;\n  projectConfig: ProjectConfigFileSchema;\n  assetsEntries?: {\n    from: string;\n    to: string;\n  }[];\n  mainEntries: {\n    [key: string]: string;\n  };\n  buildPath: string;\n  distPath?: string;\n  appConfig: T;\n  mode: Mode;\n  rootPath: string;\n  themePath: string;\n  devServerPort: number;\n  /**\n   * use devtool for webpack\n   */\n  useDevtool?: boolean;\n  /**\n   * preferred devtool for webpack\n   */\n  preferredDevtool?: string;\n  /**\n   * analyze bundle with webpack-bundle-analyzer\n   */\n  analyzeBundle?: boolean;\n  /**\n   * enable style transform for shared worker mode\n   */\n  useStyleTransform?: boolean;\n} & Pick<ProjectConfigFileSchema, 'runtimeEnvironment' | 'themeSystem'>;\n\nexport const getRawProjectConfig = (rootPath = process.cwd()) => {\n  const projectConfigPath = path.resolve(rootPath, './project.config.json');\n  const projectConfigFileSchema: ProjectConfigFileSchema =\n    fs.readJSONSync(projectConfigPath);\n  return projectConfigFileSchema;\n};\n\nexport const getBrands = (env: string) => {\n  const projectConfig = getRawProjectConfig();\n  const environmentConfig = projectConfig.environment[env as EnvironmentType];\n  if (!environmentConfig) {\n    throw new Error(`There is no config with \"${env}\" environment`);\n  }\n  return environmentConfig.brand.map((brand) =>\n    Array.isArray(brand) ? brand[0] : brand,\n  );\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst defaultPrint = (projectConfig: ProjectConfig<any>) => {\n  const { ci, buildHash, tag, brand, buildEnv, appMode } = getArgs();\n  const table = new Table({\n    head: ['Config', 'Value', 'Type'],\n  });\n\n  table.push(\n    ['Build Environment', `${buildEnv}`, `string (optional, default: 'dev')`],\n    ['Brand', `${brand}`, `string (optional, default: 'rc')`],\n    ['CI', `${ci}`, 'boolean (optional, default: false)'],\n    ['Build Hash', `${buildHash}`, `string (optional, default: '')`],\n    ['Tag', `${tag}`, `string (optional, default: '')`],\n    ['Build Mode', `${projectConfig.mode}`, `'development' | 'production'`],\n    ['App Mode', `${appMode}`, `string (optional)`],\n    [\n      'Use Devtool',\n      `${projectConfig.useDevtool ?? ''}`,\n      `boolean (optional, default: false)`,\n    ],\n    [\n      'Preferred Devtool',\n      `${projectConfig.preferredDevtool ?? ''}`,\n      `string (optional)`,\n    ],\n    [\n      'MFE Config',\n      `${\n        getArgs().env === 'mfe'\n          ? JSON.stringify(\n              (projectConfig.appConfig as BaseAppConfig).mfeConfig ?? '',\n              null,\n              2,\n            )\n          : ''\n      }`,\n      `object (default: '')`,\n    ],\n    ['Entries', `${Object.keys(projectConfig.mainEntries).join(os.EOL)}`, ``],\n  );\n  console.log(`${os.EOL}${table.toString()}${os.EOL}`);\n};\n\n/**\n * get project configuration from project.config.json\n * @param rootPath folder root path\n * @param print print function for custom print\n * @returns\n */\nexport const getProjectConfig = <T = BaseAppConfig>(\n  rootPath = process.cwd(),\n  print: false | ((config: ProjectConfig<T>) => void) = defaultPrint,\n): ProjectConfig<T> => {\n  const projectConfigFileSchema = getRawProjectConfig(rootPath);\n  const appConfigPath = path.resolve(\n    rootPath,\n    projectConfigFileSchema.appConfigPath ?? './config',\n  );\n  const appConfig = require(appConfigPath).appConfig as T;\n  if (!appConfig) {\n    throw new Error(`appConfig is not defined in ${appConfigPath}`);\n  }\n  const environment = getBuildEnv(projectConfigFileSchema);\n  const { brand: brands, ...config } = environment[buildEnv as EnvironmentType];\n  const envConfig = brands\n    .map((item) => ({\n      brand: Array.isArray(item) ? item[0] : item,\n      ...config,\n      ...(Array.isArray(item) ? item[1] : {}),\n      mode: (Array.isArray(item) ? item[1].mode : config.mode) ?? defaultMode,\n    }))\n    .filter((item) => item.brand === brand)[0];\n\n  if (!envConfig) {\n    throw new Error(`brand '${brand}' is not defined in env '${buildEnv}'`);\n  }\n\n  const { mode = defaultMode } = envConfig;\n\n  const assetsEntries = projectConfigFileSchema.assets?.map((asset) => {\n    if (typeof asset === 'string') {\n      const fromPath = path.join(rootPath, asset);\n\n      return {\n        from: fromPath,\n        to: path.relative(path.join(rootPath, 'src'), fromPath),\n      };\n    }\n\n    const fromPath = path.join(rootPath, asset.from);\n\n    return {\n      from: fromPath,\n      to: asset.to,\n    };\n  });\n\n  projectConfigFileSchema.pages.push(\n    ...(projectConfigFileSchema.includeUpgradePage\n      ? [\n          {\n            main: path.join(__dirname, 'templates/upgrade/upgrade.ts'),\n            index: path.join(__dirname, 'templates/upgrade/upgrade.html'),\n          },\n        ]\n      : []),\n    ...(projectConfigFileSchema.includeHiddenDownloadPage\n      ? [\n          {\n            main: path.join(\n              __dirname,\n              'templates/hidden-download/hidden-download.ts',\n            ),\n            index: path.join(\n              __dirname,\n              'templates/hidden-download/hidden-download.html',\n            ),\n          },\n        ]\n      : []),\n  );\n\n  // when pages is set, only include the pages in the list\n  if (pages && pages.length > 0) {\n    const originalPages = projectConfigFileSchema.pages;\n    projectConfigFileSchema.pages = originalPages.filter((page) =>\n      pages.includes(path.parse(page.main).name),\n    );\n\n    if (projectConfigFileSchema.pages.length !== pages.length) {\n      console.log(\n        `\nSome pages not found in project.config.json:\nyour input page: ${pages.join(', ')}\n\npages list: ${originalPages\n          .map((page) => path.parse(page.main).name)\n          .join(', ')}\n`,\n      );\n\n      process.exit(1);\n    }\n  }\n\n  if (excludePages && excludePages.length > 0) {\n    projectConfigFileSchema.pages = projectConfigFileSchema.pages.filter(\n      (page) => !excludePages.includes(path.parse(page.main).name),\n    );\n  }\n\n  const mainEntries = projectConfigFileSchema.pages.reduce((acc, curr) => {\n    const entryName = path\n      .basename(curr.main)\n      .split('.')\n      .slice(0, -1)\n      .join('.');\n\n    acc[entryName] = path.resolve(rootPath, curr.main);\n\n    return acc;\n  }, {} as { [key: string]: string });\n\n  const distPath = projectConfigFileSchema.distPath\n    ? path.resolve(rootPath, projectConfigFileSchema.distPath)\n    : undefined;\n  const buildPath = path.resolve(rootPath, projectConfigFileSchema.buildPath);\n  const themePath = path.resolve(\n    rootPath,\n    projectConfigFileSchema.themePath ?? '.',\n  );\n  const projectConfig: ProjectConfig<T> = {\n    env: buildEnv,\n    brand,\n    projectConfig: projectConfigFileSchema,\n    assetsEntries,\n    mainEntries,\n    distPath,\n    buildPath,\n    appConfig,\n    mode: ci ? defaultMode : mode,\n    devServerPort: projectConfigFileSchema.devServerPort ?? defaultPort,\n    rootPath,\n    themePath,\n    preferredDevtool: envConfig.preferredDevtool,\n    useDevtool: envConfig.useDevtool,\n    useStyleTransform: envConfig.useStyleTransform,\n    runtimeEnvironment: projectConfigFileSchema.runtimeEnvironment,\n    themeSystem: projectConfigFileSchema.themeSystem,\n  };\n\n  if (print) {\n    print(projectConfig);\n  }\n  return projectConfig;\n};\n\nexport function getBuildEnv(projectConfigFileSchema: ProjectConfigFileSchema) {\n  const environment = projectConfigFileSchema.environment ?? {};\n  if (!environment[buildEnv as EnvironmentType]) {\n    throw new Error(\n      `env '${buildEnv}' is not defined in environment '${JSON.stringify(\n        environment,\n        null,\n        2,\n      )}'`,\n    );\n  }\n  return environment;\n}\n"],"mappings":"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","ignoreList":[]}