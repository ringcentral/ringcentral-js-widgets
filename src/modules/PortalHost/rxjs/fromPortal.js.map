{"version":3,"file":"fromPortal.js","names":["_rxjs","require","fromPortal","exports","instanceFn","Observable","subscribe","_instanceFn","closed","close","innerClose","then","result","next","complete"],"sources":["src/modules/PortalHost/rxjs/fromPortal.ts"],"sourcesContent":["import { Observable } from 'rxjs';\n\nimport type {\n  PortalHostResolveData,\n  PortalInstance,\n} from '../PortalHost.interface';\n\n/**\n * flow way usage API, subscribe will exec portal open API,\n * when unsubscribe will auto close portal.\n *\n * @example\n * ```\n * fromPortal(() => this._modalView.open(this.confirmModal))\n * .pipe(\n *   answer({\n *     confirm: () =>\n *       of('confirm').pipe(\n *         tap(() => {\n *           // when confirm will auto switch to another flow\n *         }),\n *       ),\n *     cancel: () => {\n *       // also can do some thing without observable\n *     },\n *   }),\n *   tap((x) => {\n *     console.log(x); // x will be that original window confirm\n *   })\n * )\n * .subscribe();\n * ```\n */\nexport const fromPortal = (instanceFn: () => PortalInstance) =>\n  new Observable<PortalHostResolveData>((subscribe) => {\n    const { closed, close } = instanceFn();\n\n    let innerClose = false;\n\n    closed.then((result) => {\n      subscribe.next(result);\n      innerClose = true;\n      subscribe.complete();\n    });\n\n    return () => {\n      if (innerClose) return;\n\n      close();\n    };\n  });\n"],"mappings":";;;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,IAAMC,UAAU,GAAAC,OAAA,CAAAD,UAAA,GAAG,SAAbA,UAAUA,CAAIE,UAAgC;EAAA,OACzD,IAAIC,gBAAU,CAAwB,UAACC,SAAS,EAAK;IACnD,IAAAC,WAAA,GAA0BH,UAAU,CAAC,CAAC;MAA9BI,MAAM,GAAAD,WAAA,CAANC,MAAM;MAAEC,KAAK,GAAAF,WAAA,CAALE,KAAK;IAErB,IAAIC,UAAU,GAAG,KAAK;IAEtBF,MAAM,CAACG,IAAI,CAAC,UAACC,MAAM,EAAK;MACtBN,SAAS,CAACO,IAAI,CAACD,MAAM,CAAC;MACtBF,UAAU,GAAG,IAAI;MACjBJ,SAAS,CAACQ,QAAQ,CAAC,CAAC;IACtB,CAAC,CAAC;IAEF,OAAO,YAAM;MACX,IAAIJ,UAAU,EAAE;MAEhBD,KAAK,CAAC,CAAC;IACT,CAAC;EACH,CAAC,CAAC;AAAA","ignoreList":[]}