{"version":3,"file":"DehydratedPortal.js","names":["DehydratedPortal","exports","options","defaultProps","arguments","length","undefined","_classCallCheck","type","payload","_handlerRegister","Map","_createClass","key","get","value","getDehydrateState","id","props","getProps","dehydratedState","_dehydrateFunctions","_objectSpread","_this$options$props","_this$options","originalProps","call","processedProps","Object","entries","reduce","acc","_ref","_key","_ref2","_slicedToArray","getPureProps","currentModalProps","_ref3","_ref4","result","prototype","hasOwnProperty","handlerRegister","set"],"sources":["src/modules/PortalHost/utils/DehydratedPortal.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport type DehydratedPortalOptions<\n  Props extends Record<string, any>,\n  PayLoad extends Record<string, any>,\n> = {\n  props?: (payload: PayLoad) => Props;\n  payload?: () => Record<string, any>;\n};\n\n/**\n * dehydrated function to string with key value `Map<string, HandlerFunction>`\n * provide you a way to trigger event through different runtime instance, like multiple tabs.\n *\n * @example\n * // execute below in different runtime.\n * ```ts\n * type CustomData = {\n *   text: string;\n * }\n * type CustomDehydratedPortalOptions = DehydratedPortalOptions<{\n *   example: string;\n *   onClick: () => void;\n *   value?: string;\n * }, CustomData>\n *\n * const modalInstance = new DehydratedPortal<CustomDehydratedPortalOptions, CustomData>(\n *   {\n *     id: 'uniqueId'\n *     props: ({ text }) => ({\n *       example: `example ${text}`,\n *       onClick: () => {\n *         console.log('ðŸ§™ click');\n *       }\n *     })\n *   },\n *   {\n *     value: 'example'\n *   },\n * );\n *\n * modalInstance.open({\n * })\n * console.log(modalInstance.props);\n * // {\n * //    example: 'example',\n * //    onClick: 'onClick',\n * //    value: 'example', // default value will be add into props state\n * // }\n *\n * const modalSet = new Map<string, DehydratedPortal>();\n *\n * modalSet.set(id, modalInstance);\n * ```\n * // Then in another runtime can run the same unique id with event key name\n * ```ts\n * modalSet.get('uniqueId').handlerRegister['onClick'] // log => 'ðŸ§™ click'\n * ```\n */\nexport class DehydratedPortal<\n  Options extends DehydratedPortalOptions<any, Payload>,\n  Payload extends Record<string, any> = Record<string, any>,\n  Props = ReturnType<NonNullable<Options['props']>>,\n> {\n  /**\n   * that unique type in whole dehydrated portal system, like `AppView.confirm`\n   */\n  type!: string;\n\n  /**\n   * for type getter only,\n   */\n  readonly payload!: Payload;\n  /**\n   * register method Map\n   */\n  get handlerRegister(): Map<string, (...args: any) => any> {\n    return this._handlerRegister;\n  }\n\n  private _handlerRegister = new Map<string, (...args: any) => any>();\n\n  constructor(\n    public options: Options & DehydratedPortalOptions<any, Payload>,\n    private defaultProps: Partial<Props> = {},\n  ) {}\n\n  /**\n   * @private should not use that directly\n   */\n  getDehydrateState(id: string, payload: Payload) {\n    const props = this.getProps(payload);\n\n    const dehydratedState = this._dehydrateFunctions({\n      ...props,\n      id,\n    });\n\n    return dehydratedState;\n  }\n\n  /**\n   * @private should not use that directly\n   */\n  getProps(payload: Payload): Props {\n    const originalProps = this.options.props?.(payload) || {};\n\n    // apply default props\n    const processedProps = Object.entries(this.defaultProps).reduce(\n      (acc, [key, value]) => {\n        acc[key] = (originalProps as any)[key] ?? value;\n        return acc;\n      },\n      {} as any,\n    );\n\n    return {\n      ...originalProps,\n      ...processedProps,\n    };\n  }\n\n  /**\n   * @private should not use that directly\n   */\n  getPureProps(payload: Payload) {\n    const currentModalProps = this.getProps(payload);\n\n    return Object.entries(currentModalProps as any).reduce(\n      (acc, [key, value]) => {\n        if (typeof value !== 'function') {\n          (acc as any)[key] = value;\n        }\n        return acc;\n      },\n      {} as Props,\n    );\n  }\n\n  /**\n   * @private should not use that directly\n   */\n  private _dehydrateFunctions(props: any): Record<string, any> {\n    const result = { ...props };\n\n    for (const key in props) {\n      if (\n        Object.prototype.hasOwnProperty.call(props, key) &&\n        typeof props[key] === 'function'\n      ) {\n        this.handlerRegister.set(key, props[key]);\n        result[key] = key;\n      }\n    }\n\n    return result;\n  }\n}\n"],"mappings":"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","ignoreList":[]}