{"version":3,"file":"getTiffInfo.js","names":["_memoize","_interopRequireDefault","require","UTIF","_interopRequireWildcard","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t2","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_regenerator","Symbol","iterator","toStringTag","c","prototype","Generator","u","create","_regeneratorDefine2","p","y","G","v","a","d","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","displayName","w","m","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","getTiffInfo","exports","_ref","_callee","tiffUrl","response","buffer","ifdList","firstImage","rgba","width","height","_context","fetch","arrayBuffer","decode","decodeImage","toRGBA8","Math","floor","Error","concat","_x","tiffInfoCache","memoize","url","Date","toISOString","split","getTiffInfoWithCache","_ref2","_callee2","_t","_context2","console","error","_x2"],"sources":["src/utils/getTiffInfo.ts"],"sourcesContent":["import memoize from 'lodash/memoize';\nimport * as UTIF from 'utif';\n\n/**\n * Asynchronously fetches a TIFF image from the provided URL, decodes it, and extracts its width, height, and RGBA data.\n *\n * @param {string} tiffUrl - The URL of the TIFF image to fetch and decode.\n * An object containing the width, height, and RGBA data of the decoded TIFF image, or undefined if an error occurs.\n *\n * @throws {Error} If the RGBA data length is invalid.\n */\nexport const getTiffInfo = async (tiffUrl: string) => {\n  const response = await fetch(tiffUrl);\n  const buffer = await response.arrayBuffer();\n\n  const ifdList = UTIF.decode(buffer);\n  const firstImage = ifdList[0];\n  UTIF.decodeImage(buffer, firstImage);\n\n  const rgba = UTIF.toRGBA8(firstImage);\n\n  const width = Math.floor(firstImage.width);\n  const height = Math.floor(firstImage.height);\n\n  // Validate the size of the RGBA array\n  if (rgba.length !== width * height * 4) {\n    throw new Error(\n      `Invalid RGBA data length: expected ${width * height * 4}, got ${\n        rgba.length\n      }`,\n    );\n  }\n\n  return { width, height, rgba };\n};\n\nexport const tiffInfoCache = memoize(\n  getTiffInfo,\n  // refetch one day again\n  (url) => `${url}_${new Date().toISOString().split('T')[0]}`,\n);\n\n/**\n * Same as `getTiffInfo`, but with caching based on the URL within same date.\n *\n * like get in 2024-09-02, will not refetch in this day, if that is already fetch successfully.\n */\nexport const getTiffInfoWithCache = async (tiffUrl: string) => {\n  try {\n    return await tiffInfoCache(tiffUrl);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Error loading or rendering TIFF:', error);\n  }\n};\n"],"mappings":"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","ignoreList":[]}