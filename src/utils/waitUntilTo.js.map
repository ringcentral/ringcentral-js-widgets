{"version":3,"file":"waitUntilTo.js","names":["_waitUntil","require","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","waitUntilTo","fn","_ref","length","undefined","_ref$interval","interval","_ref$timeout","timeout","rejector","resolver","waitUntilPromise","promise","_ref2","regeneratorRuntime","mark","_callee2","reject","lastError","callback","wrap","_callee2$","_context2","prev","next","_ref3","_callee","result","_callee$","_context","sent","abrupt","t0","stop","waitUntil","_x","_x2","cancel","disabledThrow","Error","exports"],"sources":["src/utils/waitUntilTo.ts"],"sourcesContent":["import type { WaitUntilOption } from './waitUntil';\nimport { waitUntil } from './waitUntil';\n\nexport interface WaitUntilToPromise<T> extends Promise<T> {\n  /** cancel wailUntilTo timer */\n  cancel: (\n    /**\n     * by default, cancel will throw error, if you don't want to throw error, set `true`\n     * @default false\n     */\n    disabledThrow?: boolean,\n  ) => void;\n}\n\n/**\n * like `waitUntil`, but polling check `fn` execute without throw error,\n * and throw latest error when timeout.\n *\n * @returns `callback` result when callback execute completed.\n */\nexport const waitUntilTo = <T = any>(\n  fn: () => T,\n  { interval = 100, timeout = 5000 }: WaitUntilOption = {},\n): WaitUntilToPromise<T> => {\n  let rejector: (reason?: any) => void;\n  let resolver: (value: T) => void;\n  let waitUntilPromise: ReturnType<typeof waitUntil>;\n\n  // eslint-disable-next-line no-async-promise-executor\n  const promise = new Promise<T>(async (resolve, reject) => {\n    let lastError: any;\n    rejector = reject;\n    resolver = resolve;\n\n    const callback = async () => {\n      try {\n        const result = await fn();\n\n        resolve(result);\n\n        return true;\n      } catch (e) {\n        lastError = e;\n        return false;\n      }\n    };\n\n    waitUntilPromise = waitUntil(callback, { interval, timeout });\n\n    try {\n      await waitUntilPromise;\n    } catch (e) {\n      reject(lastError);\n    }\n  }) as WaitUntilToPromise<T>;\n\n  promise.cancel = (disabledThrow = false) => {\n    if (disabledThrow) {\n      resolver(undefined as any);\n    } else {\n      rejector(new Error('Async waitUntilTo has been cancelled'));\n    }\n    waitUntilPromise.cancel();\n  };\n\n  return promise;\n};\n"],"mappings":"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","ignoreList":[]}