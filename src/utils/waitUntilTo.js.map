{"version":3,"file":"waitUntilTo.js","names":["waitUntilTo","fn","interval","timeout","rejector","waitUntilPromise","promise","Promise","resolve","reject","callback","result","lastError","waitUntil","cancel","Error"],"sources":["src/utils/waitUntilTo.ts"],"sourcesContent":["import { waitUntil, WaitUntilOption } from './waitUntil';\n\nexport interface WaitUntilToPromise<T> extends Promise<T> {\n  /** cancel wailUntilTo timer */\n  cancel: () => void;\n}\n\n/**\n * like `waitUntil`, but polling check `fn` execute without throw error,\n * and throw latest error when timeout.\n *\n * @returns `callback` result when callback execute completed.\n */\nexport const waitUntilTo = <T = any>(\n  fn: () => T,\n  { interval = 100, timeout = 5000 }: WaitUntilOption = {},\n): WaitUntilToPromise<T> => {\n  let rejector: (reason?: any) => void;\n  let waitUntilPromise: ReturnType<typeof waitUntil>;\n\n  // eslint-disable-next-line no-async-promise-executor\n  const promise = new Promise<T>(async (resolve, reject) => {\n    let lastError: any;\n    rejector = reject;\n\n    const callback = async () => {\n      try {\n        const result = await fn();\n\n        resolve(result);\n\n        return true;\n      } catch (e) {\n        lastError = e;\n        return false;\n      }\n    };\n\n    waitUntilPromise = waitUntil(callback, { interval, timeout });\n\n    try {\n      await waitUntilPromise;\n    } catch (e) {\n      reject(lastError);\n    }\n  }) as WaitUntilToPromise<T>;\n\n  promise.cancel = () => {\n    rejector(new Error('Async waitUntilTo has been cancelled'));\n    waitUntilPromise.cancel();\n  };\n\n  return promise;\n};\n"],"mappings":";;;;;;;;;;;;;AAAA;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACO,IAAMA,WAAW,GAAG,SAAdA,WAAc,CACzBC,EADyB,EAGC;EAAA,+EAD4B,EAC5B;EAAA,yBADxBC,QACwB;EAAA,IADxBA,QACwB,8BADb,GACa;EAAA,wBADRC,OACQ;EAAA,IADRA,OACQ,6BADE,IACF;;EAC1B,IAAIC,QAAJ;EACA,IAAIC,gBAAJ,CAF0B,CAI1B;;EACA,IAAMC,OAAO,GAAG,IAAIC,OAAJ;IAAA,oEAAe,kBAAOC,OAAP,EAAgBC,MAAhB;MAAA;MAAA;QAAA;UAAA;YAAA;cAE7BL,QAAQ,GAAGK,MAAX;;cAEMC,QAJuB;gBAAA,oEAIZ;kBAAA;kBAAA;oBAAA;sBAAA;wBAAA;0BAAA;0BAAA;0BAAA,OAEQT,EAAE,EAFV;;wBAAA;0BAEPU,MAFO;0BAIbH,OAAO,CAACG,MAAD,CAAP;0BAJa,iCAMN,IANM;;wBAAA;0BAAA;0BAAA;0BAQbC,SAAS,cAAT;0BARa,iCASN,KATM;;wBAAA;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA;gBAAA,CAJY;;gBAAA,gBAIvBF,QAJuB;kBAAA;gBAAA;cAAA;;cAiB7BL,gBAAgB,GAAG,IAAAQ,oBAAA,EAAUH,QAAV,EAAoB;gBAAER,QAAQ,EAARA,QAAF;gBAAYC,OAAO,EAAPA;cAAZ,CAApB,CAAnB;cAjB6B;cAAA;cAAA,OAoBrBE,gBApBqB;;YAAA;cAAA;cAAA;;YAAA;cAAA;cAAA;cAsB3BI,MAAM,CAACG,SAAD,CAAN;;YAtB2B;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAf;;IAAA;MAAA;IAAA;EAAA,IAAhB;;EA0BAN,OAAO,CAACQ,MAAR,GAAiB,YAAM;IACrBV,QAAQ,CAAC,IAAIW,KAAJ,CAAU,sCAAV,CAAD,CAAR;IACAV,gBAAgB,CAACS,MAAjB;EACD,CAHD;;EAKA,OAAOR,OAAP;AACD,CAxCM"}