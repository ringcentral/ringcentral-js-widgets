{"version":3,"file":"waitUntilTo.js","names":["_waitUntil","require","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","waitUntilTo","_ref","length","_ref$interval","interval","_ref$timeout","timeout","rejector","waitUntilPromise","promise","_ref2","regeneratorRuntime","mark","_callee2","lastError","callback","wrap","_callee2$","_context2","prev","next","_ref3","_callee","result","_callee$","_context","sent","abrupt","t0","stop","waitUntil","_x","_x2","cancel","Error","exports"],"sources":["src/utils/waitUntilTo.ts"],"sourcesContent":["import type { WaitUntilOption } from './waitUntil';\nimport { waitUntil } from './waitUntil';\n\nexport interface WaitUntilToPromise<T> extends Promise<T> {\n  /** cancel wailUntilTo timer */\n  cancel: () => void;\n}\n\n/**\n * like `waitUntil`, but polling check `fn` execute without throw error,\n * and throw latest error when timeout.\n *\n * @returns `callback` result when callback execute completed.\n */\nexport const waitUntilTo = <T = any>(\n  fn: () => T,\n  { interval = 100, timeout = 5000 }: WaitUntilOption = {},\n): WaitUntilToPromise<T> => {\n  let rejector: (reason?: any) => void;\n  let waitUntilPromise: ReturnType<typeof waitUntil>;\n\n  // eslint-disable-next-line no-async-promise-executor\n  const promise = new Promise<T>(async (resolve, reject) => {\n    let lastError: any;\n    rejector = reject;\n\n    const callback = async () => {\n      try {\n        const result = await fn();\n\n        resolve(result);\n\n        return true;\n      } catch (e) {\n        lastError = e;\n        return false;\n      }\n    };\n\n    waitUntilPromise = waitUntil(callback, { interval, timeout });\n\n    try {\n      await waitUntilPromise;\n    } catch (e) {\n      reject(lastError);\n    }\n  }) as WaitUntilToPromise<T>;\n\n  promise.cancel = () => {\n    rejector(new Error('Async waitUntilTo has been cancelled'));\n    waitUntilPromise.cancel();\n  };\n\n  return promise;\n};\n"],"mappings":";;;;;;;;;AACA,IAAAA,UAAA,GAAAC,OAAA;AAAwC,SAAAC,mBAAAC,GAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,MAAA,EAAAC,GAAA,EAAAC,GAAA,cAAAC,IAAA,GAAAP,GAAA,CAAAK,GAAA,EAAAC,GAAA,OAAAE,KAAA,GAAAD,IAAA,CAAAC,KAAA,WAAAC,KAAA,IAAAP,MAAA,CAAAO,KAAA,iBAAAF,IAAA,CAAAG,IAAA,IAAAT,OAAA,CAAAO,KAAA,YAAAG,OAAA,CAAAV,OAAA,CAAAO,KAAA,EAAAI,IAAA,CAAAT,KAAA,EAAAC,MAAA;AAAA,SAAAS,kBAAAC,EAAA,6BAAAC,IAAA,SAAAC,IAAA,GAAAC,SAAA,aAAAN,OAAA,WAAAV,OAAA,EAAAC,MAAA,QAAAF,GAAA,GAAAc,EAAA,CAAAI,KAAA,CAAAH,IAAA,EAAAC,IAAA,YAAAb,MAAAK,KAAA,IAAAT,kBAAA,CAAAC,GAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,MAAA,UAAAI,KAAA,cAAAJ,OAAAe,GAAA,IAAApB,kBAAA,CAAAC,GAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,MAAA,WAAAe,GAAA,KAAAhB,KAAA,CAAAiB,SAAA;AAOxC;AACA;AACA;AACA;AACA;AACA;AACO,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CACtBP,EAAW,EAEe;EAAA,IAAAQ,IAAA,GAAAL,SAAA,CAAAM,MAAA,QAAAN,SAAA,QAAAG,SAAA,GAAAH,SAAA,MAD4B,CAAC,CAAC;IAAAO,aAAA,GAAAF,IAAA,CAAtDG,QAAQ;IAARA,QAAQ,GAAAD,aAAA,cAAG,GAAG,GAAAA,aAAA;IAAAE,YAAA,GAAAJ,IAAA,CAAEK,OAAO;IAAPA,OAAO,GAAAD,YAAA,cAAG,IAAI,GAAAA,YAAA;EAEhC,IAAIE,QAAgC;EACpC,IAAIC,gBAA8C;;EAElD;EACA,IAAMC,OAAO,GAAG,IAAInB,OAAO;IAAA,IAAAoB,KAAA,GAAAlB,iBAAA,eAAAmB,kBAAA,CAAAC,IAAA,CAAI,SAAAC,SAAOjC,OAAO,EAAEC,MAAM;MAAA,IAAAiC,SAAA,EAAAC,QAAA;MAAA,OAAAJ,kBAAA,CAAAK,IAAA,UAAAC,UAAAC,SAAA;QAAA;UAAA,QAAAA,SAAA,CAAAC,IAAA,GAAAD,SAAA,CAAAE,IAAA;YAAA;cAEnDb,QAAQ,GAAG1B,MAAM;cAEXkC,QAAQ;gBAAA,IAAAM,KAAA,GAAA7B,iBAAA,eAAAmB,kBAAA,CAAAC,IAAA,CAAG,SAAAU,QAAA;kBAAA,IAAAC,MAAA;kBAAA,OAAAZ,kBAAA,CAAAK,IAAA,UAAAQ,SAAAC,QAAA;oBAAA;sBAAA,QAAAA,QAAA,CAAAN,IAAA,GAAAM,QAAA,CAAAL,IAAA;wBAAA;0BAAAK,QAAA,CAAAN,IAAA;0BAAAM,QAAA,CAAAL,IAAA;0BAAA,OAEQ3B,EAAE,CAAC,CAAC;wBAAA;0BAAnB8B,MAAM,GAAAE,QAAA,CAAAC,IAAA;0BAEZ9C,OAAO,CAAC2C,MAAM,CAAC;0BAAC,OAAAE,QAAA,CAAAE,MAAA,WAET,IAAI;wBAAA;0BAAAF,QAAA,CAAAN,IAAA;0BAAAM,QAAA,CAAAG,EAAA,GAAAH,QAAA;0BAEXX,SAAS,GAAAW,QAAA,CAAAG,EAAI;0BAAC,OAAAH,QAAA,CAAAE,MAAA,WACP,KAAK;wBAAA;wBAAA;0BAAA,OAAAF,QAAA,CAAAI,IAAA;sBAAA;oBAAA;kBAAA,GAAAP,OAAA;gBAAA,CAEf;gBAAA,gBAXKP,QAAQA,CAAA;kBAAA,OAAAM,KAAA,CAAAxB,KAAA,OAAAD,SAAA;gBAAA;cAAA;cAadY,gBAAgB,GAAG,IAAAsB,oBAAS,EAACf,QAAQ,EAAE;gBAAEX,QAAQ,EAARA,QAAQ;gBAAEE,OAAO,EAAPA;cAAQ,CAAC,CAAC;cAACY,SAAA,CAAAC,IAAA;cAAAD,SAAA,CAAAE,IAAA;cAAA,OAGtDZ,gBAAgB;YAAA;cAAAU,SAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,SAAA,CAAAC,IAAA;cAAAD,SAAA,CAAAU,EAAA,GAAAV,SAAA;cAEtBrC,MAAM,CAACiC,SAAS,CAAC;YAAC;YAAA;cAAA,OAAAI,SAAA,CAAAW,IAAA;UAAA;QAAA;MAAA,GAAAhB,QAAA;IAAA,CAErB;IAAA,iBAAAkB,EAAA,EAAAC,GAAA;MAAA,OAAAtB,KAAA,CAAAb,KAAA,OAAAD,SAAA;IAAA;EAAA,IAA0B;EAE3Ba,OAAO,CAACwB,MAAM,GAAG,YAAM;IACrB1B,QAAQ,CAAC,IAAI2B,KAAK,CAAC,sCAAsC,CAAC,CAAC;IAC3D1B,gBAAgB,CAACyB,MAAM,CAAC,CAAC;EAC3B,CAAC;EAED,OAAOxB,OAAO;AAChB,CAAC;AAAC0B,OAAA,CAAAnC,WAAA,GAAAA,WAAA"}