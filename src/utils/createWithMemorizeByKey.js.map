{"version":3,"file":"createWithMemorizeByKey.js","names":["_memoize","_interopRequireDefault","require","e","__esModule","_regenerator","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","createWithMemorizeByKey","exports","withMemorizeByKey","memoize","cb","_cacheKey","_","cacheKey","toWithMemorizeByKey","get","_withMemorizeByKey$ca","_withMemorizeByKey$ca2","_withMemorizeByKey$ca3","cache","__data__","string","_value","_callee","_withMemorizeByKey$ca4","_withMemorizeByKey$ca5","cachedMap","_i","_Object$values","_value2","_context","values","clear","_x","createWithLocalCache","localCache","Map","withLocalCache","_ref","_callee2","promise","result","_context2","set","_x2","_x3"],"sources":["src/utils/createWithMemorizeByKey.ts"],"sourcesContent":["import memoize from 'lodash/memoize';\n\n/**\n * use lodash memoize to cache the result of cb exec result\n * and shared the promise with the same `cache key`\n */\nexport const createWithMemorizeByKey = <T = string | null>() => {\n  const withMemorizeByKey = memoize(\n    (cb: () => Promise<T>, _cacheKey: string) => cb(),\n    (_, cacheKey) => cacheKey,\n  );\n\n  const toWithMemorizeByKey = withMemorizeByKey as typeof withMemorizeByKey & {\n    /**\n     *\n     * @returns clear cached state and promise\n     */\n    clear: (\n      cb?: (\n        /**\n         * cached data callback before clear\n         */\n        data: T,\n      ) => void,\n    ) => void;\n    /**\n     * get the full cached map data\n     */\n    get value(): Record<string, T>;\n  };\n\n  Object.defineProperty(withMemorizeByKey, 'value', {\n    get: () => (withMemorizeByKey.cache as any)?.__data__?.string?.__data__,\n  });\n\n  Object.defineProperty(withMemorizeByKey, 'clear', {\n    writable: false,\n    value: async (\n      cb: (\n        /**\n         * cached data callback before clear\n         */\n        data: T,\n      ) => void,\n    ) => {\n      const cachedMap = toWithMemorizeByKey.value;\n\n      for (const cache of Object.values(cachedMap)) {\n        const value = await cache;\n\n        cb?.(value);\n      }\n\n      withMemorizeByKey.cache.clear?.();\n    },\n  });\n\n  return toWithMemorizeByKey;\n};\n\n/**\n * save the result of promise to local cache by cacheKey, and can get the result by cacheKey in sync way\n *\n * ```ts\n * const withLocalCache = createWithLocalCache<string>();\n *\n * const fetchData = async () => {\n *   // Simulate an async operation\n *   return new Promise<string>((resolve) => {\n *     setTimeout(() => resolve('data'), 1000);\n *   });\n * };\n *\n * const withLocalCache = createWithLocalCache<string>();\n *   const cacheKey = 'uniqueKey';\n *\n *   // Fetch data and cache it\n *   const data = await withLocalCache(fetchData(), cacheKey);\n *   console.log(data); // Output: 'data'\n *\n *   // Retrieve cached data synchronously\n *   const cachedData = withLocalCache.get(cacheKey);\n *   console.log(cachedData); // Output: 'data'\n *\n *   // Clear the cache\n *   withLocalCache.clear();\n *   const clearedData = withLocalCache.get(cacheKey);\n *   console.log(clearedData); // Output: undefined\n * ```\n */\nexport const createWithLocalCache = <T = string | null>() => {\n  const localCache = new Map<string, T>();\n\n  const withLocalCache = async (promise: Promise<T>, _cacheKey: string) => {\n    const result = await promise;\n    localCache.set(_cacheKey, result);\n    return result;\n  };\n\n  Object.defineProperty(withLocalCache, 'clear', {\n    writable: false,\n    value: () => localCache.clear(),\n  });\n\n  Object.defineProperty(withLocalCache, 'get', {\n    writable: false,\n    value: (cacheKey: string) => localCache.get(cacheKey),\n  });\n\n  Object.defineProperty(withLocalCache, 'value', {\n    get: () => localCache,\n  });\n\n  return withLocalCache as typeof withLocalCache & {\n    /**\n     *\n     * @returns clear local cached state\n     */\n    clear: () => void;\n    /**\n     * get the cached result by cacheKey in sync way\n     * @param cacheKey\n     */\n    get: (cacheKey: string) => T | undefined;\n    /**\n     * get the full cached map data\n     */\n    get value(): Map<string, T>;\n  };\n};\n"],"mappings":"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","ignoreList":[]}