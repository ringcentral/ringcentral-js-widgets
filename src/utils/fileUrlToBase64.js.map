{"version":3,"file":"fileUrlToBase64.js","names":["_rxjs","require","_base64Handler","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_currC2dLogo","_fileUrlToBase64","_x","_fileUrlToBase","regeneratorRuntime","mark","_callee2","c2dLogo","image","imageBlog","base64URL","wrap","_callee2$","_context2","prev","next","fetch","sent","blob","fileToBase64","abrupt","stop","fileUrlToBase64","_ref","_callee","force","cache","url$","_args","_callee$","_context","length","undefined","firstValueFrom","from","pipe","shareReplay","catchError","error","_x2","exports"],"sources":["src/utils/fileUrlToBase64.ts"],"sourcesContent":["import {\n  Observable,\n  catchError,\n  firstValueFrom,\n  from,\n  shareReplay,\n} from 'rxjs';\n\nimport { fileToBase64 } from './base64Handler';\n\nconst _currC2dLogo: Record<string, Observable<string>> = {};\n\nasync function _fileUrlToBase64(c2dLogo: string) {\n  const image = await fetch(c2dLogo);\n  const imageBlog = await image.blob();\n  const base64URL = await fileToBase64(imageBlog);\n  return base64URL;\n}\n\n/**\n * Converts a file URL to a base64 string.\n *\n * by default this method will auto cache the base64 string,\n * @param c2dLogo - The file URL to convert.\n * @param force - (Optional) If set to true, forces fetching the image again instead of using the cached base64 string.\n * @returns A Promise that resolves to the base64 string representation of the file.\n */\nexport const fileUrlToBase64 = async (c2dLogo: string, force = false) => {\n  const cache = _currC2dLogo[c2dLogo];\n  if (!force && cache) {\n    return firstValueFrom(cache);\n  }\n\n  const url$ = from(_fileUrlToBase64(c2dLogo)).pipe(\n    // save the base64 string to cache for share all same url request\n    shareReplay(1),\n    catchError((error) => {\n      // when fetch failed, remove the cache, let outside to handle the error and can refetch again\n      delete _currC2dLogo[c2dLogo];\n\n      throw error;\n    }),\n  );\n\n  _currC2dLogo[c2dLogo] = url$;\n\n  return firstValueFrom(url$);\n};\n"],"mappings":"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","ignoreList":[]}