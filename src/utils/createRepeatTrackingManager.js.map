{"version":3,"file":"createRepeatTrackingManager.js","names":["_chunk","_interopRequireDefault","require","_rxjs","e","__esModule","_slicedToArray","r","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","createRepeatTrackingManager","exports","_ref","sendToServer","ttl","groupKey","itemKey","_ref$maxBatchRequestC","maxBatchRequestCount","Number","MAX_SAFE_INTEGER","validate","link$","Subject","unlink$","clientsLinkedItemsMap$","BehaviorSubject","Map","isNever","cacheMap","fromClientListener","everLinkedMap$","pipe","buffer","throttleTime","undefined","leading","trailing","scan","distinctMap","list","forEach","item","groupValue","itemValue","_distinctMap$get","set","get","Set","add","unlinkBuffer$","startWith","combineLatest","take","repeat","map","_ref2","_ref3","everLinkedMap","unlinkList","size","_ref4","_ref5","items","itemList","distinctUntilChanged","b","JSON","stringify","switchMap","data","fromServerListener","sendRequest","linkedItems","child","val","_distinctMap$get2","_val","id","entries","of","reduce","acc","_ref6","_ref7","itemSet","validExtensionIds","filter","prevTimestamp","Date","now","splitItems","chunk","splitItem","tap","cacheList","successTime","cacheItem","identity","delay","EMPTY","clear","link","unlink","setListenerDataFromClient","clientId","presenceMap","clientsLinkedItemsMap"],"sources":["src/utils/createRepeatTrackingManager.ts"],"sourcesContent":["import chunk from 'lodash/chunk';\nimport {\n  BehaviorSubject,\n  buffer,\n  combineLatest,\n  distinctUntilChanged,\n  EMPTY,\n  filter,\n  identity,\n  map,\n  type Observable,\n  of,\n  repeat,\n  scan,\n  startWith,\n  Subject,\n  switchMap,\n  take,\n  tap,\n  throttleTime,\n} from 'rxjs';\n\nexport type RepeatTrackingItems = readonly [string, string[]];\n\nexport type CreateRepeatTrackingManagerOptions<T extends Record<any, any>> = {\n  ttl: number | 'never';\n  groupKey: keyof T;\n  itemKey: keyof T;\n  sendToServer: (data: RepeatTrackingItems[]) => Promise<void>;\n  validate?: (data: T) => boolean;\n  maxBatchRequestCount?: number;\n};\n\n/**\n * Creates a manager for repeat tracking of viewable items which linking.\n *\n * When the items be linked, will interval emit to the fromServerListener api that will provide you able to know what items still on the screen\n *\n * and the linked api trigger will have a throttle time to prevent the api be triggered too often\n *\n * @template T - Generic type extending Record<string, string> representing the data structure\n *\n * @param options - Configuration options object\n * @param options.sendToServer - Function to send data to server\n * @param options.ttl - Time-to-live duration in milliseconds for cache entries\n * @param options.groupKey - Key used to group items\n * @param options.itemKey - Key used to identify individual items\n * @param options.maxBatchRequestCount - Maximum number of items per batch request (defaults to Number.MAX_SAFE_INTEGER)\n * @param options.validate - Function to validate data items\n *\n * @returns An object containing methods to manage viewable items:\n * - link: Adds a new item to be tracked\n * - unlink: Removes an item from tracking\n * - setListenerDataFromClient: Updates data for a specific client\n * - fromClientListener: Creates an observable for client-side changes\n * - fromServerListener: Creates an observable for server-side async event to fetch data and return the cache success list\n * - clear: Resets all tracking data\n *\n * @example\n * const manager = createRepeatTrackingManager({\n *   sendToServer: async (data) => { ... },\n *   ttl: 30000,\n *   groupKey: 'accountId',\n *   itemKey: 'extensionId',\n *   validate: (data) => true\n * });\n */\nexport const createRepeatTrackingManager = <T extends Record<any, any>>({\n  sendToServer,\n  ttl,\n  groupKey,\n  itemKey,\n  maxBatchRequestCount = Number.MAX_SAFE_INTEGER,\n  validate,\n}: CreateRepeatTrackingManagerOptions<T>) => {\n  const link$ = new Subject<T>();\n  const unlink$ = new Subject<T>();\n  const clientsLinkedItemsMap$ = new BehaviorSubject(\n    new Map<string, RepeatTrackingItems[]>(),\n  );\n  const isNever = ttl === 'never';\n\n  const cacheMap = new Map<string, number>();\n\n  const fromClientListener = () => {\n    const everLinkedMap$ = link$.pipe(\n      buffer(\n        // when got first value, buffer 1s data to fetch all presence in once\n        link$.pipe(\n          throttleTime(1000, undefined, {\n            leading: false,\n            trailing: true,\n          }),\n        ),\n      ),\n      // accumulate all linked presence\n      scan((distinctMap, list) => {\n        // distinct the list by accountId and extensionId\n        list.forEach((item) => {\n          const groupValue = item[groupKey];\n          const itemValue = item[itemKey];\n\n          if (validate ? validate(item) : true) {\n            const set = distinctMap.get(groupValue) ?? new Set<string>();\n            set.add(itemValue);\n            distinctMap.set(groupValue, set);\n          }\n        });\n\n        return distinctMap;\n      }, new Map<string, Set<string>>()),\n    );\n\n    const unlinkBuffer$ = unlink$.pipe(\n      buffer(\n        unlink$.pipe(\n          // 5000ms throttle for more time is fine, can later remove subscribe\n          throttleTime(5000, undefined, {\n            leading: false,\n            trailing: true,\n          }),\n        ),\n      ),\n      startWith(null),\n    );\n\n    return combineLatest([\n      everLinkedMap$,\n      unlinkBuffer$.pipe(\n        take(2),\n        // once emit, then restart the buffer, so will only use the buffer data once, then clear\n        repeat(),\n      ),\n    ]).pipe(\n      map(([everLinkedMap, unlinkList]) => {\n        if (unlinkList) {\n          unlinkList.forEach((item) => {\n            const groupValue = item[groupKey];\n            const itemValue = item[itemKey];\n            const set = everLinkedMap.get(groupValue);\n\n            if (set) {\n              set.delete(itemValue);\n\n              if (set.size === 0) {\n                everLinkedMap.delete(groupValue);\n              }\n            }\n          });\n        }\n\n        return everLinkedMap;\n      }),\n      // convert to serializable list\n      map((distinctMap) => {\n        const list = Array.from(distinctMap).map(([groupValue, items]) => {\n          const itemList = Array.from(items);\n\n          return [groupValue, itemList] as const;\n        });\n\n        return list;\n      }),\n      // only emit when the list is changed\n      distinctUntilChanged((a, b) => JSON.stringify(a) === JSON.stringify(b)),\n      switchMap((data) => sendToServer(data)),\n    );\n  };\n\n  const fromServerListener = (\n    sendRequest: (\n      data: [string, string[]][],\n    ) => Promise<string[]> | Observable<string[]>,\n  ) => {\n    // the list from clients\n    return clientsLinkedItemsMap$.pipe(\n      // distinct the list by first key\n      map((linkedItems) => {\n        const distinctMap = new Map<string, Set<string>>();\n\n        linkedItems.forEach((child) => {\n          child.forEach((val) => {\n            const [groupValue, items] = val;\n            const set = distinctMap.get(groupValue) ?? new Set<string>();\n            items.forEach((id) => set.add(id));\n            distinctMap.set(groupValue, set);\n          });\n        });\n\n        return Array.from(distinctMap.entries());\n      }),\n      // if the list is not empty, emit the expired presence list every ttl\n      switchMap((list) => {\n        return list.length > 0\n          ? of(null).pipe(\n              map(() =>\n                list.reduce((acc, [groupValue, itemSet]) => {\n                  const validExtensionIds = Array.from(itemSet).filter(\n                    (item) => {\n                      const prevTimestamp = cacheMap.get(item);\n\n                      return (\n                        isNever ||\n                        !prevTimestamp ||\n                        Date.now() - prevTimestamp >= ttl\n                      );\n                    },\n                  );\n\n                  if (validExtensionIds.length > 0) {\n                    if (validExtensionIds.length > maxBatchRequestCount) {\n                      const splitItems = chunk(\n                        validExtensionIds,\n                        maxBatchRequestCount,\n                      );\n\n                      splitItems.forEach((splitItem) => {\n                        acc.push([groupValue, splitItem]);\n                      });\n                    } else {\n                      acc.push([groupValue, validExtensionIds]);\n                    }\n                  }\n                  return acc;\n                }, [] as [string, string[]][]),\n              ),\n              filter((list) => list.length > 0),\n              switchMap((data) => sendRequest(data)),\n              tap((cacheList) => {\n                if (isNever) return;\n                // the minus 1ms to make sure the cache is expired in the next cycle\n                const successTime = Date.now() - 1;\n\n                cacheList.forEach((cacheItem) => {\n                  cacheMap.set(cacheItem, successTime);\n                });\n              }),\n              isNever ? identity : repeat({ delay: ttl }),\n            )\n          : EMPTY;\n      }),\n    );\n  };\n\n  const clear = () => {\n    clientsLinkedItemsMap$.next(new Map());\n    cacheMap.clear();\n  };\n\n  return {\n    link(data: T) {\n      link$.next(data);\n    },\n    unlink(data: T) {\n      unlink$.next(data);\n    },\n    setListenerDataFromClient: (\n      clientId: string,\n      data: RepeatTrackingItems[],\n    ) => {\n      const presenceMap = clientsLinkedItemsMap$.value;\n      presenceMap.set(clientId, data);\n      clientsLinkedItemsMap$.next(presenceMap);\n    },\n    fromClientListener,\n    fromServerListener,\n    clear,\n    get clientsLinkedItemsMap() {\n      return clientsLinkedItemsMap$.value;\n    },\n  };\n};\n"],"mappings":"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","ignoreList":[]}