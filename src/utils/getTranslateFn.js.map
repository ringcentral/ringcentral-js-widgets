{"version":3,"file":"getTranslateFn.js","names":["_i18n","require","_format","_toArray","r","_arrayWithHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","e","n","Symbol","iterator","isArray","_defineProperties","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","toPrimitive","String","Number","_classCallCheck","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","apply","_assertThisInitialized","ReferenceError","_inherits","create","value","_setPrototypeOf","_wrapNativeSuper","Map","_isNativeFunction","has","get","set","Wrapper","_construct","arguments","push","p","bind","Boolean","valueOf","Function","indexOf","setPrototypeOf","__proto__","getPrototypeOf","getTranslateFn","exports","_len","i18nInput","_key","i18nInstances","process","env","NODE_ENV","TranslateError","_Error","message","_this","Error","_i18nInstances","firstI18n","rest","forEach","nextI18n","keys","_cache","RUNTIME","defaultLocale","hasOwnProperty","console","warn","concat","duplicatedKey","_RUNTIME$getTranslate","i18nString","currentLocale","getTranslateLocale","some","i18nInstance","result","getString","_len2","options","_key2","format"],"sources":["src/utils/getTranslateFn.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type I18n from '@ringcentral-integration/i18n';\nimport { RUNTIME } from '@ringcentral-integration/i18n';\n\nimport { format } from './format';\n\ntype UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends (\n  k: infer I,\n) => void\n  ? I\n  : never;\n\ntype ExtractBraces<S extends string> =\n  S extends `${infer _Start}{${infer Param}}${infer Rest}`\n    ?\n        | {\n            [K in Param]: string | number;\n          }\n        | ExtractBraces<Rest>\n    : never;\ntype UnwrapI18n<T> = T extends I18n<infer U> ? U : never;\ntype MergeTypes<T, U> = T & U;\n\nexport type MergeI18nArray<Types extends any[]> = Types extends [\n  infer First,\n  ...infer Rest,\n]\n  ? MergeTypes<UnwrapI18n<First>, MergeI18nArray<Rest>>\n  : unknown;\n\nexport interface Format<T extends Record<string, string>> {\n  /**\n   * i18n method `t`\n   * Format using an object hash with keys matching [0-9a-zA-Z]+\n   *\n   * ```ts\n   * showMessageWithSlot => '{hello} Show message'\n   *\n   * const message2 = t('showMessageWithSlot', { hello: 'Hello world' }); // => 'Hello world Show message'\n   * ```\n   */\n  <K extends keyof T>(\n    string: K,\n    object: UnionToIntersection<ExtractBraces<T[K]>>,\n  ): string;\n  /**\n   * i18n method `t`\n   * Format using a number indexed array\n   *\n   * ```ts\n   * showMessageWithArraySlot => '{0} Show message {1}'\n   *\n   * const message3 = t('showMessageWithArraySlot', [1, 2]); // => '1 Show message 2'\n   * ```\n   */\n  <K extends keyof T>(string: K, array: Array<any>): string;\n  /**\n   * i18n method `t`\n   * Escape {} pairs by using double {{}}\n   *\n   * ```ts\n   * showMessage => 'Show message'\n   * showMessageWithSlot => '{hello} Show message'\n   * showMessageWithArraySlot => '{0} Show message {1}'\n   *\n   * const message1 = t('showMessage'); // => 'Show message'\n   * const message2 = t('showMessageWithSlot', { hello: 'Hello world' }); // => 'Hello world Show message'\n   * const message3 = t('showMessageWithArraySlot', [1, 2]); // => '1 Show message 2'\n   * const message4 = t('showMessageWithArraySlot', 1, 2); // => '1 Show message 2'\n   * ```\n   */\n  <K extends keyof T>(string: K): string;\n}\n/**\n * provide method to work translate and format string\n */\nexport const getTranslateFn = <\n  T extends Array<I18n<any>>,\n  P extends Record<string, string> = MergeI18nArray<T>,\n>(\n  ...i18nInput: T\n): Format<P> => {\n  const i18nInstances = Array.isArray(i18nInput) ? i18nInput : [i18nInput];\n\n  if (process.env.NODE_ENV !== 'production') {\n    class TranslateError extends Error {\n      constructor(message: string, ...rest: any[]) {\n        super(message);\n        this.name = 'TranslateError';\n      }\n    }\n\n    if (i18nInstances.length > 1) {\n      const [firstI18n, ...rest] = i18nInstances;\n\n      rest.forEach((nextI18n) => {\n        Object.keys(firstI18n._cache[RUNTIME.defaultLocale] || {}).forEach(\n          (key) => {\n            if (\n              Object.prototype.hasOwnProperty.call(\n                nextI18n._cache[RUNTIME.defaultLocale],\n                key,\n              )\n            ) {\n              // eslint-disable-next-line no-console\n              console.warn(\n                new TranslateError(\n                  `[i18n] i18n files has duplicated key \"${key}\"`,\n                ),\n                {\n                  duplicatedKey: key,\n                  i18nInstances,\n                },\n              );\n            }\n          },\n        );\n      });\n    }\n  }\n\n  return (key: any, ...options: any[]) => {\n    let i18nString = key as string;\n\n    const currentLocale = RUNTIME.getTranslateLocale?.();\n\n    i18nInstances.some((i18nInstance) => {\n      const result = i18nInstance.getString(key as any, currentLocale);\n      if (result !== key) {\n        i18nString = result;\n\n        return true;\n      }\n\n      return false;\n    });\n\n    if (options.length > 0) {\n      return format(i18nString, ...options);\n    }\n    return i18nString;\n  };\n};\n"],"mappings":"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","ignoreList":[]}