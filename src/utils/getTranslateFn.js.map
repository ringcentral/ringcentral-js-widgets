{"version":3,"file":"getTranslateFn.js","names":["_i18n","require","_format","_toArray","arr","_arrayWithHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","i","arr2","iter","Symbol","iterator","isArray","_classCallCheck","instance","Constructor","_inherits","subClass","superClass","create","value","writable","configurable","defineProperty","_setPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","_typeof","_assertThisInitialized","ReferenceError","_wrapNativeSuper","Class","_cache","Map","undefined","_isNativeFunction","has","get","set","Wrapper","_construct","enumerable","Parent","args","bind","a","push","Function","sham","Proxy","Boolean","valueOf","e","fn","indexOf","p","setPrototypeOf","__proto__","getPrototypeOf","getTranslateFn","_len","i18nInput","_key","i18nInstances","process","env","NODE_ENV","TranslateError","_Error","_super","message","_this","Error","_i18nInstances","firstI18n","rest","forEach","nextI18n","keys","RUNTIME","defaultLocale","key","hasOwnProperty","console","warn","concat","duplicatedKey","i18nString","some","i18nInstance","getString","_len2","options","_key2","format","exports"],"sources":["src/utils/getTranslateFn.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type I18n from '@ringcentral-integration/i18n';\nimport type { GetI18nKey } from '@ringcentral-integration/i18n';\nimport { RUNTIME } from '@ringcentral-integration/i18n';\n\nimport { format } from './format';\n\n// TODO: that second object can be inject from string-template\n\nexport interface Format<T> {\n  /**\n   * i18n method `t`\n   * Format using an object hash with keys matching [0-9a-zA-Z]+\n   *\n   * ```ts\n   * showMessageWithSlot => '{hello} Show message'\n   *\n   * const message2 = t('showMessageWithSlot', { hello: 'Hello world' }); // => 'Hello world Show message'\n   * ```\n   */\n  (string: T, object: any): string;\n  /**\n   * i18n method `t`\n   * Format using a number indexed array\n   *\n   * ```ts\n   * showMessageWithArraySlot => '{0} Show message {1}'\n   *\n   * const message3 = t('showMessageWithArraySlot', [1, 2]); // => '1 Show message 2'\n   * ```\n   */\n  (string: T, array: Array<any>): string;\n  /**\n   * i18n method `t`\n   * Format using optional arguments\n   *\n   * ```ts\n   * showMessageWithArraySlot => '{0} Show message {1}'\n   *\n   * const message4 = t('showMessageWithArraySlot', 1, 2); // => '1 Show message 2'\n   * ```\n   */\n  (string: T, ...array: Array<any>): string;\n  /**\n   * i18n method `t`\n   * Escape {} pairs by using double {{}}\n   *\n   * ```ts\n   * showMessage => 'Show message'\n   * showMessageWithSlot => '{hello} Show message'\n   * showMessageWithArraySlot => '{0} Show message {1}'\n   *\n   * const message1 = t('showMessage'); // => 'Show message'\n   * const message2 = t('showMessageWithSlot', { hello: 'Hello world' }); // => 'Hello world Show message'\n   * const message3 = t('showMessageWithArraySlot', [1, 2]); // => '1 Show message 2'\n   * const message4 = t('showMessageWithArraySlot', 1, 2); // => '1 Show message 2'\n   * ```\n   */\n  (string: T): string;\n}\n/**\n * provide method to work translate and format string\n */\nexport const getTranslateFn = <\n  T extends I18n[],\n  K = GetI18nKey<T extends I18n[] ? T[number] : T>,\n>(\n  ...i18nInput: T\n): Format<K> => {\n  const i18nInstances = Array.isArray(i18nInput) ? i18nInput : [i18nInput];\n\n  if (process.env.NODE_ENV !== 'production') {\n    class TranslateError extends Error {\n      constructor(message: string, ...rest: any[]) {\n        super(message);\n        this.name = 'TranslateError';\n      }\n    }\n\n    if (i18nInstances.length > 1) {\n      const [firstI18n, ...rest] = i18nInstances;\n\n      rest.forEach((nextI18n) => {\n        Object.keys(firstI18n._cache[RUNTIME.defaultLocale] || {}).forEach(\n          (key) => {\n            if (\n              Object.prototype.hasOwnProperty.call(\n                nextI18n._cache[RUNTIME.defaultLocale],\n                key,\n              )\n            ) {\n              // eslint-disable-next-line no-console\n              console.warn(\n                new TranslateError(\n                  `[i18n] i18n files has duplicated key \"${key}\"`,\n                ),\n                {\n                  duplicatedKey: key,\n                  i18nInstances,\n                },\n              );\n            }\n          },\n        );\n      });\n    }\n  }\n\n  return (key: K, ...options: any[]) => {\n    let i18nString = key as string;\n\n    i18nInstances.some((i18nInstance) => {\n      const result = i18nInstance.getString(key as any);\n      if (result !== key) {\n        i18nString = result;\n\n        return true;\n      }\n\n      return false;\n    });\n\n    if (options.length > 0) {\n      return format(i18nString, ...options);\n    }\n    return i18nString;\n  };\n};\n"],"mappings":"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"}