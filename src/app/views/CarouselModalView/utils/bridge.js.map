{"version":3,"file":"bridge.js","names":["_constants","require","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","TypeError","String","Number","post","_len","args","Array","_key","last","Event","preventDefault","pop","emitValue","type","TUTORIAL_ACTION_KEY","data","window","parent","postMessage","JSON","stringify","RC_AEM","disabledGlobalActionListener","listenGlobalActionEvent","postData","actionType","source","key","_e$target","beSpace","code","beEnter","beButton","target","tagName","_JSON$parse","parse","error","console","handleListener","element","desktop","getAttribute","mobile","document","addEventListener"],"sources":["src/app/views/CarouselModalView/utils/bridge.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path='./bridge.d.ts'/>\nimport type { CarouselModalMessage } from './constants';\nimport { TUTORIAL_ACTION_KEY } from './constants';\n\ntype Action = {\n  type: string;\n  value: unknown;\n};\n\n/**\n * post message to parent window\n */\nconst post = (...args: unknown[]): void => {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const last: any = args[args.length - 1];\n  if (last instanceof Event || last.preventDefault) {\n    last.preventDefault();\n    // remove from args\n    args.pop();\n  }\n\n  const emitValue: CarouselModalMessage = {\n    type: TUTORIAL_ACTION_KEY,\n    data: args,\n  };\n\n  window.parent.postMessage(JSON.stringify(emitValue), '*');\n};\n\nwindow.RC_AEM = { ...window.RC_AEM, post };\n\nif (!window.RC_AEM.disabledGlobalActionListener) {\n  const listenGlobalActionEvent = () => {\n    function postData(\n      actionType: 'desktop' | 'mobile',\n      source: string,\n      e: Event,\n    ) {\n      if ((e as KeyboardEvent).key) {\n        const beSpace =\n          (e as KeyboardEvent).key === ' ' ||\n          (e as KeyboardEvent).code === 'Space';\n        const beEnter = (e as KeyboardEvent).key === 'Enter';\n\n        // not be space or enter, return\n        if (!(beEnter || beSpace)) {\n          return;\n        }\n\n        const beButton = (e.target as HTMLElement)?.tagName === 'BUTTON';\n        // not be button but key code is space, also not trigger\n        if (!beButton && beSpace) {\n          return;\n        }\n      }\n\n      try {\n        const { type, value }: Action = JSON.parse(source);\n\n        window.RC_AEM.post(actionType, type, value, e);\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\n          `[RC_AEM] data format error, should be string value with JSON object like\n\n        <button data-desktop-action='{\"type\": \"event\", \"value\": \"value\"}'>click</button>\n\n        or\n\n        <button data-mobile-action='{\"type\": \"event\", \"value\": \"value\"}'>click</button>\n        `,\n        );\n\n        throw error;\n      }\n    }\n\n    const handleListener = (e: Event): void => {\n      const element = e.target as HTMLElement;\n\n      const desktop = element.getAttribute('data-desktop-action');\n      const mobile = element.getAttribute('data-mobile-action');\n\n      if (desktop) {\n        postData('desktop', desktop, e);\n      }\n\n      if (mobile) {\n        postData('mobile', mobile, e);\n      }\n    };\n\n    document.addEventListener('click', handleListener);\n    document.addEventListener('keydown', handleListener);\n  };\n\n  listenGlobalActionEvent();\n}\n"],"mappings":"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","ignoreList":[]}