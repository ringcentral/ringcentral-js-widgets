{"version":3,"file":"ConversationAlert.js","names":["_services","require","_nextCore","_react","_interopRequireDefault","_services2","_ConversationPanel","_dec","_dec2","_dec3","_dec4","_dec5","_class","e","__esModule","_classCallCheck","a","n","TypeError","_defineProperties","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","value","_setPrototypeOf","ConversationAlert","exports","injectable","name","target","optional","undefined","metadata","Function","MessageSender","NumberFormatter","SmsOptOut","ConversationViewSpringOptions","_RcModule","_messageSender","_numberFormatter","_smsOptOut","_conversationViewOptions","_this","getSmsSentCapability","conversation","_conversation$from","_conversation$to","_conversation$to$","hasCapability","phoneNumber","direction","from","to","formattedPhoneNumber","formatNumber","senderNumberMap","has","getAlertInfo","_this$_smsOptOut","_this$_conversationVi3","_this$_conversationVi4","isOptOut","getIsOptOutConversation","smsCapabilityCheck","notHasSmsCapability","alertProps","children","createElement","OptOutAlert","severity","SmsCapabilityAlert","_this$_conversationVi","_this$_conversationVi2","showAlert","RcModule"],"sources":["src/app/views/ConversationViewSpring/ConversationAlert.tsx"],"sourcesContent":["import { NumberFormatter } from '@ringcentral-integration/micro-auth/src/app/services';\nimport {\n  injectable,\n  optional,\n  RcModule,\n} from '@ringcentral-integration/next-core';\nimport type { AlertProps } from '@ringcentral/spring-ui';\nimport React from 'react';\n\nimport {\n  FormattedConversation,\n  MessageSender,\n  SmsOptOut,\n} from '../../services';\n\nimport type { ConversationViewSpringOptions } from './Conversation.view.interface';\nimport { OptOutAlert, SmsCapabilityAlert } from './ConversationPanel';\n\n@injectable({\n  name: 'ConversationAlert',\n})\nexport class ConversationAlert extends RcModule {\n  constructor(\n    private _messageSender: MessageSender,\n    private _numberFormatter: NumberFormatter,\n    @optional() private _smsOptOut?: SmsOptOut,\n    @optional('ConversationViewOptions')\n    private _conversationViewOptions?: ConversationViewSpringOptions,\n  ) {\n    super();\n  }\n\n  /**\n   * Check if the conversation's phone number has SMS capability\n   */\n  getSmsSentCapability(conversation: FormattedConversation): {\n    hasCapability: boolean;\n    phoneNumber?: string;\n  } {\n    if (!conversation) {\n      return { hasCapability: true };\n    }\n\n    const phoneNumber =\n      conversation.direction === 'Outbound'\n        ? conversation.from?.phoneNumber\n        : conversation.to?.[0]?.phoneNumber;\n\n    if (!phoneNumber) {\n      return { hasCapability: true };\n    }\n\n    const formattedPhoneNumber =\n      this._numberFormatter.formatNumber(phoneNumber);\n\n    const hasCapability =\n      this._messageSender.senderNumberMap.has(formattedPhoneNumber);\n\n    return {\n      hasCapability,\n      phoneNumber: formattedPhoneNumber,\n    };\n  }\n\n  /**\n   * Get alert information for a conversation\n   */\n  getAlertInfo(conversation: FormattedConversation) {\n    const isOptOut = this._smsOptOut?.getIsOptOutConversation(conversation);\n\n    const smsCapabilityCheck = this.getSmsSentCapability(conversation);\n    const notHasSmsCapability = !smsCapabilityCheck.hasCapability;\n\n    let alertProps: AlertProps | undefined;\n    if (isOptOut) {\n      alertProps = {\n        children: <OptOutAlert />,\n        severity: 'warning',\n      };\n    } else if (notHasSmsCapability && smsCapabilityCheck.phoneNumber) {\n      alertProps = {\n        children: (\n          <SmsCapabilityAlert phoneNumber={smsCapabilityCheck.phoneNumber} />\n        ),\n        severity: 'info',\n      };\n    } else {\n      alertProps = this._conversationViewOptions?.alertProps?.();\n    }\n\n    return {\n      showAlert:\n        isOptOut ||\n        notHasSmsCapability ||\n        this._conversationViewOptions?.showAlert?.() ||\n        false,\n      alertProps,\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}