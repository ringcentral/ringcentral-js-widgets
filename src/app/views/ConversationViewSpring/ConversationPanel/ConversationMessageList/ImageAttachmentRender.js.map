{"version":3,"file":"ImageAttachmentRender.js","names":["_components","require","_utils","_constant","_springUi","_clsx","_interopRequireDefault","_react","_interopRequireWildcard","_styles","_excluded","_excluded2","e","__esModule","_typeof","o","Symbol","iterator","constructor","prototype","_extends","Object","assign","bind","n","arguments","length","t","r","hasOwnProperty","call","apply","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","toString","slice","name","Array","from","test","l","i","u","f","next","done","push","value","isArray","_objectWithoutProperties","_objectWithoutPropertiesLoose","getOwnPropertySymbols","indexOf","propertyIsEnumerable","WeakMap","__proto__","has","get","set","_t","defineProperty","getOwnPropertyDescriptor","TiffViewer","React","lazy","Promise","resolve","then","PreviewMedia","exports","props","_props$maxWidth","maxWidth","maxWidthProp","global","document","body","clientWidth","height","width","rest","_useState","useState","_useState2","setMaxWidth","heightRatio","useMemo","toWidth","Math","min","imgRef","useRef","containerRef","useResizeObserver","_containerRef$current","parentElm","current","parentElement","mode","createElement","ref","style","concat","draggable","className","ImageAttachmentRender","attachment","direction","handleImageLoad","uri","fileNameWithoutExt","fileName","removeExtension","id","fileExt","getFileExtension","CONTENT_TYPE_TO_EXTENSION","contentType","isTiff","key","clsx","styles","previewMedia","Suspense","fallback","tiffUrl","onLoad","loading","tabIndex","src","alt","title","hoverAction","ext","DownloadButton","size","url"],"sources":["src/app/views/ConversationViewSpring/ConversationPanel/ConversationMessageList/ImageAttachmentRender.tsx"],"sourcesContent":["/* eslint-disable jsx-a11y/alt-text */\nimport MessageAttachmentInfo from '@rc-ex/core/lib/definitions/MessageAttachmentInfo';\nimport { DownloadButton } from '@ringcentral-integration/next-widgets/components';\nimport {\n  getFileExtension,\n  removeExtension,\n} from '@ringcentral-integration/utils';\nimport { CONTENT_TYPE_TO_EXTENSION } from '@ringcentral-integration/utils/src/utils/fileHandler/constant';\nimport { useResizeObserver } from '@ringcentral/spring-ui';\nimport clsx from 'clsx';\nimport type { ComponentProps, FunctionComponent } from 'react';\nimport React, { Suspense, useMemo, useRef, useState } from 'react';\n\nimport styles from './styles.scss';\n\nconst TiffViewer = React.lazy(() => import('./TiffViewer'));\n\nexport interface ImageAttachmentRenderProps {\n  direction?: 'Inbound' | 'Outbound';\n  attachment: MessageAttachmentInfo;\n  handleImageLoad?: () => void;\n}\n\nexport const PreviewMedia: FunctionComponent<\n  {\n    height: number;\n    width: number;\n    maxWidth?: number;\n  } & ComponentProps<'img'>\n> = (props) => {\n  const {\n    maxWidth: maxWidthProp = global.document.body.clientWidth,\n    height,\n    width,\n    ...rest\n  } = props;\n\n  const [maxWidth, setMaxWidth] = useState(maxWidthProp);\n\n  const heightRatio = useMemo(() => height! / width!, [height, width]);\n  const toWidth = useMemo(() => Math.min(maxWidth, width), [maxWidth, width]);\n\n  const imgRef = useRef<HTMLImageElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useResizeObserver(\n    containerRef,\n    () => {\n      const parentElm = containerRef.current?.parentElement;\n      if (parentElm) {\n        setMaxWidth(parentElm.clientWidth);\n      }\n    },\n    {\n      mode: 'throttle',\n    },\n  );\n\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        width: `${toWidth}px`,\n        height: `${toWidth * heightRatio}px`,\n      }}\n    >\n      <img ref={imgRef} draggable=\"false\" className=\"w-full h-full\" {...rest} />\n    </div>\n  );\n};\n\nexport const ImageAttachmentRender: FunctionComponent<\n  ImageAttachmentRenderProps\n> = (props) => {\n  const { attachment, direction, handleImageLoad, ...rest } = props;\n\n  const uri = attachment.uri;\n  const fileNameWithoutExt = attachment.fileName\n    ? removeExtension(attachment.fileName)\n    : attachment.id;\n  const fileExt = attachment.fileName\n    ? getFileExtension(attachment.fileName)\n    : CONTENT_TYPE_TO_EXTENSION[attachment.contentType!];\n  const fileName = `${fileNameWithoutExt}.${fileExt}`;\n  const isTiff = fileExt.indexOf('tif') > -1;\n\n  return (\n    <div\n      key={attachment.id}\n      {...rest}\n      className={clsx(\n        'rounded-lg overflow-hidden relative outline-none z-10',\n        direction === 'Outbound'\n          ? 'last:rounded-br-none'\n          : 'last:rounded-bl-none',\n        styles.previewMedia,\n      )}\n    >\n      {isTiff ? (\n        <Suspense fallback={null}>\n          <TiffViewer tiffUrl={uri!} onLoad={handleImageLoad} />\n        </Suspense>\n      ) : (\n        <PreviewMedia\n          height={attachment.height || 100}\n          width={attachment.width || 100}\n          loading=\"lazy\"\n          tabIndex={0}\n          src={uri}\n          alt={fileName}\n          title={fileName}\n          draggable=\"false\"\n          onLoad={handleImageLoad}\n        />\n      )}\n      <div\n        className={clsx(\n          'bg-neutral-b4 h-8 p-2 flex items-center absolute left-0 bottom-0 translate-y-full transition-neutral-01-fast w-full',\n          styles.hoverAction,\n        )}\n        data-sign=\"image-toolbar\"\n      >\n        {fileName && (\n          <div\n            className=\"flex typography-mainText overflow-hidden flex-auto pr-2\"\n            data-sign=\"image-name\"\n          >\n            <div className=\"truncate\">{fileNameWithoutExt}</div>\n            <div className={clsx('flex-none', styles.ext)}>.{fileExt}</div>\n          </div>\n        )}\n        <div className=\"ml-auto\">\n          <DownloadButton\n            size=\"medium\"\n            url={`${uri}&contentDisposition=Attachment`}\n            name={fileName}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]}