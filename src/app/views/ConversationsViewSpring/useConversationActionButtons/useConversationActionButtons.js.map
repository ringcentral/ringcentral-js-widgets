{"version":3,"file":"useConversationActionButtons.js","names":["_components","require","_springUi","_react","_interopRequireWildcard","_ConversationLogPopover","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","u","next","done","push","value","isArray","useConversationActionButtons","exports","_ref","displayCount","actions","conversation","showLogPopover","onAction","createNewEntityTooltip","variant","moreButtonProps","loggedEntities","conversationMatches","_useState","useState","_useState2","logPopperOpened","setLogPopperOpened","_useState3","_useState4","keepActions","setKeepActions","_useState5","_useState6","anchor","setMenuAnchor","logRef","useRef","buttons","useHistoryActionButtons","actionType","event","currentTarget","viewCRMLogMenu","useMemo","menuList","map","_ref2","id","url","createElement","MenuItem","title","key","onClick","stopPropagation","MenuItemText","className","Menu","open","anchorEl","onClose","onExitComplete","MenuList","renderButtons","ActionMenuList","propsMap","all","undefined","forceActionsOpen","refMap","createLog","viewLog","selectRecordsForAutoLog","logPopover","ConversationLogPopover","current","opened","Fragment"],"sources":["src/app/views/ConversationsViewSpring/useConversationActionButtons/useConversationActionButtons.tsx"],"sourcesContent":["import {\n  ActionMenuList,\n  type ActionMenuListProps,\n  type HistoryAction,\n  type HistoryActionType,\n  useHistoryActionButtons,\n} from '@ringcentral-integration/next-widgets/components';\nimport { Menu, MenuItem, MenuItemText, MenuList } from '@ringcentral/spring-ui';\nimport React, { useMemo, useRef, useState } from 'react';\n\nimport type { FormattedConversation } from '../../../services';\n\nimport { ConversationLogPopover } from './ConversationLogPopover';\n\nexport interface UseConversationActionButtonsProps\n  extends Pick<\n    ActionMenuListProps,\n    'variant' | 'displayCount' | 'moreButtonProps'\n  > {\n  actions: HistoryAction[];\n  conversation: FormattedConversation;\n  showLogPopover?: boolean;\n  createNewEntityTooltip?: string;\n  onAction: <T extends HistoryActionType>(\n    actionType: T,\n    data?: any,\n  ) => Promise<void>;\n}\n\nexport const useConversationActionButtons = ({\n  displayCount,\n  actions,\n  conversation,\n  showLogPopover,\n  onAction,\n  createNewEntityTooltip,\n  variant,\n  moreButtonProps,\n}: UseConversationActionButtonsProps) => {\n  const { conversationMatches: loggedEntities } = conversation;\n  const [logPopperOpened, setLogPopperOpened] = useState(false);\n  const [keepActions, setKeepActions] = useState(false);\n  const [anchor, setMenuAnchor] = useState<Element | null>(null);\n  const logRef = useRef(null);\n\n  const buttons = useHistoryActionButtons(actions, (actionType, event) => {\n    if (\n      (actionType === 'createLog' ||\n        actionType === 'selectRecordsForAutoLog') &&\n      showLogPopover\n    ) {\n      setLogPopperOpened(true);\n      return;\n    }\n\n    if (actionType === 'viewLog') {\n      if (loggedEntities?.length === 1) {\n        onAction('viewLog', loggedEntities[0]);\n        return;\n      } else {\n        setMenuAnchor(event?.currentTarget as Element);\n        setKeepActions(true);\n      }\n      return;\n    }\n    onAction(actionType);\n  });\n\n  const viewCRMLogMenu = useMemo(() => {\n    if (loggedEntities?.length <= 1) {\n      return null;\n    }\n    const menuList = loggedEntities.map(({ id, name, url }) => (\n      <MenuItem\n        title={name}\n        key={id}\n        data-sign={id}\n        onClick={(e) => {\n          onAction('viewLog', { id, name, url });\n          e.stopPropagation();\n        }}\n      >\n        <MenuItemText className=\"truncate\">{name}</MenuItemText>\n      </MenuItem>\n    ));\n    return (\n      <Menu\n        open={!!anchor}\n        anchorEl={anchor}\n        onClose={() => {\n          setMenuAnchor(null);\n        }}\n        onClick={(e) => {\n          e.stopPropagation();\n        }}\n        onExitComplete={() => {\n          setKeepActions(false);\n        }}\n        data-sign=\"viewCRMLogMenu\"\n      >\n        <MenuList>{menuList}</MenuList>\n      </Menu>\n    );\n  }, [anchor, loggedEntities, onAction]);\n\n  const renderButtons = useMemo(() => {\n    return (\n      <ActionMenuList\n        displayCount={displayCount}\n        buttons={buttons}\n        variant={variant}\n        propsMap={\n          variant === 'plain'\n            ? {\n                all: {\n                  variant: 'icon',\n                },\n              }\n            : undefined\n        }\n        forceActionsOpen={logPopperOpened || keepActions}\n        refMap={{\n          createLog: logRef,\n          viewLog: logRef,\n          selectRecordsForAutoLog: logRef,\n        }}\n        moreButtonProps={moreButtonProps}\n      />\n    );\n  }, [\n    displayCount,\n    buttons,\n    variant,\n    logPopperOpened,\n    keepActions,\n    moreButtonProps,\n  ]);\n\n  const logPopover = useMemo(() => {\n    return (\n      <ConversationLogPopover\n        anchorEl={logRef.current}\n        opened={logPopperOpened}\n        onClose={() => {\n          setLogPopperOpened(false);\n        }}\n        conversation={conversation}\n        createNewEntityTooltip={createNewEntityTooltip}\n      />\n    );\n  }, [conversation, createNewEntityTooltip, logPopperOpened]);\n\n  return (\n    <>\n      {renderButtons}\n      {logPopover}\n      {viewCRMLogMenu}\n    </>\n  );\n};\n"],"mappings":"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","ignoreList":[]}