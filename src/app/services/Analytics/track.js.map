{"version":3,"file":"track.js","names":["_nextCore","require","_Analytics","_execTracking","track","exports","trackEvent","enable","arguments","length","undefined","target","name","descriptor","value","initializer","Error","concat","fn","trackedFn","analytics","getRef","container","got","Analytics","e","call","_len","args","Array","_key","result","apply","execTracking","console","warn","identifier","error","enumerable","configurable"],"sources":["src/app/services/Analytics/track.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/* eslint-disable no-console */\nimport type {\n  RcModule,\n  RcViewModule,\n} from '@ringcentral-integration/next-core';\nimport { getRef } from '@ringcentral-integration/next-core';\n\nimport { Analytics } from './Analytics';\nimport type { IAnalytics } from './Analytics.interface';\nimport { execTracking, TrackEvent } from './execTracking';\n\ninterface Descriptor<T> extends TypedPropertyDescriptor<T> {\n  initializer?(): T;\n}\n\n/**\n * decorate a method with `Analytics` Module\n *\n * @param trackEvent define trackEvent for tracking\n * @param enable enable or disable tracking\n */\nexport const track = (trackEvent: TrackEvent, enable = true) => {\n  return (\n    target: RcModule | RcViewModule,\n    name: string,\n    descriptor?: Descriptor<any>,\n  ) => {\n    if (!enable) {\n      return descriptor;\n    }\n\n    if (\n      typeof descriptor?.value !== 'function' &&\n      typeof descriptor?.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor?.value;\n    const initializer = descriptor.initializer;\n    // eslint-disable-next-line func-names\n    const trackedFn = function (this: RcModule, ...args: any) {\n      let analytics: IAnalytics | null = null;\n      try {\n        analytics = getRef(this).container!.got(Analytics)!;\n      } catch (e) {\n        //\n      }\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      if (typeof fn !== 'function') {\n        throw new Error(`@track decorated '${name}' is not a function`);\n      }\n      const result = fn.apply(this, args);\n      if (!analytics) {\n        return result;\n      }\n      try {\n        execTracking(analytics, trackEvent, [this, ...args]);\n      } catch (e) {\n        console.warn(`Analytics Error: ${getRef(target).identifier}.${name}`);\n        console.error(e);\n      }\n      return result;\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n};\n"],"mappings":";;;;;;;;AAOA,IAAAA,SAAA,GAAAC,OAAA;AAEA,IAAAC,UAAA,GAAAD,OAAA;AAEA,IAAAE,aAAA,GAAAF,OAAA;AAXA;;AAEA;;AAeA;AACA;AACA;AACA;AACA;AACA;AACO,IAAMG,KAAK,GAAAC,OAAA,CAAAD,KAAA,GAAG,SAARA,KAAKA,CAAIE,UAAsB,EAAoB;EAAA,IAAlBC,MAAM,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EACzD,OAAO,UACLG,MAA+B,EAC/BC,IAAY,EACZC,UAA4B,EACzB;IACH,IAAI,CAACN,MAAM,EAAE;MACX,OAAOM,UAAU;IACnB;IAEA,IACE,QAAOA,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEC,KAAK,MAAK,UAAU,IACvC,QAAOD,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEE,WAAW,MAAK,UAAU,EAC7C;MACA,MAAM,IAAIC,KAAK,sBAAAC,MAAA,CAAsBL,IAAI,sBAAmB,CAAC;IAC/D;IACA,IAAIM,EAAyB,GAAGL,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEC,KAAK;IACjD,IAAMC,WAAW,GAAGF,UAAU,CAACE,WAAW;IAC1C;IACA,IAAMI,SAAS,GAAG,SAAZA,SAASA,CAAA,EAA2C;MACxD,IAAIC,SAA4B,GAAG,IAAI;MACvC,IAAI;QACFA,SAAS,GAAG,IAAAC,gBAAM,EAAC,IAAI,CAAC,CAACC,SAAS,CAAEC,GAAG,CAACC,oBAAS,CAAE;MACrD,CAAC,CAAC,OAAOC,CAAC,EAAE;QACV;MAAA;MAEF,IAAI,OAAOV,WAAW,KAAK,UAAU,EAAE;QACrCG,EAAE,GAAGH,WAAW,CAACW,IAAI,CAAC,IAAI,CAAC;MAC7B;MACA,IAAI,OAAOR,EAAE,KAAK,UAAU,EAAE;QAC5B,MAAM,IAAIF,KAAK,sBAAAC,MAAA,CAAsBL,IAAI,wBAAqB,CAAC;MACjE;MAAC,SAAAe,IAAA,GAAAnB,SAAA,CAAAC,MAAA,EAZ4CmB,IAAI,OAAAC,KAAA,CAAAF,IAAA,GAAAG,IAAA,MAAAA,IAAA,GAAAH,IAAA,EAAAG,IAAA;QAAJF,IAAI,CAAAE,IAAA,IAAAtB,SAAA,CAAAsB,IAAA;MAAA;MAajD,IAAMC,MAAM,GAAGb,EAAE,CAACc,KAAK,CAAC,IAAI,EAAEJ,IAAI,CAAC;MACnC,IAAI,CAACR,SAAS,EAAE;QACd,OAAOW,MAAM;MACf;MACA,IAAI;QACF,IAAAE,0BAAY,EAACb,SAAS,EAAEd,UAAU,GAAG,IAAI,EAAAW,MAAA,CAAKW,IAAI,CAAC,CAAC;MACtD,CAAC,CAAC,OAAOH,CAAC,EAAE;QACVS,OAAO,CAACC,IAAI,qBAAAlB,MAAA,CAAqB,IAAAI,gBAAM,EAACV,MAAM,CAAC,CAACyB,UAAU,OAAAnB,MAAA,CAAIL,IAAI,CAAE,CAAC;QACrEsB,OAAO,CAACG,KAAK,CAACZ,CAAC,CAAC;MAClB;MACA,OAAOM,MAAM;IACf,CAAC;IACD;IACA,OAAO;MACLO,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBzB,KAAK,EAAEK;IACT,CAAC;EACH,CAAC;AACH,CAAC","ignoreList":[]}