{"version":3,"file":"SmsMessageStore.js","names":["_messageHelper","require","_services","_services2","_nextCore","_MessageStoreBase2","_MessageStoreEventSubscriber","_dec","_dec2","_dec3","_dec4","_dec5","_dec6","_class","_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","isArray","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","_classCallCheck","_defineProperties","key","_createClass","_toPrimitive","_typeof","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","_assertThisInitialized","ReferenceError","Boolean","valueOf","_inherits","_setPrototypeOf","SmsMessageStore","exports","injectable","target","optional","undefined","metadata","Function","Toast","Auth","Client","DataFetcher","ConnectivityMonitor","MessageStoreEventSubscriber","AppFeatures","AvailabilityMonitor","SmsMessageStoreOptions","_MessageStoreBase","_toast","_auth","_client","_dataFetcher","_connectivityMonitor","_messageEventSubscriber","_appFeatures","_availabilityMonitor","_tabManager","_messageStoreOptions","_this","messageType","messageStoreKey","_messageIsUnreadFunc","directionlessMessageIsUnread","_findTargetMessages","_ref","conversationId","messageId","readStatus","targetMessages","messageList","conversationStore","unreadMessageIds","_this$data","oldDataSet","data","targetConversation","JSON","parse","stringify","targetMessage","find","message","id","preUpdateReadStatus","_ref2","newTargetMessages","map","msg","conversation","lastModifiedTime","pushMessages","rollbackPreUpdateReadStatus","_ref3","rollbackMessages","original","get","hasReadTextPermission","_setConversationAsRead2","_callee","ownerId","updatedMessages","_context","messageIsDeleted","_updateMessagesApi","_setConversationAsRead","_x","MessageStoreBase"],"sources":["src/app/services/Sms/SmsMessageStore.ts"],"sourcesContent":["import type { Message } from '@ringcentral-integration/commons/interfaces/MessageStore.model';\nimport {\n  directionlessMessageIsUnread,\n  messageIsDeleted,\n} from '@ringcentral-integration/commons/lib/messageHelper';\nimport {\n  AppFeatures,\n  Auth,\n  AvailabilityMonitor,\n  Client,\n  ConnectivityMonitor,\n  DataFetcher,\n} from '@ringcentral-integration/micro-auth/src/app/services';\nimport { Toast } from '@ringcentral-integration/micro-core/src/app/services';\nimport { injectable, optional } from '@ringcentral-integration/next-core';\n\nimport { MessageStoreBase } from '../MessageStore/MessageStoreBase';\nimport { MessageStoreEventSubscriber } from '../MessageStoreEventSubscriber';\n\nimport type { SmsMessageStoreOptions } from './SmsMessageStore.interface';\n\ninterface PreUpdateParams {\n  conversationId: string;\n  messageId?: number;\n  readStatus?: 'Read' | 'Unread';\n}\n\ninterface MessageWithTempReadStatus extends Message {\n  preUpdateReadStatus?: Pick<Message, 'readStatus'>;\n}\n\n@injectable({\n  name: 'SmsMessageStore',\n})\nexport class SmsMessageStore extends MessageStoreBase {\n  constructor(\n    protected override _toast: Toast,\n    protected override _auth: Auth,\n    protected override _client: Client,\n    protected override _dataFetcher: DataFetcher,\n    protected override _connectivityMonitor: ConnectivityMonitor,\n    protected override _messageEventSubscriber: MessageStoreEventSubscriber,\n    protected override _appFeatures: AppFeatures,\n    @optional()\n    protected override _availabilityMonitor?: AvailabilityMonitor,\n    @optional('TabManager') protected override _tabManager?: any,\n    @optional('SmsMessageStoreOptions')\n    protected override _messageStoreOptions?: SmsMessageStoreOptions,\n  ) {\n    super(\n      _toast,\n      _auth,\n      _client,\n      _dataFetcher,\n      _connectivityMonitor,\n      _appFeatures,\n      _messageEventSubscriber,\n      _availabilityMonitor,\n      _tabManager,\n      {\n        ..._messageStoreOptions,\n        messageType: ['SMS', 'Text'],\n        messageStoreKey: 'smsMessageStore',\n      },\n    );\n    // in SMS both inbound & outbound SMS could be unread status\n    this._messageIsUnreadFunc = directionlessMessageIsUnread;\n  }\n\n  private _findTargetMessages({\n    conversationId,\n    messageId,\n    readStatus,\n  }: PreUpdateParams) {\n    let targetMessages: MessageWithTempReadStatus[] = [];\n\n    if (readStatus === 'Read') {\n      // Mark as read -> MessageStore.readMessages, multiple messages\n      const messageList = this.conversationStore[conversationId!];\n      if (!messageList || messageList.length === 0) {\n        return;\n      }\n      const unreadMessageIds = messageList.filter(this._messageIsUnreadFunc);\n      if (unreadMessageIds.length === 0) {\n        return;\n      }\n      targetMessages = [...unreadMessageIds];\n    } else {\n      // Mark as unread -> MessageStore.unreadMessage, one messages\n      const oldDataSet = { ...this.data?.conversationStore };\n      if (!oldDataSet) {\n        return;\n      }\n      const targetConversation = JSON.parse(\n        JSON.stringify(oldDataSet[conversationId]),\n      );\n      const targetMessage = targetConversation.find(\n        (message: Message) => message.id === messageId,\n      );\n      targetMessages.push(targetMessage);\n    }\n\n    return targetMessages;\n  }\n\n  /**\n   * manually update the local conversationStore before message-sync back\n   */\n  preUpdateReadStatus({\n    conversationId,\n    messageId,\n    readStatus,\n  }: PreUpdateParams) {\n    const targetMessages = this._findTargetMessages({\n      conversationId,\n      messageId,\n      readStatus,\n    });\n    if (!targetMessages || targetMessages.length === 0) {\n      return;\n    }\n    /*\n     * 'conversation' and 'lastModifiedTime' data structure are must-have\n     * for '_processRawConversationList' & '_processRawConversationStore'\n     * 'lastModifiedTime + 1' to make sure update local message success\n     * add extra 'preUpdateReadStatus' field, which will be erased when sync done\n     */\n    const newTargetMessages = targetMessages.map((msg) => ({\n      ...msg,\n      preUpdateReadStatus: readStatus,\n      conversation: {\n        id: conversationId,\n      },\n      lastModifiedTime: msg.lastModifiedTime! + 1,\n    })) as any;\n    this.pushMessages(newTargetMessages);\n  }\n\n  rollbackPreUpdateReadStatus({ conversationId }: PreUpdateParams) {\n    const messageList = this.conversationStore[\n      conversationId!\n    ] as MessageWithTempReadStatus[];\n    if (!messageList || messageList.length === 0) {\n      return;\n    }\n    const rollbackMessages = messageList\n      .filter((msg) => msg.preUpdateReadStatus)\n      .map((msg) => {\n        const original = {\n          ...msg,\n          conversation: {\n            id: conversationId,\n          },\n          lastModifiedTime: msg.lastModifiedTime! + 1,\n        };\n        delete original.preUpdateReadStatus;\n        return original;\n      }) as any;\n\n    this.pushMessages(rollbackMessages);\n  }\n\n  override get _hasPermission() {\n    return this._appFeatures.hasReadTextPermission;\n  }\n\n  override async _setConversationAsRead(\n    conversationId: Message['conversationId'],\n  ) {\n    const messageList = this.conversationStore[conversationId!];\n    if (!messageList || messageList.length === 0) {\n      return;\n    }\n    const unreadMessageIds = messageList\n      // the only different with MessageStoreBase, could not use the _messageIsUnreadFunc\n      // cause it will mix the preUpdateReadStatus and real readStatus\n      .filter((msg) => msg.readStatus === 'Unread' && !messageIsDeleted(msg))\n      .map((m) => m.id);\n    if (unreadMessageIds.length === 0) {\n      return;\n    }\n\n    const { ownerId } = this._auth;\n    const updatedMessages = await this._updateMessagesApi(\n      unreadMessageIds,\n      'Read',\n    );\n\n    if (ownerId !== this._auth.ownerId) {\n      return;\n    }\n\n    this.pushMessages(updatedMessages);\n  }\n}\n"],"mappings":"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","ignoreList":[]}