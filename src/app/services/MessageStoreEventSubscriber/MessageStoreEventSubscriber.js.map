{"version":3,"file":"MessageStoreEventSubscriber.js","names":["_subscriptionFilters","require","_services","_nextCore","_rxjs","_dec","_dec2","_dec3","_dec4","_dec5","_dec6","_class","_classCallCheck","a","n","TypeError","_defineProperties","e","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","value","_setPrototypeOf","MessageStoreEventSubscriber","exports","injectable","name","target","optional","undefined","metadata","Function","AppFeatures","Subscription","MessageStoreEventSubscriberOptions","_RcModule","_appFeatures","_subscription","_tabManager","_messageStoreEventSubscriberOptions","_this$_subscription","_this","messageEvents","getMessageEvents$","register","filters","subscriptionFilters","messageStore","instantMessage","get","hasReadMessagesPermission","_this2","messageStore$","fromMessage$","pipe","filter","_hasPermission","instantMessage$","RcModule"],"sources":["src/app/services/MessageStoreEventSubscriber/MessageStoreEventSubscriber.ts"],"sourcesContent":["import type MessageEvent from '@rc-ex/core/lib/definitions/MessageEvent';\nimport { subscriptionFilters } from '@ringcentral-integration/commons/enums/subscriptionFilters';\nimport type { WebSocketSubscription as Subscription } from '@ringcentral-integration/micro-auth/src/app/services';\nimport { AppFeatures } from '@ringcentral-integration/micro-auth/src/app/services';\nimport {\n  injectable,\n  optional,\n  RcModule,\n} from '@ringcentral-integration/next-core';\nimport { filter } from 'rxjs';\n\nimport type { MessageStoreEventSubscriberOptions } from './MessageStoreEventSubscriber.interface';\n\n@injectable({\n  name: 'MessageStoreEventSubscriber',\n})\nexport class MessageStoreEventSubscriber extends RcModule {\n  constructor(\n    protected _appFeatures: AppFeatures,\n    @optional('Subscription') protected _subscription?: Subscription,\n    @optional('TabManager') protected _tabManager?: any,\n    @optional('MessageStoreEventSubscriberOptions')\n    protected _messageStoreEventSubscriberOptions?: MessageStoreEventSubscriberOptions,\n  ) {\n    super();\n\n    this._subscription?.register(this, {\n      filters: [\n        subscriptionFilters.messageStore,\n        subscriptionFilters.instantMessage,\n      ],\n    });\n  }\n\n  get _hasPermission() {\n    return this._appFeatures.hasReadMessagesPermission;\n  }\n\n  messageEvents = this.getMessageEvents$();\n\n  private getMessageEvents$() {\n    const _subscription = this._subscription;\n    if (!_subscription) return;\n\n    const messageStore$ = _subscription\n      .fromMessage$<MessageEvent['body']>(/\\/message-store$/)\n      .pipe(filter(() => this._hasPermission));\n    const instantMessage$ = _subscription\n      .fromMessage$<MessageEvent['body']>(/\\/message-store\\/instant\\?type=SMS$/)\n      .pipe(filter(() => this._hasPermission));\n\n    return {\n      messageStore$,\n      instantMessage$,\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}