{"version":3,"file":"RateLimiter.js","names":["_services","require","_views","_nextCore","_useInterval2","_react","_interopRequireWildcard","_Client","_Environment","_errorMessages","_i18n","_dec","_dec2","_dec3","_dec4","_dec5","_dec6","_dec7","_dec8","_dec9","_dec0","_class","_class2","_descriptor","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","u","next","done","push","value","isArray","_regenerator","toStringTag","c","prototype","Generator","create","_regeneratorDefine2","p","y","G","v","d","bind","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","displayName","w","m","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","initializer","_classCallCheck","_defineProperties","_toPropertyKey","key","_createClass","_toPrimitive","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","_assertThisInitialized","ReferenceError","Boolean","valueOf","_inherits","_setPrototypeOf","_applyDecoratedDescriptor","keys","forEach","reverse","reduce","_initializerWarningHelper","Error","DEFAULT_THROTTLE_DURATION","calculateTimeRemaining","duration","timestamp","Math","max","floor","Date","now","RateLimiter","exports","injectable","target","optional","undefined","metadata","Function","Toast","Client","StoragePlugin","Environment","RateLimiterOptions","delegate","_RcModule","_toast","_client","_storage","_environment","_rateLimiterOptions","_this$_rateLimiterOpt","_this$_rateLimiterOpt2","_this","_timeoutId","_unbindHandlers","_ttl","_beforeRequestHandler","restricted","errorMessages","rateLimitReached","_requestErrorHandler","error","message","response","retryAfter","headers","parseInt","showAlert","throttleDuration","_this$_rateLimiterOpt3","_this$_rateLimiterOpt4","suppressAlerts","onInitOnce","_this2","watch","changeCounter","ready","_bindHandlers","onInit","_showAlert","_callee","_context","_suppressAlerts","open","rateLimitReachedToast","_this3","toasts","some","toast","group","identifier","_this4","client","service","on","events","requestError","beforeRequest","removeListener","RcModule","portal","_this5","view","_useToastItemView","useToastItemView","props","initTiming","useMemo","ttl","_useState","useState","_useState2","setTtl","_useInterval","useInterval","newTtl","cancel","createElement","Fragment","level","computed"],"sources":["src/app/services/RateLimiter/RateLimiter.tsx"],"sourcesContent":["/* eslint-disable react-hooks/rules-of-hooks */\nimport { Toast } from '@ringcentral-integration/micro-core/src/app/services';\nimport { useToastItemView } from '@ringcentral-integration/micro-core/src/app/views';\nimport {\n  computed,\n  delegate,\n  injectable,\n  optional,\n  portal,\n  RcModule,\n  StoragePlugin,\n  watch,\n} from '@ringcentral-integration/next-core';\nimport { useInterval } from '@ringcentral/juno';\nimport type { ApiError } from '@ringcentral/sdk';\nimport React, { useMemo, useState } from 'react';\n\nimport { Client } from '../Client';\nimport { Environment } from '../Environment';\n\nimport type { RateLimiterOptions } from './RateLimiter.interface';\nimport { errorMessages } from './errorMessages';\nimport { t } from './i18n';\n\nconst DEFAULT_THROTTLE_DURATION = 61 * 1000;\n\nfunction calculateTimeRemaining(duration: number, timestamp: number) {\n  return Math.max(Math.floor((duration - (Date.now() - timestamp)) / 1000), 0);\n}\n\n@injectable({\n  name: 'RateLimiter',\n})\nexport class RateLimiter extends RcModule {\n  protected _timeoutId: NodeJS.Timeout | null = null;\n  protected _unbindHandlers: (() => void) | null = null;\n  protected _ttl: number = DEFAULT_THROTTLE_DURATION;\n\n  @portal\n  private rateLimitReachedToast = this._toast.create({\n    view: () => {\n      const { props } = useToastItemView();\n\n      const initTiming = useMemo(\n        () => calculateTimeRemaining(props.ttl, props.timestamp),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [],\n      );\n\n      const [ttl, setTtl] = useState(initTiming);\n      const { cancel } = useInterval(() => {\n        const newTtl = ttl - 1;\n        setTtl(newTtl);\n        if (newTtl === 0) {\n          cancel();\n        }\n      }, 1000);\n\n      return <>{t('rateLimitReached', { ttl })}</>;\n    },\n    props: () => ({\n      level: 'warning',\n      ttl: this._ttl,\n      group: this.identifier,\n    }),\n  });\n\n  constructor(\n    protected _toast: Toast,\n    protected _client: Client,\n    protected _storage: StoragePlugin,\n    @optional() protected _environment?: Environment,\n    @optional('RateLimiterOptions')\n    protected _rateLimiterOptions?: RateLimiterOptions,\n  ) {\n    super();\n\n    this._ttl =\n      this._rateLimiterOptions?.throttleDuration ?? DEFAULT_THROTTLE_DURATION;\n  }\n\n  get _suppressAlerts() {\n    return this._rateLimiterOptions?.suppressAlerts ?? false;\n  }\n\n  override onInitOnce() {\n    if (this._environment) {\n      watch(\n        this,\n        () => this._environment!.changeCounter,\n        () => {\n          if (this.ready) {\n            this._bindHandlers();\n          }\n        },\n      );\n    }\n  }\n\n  override onInit() {\n    this._bindHandlers();\n  }\n\n  /**\n   * If the app is restricted, an incoming request will lead to an exception\n   */\n  _beforeRequestHandler = () => {\n    if (this.restricted) {\n      throw new Error(errorMessages.rateLimitReached);\n    }\n  };\n\n  @delegate('server')\n  async showAlert() {\n    if (this._suppressAlerts || this.restricted) {\n      return;\n    }\n\n    return this._toast.open(this.rateLimitReachedToast);\n  }\n\n  _requestErrorHandler = (error: ApiError) => {\n    if (\n      !(error instanceof Error) ||\n      error.message !== 'Request rate exceeded'\n    ) {\n      return;\n    }\n\n    // Get `retry-after` from response headers first\n    this._ttl = DEFAULT_THROTTLE_DURATION;\n    if (error.response) {\n      const retryAfter = error.response.headers.get('retry-after');\n      if (retryAfter) {\n        this._ttl = 1000 * Number.parseInt(retryAfter, 10);\n      }\n    }\n\n    this.showAlert();\n  };\n\n  @computed\n  get restricted() {\n    return this._toast.toasts.some((toast) => {\n      return toast.group === this.identifier;\n    });\n  }\n\n  _bindHandlers() {\n    if (this._unbindHandlers) {\n      this._unbindHandlers();\n    }\n    const client = this._client.service.client();\n    client.on(client.events.requestError, this._requestErrorHandler);\n    client.on(client.events.beforeRequest, this._beforeRequestHandler);\n    this._unbindHandlers = () => {\n      client.removeListener(\n        client.events.requestError,\n        this._requestErrorHandler,\n      );\n      client.removeListener(\n        client.events.beforeRequest,\n        this._beforeRequestHandler,\n      );\n      this._unbindHandlers = null;\n    };\n  }\n\n  get throttleDuration() {\n    return this._ttl;\n  }\n}\n"],"mappings":"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","ignoreList":[]}