{"version":3,"file":"useContactRenderInfo.js","names":["_callResults","require","_callLogHelpers","_formatDuration","_messageHelper","_components","_components2","_hooks","_helpers","_nextCore","_DurationCounter","_springIcon","_springUi","_clsx","_interopRequireDefault","_react","_interopRequireWildcard","_helpers2","_CallHistory","_components3","_ContactAvatarByRenderInfo","_i18n","_utils","_excluded","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","_objectWithoutProperties","_objectWithoutPropertiesLoose","getOwnPropertySymbols","indexOf","propertyIsEnumerable","useContactRenderInfoFromCall","exports","options","undefined","_useLocale","useLocale","i18n","contactRendererOptions","useContainer","isQueue","isQueueCall","callQueueName","getDisplayCallQueueName","callFrom","from","callTo","to","direction","webphoneSession","startTime","offset","isInbound","isInboundCall","ringing","isRingingCall","otherDevice","isOtherDeviceCall","holding","isHoldingCall","controllable","_options$phoneNumberD","phoneNumberDisplayMode","extensionNumber","phoneNumber","matches","fromMatches","toMatches","callerId","fromUserName","toUserName","callSelectionInfo","renderInfo","getContactDisplayInfo","queueName","displaySelection","displayedSelection","selections","getDefaultCrmMatch","getContactDisplayTextFn","useGetContactDisplayTextFn","conferenceParticipantsInfoFnList","useMemo","_call$conferenceParti","conferenceParticipants","map","conferenceParticipant","index","_call$conferenceParti2","_participantRenderInf","_ref","participantQueueName","participantRenderInfo","info","conferenceParticipantsMatchesList","participantBeQueue","Boolean","matchedContact","isCallQueueNumber","Avatar","_ref2","size","createElement","ContactAvatarByRenderInfo","isConferenceCall","data","result","ContactDisplayRender","displayName","fromInfo","useFormatExtOrPhoneNumber","fromInfoHideBlocked","toInfo","callStatusText","CallStatus","useCallback","_ref3","children","className","clsx","OnOtherDevice","_ref4","_ref4$mode","mode","rest","Tooltip","title","placement","Icon","symbol","MobileMd","Tag","color","variant","_ref5","DisplayName","props","text","fn","filter","x","isHost","join","displayPhoneNumber","hideBlockedFromInfo","myCallerId","duration","DurationCounter","useContactRenderInfoFromCallHistory","currentCallLog","_ref6","_ref6$startTimeMode","startTimeMode","_ref6$hideBlockedFrom","_ref6$showLogInfo","showLogInfo","_ref6$phoneNumberDisp","delaySavingState","DelayComponent","_useLocale2","formattedPhoneNumberFn","useFormattedPhoneNumberFn","isMissed","isMissedCall","useFormattedDateFromNow","formatDurationWithLocale","day","hr","min","sec","ringingElsewhere","callResults","queueCallDisplayMode","answeredElsewhere","answeredByDelegate","delegate","hasAiNotes","hasSmartNote","Status","_ref7","_ref7$mode","queueCallRender","answeredByText","concat","name","queueCallDisplayModeNode","displayDuration","DelegatedCallsMd","ActiveCallMd","toLowerCase","MissedCallMd","IncomingCallMd","OutgoingCallMd","Fragment","SmartNotesMd","isQueueHistoryCall","signalSourceInfo","serverName","isLogged","formattedPhoneNumber","dialToPhoneNumber","_ref8","copyNumber","copyWithResultMessage","getActionInfo","type","myCallerIdTitle","logged","LogInfo","showViewLogIcon","useContactRenderInfoFromConversation","conversation","_conversation$faxAtta","_conversation$voicema","_displayInfoList$","_ref9","_ref9$timePresentatio","timePresentationMode","_ref9$displayLogStatu","displayLogStatus","_ref9$hasCrmLogged","hasCrmLogged","_ref9$phoneNumberDisp","_ref9$isOptOut","isOptOut","_useLocale3","isTextMessage","messageIsTextMessage","isFax","messageIsFax","isVoicemail","messageIsVoicemail","markAble","messageStatus","faxAttachmentExist","faxAttachment","uri","voicemailAttachmentExist","voicemailAttachment","creationTime","callSelf","self","correspondents","lastMatchedCorrespondentEntity","conversationMatches","correspondentMatches","correspondentMatchesList","singleCorrespondent","multiMatchForSingleCorrespondent","selectedIndex","correspondentMatchId","id","findIndex","contact","_useMemo","displayInfoList","correspondentsDisplayInfoMap","Map","correspondent","isMultipleCorrespondent","nonSupportSelectionType","getDisplayedSelectedEntity","conversationId","alwaysShowFirstMatch","detail","getDetail","_getIconInfo","getIconInfo","icon","displayDescription","InfoMd","unreadCounts","signalTo","_ref0","ContactAvatar","contactName","MeetingMd","displayType","Unread","Badge","count","faxAttachmentUri","faxAttachmentDownloadUri","voicemailAttachmentUri"],"sources":["src/app/hooks/useContactRenderInfo/useContactRenderInfo.tsx"],"sourcesContent":["import { callResults } from '@ringcentral-integration/commons/enums/callResults';\nimport type { Call as ICall } from '@ringcentral-integration/commons/interfaces/Call.interface';\nimport { Entity } from '@ringcentral-integration/commons/interfaces/Entity.interface';\nimport {\n  isInbound as isInboundCall,\n  isMissed as isMissedCall,\n} from '@ringcentral-integration/commons/lib/callLogHelpers';\nimport { formatDurationWithLocale } from '@ringcentral-integration/commons/lib/formatDuration';\nimport {\n  messageIsFax,\n  messageIsTextMessage,\n  messageIsVoicemail,\n} from '@ringcentral-integration/commons/lib/messageHelper';\nimport { useFormattedPhoneNumberFn } from '@ringcentral-integration/micro-auth/src/app/components';\nimport { ContactAvatar } from '@ringcentral-integration/micro-contacts/src/app/components';\nimport { useLocale } from '@ringcentral-integration/micro-core/src/app/hooks';\nimport type {\n  CorrespondentMatch,\n  FormattedConversation,\n} from '@ringcentral-integration/micro-message/src/app/services';\nimport {\n  getDetail,\n  getIconInfo,\n} from '@ringcentral-integration/micro-message/src/app/views/ConversationsViewSpring/ConversationsPage/ConversationsListItem/helpers';\nimport { useContainer } from '@ringcentral-integration/next-core';\nimport { DurationCounter } from '@ringcentral-integration/widgets/components/DurationCounter';\nimport {\n  ActiveCallMd,\n  DelegatedCallsMd,\n  InfoMd,\n  IncomingCallMd,\n  MeetingMd,\n  MissedCallMd,\n  MobileMd,\n  OutgoingCallMd,\n  SmartNotesMd,\n} from '@ringcentral/spring-icon';\nimport {\n  type AvatarProps,\n  Badge,\n  type BadgeProps,\n  Icon,\n  Tag,\n  type TagProps,\n  Tooltip,\n} from '@ringcentral/spring-ui';\nimport clsx from 'clsx';\nimport React, { FunctionComponent, useCallback, useMemo } from 'react';\n\nimport {\n  getDisplayCallQueueName,\n  isHoldingCall,\n  isOtherDeviceCall,\n  isQueueCall,\n  isRingingCall,\n} from '../../services/ActiveCallControl/helpers';\nimport {\n  type HistoryCall,\n  isQueueHistoryCall,\n} from '../../services/CallHistory';\n\nimport {\n  ContactDisplayRender,\n  ContactDisplayRenderProps,\n  LogInfo,\n  useFormatExtOrPhoneNumber,\n  useGetContactDisplayTextFn,\n} from './components';\nimport { ContactAvatarByRenderInfo } from './components/ContactAvatarByRenderInfo';\nimport i18n from './i18n';\nimport {\n  type ContactDisplayInfo,\n  copyWithResultMessage,\n  getContactDisplayInfo,\n  GetContactDisplayInfoOptions,\n  useFormattedDateFromNow,\n} from './utils';\n\ntype EntityOrCorrespondentMatch = Entity | CorrespondentMatch;\n\nexport type ContactRendererOptions = {\n  onSelectContact?: (\n    data:\n      | {\n          type: 'conversation';\n          source: FormattedConversation;\n          entity: EntityOrCorrespondentMatch;\n        }\n      // TODO: rest of types still not implement\n      | {\n          type: 'call';\n          source: ICall;\n          entity: EntityOrCorrespondentMatch;\n        }\n      | {\n          type: 'callHistory';\n          source: HistoryCall;\n          entity: EntityOrCorrespondentMatch;\n        },\n  ) => void;\n  getDisplayedSelectedEntity?: (\n    selection: EntityOrCorrespondentMatch[],\n    conversationId?: string,\n  ) => EntityOrCorrespondentMatch | undefined;\n  getDefaultCrmMatch?: (\n    matches: Array<EntityOrCorrespondentMatch>,\n  ) => EntityOrCorrespondentMatch | undefined;\n};\n\nexport const useContactRenderInfoFromCall = (\n  call: ICall,\n  options: {\n    hideBlockedFromInfo?: boolean;\n  } & Pick<GetContactDisplayInfoOptions<any>, 'phoneNumberDisplayMode'> = {},\n) => {\n  const { t } = useLocale(i18n);\n\n  const contactRendererOptions = useContainer<ContactRendererOptions, true>(\n    'ContactRendererOptions',\n  );\n\n  const isQueue = isQueueCall(call);\n  const callQueueName = getDisplayCallQueueName(call);\n  const callFrom = call.from || {};\n  const callTo = call.to || {};\n  const { direction, webphoneSession, startTime, offset } = call;\n  const isInbound = isInboundCall(call);\n  const ringing = isRingingCall(call);\n  const otherDevice = isOtherDeviceCall(call);\n  const holding = isHoldingCall(call);\n  const controllable = !!webphoneSession;\n  const { phoneNumberDisplayMode = 'phoneNumber' } = options;\n\n  const extensionNumber = isInbound\n    ? callFrom.extensionNumber\n    : callTo.extensionNumber;\n\n  const phoneNumber = isInbound ? callFrom.phoneNumber : callTo.phoneNumber;\n  const matches = isInbound ? call.fromMatches : call.toMatches;\n\n  // const activeCallControlCallerIdName = isInbound ? callFrom.name : callTo.name;\n\n  // active call control api return the wrong data during the call process in XMN-up, so we use webphone data only for webphone call, not have correct callerIdName, so we use the webphone data\n  const callerId = isInbound\n    ? webphoneSession?.fromUserName\n    : webphoneSession?.toUserName;\n\n  const callSelectionInfo = call.callSelectionInfo;\n\n  const renderInfo = getContactDisplayInfo({\n    callerId,\n    queueName: callQueueName,\n    matches,\n    phoneNumber,\n    extensionNumber,\n    phoneNumberDisplayMode,\n    displaySelection: callSelectionInfo?.displayedSelection,\n    selections: callSelectionInfo?.selections,\n    getDefaultCrmMatch: contactRendererOptions?.getDefaultCrmMatch,\n  });\n  const getContactDisplayTextFn = useGetContactDisplayTextFn();\n\n  // TODO: the conference view able still not support\n  const conferenceParticipantsInfoFnList = useMemo(\n    () =>\n      call.conferenceParticipants?.map(\n        (conferenceParticipant, index) =>\n          ({\n            phoneNumberDisplayMode,\n          }: Pick<\n            GetContactDisplayInfoOptions<any>,\n            'phoneNumberDisplayMode'\n          > = {}) => {\n            const participantQueueName = conferenceParticipant.queueName;\n            const participantRenderInfo = getContactDisplayInfo({\n              // active call control api return the wrong data during the call process in XMN-up, so we use webphone data only for webphone call, not have correct callerIdName, so we use the webphone data\n              // conferenceParticipant.info.name,\n              callerId: undefined,\n              queueName: callQueueName,\n              phoneNumber: conferenceParticipant.info.phoneNumber,\n              extensionNumber: conferenceParticipant.info.extensionNumber,\n              matches: call.conferenceParticipantsMatchesList?.[index],\n              phoneNumberDisplayMode,\n            });\n            const participantBeQueue = Boolean(\n              participantQueueName ||\n                participantRenderInfo.matchedContact?.isCallQueueNumber,\n            );\n\n            const Avatar = ({ size }: Pick<AvatarProps, 'size'>) => (\n              <ContactAvatarByRenderInfo\n                isQueue={participantBeQueue}\n                isConferenceCall={false}\n                renderInfo={participantRenderInfo}\n                size={size}\n              />\n            );\n\n            return {\n              data: conferenceParticipant,\n              renderInfo: participantRenderInfo,\n              result: (\n                <ContactDisplayRender\n                  info={participantRenderInfo}\n                  callQueueName={participantQueueName}\n                  // TODO: conference call display control not implemented\n                  // displayControl={{\n                  //   viewable: false,\n                  // }}\n                />\n              ),\n              /**\n               * plain text display name\n               */\n              displayName: getContactDisplayTextFn({\n                renderInfo: participantRenderInfo,\n                callQueueName: participantQueueName,\n              }) as string,\n              Avatar,\n            };\n          },\n      ),\n    [call, callQueueName, getContactDisplayTextFn],\n  );\n\n  const isConferenceCall = Boolean(call.isConferenceCall);\n\n  const fromInfo = useFormatExtOrPhoneNumber(callFrom);\n  const fromInfoHideBlocked = useFormatExtOrPhoneNumber(callFrom, true);\n  const toInfo = useFormatExtOrPhoneNumber(callTo);\n\n  const callStatusText = useMemo(() => {\n    if (ringing) return t('Inbound');\n    if (holding) return t('onHold');\n\n    return t('activeCall');\n  }, [holding, ringing, t]);\n\n  const CallStatus = useCallback<FunctionComponent>(\n    ({ children }) => (\n      <div\n        className={clsx(\n          ringing && 'text-success-f',\n          holding && 'text-warning-high-contrast',\n          !ringing && !holding && 'text-danger-f',\n        )}\n      >\n        <span className=\"mr-1\">{callStatusText}</span>\n\n        {children}\n      </div>\n    ),\n    [ringing, holding, callStatusText],\n  );\n\n  const OnOtherDevice = useCallback<\n    FunctionComponent<\n      {\n        /**\n         * @default 'text'\n         */\n        mode?: 'icon' | 'text';\n      } & TagProps\n    >\n  >(\n    ({ mode = 'text', ...rest }) => {\n      if (mode === 'icon')\n        return (\n          <Tooltip title={t('otherDevice')} placement=\"top\">\n            <Icon data-sign=\"onOtherDevice\" symbol={MobileMd} size=\"small\" />\n          </Tooltip>\n        );\n\n      return (\n        <Tag\n          data-sign=\"onOtherDevice\"\n          color=\"neutral\"\n          variant=\"inverted\"\n          {...rest}\n        >\n          {t('otherDevice')}\n        </Tag>\n      );\n    },\n    [t],\n  );\n\n  const Avatar = useCallback(\n    ({ size }: Pick<AvatarProps, 'size'>) => (\n      <ContactAvatarByRenderInfo\n        isQueue={isQueue}\n        isConferenceCall={isConferenceCall}\n        renderInfo={renderInfo}\n        size={size}\n      />\n    ),\n    [isConferenceCall, renderInfo, isQueue],\n  );\n\n  return {\n    DisplayName: (props: Pick<ContactDisplayRenderProps, 'displayControl'>) => {\n      if (isConferenceCall) {\n        const text = conferenceParticipantsInfoFnList\n          ?.map((fn) =>\n            // the conference call participant show the phone number for group name\n            fn({ phoneNumberDisplayMode: 'phoneNumber' }),\n          )\n          .filter((x) => !x.data.isHost)\n          .map((x) => x.displayName)\n          .join(', ');\n        // TODO: the conference view able still not support\n        return (\n          <span title={text} className=\"truncate\">\n            {text}\n          </span>\n        );\n      }\n\n      return (\n        <ContactDisplayRender\n          info={renderInfo}\n          callQueueName={callQueueName}\n          {...props}\n        />\n      );\n    },\n    displayPhoneNumber: isInbound\n      ? options?.hideBlockedFromInfo\n        ? fromInfoHideBlocked\n        : fromInfo\n      : toInfo,\n    Avatar,\n    myCallerId: isInbound ? toInfo : fromInfo,\n    duration: <DurationCounter startTime={startTime} offset={offset} />,\n    CallStatus,\n    OnOtherDevice: otherDevice ? OnOtherDevice : null,\n    // basic info\n    direction,\n    isInbound,\n    ringing,\n    holding,\n    controllable,\n    conferenceParticipantsInfoFnList,\n    callQueueName,\n  };\n};\n\nexport const useContactRenderInfoFromCallHistory = (\n  currentCallLog: HistoryCall,\n  {\n    startTimeMode = 'withTime',\n    hideBlockedFromInfo = false,\n    showLogInfo = false,\n    phoneNumberDisplayMode = 'unknown',\n    delaySavingState,\n    DelayComponent,\n  }: {\n    /**\n     * how to display the startTime\n     *\n     * @default 'withTime'\n     */\n    startTimeMode?: 'withoutTime' | 'withTime';\n    /**\n     * hide blocked number from info\n     *\n     * @default false\n     */\n    hideBlockedFromInfo?: boolean;\n    /**\n     * should show log status info\n     *\n     * @default false\n     */\n    showLogInfo?: boolean;\n    // TODO: should move out of here, should update in the usage place of component instead\n    /**\n     * delay saving state for the current call\n     */\n    delaySavingState?: {\n      delayUpdatingStartTime: number;\n      delayUpdatingMinutes: number;\n    } | null;\n    /**\n     * custom component to render the delay countdown\n     */\n    DelayComponent?: React.ComponentType<{\n      startTime: number;\n      durationMinutes: number;\n    }>;\n  } & Pick<GetContactDisplayInfoOptions<any>, 'phoneNumberDisplayMode'> = {},\n) => {\n  const { t } = useLocale(i18n);\n  const formattedPhoneNumberFn = useFormattedPhoneNumberFn();\n\n  const contactRendererOptions = useContainer<ContactRendererOptions, true>(\n    'ContactRendererOptions',\n  );\n\n  const result = currentCallLog.result;\n\n  const direction = currentCallLog.direction;\n  const isInbound = currentCallLog && isInboundCall(currentCallLog);\n  const isMissed =\n    isInbound &&\n    currentCallLog &&\n    isMissedCall({ result: currentCallLog.result });\n  const startTime = useFormattedDateFromNow(\n    currentCallLog.startTime,\n    startTimeMode,\n  );\n\n  const duration = useMemo(\n    () =>\n      formatDurationWithLocale(currentCallLog.duration, {\n        day: t('day'),\n        hr: t('hr'),\n        min: t('min'),\n        sec: t('sec'),\n      }),\n    [currentCallLog.duration, t],\n  );\n\n  const ringingElsewhere = (result as any) === callResults.ringingElsewhere;\n  // TODO: maybe need upgrade `@rc-ex/core`\n  const queueCallDisplayMode =\n    (result as any) === callResults.answeredElsewhere || ringingElsewhere;\n\n  const answeredByDelegate = currentCallLog.delegate;\n  const hasAiNotes = currentCallLog.hasSmartNote;\n\n  const Status = useCallback<\n    FunctionComponent<{\n      /**\n       * @default 'text'\n       */\n      mode?: 'icon' | 'text';\n    }>\n  >(\n    ({ mode = 'text' }) => {\n      if (!result || !direction) return null;\n\n      const queueCallRender = () => {\n        const answeredByText = answeredByDelegate\n          ? `${t('answeredBy')} ${answeredByDelegate?.name}`\n          : undefined;\n\n        const queueCallDisplayModeNode = answeredByDelegate ? (\n          <span\n            className=\"truncate\"\n            data-sign=\"answered-by\"\n            title={answeredByText}\n          >\n            {answeredByText}\n          </span>\n        ) : (\n          <span>{t(result)}</span>\n        );\n\n        return queueCallDisplayModeNode;\n      };\n\n      if (mode === 'text') {\n        if (queueCallDisplayMode) {\n          return queueCallRender();\n        }\n\n        const displayDuration = duration ? `(${duration})` : '';\n        return (\n          <span\n            className={isMissed ? 'text-danger-f' : 'text-success-f'}\n            data-sign=\"callDetailInfoResult\"\n          >\n            {isMissed ? t('Missed') : `${t(direction)} ${displayDuration}`}\n          </span>\n        );\n      }\n\n      if (queueCallDisplayMode) {\n        return (\n          <div className=\"flex gap-1 items-center pt-0.5\" data-sign={result}>\n            <Icon\n              size=\"small\"\n              data-sign={\n                answeredByDelegate ? 'delegate-icon' : 'active-call-icon'\n              }\n              symbol={answeredByDelegate ? DelegatedCallsMd : ActiveCallMd}\n            />\n            {queueCallRender()}\n          </div>\n        );\n      }\n\n      return (\n        <div\n          className={clsx(\n            'flex gap-1 items-center pt-0.5',\n            isMissed && 'text-danger',\n          )}\n          data-sign={`status-${isMissed ? 'missed' : direction.toLowerCase()}`}\n        >\n          <Icon\n            size=\"small\"\n            data-sign={\n              isMissed\n                ? 'missed-icon'\n                : isInbound\n                ? 'incoming-icon'\n                : 'outgoing-icon'\n            }\n            symbol={\n              isMissed\n                ? MissedCallMd\n                : isInbound\n                ? IncomingCallMd\n                : OutgoingCallMd\n            }\n            className={isMissed ? 'text-inherit' : undefined}\n          />\n          <span data-sign=\"duration\">{isMissed ? t('Missed') : duration}</span>\n          {hasAiNotes && (\n            <>\n              <Icon size=\"small\" symbol={SmartNotesMd} />\n              <span data-sign=\"aiNote\">{t('notes')}</span>\n            </>\n          )}\n        </div>\n      );\n    },\n    [\n      queueCallDisplayMode,\n      answeredByDelegate,\n      direction,\n      duration,\n      hasAiNotes,\n      isInbound,\n      isMissed,\n      result,\n      t,\n    ],\n  );\n\n  const isQueue = isQueueHistoryCall(currentCallLog);\n  const callQueueName = getDisplayCallQueueName(currentCallLog);\n\n  const callFrom = currentCallLog.from || {};\n  const callTo = currentCallLog.to || {};\n\n  const signalSourceInfo = isInbound ? callFrom : callTo;\n  const phoneNumber = signalSourceInfo.phoneNumber;\n  const extensionNumber = isInbound\n    ? callFrom.extensionNumber\n    : callTo.extensionNumber;\n\n  const matches = isInbound\n    ? currentCallLog.fromMatches\n    : currentCallLog.toMatches;\n  const serverName = isInbound ? callFrom.name : callTo.name;\n  const callSelectionInfo = currentCallLog.callSelectionInfo;\n\n  const renderInfo = getContactDisplayInfo({\n    serverName,\n    queueName: callQueueName,\n    matches,\n    phoneNumber,\n    extensionNumber,\n    phoneNumberDisplayMode,\n    displaySelection: callSelectionInfo?.displayedSelection,\n    selections: callSelectionInfo?.selections,\n    getDefaultCrmMatch: contactRendererOptions?.getDefaultCrmMatch,\n  });\n\n  const isConferenceCall = Boolean(currentCallLog.isConferenceCall);\n\n  const fromInfo = useFormatExtOrPhoneNumber(callFrom);\n  const fromInfoHideBlocked = useFormatExtOrPhoneNumber(\n    callFrom,\n    hideBlockedFromInfo,\n  );\n  const toInfo = useFormatExtOrPhoneNumber(callTo);\n\n  const isLogged = currentCallLog.isLogged;\n  const formattedPhoneNumber = renderInfo.dialToPhoneNumber\n    ? formattedPhoneNumberFn(renderInfo.dialToPhoneNumber)\n    : '';\n\n  const Avatar = useCallback(\n    ({ size }: Pick<AvatarProps, 'size'>) => (\n      <ContactAvatarByRenderInfo\n        isConferenceCall={isConferenceCall}\n        isQueue={isQueue}\n        renderInfo={renderInfo}\n        size={size}\n      />\n    ),\n    [isConferenceCall, isQueue, renderInfo],\n  );\n\n  const copyNumber = () => {\n    return copyWithResultMessage(formattedPhoneNumber);\n  };\n\n  /**\n   * get info when want to call the entity or send message to the entity\n   */\n  const getActionInfo = () => {\n    const matchedContact = renderInfo.matchedContact as Entity;\n    if (matchedContact?.name) {\n      return {\n        phoneNumber: formattedPhoneNumber,\n        name: matchedContact.name,\n        type: matchedContact.type,\n      };\n    }\n\n    if (formattedPhoneNumber) {\n      return {\n        phoneNumber: formattedPhoneNumber,\n      };\n    }\n\n    return undefined;\n  };\n\n  return {\n    DisplayName: (props: Pick<ContactDisplayRenderProps, 'displayControl'>) => {\n      // in call history be conference call, we show that be conference call\n      if (isConferenceCall) return <span>{t('conferenceCall')}</span>;\n\n      return (\n        <ContactDisplayRender\n          info={renderInfo}\n          callQueueName={callQueueName}\n          isMissed={isMissed}\n          {...props}\n        />\n      );\n    },\n    displayPhoneNumber: isInbound\n      ? hideBlockedFromInfo\n        ? fromInfoHideBlocked\n        : fromInfo\n      : toInfo,\n    Avatar,\n    myCallerIdTitle: isInbound ? t('to') : t('from'),\n    myCallerId: isInbound ? toInfo : fromInfo,\n    startTime,\n    duration,\n    Status,\n    callQueueName,\n    isConferenceCall,\n    // basic info\n    isInbound,\n    renderInfo,\n    signalSourceInfo,\n    formattedPhoneNumber,\n    logged: showLogInfo ? (\n      <LogInfo\n        logged={isLogged}\n        delaySavingState={delaySavingState}\n        DelayComponent={DelayComponent}\n      />\n    ) : null,\n    showViewLogIcon: Boolean(showLogInfo && isLogged),\n    ringingElsewhere,\n    answeredByDelegate,\n    copyNumber,\n    getActionInfo,\n  };\n};\n\nexport const useContactRenderInfoFromConversation = (\n  conversation: FormattedConversation,\n  {\n    timePresentationMode = 'withTime',\n    displayLogStatus = false,\n    hasCrmLogged = false,\n    phoneNumberDisplayMode = 'phoneNumber',\n    isOptOut = false,\n  }: {\n    /**\n     * how to display the startTime\n     *\n     * @default 'withTime'\n     */\n    timePresentationMode?: 'withoutTime' | 'withTime';\n    displayLogStatus?: boolean;\n    hasCrmLogged?: boolean;\n    /**\n     * for no matched contact but with/without server name display logic\n     *\n     * Currently, only in voicemail detail, display 'Unknown'\n     * In other conversations list or detail, display the phone number directly\n     */\n    phoneNumberDisplayMode?: 'unknown' | 'phoneNumber';\n    /**\n     * whether the conversation is opted out\n     *\n     * @default false\n     */\n    isOptOut?: boolean;\n  } = {},\n) => {\n  const { t } = useLocale(i18n);\n  const formattedPhoneNumberFn = useFormattedPhoneNumberFn();\n\n  const contactRendererOptions = useContainer<ContactRendererOptions, true>(\n    'ContactRendererOptions',\n  );\n\n  const isInbound = isInboundCall(conversation);\n  const isTextMessage = messageIsTextMessage(conversation);\n  const isFax = messageIsFax(conversation);\n  const isVoicemail = messageIsVoicemail(conversation);\n  const markAble =\n    // TODO: currently we not support mark text message, so we just mark voicemail and fax\n    // the mark text message in jupiter that just mark the first message of the conversation\n    // isTextMessage ||\n    isVoicemail || (isFax && isInbound);\n  const messageStatus = conversation.messageStatus;\n  const faxAttachmentExist = Boolean(\n    isFax &&\n      (messageStatus === 'Sent' || messageStatus === 'Received') &&\n      conversation.faxAttachment?.uri,\n  );\n  const voicemailAttachmentExist = Boolean(\n    isVoicemail && conversation.voicemailAttachment?.uri,\n  );\n\n  const creationTime = useFormattedDateFromNow(\n    conversation.creationTime,\n    timePresentationMode,\n  );\n\n  const callFrom = conversation.from!;\n  const callTo = conversation.to;\n  const callSelf = conversation.self;\n\n  const fromInfo = useFormatExtOrPhoneNumber(callFrom);\n  const toInfo = useFormatExtOrPhoneNumber(callSelf);\n\n  const {\n    correspondents,\n    lastMatchedCorrespondentEntity,\n    conversationMatches,\n    correspondentMatches,\n    correspondentMatchesList,\n  } = conversation;\n\n  const singleCorrespondent = correspondents.length === 1;\n  const multiMatchForSingleCorrespondent =\n    singleCorrespondent &&\n    correspondentMatchesList.length === 1 &&\n    correspondentMatchesList[0].length > 1;\n\n  const selectedIndex = useMemo(() => {\n    // when not multi-match for singleCorrespondent, should select the first one\n    if (!multiMatchForSingleCorrespondent) return 0;\n    const correspondentMatchId =\n      (lastMatchedCorrespondentEntity && lastMatchedCorrespondentEntity.id) ||\n      (conversationMatches[0] && conversationMatches[0].id);\n    if (correspondentMatchId) {\n      const index = correspondentMatches.findIndex(\n        (contact: any) => contact.id === correspondentMatchId,\n      );\n      if (index! > -1) return index;\n    }\n    // index return undefined means not selected yet\n  }, [\n    multiMatchForSingleCorrespondent,\n    lastMatchedCorrespondentEntity,\n    conversationMatches,\n    correspondentMatches,\n  ]);\n\n  const { displayInfoList, correspondentsDisplayInfoMap } = useMemo(() => {\n    if (!correspondents.length) {\n      // some record like block number will not have correspondents or from/to data\n      return {\n        displayInfoList: [\n          getContactDisplayInfo({\n            queueName: undefined,\n            phoneNumber: undefined,\n            extensionNumber: undefined,\n            matches: [],\n            phoneNumberDisplayMode,\n            getDefaultCrmMatch: contactRendererOptions?.getDefaultCrmMatch,\n          }),\n        ],\n      };\n    }\n\n    const correspondentsDisplayInfoMap = new Map<string, ContactDisplayInfo>();\n\n    const displayInfoList = correspondents.map((correspondent, index) => {\n      const isMultipleCorrespondent = !singleCorrespondent;\n      const nonSupportSelectionType =\n        isFax || isVoicemail || isMultipleCorrespondent;\n\n      const renderInfo = getContactDisplayInfo({\n        serverName: correspondent.name,\n        queueName: undefined,\n        phoneNumber: correspondent.phoneNumber,\n        extensionNumber: correspondent.extensionNumber,\n        matches: correspondentMatchesList[index],\n        displaySelection: contactRendererOptions?.getDisplayedSelectedEntity\n          ? contactRendererOptions?.getDisplayedSelectedEntity(\n              conversationMatches,\n              conversation.conversationId,\n            )\n          : selectedIndex\n          ? correspondentMatchesList[index][selectedIndex]\n          : undefined,\n        selections: nonSupportSelectionType ? undefined : conversationMatches,\n        // TODO: support the multiple match display in multiple correspondents scenario\n        alwaysShowFirstMatch: isMultipleCorrespondent,\n        phoneNumberDisplayMode,\n        getDefaultCrmMatch: contactRendererOptions?.getDefaultCrmMatch,\n      });\n\n      if (renderInfo.dialToPhoneNumber) {\n        correspondentsDisplayInfoMap.set(\n          renderInfo.dialToPhoneNumber,\n          renderInfo,\n        );\n      }\n\n      return renderInfo;\n    });\n\n    return { displayInfoList, correspondentsDisplayInfoMap };\n  }, [\n    correspondents,\n    phoneNumberDisplayMode,\n    contactRendererOptions,\n    singleCorrespondent,\n    isFax,\n    isVoicemail,\n    correspondentMatchesList,\n    conversationMatches,\n    conversation.conversationId,\n    selectedIndex,\n  ]);\n\n  const detail = getDetail(conversation);\n  const { icon } = getIconInfo(conversation);\n  const displayDescription = (\n    <div className={clsx('flex items-center gap-1')} data-sign=\"summary\">\n      {isOptOut ? (\n        <>\n          <Tooltip title={t('optOutAlertTooltip')}>\n            <Icon symbol={InfoMd} className=\"text-warning-f\" size=\"small\" />\n          </Tooltip>\n          <span className=\"truncate\" title={t('optedOut')}>\n            {t('optedOut')}\n          </span>\n        </>\n      ) : (\n        <>\n          <Icon size=\"small\" symbol={icon} />\n          <span className=\"truncate\" title={detail}>\n            {detail}\n          </span>\n        </>\n      )}\n    </div>\n  );\n  const unreadCounts = conversation.unreadCounts || 0;\n  const signalTo =\n    // when self fx, will not have to data\n    !callTo || callTo.length === 1;\n\n  // currently we only support one of contact able to select matchedContact, for multiple correspondents, we not show those related function\n  // TODO: when support multiple contact select in one conversation, we need to change the logic\n  const matchedContact = displayInfoList[0]?.matchedContact;\n\n  const signalSourceInfo = useMemo(() => {\n    if (signalTo) {\n      return isInbound ? callFrom : callTo ? callTo[0] : undefined;\n    }\n    return undefined;\n  }, [callFrom, callTo, isInbound, signalTo]);\n\n  const displayName = displayInfoList\n    .map((info) => {\n      if (info.type === 'phoneNumber') {\n        return formattedPhoneNumberFn(info.displayName);\n      }\n      return info.displayName;\n    })\n    .join(', ');\n\n  const Avatar = useCallback(\n    ({ size }: Pick<AvatarProps, 'size'>) =>\n      signalTo ? (\n        <ContactAvatar\n          size={size}\n          {...(matchedContact\n            ? {\n                contact: {\n                  id: matchedContact.id!,\n                  type: matchedContact.type!,\n                },\n                contactName: matchedContact.name,\n                phoneNumber: matchedContact.phoneNumber,\n              }\n            : {\n                contactName:\n                  displayInfoList[0].type === 'callerIdName'\n                    ? displayName\n                    : undefined,\n                phoneNumber: displayInfoList[0].dialToPhoneNumber,\n              })}\n        />\n      ) : (\n        <ContactAvatar size={size} symbol={MeetingMd} />\n      ),\n    [displayInfoList, displayName, matchedContact, signalTo],\n  );\n\n  const dialToPhoneNumber = signalTo\n    ? displayInfoList[0].dialToPhoneNumber\n    : undefined;\n\n  const formattedPhoneNumber = dialToPhoneNumber\n    ? formattedPhoneNumberFn(dialToPhoneNumber)\n    : '';\n\n  const copyNumber = () => {\n    return copyWithResultMessage(formattedPhoneNumber);\n  };\n\n  /**\n   * get info when want to call the entity or send message to the entity\n   */\n  const getActionInfo = () => {\n    if (signalSourceInfo) {\n      if (matchedContact?.name) {\n        return {\n          phoneNumber: formattedPhoneNumber,\n          name: matchedContact.name,\n          type: matchedContact.type,\n        };\n      }\n\n      if (formattedPhoneNumber) {\n        return {\n          phoneNumber: formattedPhoneNumber,\n        };\n      }\n    }\n\n    return undefined;\n  };\n\n  return {\n    DisplayName: (props: Pick<ContactDisplayRenderProps, 'displayControl'>) => {\n      if (\n        displayInfoList?.length > 1 ||\n        displayInfoList[0].type === 'phoneNumber'\n      ) {\n        return (\n          <div className=\"truncate self-stretch\" title={displayName}>\n            {displayName}\n          </div>\n        );\n      }\n\n      return <ContactDisplayRender info={displayInfoList[0]} {...props} />;\n    },\n    formattedPhoneNumber,\n    correspondentsDisplayInfoMap,\n    displayType: signalTo ? displayInfoList[0].type : 'multiple',\n    displayDescription,\n    Unread: (props: Omit<BadgeProps, 'count'>) =>\n      unreadCounts > 0 ? (\n        <Badge\n          variant=\"contained\"\n          type=\"dot\"\n          size=\"medium\"\n          color=\"warning\"\n          count={unreadCounts}\n          {...props}\n        />\n      ) : null,\n    Avatar,\n    creationTime,\n    // basic info\n    signalSourceInfo,\n    matchedContact,\n    isInbound,\n    isTextMessage,\n    isFax,\n    isVoicemail,\n    markAble,\n    unreadCounts,\n    faxAttachmentExist,\n    faxAttachmentUri: faxAttachmentExist\n      ? conversation.faxAttachment!.uri\n      : undefined,\n    faxAttachmentDownloadUri: faxAttachmentExist\n      ? `${conversation.faxAttachment!.uri}&contentDisposition=Attachment`\n      : undefined,\n    voicemailAttachmentExist,\n    voicemailAttachmentUri: voicemailAttachmentExist\n      ? conversation.voicemailAttachment!.uri\n      : undefined,\n    signalTo,\n    logged: displayLogStatus ? <LogInfo logged={hasCrmLogged} /> : null,\n    myCallerIdTitle: isInbound ? t('to') : t('from'),\n    myCallerId: isInbound ? toInfo : fromInfo,\n    copyNumber,\n    getActionInfo,\n  };\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAGA,IAAAC,eAAA,GAAAD,OAAA;AAIA,IAAAE,eAAA,GAAAF,OAAA;AACA,IAAAG,cAAA,GAAAH,OAAA;AAKA,IAAAI,WAAA,GAAAJ,OAAA;AACA,IAAAK,YAAA,GAAAL,OAAA;AACA,IAAAM,MAAA,GAAAN,OAAA;AAKA,IAAAO,QAAA,GAAAP,OAAA;AAIA,IAAAQ,SAAA,GAAAR,OAAA;AACA,IAAAS,gBAAA,GAAAT,OAAA;AACA,IAAAU,WAAA,GAAAV,OAAA;AAWA,IAAAW,SAAA,GAAAX,OAAA;AASA,IAAAY,KAAA,GAAAC,sBAAA,CAAAb,OAAA;AACA,IAAAc,MAAA,GAAAC,uBAAA,CAAAf,OAAA;AAEA,IAAAgB,SAAA,GAAAhB,OAAA;AAOA,IAAAiB,YAAA,GAAAjB,OAAA;AAKA,IAAAkB,YAAA,GAAAlB,OAAA;AAOA,IAAAmB,0BAAA,GAAAnB,OAAA;AACA,IAAAoB,KAAA,GAAAP,sBAAA,CAAAb,OAAA;AACA,IAAAqB,MAAA,GAAArB,OAAA;AAMiB,IAAAsB,SAAA;AAAA,SAAAP,wBAAAQ,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAV,uBAAA,YAAAA,wBAAAQ,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,mBAAAT,CAAA,iBAAAA,CAAA,gBAAAU,OAAA,CAAAV,CAAA,0BAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,cAAAM,EAAA,IAAAd,CAAA,gBAAAc,EAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,EAAA,OAAAP,CAAA,IAAAD,CAAA,GAAAW,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAnB,CAAA,EAAAc,EAAA,OAAAP,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAM,EAAA,EAAAP,CAAA,IAAAC,CAAA,CAAAM,EAAA,IAAAd,CAAA,CAAAc,EAAA,WAAAN,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAAA,SAAAX,uBAAAU,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAK,UAAA,GAAAL,CAAA,gBAAAA,CAAA;AAAA,SAAAoB,SAAA,WAAAA,QAAA,GAAAH,MAAA,CAAAI,MAAA,GAAAJ,MAAA,CAAAI,MAAA,CAAAC,IAAA,eAAAlB,CAAA,aAAAJ,CAAA,MAAAA,CAAA,GAAAuB,SAAA,CAAAC,MAAA,EAAAxB,CAAA,UAAAC,CAAA,GAAAsB,SAAA,CAAAvB,CAAA,YAAAG,CAAA,IAAAF,CAAA,OAAAc,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAE,CAAA,MAAAC,CAAA,CAAAD,CAAA,IAAAF,CAAA,CAAAE,CAAA,aAAAC,CAAA,KAAAgB,QAAA,CAAAK,KAAA,OAAAF,SAAA;AAAA,SAAAG,yBAAA1B,CAAA,EAAAC,CAAA,gBAAAD,CAAA,iBAAAM,CAAA,EAAAH,CAAA,EAAAI,CAAA,GAAAoB,6BAAA,CAAA3B,CAAA,EAAAC,CAAA,OAAAgB,MAAA,CAAAW,qBAAA,QAAAxB,CAAA,GAAAa,MAAA,CAAAW,qBAAA,CAAA5B,CAAA,QAAAG,CAAA,MAAAA,CAAA,GAAAC,CAAA,CAAAoB,MAAA,EAAArB,CAAA,IAAAG,CAAA,GAAAF,CAAA,CAAAD,CAAA,UAAAF,CAAA,CAAA4B,OAAA,CAAAvB,CAAA,QAAAwB,oBAAA,CAAAd,IAAA,CAAAhB,CAAA,EAAAM,CAAA,MAAAC,CAAA,CAAAD,CAAA,IAAAN,CAAA,CAAAM,CAAA,aAAAC,CAAA;AAAA,SAAAoB,8BAAAxB,CAAA,EAAAH,CAAA,gBAAAG,CAAA,iBAAAF,CAAA,gBAAAG,CAAA,IAAAD,CAAA,SAAAY,cAAA,CAAAC,IAAA,CAAAb,CAAA,EAAAC,CAAA,gBAAAJ,CAAA,CAAA6B,OAAA,CAAAzB,CAAA,aAAAH,CAAA,CAAAG,CAAA,IAAAD,CAAA,CAAAC,CAAA,YAAAH,CAAA;AAiCV,IAAM8B,4BAA4B,GAAAC,OAAA,CAAAD,4BAAA,GAAG,SAA/BA,4BAA4BA,CACvCf,IAAW,EAIR;EAAA,IAHHiB,OAEqE,GAAAV,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAW,SAAA,GAAAX,SAAA,MAAG,CAAC,CAAC;EAE1E,IAAAY,UAAA,GAAc,IAAAC,gBAAS,EAACC,gBAAI,CAAC;IAArBpC,CAAC,GAAAkC,UAAA,CAADlC,CAAC;EAET,IAAMqC,sBAAsB,GAAG,IAAAC,sBAAY,EACzC,wBACF,CAAC;EAED,IAAMC,OAAO,GAAG,IAAAC,qBAAW,EAACzB,IAAI,CAAC;EACjC,IAAM0B,aAAa,GAAG,IAAAC,iCAAuB,EAAC3B,IAAI,CAAC;EACnD,IAAM4B,QAAQ,GAAG5B,IAAI,CAAC6B,IAAI,IAAI,CAAC,CAAC;EAChC,IAAMC,MAAM,GAAG9B,IAAI,CAAC+B,EAAE,IAAI,CAAC,CAAC;EAC5B,IAAQC,SAAS,GAAyChC,IAAI,CAAtDgC,SAAS;IAAEC,eAAe,GAAwBjC,IAAI,CAA3CiC,eAAe;IAAEC,SAAS,GAAalC,IAAI,CAA1BkC,SAAS;IAAEC,MAAM,GAAKnC,IAAI,CAAfmC,MAAM;EACrD,IAAMC,SAAS,GAAG,IAAAC,yBAAa,EAACrC,IAAI,CAAC;EACrC,IAAMsC,OAAO,GAAG,IAAAC,uBAAa,EAACvC,IAAI,CAAC;EACnC,IAAMwC,WAAW,GAAG,IAAAC,2BAAiB,EAACzC,IAAI,CAAC;EAC3C,IAAM0C,OAAO,GAAG,IAAAC,uBAAa,EAAC3C,IAAI,CAAC;EACnC,IAAM4C,YAAY,GAAG,CAAC,CAACX,eAAe;EACtC,IAAAY,qBAAA,GAAmD5B,OAAO,CAAlD6B,sBAAsB;IAAtBA,sBAAsB,GAAAD,qBAAA,cAAG,aAAa,GAAAA,qBAAA;EAE9C,IAAME,eAAe,GAAGX,SAAS,GAC7BR,QAAQ,CAACmB,eAAe,GACxBjB,MAAM,CAACiB,eAAe;EAE1B,IAAMC,WAAW,GAAGZ,SAAS,GAAGR,QAAQ,CAACoB,WAAW,GAAGlB,MAAM,CAACkB,WAAW;EACzE,IAAMC,OAAO,GAAGb,SAAS,GAAGpC,IAAI,CAACkD,WAAW,GAAGlD,IAAI,CAACmD,SAAS;;EAE7D;;EAEA;EACA,IAAMC,QAAQ,GAAGhB,SAAS,GACtBH,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAEoB,YAAY,GAC7BpB,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAEqB,UAAU;EAE/B,IAAMC,iBAAiB,GAAGvD,IAAI,CAACuD,iBAAiB;EAEhD,IAAMC,UAAU,GAAG,IAAAC,4BAAqB,EAAC;IACvCL,QAAQ,EAARA,QAAQ;IACRM,SAAS,EAAEhC,aAAa;IACxBuB,OAAO,EAAPA,OAAO;IACPD,WAAW,EAAXA,WAAW;IACXD,eAAe,EAAfA,eAAe;IACfD,sBAAsB,EAAtBA,sBAAsB;IACtBa,gBAAgB,EAAEJ,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEK,kBAAkB;IACvDC,UAAU,EAAEN,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEM,UAAU;IACzCC,kBAAkB,EAAExC,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAEwC;EAC9C,CAAC,CAAC;EACF,IAAMC,uBAAuB,GAAG,IAAAC,uCAA0B,EAAC,CAAC;;EAE5D;EACA,IAAMC,gCAAgC,GAAG,IAAAC,cAAO,EAC9C;IAAA,IAAAC,qBAAA;IAAA,QAAAA,qBAAA,GACEnE,IAAI,CAACoE,sBAAsB,cAAAD,qBAAA,uBAA3BA,qBAAA,CAA6BE,GAAG,CAC9B,UAACC,qBAAqB,EAAEC,KAAK;MAAA,OAC3B,YAKW;QAAA,IAAAC,sBAAA,EAAAC,qBAAA;QAAA,IAAAC,IAAA,GAAAnE,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAW,SAAA,GAAAX,SAAA,MAAP,CAAC,CAAC;UAJJuC,sBAAsB,GAAA4B,IAAA,CAAtB5B,sBAAsB;QAKtB,IAAM6B,oBAAoB,GAAGL,qBAAqB,CAACZ,SAAS;QAC5D,IAAMkB,qBAAqB,GAAG,IAAAnB,4BAAqB,EAAC;UAClD;UACA;UACAL,QAAQ,EAAElC,SAAS;UACnBwC,SAAS,EAAEhC,aAAa;UACxBsB,WAAW,EAAEsB,qBAAqB,CAACO,IAAI,CAAC7B,WAAW;UACnDD,eAAe,EAAEuB,qBAAqB,CAACO,IAAI,CAAC9B,eAAe;UAC3DE,OAAO,GAAAuB,sBAAA,GAAExE,IAAI,CAAC8E,iCAAiC,cAAAN,sBAAA,uBAAtCA,sBAAA,CAAyCD,KAAK,CAAC;UACxDzB,sBAAsB,EAAtBA;QACF,CAAC,CAAC;QACF,IAAMiC,kBAAkB,GAAGC,OAAO,CAChCL,oBAAoB,MAAAF,qBAAA,GAClBG,qBAAqB,CAACK,cAAc,cAAAR,qBAAA,uBAApCA,qBAAA,CAAsCS,iBAAiB,CAC3D,CAAC;QAED,IAAMC,MAAM,GAAG,SAATA,MAAMA,CAAAC,KAAA;UAAA,IAAMC,IAAI,GAAAD,KAAA,CAAJC,IAAI;UAAA,oBACpB9G,MAAA,YAAA+G,aAAA,CAAC1G,0BAAA,CAAA2G,yBAAyB;YACxB/D,OAAO,EAAEuD,kBAAmB;YAC5BS,gBAAgB,EAAE,KAAM;YACxBhC,UAAU,EAAEoB,qBAAsB;YAClCS,IAAI,EAAEA;UAAK,CACZ,CAAC;QAAA,CACH;QAED,OAAO;UACLI,IAAI,EAAEnB,qBAAqB;UAC3Bd,UAAU,EAAEoB,qBAAqB;UACjCc,MAAM,eACJnH,MAAA,YAAA+G,aAAA,CAAC3G,YAAA,CAAAgH,oBAAoB;YACnBd,IAAI,EAAED,qBAAsB;YAC5BlD,aAAa,EAAEiD;YACf;YACA;YACA;YACA;UAAA,CACD,CACF;UACD;AACd;AACA;UACciB,WAAW,EAAE7B,uBAAuB,CAAC;YACnCP,UAAU,EAAEoB,qBAAqB;YACjClD,aAAa,EAAEiD;UACjB,CAAC,CAAW;UACZQ,MAAM,EAANA;QACF,CAAC;MACH,CAAC;IAAA,CACL,CAAC;EAAA,GACH,CAACnF,IAAI,EAAE0B,aAAa,EAAEqC,uBAAuB,CAC/C,CAAC;EAED,IAAMyB,gBAAgB,GAAGR,OAAO,CAAChF,IAAI,CAACwF,gBAAgB,CAAC;EAEvD,IAAMK,QAAQ,GAAG,IAAAC,sCAAyB,EAAClE,QAAQ,CAAC;EACpD,IAAMmE,mBAAmB,GAAG,IAAAD,sCAAyB,EAAClE,QAAQ,EAAE,IAAI,CAAC;EACrE,IAAMoE,MAAM,GAAG,IAAAF,sCAAyB,EAAChE,MAAM,CAAC;EAEhD,IAAMmE,cAAc,GAAG,IAAA/B,cAAO,EAAC,YAAM;IACnC,IAAI5B,OAAO,EAAE,OAAOrD,CAAC,CAAC,SAAS,CAAC;IAChC,IAAIyD,OAAO,EAAE,OAAOzD,CAAC,CAAC,QAAQ,CAAC;IAE/B,OAAOA,CAAC,CAAC,YAAY,CAAC;EACxB,CAAC,EAAE,CAACyD,OAAO,EAAEJ,OAAO,EAAErD,CAAC,CAAC,CAAC;EAEzB,IAAMiH,UAAU,GAAG,IAAAC,kBAAW,EAC5B,UAAAC,KAAA;IAAA,IAAGC,QAAQ,GAAAD,KAAA,CAARC,QAAQ;IAAA,oBACT9H,MAAA,YAAA+G,aAAA;MACEgB,SAAS,EAAE,IAAAC,gBAAI,EACbjE,OAAO,IAAI,gBAAgB,EAC3BI,OAAO,IAAI,4BAA4B,EACvC,CAACJ,OAAO,IAAI,CAACI,OAAO,IAAI,eAC1B;IAAE,gBAEFnE,MAAA,YAAA+G,aAAA;MAAMgB,SAAS,EAAC;IAAM,GAAEL,cAAqB,CAAC,EAE7CI,QACE,CAAC;EAAA,CACP,EACD,CAAC/D,OAAO,EAAEI,OAAO,EAAEuD,cAAc,CACnC,CAAC;EAED,IAAMO,aAAa,GAAG,IAAAL,kBAAW,EAU/B,UAAAM,KAAA,EAAgC;IAAA,IAAAC,UAAA,GAAAD,KAAA,CAA7BE,IAAI;MAAJA,IAAI,GAAAD,UAAA,cAAG,MAAM,GAAAA,UAAA;MAAKE,IAAI,GAAAlG,wBAAA,CAAA+F,KAAA,EAAA1H,SAAA;IACvB,IAAI4H,IAAI,KAAK,MAAM,EACjB,oBACEpI,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAAyI,OAAO;MAACC,KAAK,EAAE7H,CAAC,CAAC,aAAa,CAAE;MAAC8H,SAAS,EAAC;IAAK,gBAC/CxI,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA4I,IAAI;MAAC,aAAU,eAAe;MAACC,MAAM,EAAEC,oBAAS;MAAC7B,IAAI,EAAC;IAAO,CAAE,CACzD,CAAC;IAGd,oBACE9G,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA+I,GAAG,EAAA/G,QAAA;MACF,aAAU,eAAe;MACzBgH,KAAK,EAAC,SAAS;MACfC,OAAO,EAAC;IAAU,GACdT,IAAI,GAEP3H,CAAC,CAAC,aAAa,CACb,CAAC;EAEV,CAAC,EACD,CAACA,CAAC,CACJ,CAAC;EAED,IAAMkG,MAAM,GAAG,IAAAgB,kBAAW,EACxB,UAAAmB,KAAA;IAAA,IAAGjC,IAAI,GAAAiC,KAAA,CAAJjC,IAAI;IAAA,oBACL9G,MAAA,YAAA+G,aAAA,CAAC1G,0BAAA,CAAA2G,yBAAyB;MACxB/D,OAAO,EAAEA,OAAQ;MACjBgE,gBAAgB,EAAEA,gBAAiB;MACnChC,UAAU,EAAEA,UAAW;MACvB6B,IAAI,EAAEA;IAAK,CACZ,CAAC;EAAA,CACH,EACD,CAACG,gBAAgB,EAAEhC,UAAU,EAAEhC,OAAO,CACxC,CAAC;EAED,OAAO;IACL+F,WAAW,EAAE,SAAbA,WAAWA,CAAGC,KAAwD,EAAK;MACzE,IAAIhC,gBAAgB,EAAE;QACpB,IAAMiC,IAAI,GAAGxD,gCAAgC,aAAhCA,gCAAgC,uBAAhCA,gCAAgC,CACzCI,GAAG,CAAC,UAACqD,EAAE;UAAA;YACP;YACAA,EAAE,CAAC;cAAE5E,sBAAsB,EAAE;YAAc,CAAC;UAAC;QAAA,CAC/C,CAAC,CACA6E,MAAM,CAAC,UAACC,CAAC;UAAA,OAAK,CAACA,CAAC,CAACnC,IAAI,CAACoC,MAAM;QAAA,EAAC,CAC7BxD,GAAG,CAAC,UAACuD,CAAC;UAAA,OAAKA,CAAC,CAAChC,WAAW;QAAA,EAAC,CACzBkC,IAAI,CAAC,IAAI,CAAC;QACb;QACA,oBACEvJ,MAAA,YAAA+G,aAAA;UAAMwB,KAAK,EAAEW,IAAK;UAACnB,SAAS,EAAC;QAAU,GACpCmB,IACG,CAAC;MAEX;MAEA,oBACElJ,MAAA,YAAA+G,aAAA,CAAC3G,YAAA,CAAAgH,oBAAoB,EAAAvF,QAAA;QACnByE,IAAI,EAAErB,UAAW;QACjB9B,aAAa,EAAEA;MAAc,GACzB8F,KAAK,CACV,CAAC;IAEN,CAAC;IACDO,kBAAkB,EAAE3F,SAAS,GACzB,CAAAnB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAE+G,mBAAmB,IAC1BjC,mBAAmB,GACnBF,QAAQ,GACVG,MAAM;IACVb,MAAM,EAANA,MAAM;IACN8C,UAAU,EAAE7F,SAAS,GAAG4D,MAAM,GAAGH,QAAQ;IACzCqC,QAAQ,eAAE3J,MAAA,YAAA+G,aAAA,CAACpH,gBAAA,CAAAiK,eAAe;MAACjG,SAAS,EAAEA,SAAU;MAACC,MAAM,EAAEA;IAAO,CAAE,CAAC;IACnE+D,UAAU,EAAVA,UAAU;IACVM,aAAa,EAAEhE,WAAW,GAAGgE,aAAa,GAAG,IAAI;IACjD;IACAxE,SAAS,EAATA,SAAS;IACTI,SAAS,EAATA,SAAS;IACTE,OAAO,EAAPA,OAAO;IACPI,OAAO,EAAPA,OAAO;IACPE,YAAY,EAAZA,YAAY;IACZqB,gCAAgC,EAAhCA,gCAAgC;IAChCvC,aAAa,EAAbA;EACF,CAAC;AACH,CAAC;AAEM,IAAM0G,mCAAmC,GAAApH,OAAA,CAAAoH,mCAAA,GAAG,SAAtCA,mCAAmCA,CAC9CC,cAA2B,EA2CxB;EAAA,IAAAC,KAAA,GAAA/H,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAW,SAAA,GAAAX,SAAA,MADqE,CAAC,CAAC;IAAAgI,mBAAA,GAAAD,KAAA,CAxCxEE,aAAa;IAAbA,aAAa,GAAAD,mBAAA,cAAG,UAAU,GAAAA,mBAAA;IAAAE,qBAAA,GAAAH,KAAA,CAC1BN,mBAAmB;IAAnBA,mBAAmB,GAAAS,qBAAA,cAAG,KAAK,GAAAA,qBAAA;IAAAC,iBAAA,GAAAJ,KAAA,CAC3BK,WAAW;IAAXA,WAAW,GAAAD,iBAAA,cAAG,KAAK,GAAAA,iBAAA;IAAAE,qBAAA,GAAAN,KAAA,CACnBxF,sBAAsB;IAAtBA,sBAAsB,GAAA8F,qBAAA,cAAG,SAAS,GAAAA,qBAAA;IAClCC,gBAAgB,GAAAP,KAAA,CAAhBO,gBAAgB;IAChBC,cAAc,GAAAR,KAAA,CAAdQ,cAAc;EAqChB,IAAAC,WAAA,GAAc,IAAA3H,gBAAS,EAACC,gBAAI,CAAC;IAArBpC,CAAC,GAAA8J,WAAA,CAAD9J,CAAC;EACT,IAAM+J,sBAAsB,GAAG,IAAAC,qCAAyB,EAAC,CAAC;EAE1D,IAAM3H,sBAAsB,GAAG,IAAAC,sBAAY,EACzC,wBACF,CAAC;EAED,IAAMmE,MAAM,GAAG2C,cAAc,CAAC3C,MAAM;EAEpC,IAAM1D,SAAS,GAAGqG,cAAc,CAACrG,SAAS;EAC1C,IAAMI,SAAS,GAAGiG,cAAc,IAAI,IAAAhG,yBAAa,EAACgG,cAAc,CAAC;EACjE,IAAMa,QAAQ,GACZ9G,SAAS,IACTiG,cAAc,IACd,IAAAc,wBAAY,EAAC;IAAEzD,MAAM,EAAE2C,cAAc,CAAC3C;EAAO,CAAC,CAAC;EACjD,IAAMxD,SAAS,GAAG,IAAAkH,8BAAuB,EACvCf,cAAc,CAACnG,SAAS,EACxBsG,aACF,CAAC;EAED,IAAMN,QAAQ,GAAG,IAAAhE,cAAO,EACtB;IAAA,OACE,IAAAmF,wCAAwB,EAAChB,cAAc,CAACH,QAAQ,EAAE;MAChDoB,GAAG,EAAErK,CAAC,CAAC,KAAK,CAAC;MACbsK,EAAE,EAAEtK,CAAC,CAAC,IAAI,CAAC;MACXuK,GAAG,EAAEvK,CAAC,CAAC,KAAK,CAAC;MACbwK,GAAG,EAAExK,CAAC,CAAC,KAAK;IACd,CAAC,CAAC;EAAA,GACJ,CAACoJ,cAAc,CAACH,QAAQ,EAAEjJ,CAAC,CAC7B,CAAC;EAED,IAAMyK,gBAAgB,GAAIhE,MAAM,KAAaiE,wBAAW,CAACD,gBAAgB;EACzE;EACA,IAAME,oBAAoB,GACvBlE,MAAM,KAAaiE,wBAAW,CAACE,iBAAiB,IAAIH,gBAAgB;EAEvE,IAAMI,kBAAkB,GAAGzB,cAAc,CAAC0B,QAAQ;EAClD,IAAMC,UAAU,GAAG3B,cAAc,CAAC4B,YAAY;EAE9C,IAAMC,MAAM,GAAG,IAAA/D,kBAAW,EAQxB,UAAAgE,KAAA,EAAuB;IAAA,IAAAC,UAAA,GAAAD,KAAA,CAApBxD,IAAI;MAAJA,IAAI,GAAAyD,UAAA,cAAG,MAAM,GAAAA,UAAA;IACd,IAAI,CAAC1E,MAAM,IAAI,CAAC1D,SAAS,EAAE,OAAO,IAAI;IAEtC,IAAMqI,eAAe,GAAG,SAAlBA,eAAeA,CAAA,EAAS;MAC5B,IAAMC,cAAc,GAAGR,kBAAkB,MAAAS,MAAA,CAClCtL,CAAC,CAAC,YAAY,CAAC,OAAAsL,MAAA,CAAIT,kBAAkB,aAAlBA,kBAAkB,uBAAlBA,kBAAkB,CAAEU,IAAI,IAC9CtJ,SAAS;MAEb,IAAMuJ,wBAAwB,GAAGX,kBAAkB,gBACjDvL,MAAA,YAAA+G,aAAA;QACEgB,SAAS,EAAC,UAAU;QACpB,aAAU,aAAa;QACvBQ,KAAK,EAAEwD;MAAe,GAErBA,cACG,CAAC,gBAEP/L,MAAA,YAAA+G,aAAA,eAAOrG,CAAC,CAACyG,MAAM,CAAQ,CACxB;MAED,OAAO+E,wBAAwB;IACjC,CAAC;IAED,IAAI9D,IAAI,KAAK,MAAM,EAAE;MACnB,IAAIiD,oBAAoB,EAAE;QACxB,OAAOS,eAAe,CAAC,CAAC;MAC1B;MAEA,IAAMK,eAAe,GAAGxC,QAAQ,OAAAqC,MAAA,CAAOrC,QAAQ,SAAM,EAAE;MACvD,oBACE3J,MAAA,YAAA+G,aAAA;QACEgB,SAAS,EAAE4C,QAAQ,GAAG,eAAe,GAAG,gBAAiB;QACzD,aAAU;MAAsB,GAE/BA,QAAQ,GAAGjK,CAAC,CAAC,QAAQ,CAAC,MAAAsL,MAAA,CAAMtL,CAAC,CAAC+C,SAAS,CAAC,OAAAuI,MAAA,CAAIG,eAAe,CACxD,CAAC;IAEX;IAEA,IAAId,oBAAoB,EAAE;MACxB,oBACErL,MAAA,YAAA+G,aAAA;QAAKgB,SAAS,EAAC,gCAAgC;QAAC,aAAWZ;MAAO,gBAChEnH,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA4I,IAAI;QACH3B,IAAI,EAAC,OAAO;QACZ,aACEyE,kBAAkB,GAAG,eAAe,GAAG,kBACxC;QACD7C,MAAM,EAAE6C,kBAAkB,GAAGa,4BAAgB,GAAGC;MAAa,CAC9D,CAAC,EACDP,eAAe,CAAC,CACd,CAAC;IAEV;IAEA,oBACE9L,MAAA,YAAA+G,aAAA;MACEgB,SAAS,EAAE,IAAAC,gBAAI,EACb,gCAAgC,EAChC2C,QAAQ,IAAI,aACd,CAAE;MACF,uBAAAqB,MAAA,CAAqBrB,QAAQ,GAAG,QAAQ,GAAGlH,SAAS,CAAC6I,WAAW,CAAC,CAAC;IAAG,gBAErEtM,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA4I,IAAI;MACH3B,IAAI,EAAC,OAAO;MACZ,aACE6D,QAAQ,GACJ,aAAa,GACb9G,SAAS,GACT,eAAe,GACf,eACL;MACD6E,MAAM,EACJiC,QAAQ,GACJ4B,wBAAY,GACZ1I,SAAS,GACT2I,0BAAc,GACdC,0BACL;MACD1E,SAAS,EAAE4C,QAAQ,GAAG,cAAc,GAAGhI;IAAU,CAClD,CAAC,eACF3C,MAAA,YAAA+G,aAAA;MAAM,aAAU;IAAU,GAAE4D,QAAQ,GAAGjK,CAAC,CAAC,QAAQ,CAAC,GAAGiJ,QAAe,CAAC,EACpE8B,UAAU,iBACTzL,MAAA,YAAA+G,aAAA,CAAA/G,MAAA,YAAA0M,QAAA,qBACE1M,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA4I,IAAI;MAAC3B,IAAI,EAAC,OAAO;MAAC4B,MAAM,EAAEiE;IAAa,CAAE,CAAC,eAC3C3M,MAAA,YAAA+G,aAAA;MAAM,aAAU;IAAQ,GAAErG,CAAC,CAAC,OAAO,CAAQ,CAC3C,CAED,CAAC;EAEV,CAAC,EACD,CACE2K,oBAAoB,EACpBE,kBAAkB,EAClB9H,SAAS,EACTkG,QAAQ,EACR8B,UAAU,EACV5H,SAAS,EACT8G,QAAQ,EACRxD,MAAM,EACNzG,CAAC,CAEL,CAAC;EAED,IAAMuC,OAAO,GAAG,IAAA2J,+BAAkB,EAAC9C,cAAc,CAAC;EAClD,IAAM3G,aAAa,GAAG,IAAAC,iCAAuB,EAAC0G,cAAc,CAAC;EAE7D,IAAMzG,QAAQ,GAAGyG,cAAc,CAACxG,IAAI,IAAI,CAAC,CAAC;EAC1C,IAAMC,MAAM,GAAGuG,cAAc,CAACtG,EAAE,IAAI,CAAC,CAAC;EAEtC,IAAMqJ,gBAAgB,GAAGhJ,SAAS,GAAGR,QAAQ,GAAGE,MAAM;EACtD,IAAMkB,WAAW,GAAGoI,gBAAgB,CAACpI,WAAW;EAChD,IAAMD,eAAe,GAAGX,SAAS,GAC7BR,QAAQ,CAACmB,eAAe,GACxBjB,MAAM,CAACiB,eAAe;EAE1B,IAAME,OAAO,GAAGb,SAAS,GACrBiG,cAAc,CAACnF,WAAW,GAC1BmF,cAAc,CAAClF,SAAS;EAC5B,IAAMkI,UAAU,GAAGjJ,SAAS,GAAGR,QAAQ,CAAC4I,IAAI,GAAG1I,MAAM,CAAC0I,IAAI;EAC1D,IAAMjH,iBAAiB,GAAG8E,cAAc,CAAC9E,iBAAiB;EAE1D,IAAMC,UAAU,GAAG,IAAAC,4BAAqB,EAAC;IACvC4H,UAAU,EAAVA,UAAU;IACV3H,SAAS,EAAEhC,aAAa;IACxBuB,OAAO,EAAPA,OAAO;IACPD,WAAW,EAAXA,WAAW;IACXD,eAAe,EAAfA,eAAe;IACfD,sBAAsB,EAAtBA,sBAAsB;IACtBa,gBAAgB,EAAEJ,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEK,kBAAkB;IACvDC,UAAU,EAAEN,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEM,UAAU;IACzCC,kBAAkB,EAAExC,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAEwC;EAC9C,CAAC,CAAC;EAEF,IAAM0B,gBAAgB,GAAGR,OAAO,CAACqD,cAAc,CAAC7C,gBAAgB,CAAC;EAEjE,IAAMK,QAAQ,GAAG,IAAAC,sCAAyB,EAAClE,QAAQ,CAAC;EACpD,IAAMmE,mBAAmB,GAAG,IAAAD,sCAAyB,EACnDlE,QAAQ,EACRoG,mBACF,CAAC;EACD,IAAMhC,MAAM,GAAG,IAAAF,sCAAyB,EAAChE,MAAM,CAAC;EAEhD,IAAMwJ,QAAQ,GAAGjD,cAAc,CAACiD,QAAQ;EACxC,IAAMC,oBAAoB,GAAG/H,UAAU,CAACgI,iBAAiB,GACrDxC,sBAAsB,CAACxF,UAAU,CAACgI,iBAAiB,CAAC,GACpD,EAAE;EAEN,IAAMrG,MAAM,GAAG,IAAAgB,kBAAW,EACxB,UAAAsF,KAAA;IAAA,IAAGpG,IAAI,GAAAoG,KAAA,CAAJpG,IAAI;IAAA,oBACL9G,MAAA,YAAA+G,aAAA,CAAC1G,0BAAA,CAAA2G,yBAAyB;MACxBC,gBAAgB,EAAEA,gBAAiB;MACnChE,OAAO,EAAEA,OAAQ;MACjBgC,UAAU,EAAEA,UAAW;MACvB6B,IAAI,EAAEA;IAAK,CACZ,CAAC;EAAA,CACH,EACD,CAACG,gBAAgB,EAAEhE,OAAO,EAAEgC,UAAU,CACxC,CAAC;EAED,IAAMkI,UAAU,GAAG,SAAbA,UAAUA,CAAA,EAAS;IACvB,OAAO,IAAAC,4BAAqB,EAACJ,oBAAoB,CAAC;EACpD,CAAC;;EAED;AACF;AACA;EACE,IAAMK,aAAa,GAAG,SAAhBA,aAAaA,CAAA,EAAS;IAC1B,IAAM3G,cAAc,GAAGzB,UAAU,CAACyB,cAAwB;IAC1D,IAAIA,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEuF,IAAI,EAAE;MACxB,OAAO;QACLxH,WAAW,EAAEuI,oBAAoB;QACjCf,IAAI,EAAEvF,cAAc,CAACuF,IAAI;QACzBqB,IAAI,EAAE5G,cAAc,CAAC4G;MACvB,CAAC;IACH;IAEA,IAAIN,oBAAoB,EAAE;MACxB,OAAO;QACLvI,WAAW,EAAEuI;MACf,CAAC;IACH;IAEA,OAAOrK,SAAS;EAClB,CAAC;EAED,OAAO;IACLqG,WAAW,EAAE,SAAbA,WAAWA,CAAGC,KAAwD,EAAK;MACzE;MACA,IAAIhC,gBAAgB,EAAE,oBAAOjH,MAAA,YAAA+G,aAAA,eAAOrG,CAAC,CAAC,gBAAgB,CAAQ,CAAC;MAE/D,oBACEV,MAAA,YAAA+G,aAAA,CAAC3G,YAAA,CAAAgH,oBAAoB,EAAAvF,QAAA;QACnByE,IAAI,EAAErB,UAAW;QACjB9B,aAAa,EAAEA,aAAc;QAC7BwH,QAAQ,EAAEA;MAAS,GACf1B,KAAK,CACV,CAAC;IAEN,CAAC;IACDO,kBAAkB,EAAE3F,SAAS,GACzB4F,mBAAmB,GACjBjC,mBAAmB,GACnBF,QAAQ,GACVG,MAAM;IACVb,MAAM,EAANA,MAAM;IACN2G,eAAe,EAAE1J,SAAS,GAAGnD,CAAC,CAAC,IAAI,CAAC,GAAGA,CAAC,CAAC,MAAM,CAAC;IAChDgJ,UAAU,EAAE7F,SAAS,GAAG4D,MAAM,GAAGH,QAAQ;IACzC3D,SAAS,EAATA,SAAS;IACTgG,QAAQ,EAARA,QAAQ;IACRgC,MAAM,EAANA,MAAM;IACNxI,aAAa,EAAbA,aAAa;IACb8D,gBAAgB,EAAhBA,gBAAgB;IAChB;IACApD,SAAS,EAATA,SAAS;IACToB,UAAU,EAAVA,UAAU;IACV4H,gBAAgB,EAAhBA,gBAAgB;IAChBG,oBAAoB,EAApBA,oBAAoB;IACpBQ,MAAM,EAAEpD,WAAW,gBACjBpK,MAAA,YAAA+G,aAAA,CAAC3G,YAAA,CAAAqN,OAAO;MACND,MAAM,EAAET,QAAS;MACjBzC,gBAAgB,EAAEA,gBAAiB;MACnCC,cAAc,EAAEA;IAAe,CAChC,CAAC,GACA,IAAI;IACRmD,eAAe,EAAEjH,OAAO,CAAC2D,WAAW,IAAI2C,QAAQ,CAAC;IACjD5B,gBAAgB,EAAhBA,gBAAgB;IAChBI,kBAAkB,EAAlBA,kBAAkB;IAClB4B,UAAU,EAAVA,UAAU;IACVE,aAAa,EAAbA;EACF,CAAC;AACH,CAAC;AAEM,IAAMM,oCAAoC,GAAAlL,OAAA,CAAAkL,oCAAA,GAAG,SAAvCA,oCAAoCA,CAC/CC,YAAmC,EA8BhC;EAAA,IAAAC,qBAAA,EAAAC,qBAAA,EAAAC,iBAAA;EAAA,IAAAC,KAAA,GAAAhM,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAW,SAAA,GAAAX,SAAA,MADC,CAAC,CAAC;IAAAiM,qBAAA,GAAAD,KAAA,CA3BJE,oBAAoB;IAApBA,oBAAoB,GAAAD,qBAAA,cAAG,UAAU,GAAAA,qBAAA;IAAAE,qBAAA,GAAAH,KAAA,CACjCI,gBAAgB;IAAhBA,gBAAgB,GAAAD,qBAAA,cAAG,KAAK,GAAAA,qBAAA;IAAAE,kBAAA,GAAAL,KAAA,CACxBM,YAAY;IAAZA,YAAY,GAAAD,kBAAA,cAAG,KAAK,GAAAA,kBAAA;IAAAE,qBAAA,GAAAP,KAAA,CACpBzJ,sBAAsB;IAAtBA,sBAAsB,GAAAgK,qBAAA,cAAG,aAAa,GAAAA,qBAAA;IAAAC,cAAA,GAAAR,KAAA,CACtCS,QAAQ;IAARA,QAAQ,GAAAD,cAAA,cAAG,KAAK,GAAAA,cAAA;EAyBlB,IAAAE,WAAA,GAAc,IAAA7L,gBAAS,EAACC,gBAAI,CAAC;IAArBpC,CAAC,GAAAgO,WAAA,CAADhO,CAAC;EACT,IAAM+J,sBAAsB,GAAG,IAAAC,qCAAyB,EAAC,CAAC;EAE1D,IAAM3H,sBAAsB,GAAG,IAAAC,sBAAY,EACzC,wBACF,CAAC;EAED,IAAMa,SAAS,GAAG,IAAAC,yBAAa,EAAC8J,YAAY,CAAC;EAC7C,IAAMe,aAAa,GAAG,IAAAC,mCAAoB,EAAChB,YAAY,CAAC;EACxD,IAAMiB,KAAK,GAAG,IAAAC,2BAAY,EAAClB,YAAY,CAAC;EACxC,IAAMmB,WAAW,GAAG,IAAAC,iCAAkB,EAACpB,YAAY,CAAC;EACpD,IAAMqB,QAAQ;EACZ;EACA;EACA;EACAF,WAAW,IAAKF,KAAK,IAAIhL,SAAU;EACrC,IAAMqL,aAAa,GAAGtB,YAAY,CAACsB,aAAa;EAChD,IAAMC,kBAAkB,GAAG1I,OAAO,CAChCoI,KAAK,KACFK,aAAa,KAAK,MAAM,IAAIA,aAAa,KAAK,UAAU,CAAC,MAAArB,qBAAA,GAC1DD,YAAY,CAACwB,aAAa,cAAAvB,qBAAA,uBAA1BA,qBAAA,CAA4BwB,GAAG,CACnC,CAAC;EACD,IAAMC,wBAAwB,GAAG7I,OAAO,CACtCsI,WAAW,MAAAjB,qBAAA,GAAIF,YAAY,CAAC2B,mBAAmB,cAAAzB,qBAAA,uBAAhCA,qBAAA,CAAkCuB,GAAG,CACtD,CAAC;EAED,IAAMG,YAAY,GAAG,IAAA3E,8BAAuB,EAC1C+C,YAAY,CAAC4B,YAAY,EACzBtB,oBACF,CAAC;EAED,IAAM7K,QAAQ,GAAGuK,YAAY,CAACtK,IAAK;EACnC,IAAMC,MAAM,GAAGqK,YAAY,CAACpK,EAAE;EAC9B,IAAMiM,QAAQ,GAAG7B,YAAY,CAAC8B,IAAI;EAElC,IAAMpI,QAAQ,GAAG,IAAAC,sCAAyB,EAAClE,QAAQ,CAAC;EACpD,IAAMoE,MAAM,GAAG,IAAAF,sCAAyB,EAACkI,QAAQ,CAAC;EAElD,IACEE,cAAc,GAKZ/B,YAAY,CALd+B,cAAc;IACdC,8BAA8B,GAI5BhC,YAAY,CAJdgC,8BAA8B;IAC9BC,mBAAmB,GAGjBjC,YAAY,CAHdiC,mBAAmB;IACnBC,oBAAoB,GAElBlC,YAAY,CAFdkC,oBAAoB;IACpBC,wBAAwB,GACtBnC,YAAY,CADdmC,wBAAwB;EAG1B,IAAMC,mBAAmB,GAAGL,cAAc,CAAC1N,MAAM,KAAK,CAAC;EACvD,IAAMgO,gCAAgC,GACpCD,mBAAmB,IACnBD,wBAAwB,CAAC9N,MAAM,KAAK,CAAC,IACrC8N,wBAAwB,CAAC,CAAC,CAAC,CAAC9N,MAAM,GAAG,CAAC;EAExC,IAAMiO,aAAa,GAAG,IAAAvK,cAAO,EAAC,YAAM;IAClC;IACA,IAAI,CAACsK,gCAAgC,EAAE,OAAO,CAAC;IAC/C,IAAME,oBAAoB,GACvBP,8BAA8B,IAAIA,8BAA8B,CAACQ,EAAE,IACnEP,mBAAmB,CAAC,CAAC,CAAC,IAAIA,mBAAmB,CAAC,CAAC,CAAC,CAACO,EAAG;IACvD,IAAID,oBAAoB,EAAE;MACxB,IAAMnK,KAAK,GAAG8J,oBAAoB,CAACO,SAAS,CAC1C,UAACC,OAAY;QAAA,OAAKA,OAAO,CAACF,EAAE,KAAKD,oBAAoB;MAAA,CACvD,CAAC;MACD,IAAInK,KAAK,GAAI,CAAC,CAAC,EAAE,OAAOA,KAAK;IAC/B;IACA;EACF,CAAC,EAAE,CACDiK,gCAAgC,EAChCL,8BAA8B,EAC9BC,mBAAmB,EACnBC,oBAAoB,CACrB,CAAC;EAEF,IAAAS,QAAA,GAA0D,IAAA5K,cAAO,EAAC,YAAM;MACtE,IAAI,CAACgK,cAAc,CAAC1N,MAAM,EAAE;QAC1B;QACA,OAAO;UACLuO,eAAe,EAAE,CACf,IAAAtL,4BAAqB,EAAC;YACpBC,SAAS,EAAExC,SAAS;YACpB8B,WAAW,EAAE9B,SAAS;YACtB6B,eAAe,EAAE7B,SAAS;YAC1B+B,OAAO,EAAE,EAAE;YACXH,sBAAsB,EAAtBA,sBAAsB;YACtBgB,kBAAkB,EAAExC,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAEwC;UAC9C,CAAC,CAAC;QAEN,CAAC;MACH;MAEA,IAAMkL,4BAA4B,GAAG,IAAIC,GAAG,CAA6B,CAAC;MAE1E,IAAMF,eAAe,GAAGb,cAAc,CAAC7J,GAAG,CAAC,UAAC6K,aAAa,EAAE3K,KAAK,EAAK;QACnE,IAAM4K,uBAAuB,GAAG,CAACZ,mBAAmB;QACpD,IAAMa,uBAAuB,GAC3BhC,KAAK,IAAIE,WAAW,IAAI6B,uBAAuB;QAEjD,IAAM3L,UAAU,GAAG,IAAAC,4BAAqB,EAAC;UACvC4H,UAAU,EAAE6D,aAAa,CAAC1E,IAAI;UAC9B9G,SAAS,EAAExC,SAAS;UACpB8B,WAAW,EAAEkM,aAAa,CAAClM,WAAW;UACtCD,eAAe,EAAEmM,aAAa,CAACnM,eAAe;UAC9CE,OAAO,EAAEqL,wBAAwB,CAAC/J,KAAK,CAAC;UACxCZ,gBAAgB,EAAE,CAAArC,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAE+N,0BAA0B,IAChE/N,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAE+N,0BAA0B,CAChDjB,mBAAmB,EACnBjC,YAAY,CAACmD,cACf,CAAC,GACDb,aAAa,GACbH,wBAAwB,CAAC/J,KAAK,CAAC,CAACkK,aAAa,CAAC,GAC9CvN,SAAS;UACb2C,UAAU,EAAEuL,uBAAuB,GAAGlO,SAAS,GAAGkN,mBAAmB;UACrE;UACAmB,oBAAoB,EAAEJ,uBAAuB;UAC7CrM,sBAAsB,EAAtBA,sBAAsB;UACtBgB,kBAAkB,EAAExC,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAEwC;QAC9C,CAAC,CAAC;QAEF,IAAIN,UAAU,CAACgI,iBAAiB,EAAE;UAChCwD,4BAA4B,CAACnP,GAAG,CAC9B2D,UAAU,CAACgI,iBAAiB,EAC5BhI,UACF,CAAC;QACH;QAEA,OAAOA,UAAU;MACnB,CAAC,CAAC;MAEF,OAAO;QAAEuL,eAAe,EAAfA,eAAe;QAAEC,4BAA4B,EAA5BA;MAA6B,CAAC;IAC1D,CAAC,EAAE,CACDd,cAAc,EACdpL,sBAAsB,EACtBxB,sBAAsB,EACtBiN,mBAAmB,EACnBnB,KAAK,EACLE,WAAW,EACXgB,wBAAwB,EACxBF,mBAAmB,EACnBjC,YAAY,CAACmD,cAAc,EAC3Bb,aAAa,CACd,CAAC;IAnEMM,eAAe,GAAAD,QAAA,CAAfC,eAAe;IAAEC,4BAA4B,GAAAF,QAAA,CAA5BE,4BAA4B;EAqErD,IAAMQ,MAAM,GAAG,IAAAC,kBAAS,EAACtD,YAAY,CAAC;EACtC,IAAAuD,YAAA,GAAiB,IAAAC,oBAAW,EAACxD,YAAY,CAAC;IAAlCyD,IAAI,GAAAF,YAAA,CAAJE,IAAI;EACZ,IAAMC,kBAAkB,gBACtBtR,MAAA,YAAA+G,aAAA;IAAKgB,SAAS,EAAE,IAAAC,gBAAI,EAAC,yBAAyB,CAAE;IAAC,aAAU;EAAS,GACjEyG,QAAQ,gBACPzO,MAAA,YAAA+G,aAAA,CAAA/G,MAAA,YAAA0M,QAAA,qBACE1M,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAAyI,OAAO;IAACC,KAAK,EAAE7H,CAAC,CAAC,oBAAoB;EAAE,gBACtCV,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA4I,IAAI;IAACC,MAAM,EAAE6I,kBAAO;IAACxJ,SAAS,EAAC,gBAAgB;IAACjB,IAAI,EAAC;EAAO,CAAE,CACxD,CAAC,eACV9G,MAAA,YAAA+G,aAAA;IAAMgB,SAAS,EAAC,UAAU;IAACQ,KAAK,EAAE7H,CAAC,CAAC,UAAU;EAAE,GAC7CA,CAAC,CAAC,UAAU,CACT,CACN,CAAC,gBAEHV,MAAA,YAAA+G,aAAA,CAAA/G,MAAA,YAAA0M,QAAA,qBACE1M,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAA4I,IAAI;IAAC3B,IAAI,EAAC,OAAO;IAAC4B,MAAM,EAAE2I;EAAK,CAAE,CAAC,eACnCrR,MAAA,YAAA+G,aAAA;IAAMgB,SAAS,EAAC,UAAU;IAACQ,KAAK,EAAE0I;EAAO,GACtCA,MACG,CACN,CAED,CACN;EACD,IAAMO,YAAY,GAAG5D,YAAY,CAAC4D,YAAY,IAAI,CAAC;EACnD,IAAMC,QAAQ;EACZ;EACA,CAAClO,MAAM,IAAIA,MAAM,CAACtB,MAAM,KAAK,CAAC;;EAEhC;EACA;EACA,IAAMyE,cAAc,IAAAqH,iBAAA,GAAGyC,eAAe,CAAC,CAAC,CAAC,cAAAzC,iBAAA,uBAAlBA,iBAAA,CAAoBrH,cAAc;EAEzD,IAAMmG,gBAAgB,GAAG,IAAAlH,cAAO,EAAC,YAAM;IACrC,IAAI8L,QAAQ,EAAE;MACZ,OAAO5N,SAAS,GAAGR,QAAQ,GAAGE,MAAM,GAAGA,MAAM,CAAC,CAAC,CAAC,GAAGZ,SAAS;IAC9D;IACA,OAAOA,SAAS;EAClB,CAAC,EAAE,CAACU,QAAQ,EAAEE,MAAM,EAAEM,SAAS,EAAE4N,QAAQ,CAAC,CAAC;EAE3C,IAAMpK,WAAW,GAAGmJ,eAAe,CAChC1K,GAAG,CAAC,UAACQ,IAAI,EAAK;IACb,IAAIA,IAAI,CAACgH,IAAI,KAAK,aAAa,EAAE;MAC/B,OAAO7C,sBAAsB,CAACnE,IAAI,CAACe,WAAW,CAAC;IACjD;IACA,OAAOf,IAAI,CAACe,WAAW;EACzB,CAAC,CAAC,CACDkC,IAAI,CAAC,IAAI,CAAC;EAEb,IAAM3C,MAAM,GAAG,IAAAgB,kBAAW,EACxB,UAAA8J,KAAA;IAAA,IAAG5K,IAAI,GAAA4K,KAAA,CAAJ5K,IAAI;IAAA,OACL2K,QAAQ,gBACNzR,MAAA,YAAA+G,aAAA,CAACxH,YAAA,CAAAoS,aAAa,EAAA9P,QAAA;MACZiF,IAAI,EAAEA;IAAK,GACNJ,cAAc,GACf;MACE4J,OAAO,EAAE;QACPF,EAAE,EAAE1J,cAAc,CAAC0J,EAAG;QACtB9C,IAAI,EAAE5G,cAAc,CAAC4G;MACvB,CAAC;MACDsE,WAAW,EAAElL,cAAc,CAACuF,IAAI;MAChCxH,WAAW,EAAEiC,cAAc,CAACjC;IAC9B,CAAC,GACD;MACEmN,WAAW,EACTpB,eAAe,CAAC,CAAC,CAAC,CAAClD,IAAI,KAAK,cAAc,GACtCjG,WAAW,GACX1E,SAAS;MACf8B,WAAW,EAAE+L,eAAe,CAAC,CAAC,CAAC,CAACvD;IAClC,CAAC,CACN,CAAC,gBAEFjN,MAAA,YAAA+G,aAAA,CAACxH,YAAA,CAAAoS,aAAa;MAAC7K,IAAI,EAAEA,IAAK;MAAC4B,MAAM,EAAEmJ;IAAU,CAAE,CAChD;EAAA,GACH,CAACrB,eAAe,EAAEnJ,WAAW,EAAEX,cAAc,EAAE+K,QAAQ,CACzD,CAAC;EAED,IAAMxE,iBAAiB,GAAGwE,QAAQ,GAC9BjB,eAAe,CAAC,CAAC,CAAC,CAACvD,iBAAiB,GACpCtK,SAAS;EAEb,IAAMqK,oBAAoB,GAAGC,iBAAiB,GAC1CxC,sBAAsB,CAACwC,iBAAiB,CAAC,GACzC,EAAE;EAEN,IAAME,UAAU,GAAG,SAAbA,UAAUA,CAAA,EAAS;IACvB,OAAO,IAAAC,4BAAqB,EAACJ,oBAAoB,CAAC;EACpD,CAAC;;EAED;AACF;AACA;EACE,IAAMK,aAAa,GAAG,SAAhBA,aAAaA,CAAA,EAAS;IAC1B,IAAIR,gBAAgB,EAAE;MACpB,IAAInG,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEuF,IAAI,EAAE;QACxB,OAAO;UACLxH,WAAW,EAAEuI,oBAAoB;UACjCf,IAAI,EAAEvF,cAAc,CAACuF,IAAI;UACzBqB,IAAI,EAAE5G,cAAc,CAAC4G;QACvB,CAAC;MACH;MAEA,IAAIN,oBAAoB,EAAE;QACxB,OAAO;UACLvI,WAAW,EAAEuI;QACf,CAAC;MACH;IACF;IAEA,OAAOrK,SAAS;EAClB,CAAC;EAED,OAAO;IACLqG,WAAW,EAAE,SAAbA,WAAWA,CAAGC,KAAwD,EAAK;MACzE,IACE,CAAAuH,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAEvO,MAAM,IAAG,CAAC,IAC3BuO,eAAe,CAAC,CAAC,CAAC,CAAClD,IAAI,KAAK,aAAa,EACzC;QACA,oBACEtN,MAAA,YAAA+G,aAAA;UAAKgB,SAAS,EAAC,uBAAuB;UAACQ,KAAK,EAAElB;QAAY,GACvDA,WACE,CAAC;MAEV;MAEA,oBAAOrH,MAAA,YAAA+G,aAAA,CAAC3G,YAAA,CAAAgH,oBAAoB,EAAAvF,QAAA;QAACyE,IAAI,EAAEkK,eAAe,CAAC,CAAC;MAAE,GAAKvH,KAAK,CAAG,CAAC;IACtE,CAAC;IACD+D,oBAAoB,EAApBA,oBAAoB;IACpByD,4BAA4B,EAA5BA,4BAA4B;IAC5BqB,WAAW,EAAEL,QAAQ,GAAGjB,eAAe,CAAC,CAAC,CAAC,CAAClD,IAAI,GAAG,UAAU;IAC5DgE,kBAAkB,EAAlBA,kBAAkB;IAClBS,MAAM,EAAE,SAARA,MAAMA,CAAG9I,KAAgC;MAAA,OACvCuI,YAAY,GAAG,CAAC,gBACdxR,MAAA,YAAA+G,aAAA,CAAClH,SAAA,CAAAmS,KAAK,EAAAnQ,QAAA;QACJiH,OAAO,EAAC,WAAW;QACnBwE,IAAI,EAAC,KAAK;QACVxG,IAAI,EAAC,QAAQ;QACb+B,KAAK,EAAC,SAAS;QACfoJ,KAAK,EAAET;MAAa,GAChBvI,KAAK,CACV,CAAC,GACA,IAAI;IAAA;IACVrC,MAAM,EAANA,MAAM;IACN4I,YAAY,EAAZA,YAAY;IACZ;IACA3C,gBAAgB,EAAhBA,gBAAgB;IAChBnG,cAAc,EAAdA,cAAc;IACd7C,SAAS,EAATA,SAAS;IACT8K,aAAa,EAAbA,aAAa;IACbE,KAAK,EAALA,KAAK;IACLE,WAAW,EAAXA,WAAW;IACXE,QAAQ,EAARA,QAAQ;IACRuC,YAAY,EAAZA,YAAY;IACZrC,kBAAkB,EAAlBA,kBAAkB;IAClB+C,gBAAgB,EAAE/C,kBAAkB,GAChCvB,YAAY,CAACwB,aAAa,CAAEC,GAAG,GAC/B1M,SAAS;IACbwP,wBAAwB,EAAEhD,kBAAkB,MAAAnD,MAAA,CACrC4B,YAAY,CAACwB,aAAa,CAAEC,GAAG,sCAClC1M,SAAS;IACb2M,wBAAwB,EAAxBA,wBAAwB;IACxB8C,sBAAsB,EAAE9C,wBAAwB,GAC5C1B,YAAY,CAAC2B,mBAAmB,CAAEF,GAAG,GACrC1M,SAAS;IACb8O,QAAQ,EAARA,QAAQ;IACRjE,MAAM,EAAEY,gBAAgB,gBAAGpO,MAAA,YAAA+G,aAAA,CAAC3G,YAAA,CAAAqN,OAAO;MAACD,MAAM,EAAEc;IAAa,CAAE,CAAC,GAAG,IAAI;IACnEf,eAAe,EAAE1J,SAAS,GAAGnD,CAAC,CAAC,IAAI,CAAC,GAAGA,CAAC,CAAC,MAAM,CAAC;IAChDgJ,UAAU,EAAE7F,SAAS,GAAG4D,MAAM,GAAGH,QAAQ;IACzC6F,UAAU,EAAVA,UAAU;IACVE,aAAa,EAAbA;EACF,CAAC;AACH,CAAC","ignoreList":[]}