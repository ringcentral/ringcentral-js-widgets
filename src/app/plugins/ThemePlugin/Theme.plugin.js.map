{"version":3,"file":"Theme.plugin.js","names":["_nextCore","require","_styledComponents","_ThemeProvider","_react","_interopRequireWildcard","_services","_utils","_templateObject","_dec","_dec2","_dec3","_dec4","_class","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_classCallCheck","a","TypeError","_defineProperties","length","enumerable","configurable","writable","_toPropertyKey","key","_createClass","prototype","_toPrimitive","Symbol","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","_inherits","create","value","_setPrototypeOf","_taggedTemplateLiteral","slice","freeze","defineProperties","raw","GlobalVariablesStyles","createGlobalStyle","_ref","theme","palette","type","_ref2","variable","getThemeVariableString","_ref3","addition","ThemePlugin","exports","injectable","name","target","optional","undefined","metadata","Function","Theme","ThemePluginOptions","_PluginModule","_theme","_themePluginOptions","_this","_hostStyleElement","provider","_ref4","children","_useConnector","useConnector","junoCss","useMemo","getCssVariablesFromObject","useEffect","_this$_hostStyleEleme","_this$_hostStyleEleme2","remove","createElement","StyleSheetManager","RcThemeProvider","getHostElement","_this$_themePluginOpt","_this$_themePluginOpt2","element","document","setAttribute","body","appendChild","afterCreateStore","store","global","PluginModule"],"sources":["src/app/plugins/ThemePlugin/Theme.plugin.tsx"],"sourcesContent":["import type { Store } from '@ringcentral-integration/next-core';\nimport {\n  injectable,\n  optional,\n  PluginModule,\n  useConnector,\n} from '@ringcentral-integration/next-core';\nimport type { ThemeContainerProps } from '@ringcentral-integration/widgets/containers/ThemeContainer/ThemeContainer.interface';\nimport {\n  createGlobalStyle,\n  RcThemeProvider,\n  StyleSheetManager,\n} from '@ringcentral/juno';\nimport React, { PropsWithChildren, useEffect, useMemo } from 'react';\n\nimport { Theme } from '../../services';\n\nimport type {\n  ThemePluginOptions,\n  ThemePluginProps,\n} from './Theme.plugin.interface';\nimport { getCssVariablesFromObject, getThemeVariableString } from './utils';\n\ntype GlobalVariablesStylesProps = Pick<ThemeContainerProps, 'variable'> & {\n  addition?: string;\n};\n\nconst GlobalVariablesStyles = createGlobalStyle<GlobalVariablesStylesProps>`\n  :root {\n    color-scheme: ${({ theme }) => theme.palette.type};\n    ${({ variable, theme }) => getThemeVariableString(variable, theme)};\n    ${({ addition }) => addition};\n  }\n`;\n\n@injectable({\n  name: 'ThemePlugin',\n})\nexport class ThemePlugin extends PluginModule {\n  private _hostStyleElement?: HTMLElement;\n\n  constructor(\n    private _theme: Theme,\n    @optional('ThemePluginOptions')\n    private _themePluginOptions: ThemePluginOptions,\n  ) {\n    super();\n  }\n\n  // for our old system can work with Juno, need host juno inside body, make that always have the higher priority, also make that work in shared worker\n  private getHostElement() {\n    return (\n      this._themePluginOptions?.getHostElement?.() ||\n      (() => {\n        const element = document.createElement('div');\n        element.setAttribute('id', 'theme-plugin-host');\n\n        document.body.appendChild(element);\n        return element;\n      })()\n    );\n  }\n\n  override afterCreateStore(store: Store) {\n    if (global.document && !this._hostStyleElement) {\n      this._hostStyleElement = this.getHostElement();\n    }\n\n    return store;\n  }\n\n  override provider = ({ children }: PropsWithChildren<ThemePluginProps>) => {\n    const { variable, theme } = useConnector(() => {\n      return {\n        theme: this._theme.theme,\n        variable: this._theme.variable,\n      };\n    });\n\n    const junoCss = useMemo(\n      () => getCssVariablesFromObject(theme?.palette as any, 'j-'),\n      [theme?.palette],\n    );\n\n    useEffect(\n      () => () => {\n        this._hostStyleElement?.remove?.();\n      },\n      [],\n    );\n\n    return (\n      <StyleSheetManager target={this._hostStyleElement}>\n        <RcThemeProvider theme={theme}>\n          <GlobalVariablesStyles variable={variable} addition={junoCss} />\n          {children}\n        </RcThemeProvider>\n      </StyleSheetManager>\n    );\n  };\n}\n"],"mappings":"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","ignoreList":[]}