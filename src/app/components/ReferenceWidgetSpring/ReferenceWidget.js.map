{"version":3,"file":"ReferenceWidget.js","names":["_hooks","require","_springIcon","_springUi","_react","_interopRequireWildcard","_ReferencePopper","_ReferenceSearchPanel","_i18n","_interopRequireDefault","e","__esModule","t","WeakMap","r","n","o","i","f","__proto__","_typeof","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","value","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","_extends","assign","bind","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","iterator","Array","from","isArray","_arrayLikeToArray","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","a","toString","slice","constructor","name","test","l","u","next","done","ReferenceWidget","exports","filedProps","props","uiSchema","formData","schema","currentValue","useMemo","_useLocale","useLocale","i18n","_ref","overrideLabel","disabled","onChange","allDisplayList","onCreateEntity","addEntityMenu","enableSearch","formKey","searchFn","multiple","expandMode","_ref$useMenuList","useMenuList","getIcon","_ref$showChips","showChips","addEntityTooltip","_ref$autoCloseOnSelec","autoCloseOnSelect","_ref$clearBtnClearsSe","clearBtnClearsSelection","withAddEntityButtonRef","useRef","inputRef","autocompleteRef","_useState","useState","_useState2","inputValue","setInputValue","_useState3","_useState4","searchOpened","setSearchOpened","matchedCount","reduce","acc","list","values","selectedMap","item","id","fieldLabel","title","referenceItemClickHandler","useCallback","selected","newValues","concat","record","current","inputElement","blur","openSearchPage","closeSearchPage","anchorEl","CustomPopper","useReferencePopper","filterTerm","onItemClick","renderTags","getTagProps","_values$","createElement","className","style","maxWidth","map","index","tagProps","_ref2","type","Chip","key","label","onDelete","truncate","showAddEntityButton","Boolean","addEntityButtonRef","_useState5","_useState6","menuOpen","setMenuOpen","handleMenuOpen","handleMenuClose","onPressEnter","ReferenceInput","Autocomplete","ref","RootProps","ClearButtonProps","onClick","placeholder","clearBtn","toggleButton","PopperComponent","PopperProps","anchorElType","placement","onClose","reason","options","onInputChange","newInputValue","ToggleButtonProps","inputVariant","onKeyDown","size","Fragment","IconButton","TooltipProps","symbol","PlusMd","color","variant","Menu","open","option","MenuItem","onSelect","icon","MenuItemText","ReferenceSearchPanel","onBack","_inputRef$current","focus","closePageFn","initValue"],"sources":["src/app/components/ReferenceWidgetSpring/ReferenceWidget.tsx"],"sourcesContent":["import { useLocale } from '@ringcentral-integration/micro-core/src/app/hooks';\nimport { PlusMd } from '@ringcentral/spring-icon';\nimport {\n  Autocomplete,\n  AutocompleteProps,\n  Chip,\n  IconButton,\n  Menu,\n  MenuItem,\n  MenuItemText,\n} from '@ringcentral/spring-ui';\nimport React, { useCallback, useMemo, useRef, useState } from 'react';\n\nimport {\n  ReferenceItemClickHandler,\n  ReferenceWidgetAddEntityMenuProps,\n  ReferenceWidgetProps,\n  SelectedIdMap,\n  SimpleCrmObject,\n} from './ReferenceWidget.interface';\nimport { useReferencePopper } from './components/ReferencePopper';\nimport { ReferenceSearchPanel } from './components/ReferenceSearchPanel';\nimport i18n from './i18n';\n\nexport const ReferenceWidget = (filedProps: any) => {\n  const {\n    uiSchema: { 'ui:options': props },\n    formData,\n    schema,\n  } = filedProps;\n\n  // Ensure currentValue is always an array\n  const currentValue = useMemo(\n    () => (Array.isArray(formData) ? formData : []),\n    [formData],\n  );\n\n  const { t } = useLocale(i18n);\n\n  const {\n    overrideLabel,\n    disabled,\n    onChange,\n    allDisplayList,\n    onCreateEntity,\n    addEntityMenu,\n    enableSearch,\n    formKey,\n    searchFn,\n    multiple,\n    expandMode,\n    useMenuList = false,\n    getIcon,\n    showChips = true,\n    addEntityTooltip,\n    autoCloseOnSelect = false,\n    clearBtnClearsSelection = false,\n  } = props as ReferenceWidgetProps & {\n    expandMode: boolean;\n    showChips?: boolean;\n    addEntityMenu?: ReferenceWidgetAddEntityMenuProps;\n  };\n  const withAddEntityButtonRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const autocompleteRef = useRef<any>(null);\n  const [inputValue, setInputValue] = useState('');\n  const [searchOpened, setSearchOpened] = useState(false);\n  const matchedCount = allDisplayList.reduce(\n    (acc, list) => acc + list.values.length,\n    0,\n  );\n  const selectedMap = useMemo(\n    () =>\n      currentValue.reduce((acc, item) => {\n        if (item && item.id) {\n          acc[item.id] = true;\n        }\n        return acc;\n      }, {} as SelectedIdMap),\n    [currentValue],\n  );\n\n  const fieldLabel = overrideLabel ?? schema.title;\n  const referenceItemClickHandler = useCallback<ReferenceItemClickHandler>(\n    (item, selected) => {\n      let newValues: SimpleCrmObject[] = [];\n      if (!multiple) {\n        newValues = selected ? [item] : [];\n      } else {\n        newValues = selected\n          ? [...currentValue, item]\n          : currentValue.filter(\n              (record: SimpleCrmObject) => record.id !== item.id,\n            );\n      }\n      onChange(newValues, { item, selected });\n\n      if (autoCloseOnSelect && selected && autocompleteRef.current) {\n        const inputElement = inputRef.current;\n        if (inputElement) {\n          inputElement.blur();\n        }\n      }\n    },\n    [onChange, currentValue, multiple, autoCloseOnSelect],\n  );\n\n  const openSearchPage = useCallback(() => {\n    setSearchOpened(true);\n  }, []);\n  const closeSearchPage = useCallback(() => {\n    setSearchOpened(false);\n  }, []);\n  const anchorEl = useCallback(() => withAddEntityButtonRef.current, []);\n\n  const CustomPopper = useReferencePopper({\n    filterTerm: inputValue,\n    allDisplayList,\n    currentValue,\n    formKey,\n    onItemClick: referenceItemClickHandler,\n    enableSearch,\n    searchFn: openSearchPage,\n    useMenuList,\n    getIcon,\n    anchorEl,\n  });\n\n  const renderTags: AutocompleteProps['renderTags'] = useCallback(\n    (values, getTagProps) => {\n      if (!showChips) {\n        if (!values || values.length === 0) {\n          return null;\n        }\n        return (\n          <span\n            className=\"typography-mainText text-neutral-b1 truncate\"\n            style={{ maxWidth: '75%' }} // tailwind css not computing max-w-[75%]\n          >\n            {values[0]?.name || ''}\n          </span>\n        );\n      }\n      return values.map((item: any, index: number) => {\n        const tagProps = getTagProps(item, index);\n        const { id, name, type } = item as SimpleCrmObject;\n\n        return (\n          <Chip\n            data-sign={`chip-${id ?? index}`}\n            key={index}\n            {...tagProps}\n            label={name}\n            onDelete={() => {\n              referenceItemClickHandler(item, false);\n            }}\n            truncate\n          />\n        );\n      });\n    },\n    [referenceItemClickHandler, showChips],\n  );\n\n  const showAddEntityButton = Boolean(onCreateEntity || addEntityMenu);\n\n  // Ref and state for the add entity menu\n  const addEntityButtonRef = useRef<HTMLButtonElement>(null);\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  const handleMenuOpen = () => setMenuOpen(true);\n  const handleMenuClose = () => setMenuOpen(false);\n\n  const onPressEnter = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === 'Enter') {\n        if (!enableSearch || inputValue.length < 3 || searchOpened) return;\n        // setSearchOpenedState(formKey);\n        setSearchOpened(true);\n      }\n    },\n    [enableSearch, inputValue, searchOpened, setSearchOpened],\n  );\n\n  const ReferenceInput = (\n    <Autocomplete\n      ref={autocompleteRef}\n      inputRef={inputRef}\n      RootProps={{\n        'data-sign': formKey,\n        className: 'max-w-full',\n      }}\n      ClearButtonProps={\n        {\n          'data-sign': 'removeBtn',\n          ...(clearBtnClearsSelection && {\n            onClick: () => {\n              setInputValue('');\n              if (currentValue && currentValue.length > 0) {\n                currentValue.forEach((item) => {\n                  referenceItemClickHandler(item, false);\n                });\n              }\n            },\n          }),\n          // TODO: spring-ui issue with data-props miss, so must as any\n        } as any\n      }\n      placeholder={t('matchedRecordsTips', { matchedCount })}\n      disabled={disabled}\n      clearBtn={\n        !!inputValue.length ||\n        (clearBtnClearsSelection && currentValue && currentValue.length > 0)\n      }\n      multiple\n      toggleButton\n      //@ts-ignore\n      PopperComponent={CustomPopper}\n      PopperProps={{\n        anchorElType: 'root',\n        placement: 'bottom',\n      }}\n      value={currentValue}\n      onClose={(e, reason) => {\n        if (reason === 'blur' || reason === 'escape') {\n          setInputValue('');\n        }\n      }}\n      options={[]}\n      label={fieldLabel}\n      inputValue={inputValue}\n      onInputChange={(newInputValue) => {\n        setInputValue(newInputValue);\n      }}\n      ToggleButtonProps={{\n        disabled: false,\n      }}\n      renderTags={renderTags}\n      inputVariant=\"outlined\"\n      onKeyDown={onPressEnter}\n      size=\"medium\"\n    />\n  );\n  return (\n    <>\n      {showAddEntityButton ? (\n        <div className=\"flex items-center gap-2\" ref={withAddEntityButtonRef}>\n          <div className=\"flex-1 min-w-0\">{ReferenceInput}</div>\n          <IconButton\n            data-sign=\"addEntity\"\n            className=\"mt-6 flex-shrink-0\"\n            TooltipProps={{\n              title: addEntityTooltip,\n            }}\n            symbol={PlusMd}\n            color=\"secondary\"\n            variant=\"icon\"\n            ref={addEntityButtonRef}\n            onClick={() => {\n              if (addEntityMenu) {\n                handleMenuOpen();\n              } else {\n                onCreateEntity?.();\n              }\n            }}\n            size=\"medium\"\n          />\n        </div>\n      ) : (\n        ReferenceInput\n      )}\n      {addEntityMenu && (\n        <Menu\n          open={menuOpen}\n          anchorEl={() => addEntityButtonRef.current}\n          onClose={handleMenuClose}\n        >\n          {addEntityMenu.options.map((option) => (\n            <MenuItem\n              key={option.type}\n              onClick={() => {\n                addEntityMenu.onSelect(option.type);\n                handleMenuClose();\n              }}\n            >\n              <span className=\"mr-2\">{option.icon}</span>\n              <MenuItemText>{option.label}</MenuItemText>\n            </MenuItem>\n          ))}\n        </Menu>\n      )}\n      {searchOpened && (\n        <ReferenceSearchPanel\n          expandMode={expandMode}\n          onBack={() => {\n            setInputValue('');\n            inputRef.current?.focus();\n          }}\n          closePageFn={closeSearchPage}\n          onCreateEntity={onCreateEntity}\n          addEntityMenu={addEntityMenu}\n          onItemClick={referenceItemClickHandler}\n          selectedMap={selectedMap}\n          searchFn={searchFn}\n          initValue={inputValue}\n          useMenuList={useMenuList}\n          getIcon={getIcon}\n          addEntityTooltip={addEntityTooltip}\n        />\n      )}\n    </>\n  );\n};\n"],"mappings":"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","ignoreList":[]}