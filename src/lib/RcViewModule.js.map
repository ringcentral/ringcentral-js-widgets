{"version":3,"file":"RcViewModule.js","names":["_loggerV","require","_reactantShare","_rxjs","_constant","_RcModule","_rxjs2","_defineProperties","e","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","TypeError","String","Number","_classCallCheck","a","n","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","value","_setPrototypeOf","RcViewModule","exports","_ViewModule","_this","logger","loggerV2","status$","fromWatchValue","status","ready$","pipe","filter","ready","readyState$","map","resetting$","resetting","ignoreReadyModulesKey","Set","ModuleStatus","Pending","initModuleKey","ViewModule","defineProperties","getOwnPropertyDescriptors","RcModule"],"sources":["src/lib/RcViewModule.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-declaration-merging */\nimport { loggerV2 } from '@ringcentral-integration/core/lib/logger/loggerV2';\nimport { ViewModule } from 'reactant-share';\nimport { filter, map } from 'rxjs';\n\nimport {\n  ignoreReadyModulesKey,\n  initModuleKey,\n  ModuleStatus,\n} from '../constant';\n\nimport { RcModule } from './RcModule';\nimport { fromWatchValue } from './rxjs';\n\nexport interface RcViewModule {\n  [initModuleKey](): void;\n\n  // that implement in RcModule with prototype\n  get pending(): boolean;\n  get ready(): boolean;\n  get resetting(): boolean;\n  get initializing(): boolean;\n  get identifier(): string;\n}\n\nexport abstract class RcViewModule extends ViewModule {\n  protected logger = loggerV2.create(this);\n\n  status$ = fromWatchValue(this, () => this.status);\n\n  /**\n   * emit when module is ready\n   *\n   * 1. Only emit once when module is ready, if you want handle different status, you can use `status$`\n   *      normally should work with retry(this.resetting$) to re-start the flow when user logout\n   *\n   * 2. if you want to handle base on ready state, you can use `readyState$`\n   */\n  ready$ = this.status$.pipe(filter(() => this.ready));\n\n  readyState$ = this.status$.pipe(map(() => this.ready));\n\n  resetting$ = this.status$.pipe(filter(() => this.resetting));\n\n  status: ModuleStatus;\n\n  private [ignoreReadyModulesKey] = new Set<RcModule | RcViewModule>();\n\n  constructor() {\n    super();\n    this.status = ModuleStatus.Pending;\n    this[initModuleKey]();\n  }\n\n  protected onInit?(): Promise<void> | void;\n  /**\n   * `onInitOnce` once life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInitOnce?(): Promise<void> | void;\n  /**\n   * `onInitSuccess` life cycle for current initialization after this module is ready.\n   */\n  protected onInitSuccess?(): Promise<void> | void;\n  /**\n   * `onReset` life cycle for current reset before one of deps modules is not ready.\n   */\n  protected onReset?(): Promise<void> | void;\n  /**\n   * Each Redux dispatch action will trigger `onStateChange` once.\n   */\n  protected onStateChange?(): Promise<void> | void;\n  /**\n   * @deprecated\n   */\n  // @ts-ignore that implement in RcModule with prototype\n  protected _shouldInit(): boolean;\n  /**\n   * @deprecated\n   */\n  // @ts-ignore that implement in RcModule with prototype\n  protected _shouldReset(): boolean;\n}\n\n// RcViewModule is multi-inherited , it needs to inherit implicitly from RcModule.\nObject.defineProperties(\n  RcViewModule.prototype,\n  Object.getOwnPropertyDescriptors(RcModule.prototype),\n);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,cAAA,GAAAD,OAAA;AACA,IAAAE,KAAA,GAAAF,OAAA;AAEA,IAAAG,SAAA,GAAAH,OAAA;AAMA,IAAAI,SAAA,GAAAJ,OAAA;AACA,IAAAK,MAAA,GAAAL,OAAA;AAAwC,SAAAM,kBAAAC,CAAA,EAAAC,CAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAD,CAAA,CAAAE,MAAA,EAAAD,CAAA,UAAAE,CAAA,GAAAH,CAAA,CAAAC,CAAA,GAAAE,CAAA,CAAAC,UAAA,GAAAD,CAAA,CAAAC,UAAA,QAAAD,CAAA,CAAAE,YAAA,kBAAAF,CAAA,KAAAA,CAAA,CAAAG,QAAA,QAAAC,MAAA,CAAAC,cAAA,CAAAT,CAAA,EAAAU,cAAA,CAAAN,CAAA,CAAAO,GAAA,GAAAP,CAAA;AAAA,SAAAQ,aAAAZ,CAAA,EAAAC,CAAA,EAAAC,CAAA,WAAAD,CAAA,IAAAF,iBAAA,CAAAC,CAAA,CAAAa,SAAA,EAAAZ,CAAA,GAAAC,CAAA,IAAAH,iBAAA,CAAAC,CAAA,EAAAE,CAAA,GAAAM,MAAA,CAAAC,cAAA,CAAAT,CAAA,iBAAAO,QAAA,SAAAP,CAAA;AAAA,SAAAU,eAAAR,CAAA,QAAAY,CAAA,GAAAC,YAAA,CAAAb,CAAA,gCAAAc,OAAA,CAAAF,CAAA,IAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAC,aAAAb,CAAA,EAAAD,CAAA,oBAAAe,OAAA,CAAAd,CAAA,MAAAA,CAAA,SAAAA,CAAA,MAAAF,CAAA,GAAAE,CAAA,CAAAe,MAAA,CAAAC,WAAA,kBAAAlB,CAAA,QAAAc,CAAA,GAAAd,CAAA,CAAAmB,IAAA,CAAAjB,CAAA,EAAAD,CAAA,gCAAAe,OAAA,CAAAF,CAAA,UAAAA,CAAA,YAAAM,SAAA,yEAAAnB,CAAA,GAAAoB,MAAA,GAAAC,MAAA,EAAApB,CAAA;AAAA,SAAAqB,gBAAAC,CAAA,EAAAC,CAAA,UAAAD,CAAA,YAAAC,CAAA,aAAAL,SAAA;AAAA,SAAAM,WAAAxB,CAAA,EAAAE,CAAA,EAAAJ,CAAA,WAAAI,CAAA,GAAAuB,eAAA,CAAAvB,CAAA,GAAAwB,0BAAA,CAAA1B,CAAA,EAAA2B,yBAAA,KAAAC,OAAA,CAAAC,SAAA,CAAA3B,CAAA,EAAAJ,CAAA,QAAA2B,eAAA,CAAAzB,CAAA,EAAA8B,WAAA,IAAA5B,CAAA,CAAA6B,KAAA,CAAA/B,CAAA,EAAAF,CAAA;AAAA,SAAA4B,2BAAA1B,CAAA,EAAAF,CAAA,QAAAA,CAAA,iBAAAgB,OAAA,CAAAhB,CAAA,0BAAAA,CAAA,UAAAA,CAAA,iBAAAA,CAAA,YAAAoB,SAAA,qEAAAc,sBAAA,CAAAhC,CAAA;AAAA,SAAAgC,uBAAAlC,CAAA,mBAAAA,CAAA,YAAAmC,cAAA,sEAAAnC,CAAA;AAAA,SAAA6B,0BAAA,cAAA3B,CAAA,IAAAkC,OAAA,CAAAvB,SAAA,CAAAwB,OAAA,CAAAlB,IAAA,CAAAW,OAAA,CAAAC,SAAA,CAAAK,OAAA,iCAAAlC,CAAA,aAAA2B,yBAAA,YAAAA,0BAAA,aAAA3B,CAAA;AAAA,SAAAyB,gBAAAzB,CAAA,WAAAyB,eAAA,GAAAnB,MAAA,CAAA8B,cAAA,GAAA9B,MAAA,CAAA+B,cAAA,CAAAC,IAAA,eAAAtC,CAAA,WAAAA,CAAA,CAAAuC,SAAA,IAAAjC,MAAA,CAAA+B,cAAA,CAAArC,CAAA,MAAAyB,eAAA,CAAAzB,CAAA;AAAA,SAAAwC,UAAAxC,CAAA,EAAAF,CAAA,6BAAAA,CAAA,aAAAA,CAAA,YAAAoB,SAAA,wDAAAlB,CAAA,CAAAW,SAAA,GAAAL,MAAA,CAAAmC,MAAA,CAAA3C,CAAA,IAAAA,CAAA,CAAAa,SAAA,IAAAmB,WAAA,IAAAY,KAAA,EAAA1C,CAAA,EAAAK,QAAA,MAAAD,YAAA,WAAAE,MAAA,CAAAC,cAAA,CAAAP,CAAA,iBAAAK,QAAA,SAAAP,CAAA,IAAA6C,eAAA,CAAA3C,CAAA,EAAAF,CAAA;AAAA,SAAA6C,gBAAA3C,CAAA,EAAAF,CAAA,WAAA6C,eAAA,GAAArC,MAAA,CAAA8B,cAAA,GAAA9B,MAAA,CAAA8B,cAAA,CAAAE,IAAA,eAAAtC,CAAA,EAAAF,CAAA,WAAAE,CAAA,CAAAuC,SAAA,GAAAzC,CAAA,EAAAE,CAAA,KAAA2C,eAAA,CAAA3C,CAAA,EAAAF,CAAA,KAZxC;AAAA,IAyBsB8C,YAAY,GAAAC,OAAA,CAAAD,YAAA,0BAAAE,WAAA;EAuBhC,SAAAF,aAAA,EAAc;IAAA,IAAAG,KAAA;IAAA1B,eAAA,OAAAuB,YAAA;IACZG,KAAA,GAAAvB,UAAA,OAAAoB,YAAA;IAAQG,KAAA,CAvBAC,MAAM,GAAGC,iBAAQ,CAACR,MAAM,CAAAM,KAAK,CAAC;IAAAA,KAAA,CAExCG,OAAO,GAAG,IAAAC,qBAAc,EAAAJ,KAAA,EAAO;MAAA,OAAMA,KAAA,CAAKK,MAAM;IAAA,EAAC;IAEjD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;IAPEL,KAAA,CAQAM,MAAM,GAAGN,KAAA,CAAKG,OAAO,CAACI,IAAI,CAAC,IAAAC,YAAM,EAAC;MAAA,OAAMR,KAAA,CAAKS,KAAK;IAAA,EAAC,CAAC;IAAAT,KAAA,CAEpDU,WAAW,GAAGV,KAAA,CAAKG,OAAO,CAACI,IAAI,CAAC,IAAAI,SAAG,EAAC;MAAA,OAAMX,KAAA,CAAKS,KAAK;IAAA,EAAC,CAAC;IAAAT,KAAA,CAEtDY,UAAU,GAAGZ,KAAA,CAAKG,OAAO,CAACI,IAAI,CAAC,IAAAC,YAAM,EAAC;MAAA,OAAMR,KAAA,CAAKa,SAAS;IAAA,EAAC,CAAC;IAAAb,KAAA,CAE5DK,MAAM;IAAAL,KAAA,CAEGc,+BAAqB,IAAI,IAAIC,GAAG,CAA0B,CAAC;IAIlEf,KAAA,CAAKK,MAAM,GAAGW,sBAAY,CAACC,OAAO;IAClCjB,KAAA,CAAKkB,uBAAa,CAAC,CAAC,CAAC;IAAC,OAAAlB,KAAA;EACxB;EAACP,SAAA,CAAAI,YAAA,EAAAE,WAAA;EAAA,OAAApC,YAAA,CAAAkC,YAAA;AAAA,EA3BwCsB,yBAAU,GA0DrD;AACA5D,MAAM,CAAC6D,gBAAgB,CACrBvB,YAAY,CAACjC,SAAS,EACtBL,MAAM,CAAC8D,yBAAyB,CAACC,kBAAQ,CAAC1D,SAAS,CACrD,CAAC","ignoreList":[]}