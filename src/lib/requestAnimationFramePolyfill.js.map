{"version":3,"file":"requestAnimationFramePolyfill.js","names":["_isSharedWorker","require","_isWebWorker","_typeof","o","Symbol","iterator","constructor","prototype","uId","uniqueId","root","exports","self","global","nowOffset","Date","now","pnow","performance","reservedCBs","lastTime","polyfillRaf","callback","TypeError","currentTime","gap","delay","id","Object","keys","length","setTimeout","copied","forEach","key","polyfillCaf","vendorPrefixes","getRequestAnimationFrame","vp","getCancelAnimationFrame","find","arr","predicate","i","isWebWorker","isSharedWorker","globalThis","requestAnimationFrame","cancelAnimationFrame"],"sources":["src/lib/requestAnimationFramePolyfill.ts"],"sourcesContent":["/**\n * Thanks for following contributor of codes\n * https://gist.github.com/1866474\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n * https://github.com/Financial-Times/polyfill-library/blob/master/polyfills/requestAnimationFrame/polyfill.js\n **/\nimport { isSharedWorker } from './isSharedWorker';\nimport { isWebWorker } from './isWebWorker';\n\n// source: https://github.com/aluc-io/request-animation-frame-polyfill/blob/master/src/request-animation-frame-polyfill.ts\nlet uId = 1;\nconst uniqueId = () => uId++;\n\n// We use `self` instead of `window` for `WebWorker` support.\nexport const root: any =\n  typeof self === 'object' && self.self == self\n    ? self\n    : typeof global === 'object' && (global as any).global == global\n    ? global\n    : {};\n\nconst nowOffset = Date.now();\n\n// use performance api if exist, otherwise use Date.now.\n// Date.now polyfill required.\nconst pnow = (): number => {\n  if (root.performance && typeof root.performance.now === 'function') {\n    return root.performance.now();\n  }\n\n  // fallback\n  return Date.now() - nowOffset;\n};\n\ninterface IReservedCBs {\n  [key: string]: (...args: any[]) => void;\n}\nlet reservedCBs: IReservedCBs = {};\n\nlet lastTime = Date.now();\n\nconst polyfillRaf = (callback: (...args: any[]) => void) => {\n  if (typeof callback !== 'function') {\n    throw new TypeError(callback + ' is not a function');\n  }\n\n  const currentTime = Date.now();\n  const gap = currentTime - lastTime;\n  const delay = gap > 16 ? 0 : 16 - gap;\n\n  const id = uniqueId();\n  reservedCBs[id] = callback;\n\n  // keys(reservedCBs).length > 1 의미는 이미 setTimeout 이 걸려있는 경우.\n  // 함께 callback 이 실행될 수 있게 reservedCBs 에만 추가해주고 return\n  if (Object.keys(reservedCBs).length > 1) return id;\n\n  setTimeout(() => {\n    lastTime = currentTime;\n    const copied = reservedCBs;\n    reservedCBs = {};\n\n    Object.keys(copied).forEach((key: string) => copied[key](pnow()));\n  }, delay);\n\n  return id;\n};\n\nconst polyfillCaf = (id: number) => {\n  delete reservedCBs[id];\n};\n\nconst vendorPrefixes = ['', 'webkit', 'moz', 'ms', 'o'];\n\ntype TRequestAnimationFrame = (callback: (...args: any[]) => void) => number;\ntype TCancelAnimationFrame = (id: number) => void;\n\nconst getRequestAnimationFrame = (\n  vp: string | void,\n): TRequestAnimationFrame => {\n  if (typeof vp !== 'string') return polyfillRaf;\n  if (vp === '') return root['requestAnimationFrame'];\n  return root[vp + 'RequestAnimationFrame'];\n};\n\nconst getCancelAnimationFrame = (vp: string | void): TCancelAnimationFrame => {\n  if (typeof vp !== 'string') return polyfillCaf;\n  if (vp === '') return root['cancelAnimationFrame'];\n  return (\n    root[vp + 'CancelAnimationFrame'] ||\n    root[vp + 'CancelRequestAnimationFrame']\n  );\n};\n\nconst find = (arr: any[], predicate: (...args: any[]) => boolean) => {\n  let i = 0;\n  while (arr[i] !== void 0) {\n    if (predicate(arr[i])) return arr[i];\n    i = i + 1;\n  }\n};\n\nconst vp = find(vendorPrefixes, (vp: string) => !!getRequestAnimationFrame(vp));\n\nif (isWebWorker || isSharedWorker) {\n  globalThis.requestAnimationFrame = getRequestAnimationFrame(vp);\n  globalThis.cancelAnimationFrame = getCancelAnimationFrame(vp);\n}\n"],"mappings":"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","ignoreList":[]}