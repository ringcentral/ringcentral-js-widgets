{"version":3,"file":"withAbortController.js","names":["_rxjs","require","withAbortController","exports","fetcher","defer","controller","AbortController","signal","pipe","tap","finalize","_controller","abort"],"sources":["src/lib/rxjs/withAbortController.ts"],"sourcesContent":["import {\n  Observable,\n  ObservableInput,\n  ObservedValueOf,\n  defer,\n  finalize,\n  tap,\n} from 'rxjs';\n\n/**\n * abort controller with flow way, when unsubscribe,\n * abort controller will be abort, that can be use in abort fetch request\n *\n * @example\n * ```ts\n * const fetch$ = withAbortController(signal => fetch('url', { signal }));\n * const subscription = fetch$.subscribe();\n *\n * subscription.unsubscribe(); // abort fetch request\n * ```\n */\nexport const withAbortController = <R extends ObservableInput<unknown>>(\n  fetcher: (signal: AbortSignal) => R,\n): Observable<ObservedValueOf<R>> => {\n  return defer(() => {\n    let controller: AbortController | null = new AbortController();\n    const signal = controller.signal;\n\n    return defer(() => fetcher(signal)).pipe(\n      tap(() => (controller = null)),\n      finalize(() => controller?.abort()),\n    );\n  });\n};\n"],"mappings":";;;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,IAAMC,mBAAmB,GAAAC,OAAA,CAAAD,mBAAA,GAAG,SAAtBA,mBAAmBA,CAC9BE,OAAmC,EACA;EACnC,OAAO,IAAAC,WAAK,EAAC,YAAM;IACjB,IAAIC,UAAkC,GAAG,IAAIC,eAAe,CAAC,CAAC;IAC9D,IAAMC,MAAM,GAAGF,UAAU,CAACE,MAAM;IAEhC,OAAO,IAAAH,WAAK,EAAC;MAAA,OAAMD,OAAO,CAACI,MAAM,CAAC;IAAA,EAAC,CAACC,IAAI,CACtC,IAAAC,SAAG,EAAC;MAAA,OAAOJ,UAAU,GAAG,IAAI;IAAA,CAAC,CAAC,EAC9B,IAAAK,cAAQ,EAAC;MAAA,IAAAC,WAAA;MAAA,QAAAA,WAAA,GAAMN,UAAU,cAAAM,WAAA,uBAAVA,WAAA,CAAYC,KAAK,CAAC,CAAC;IAAA,EACpC,CAAC;EACH,CAAC,CAAC;AACJ,CAAC","ignoreList":[]}