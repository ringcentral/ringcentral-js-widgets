{"version":3,"file":"checkModules.js","names":["_constant","require","_slicedToArray","r","e","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","process","env","NODE_ENV","globalThis","checkModules","_globalThis$app$modul","needCheckModules","arguments","undefined","checkedModules","pickedModules","isObject","_needCheckModules","values","app","modules","forEach","module","ready","notReadyModules","notReadyModulesKey","includes","error","_shouldInit","pending","console","warn","concat","log","onInit","onInitOnce","_globalThis$app$modul2","entries","reduce","obj","_ref","_ref2","key"],"sources":["src/lib/checkModules.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { notReadyModulesKey } from '../constant';\n\nif (process.env.NODE_ENV !== 'production') {\n  globalThis.checkModules = (\n    needCheckModules = null,\n    checkedModules: any[] = [],\n    pickedModules: any[] = [],\n  ) => {\n    const isObject = toString.call(needCheckModules) === '[object Object]';\n    const _needCheckModules: any[] = isObject\n      ? [needCheckModules]\n      : needCheckModules ?? Object.values(globalThis.app.modules ?? {});\n    _needCheckModules.forEach((module) => {\n      if (module && typeof module.ready === 'boolean' && !module.ready) {\n        const notReadyModules = module[notReadyModulesKey];\n        if (notReadyModules.length > 0 && !checkedModules.includes(module)) {\n          checkedModules.push(module);\n          globalThis.checkModules(notReadyModules, checkedModules, pickedModules);\n          return;\n        } else if (\n          !pickedModules.includes(module) &&\n          notReadyModules.length === 0\n        ) {\n          pickedModules.push(module);\n        }\n      }\n    });\n    if (!needCheckModules || isObject) {\n      let error = 0;\n      // please check `_shouldInit()`, `onInit()` or `onInitOnce`.\n      pickedModules.forEach((module: any) => {\n        if (!module._shouldInit() && module.pending) {\n          console.warn(\n            `Please check the ${module.constructor.name}._shouldInit method.`,\n          );\n          console.log(module._shouldInit);\n          error++;\n        } else {\n          if (module.onInit) {\n            console.warn(\n              `Please check the ${module.constructor.name}.onInit method.`,\n            );\n            error++;\n          }\n          if (module.onInitOnce) {\n            console.warn(\n              `Please check the ${module.constructor.name}.onInitOnce method.`,\n            );\n            error++;\n          }\n        }\n      });\n\n      if (error === 0) {\n        console.log('✨✨✨✨✨ All modules pass check ✨✨✨✨✨');\n      } else if (!needCheckModules) {\n        return Object.entries(\n          (globalThis.app.modules ?? {}) as Record<string, any>,\n        ).reduce((obj, [key, value]) => {\n          if (value.ready === false) {\n            obj[key] = () => globalThis.checkModules(value);\n          }\n          return obj;\n        }, {} as Record<string, any>);\n      }\n    }\n  };\n}\n"],"mappings":"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","ignoreList":[]}