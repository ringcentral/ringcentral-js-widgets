{"version":3,"file":"RcModule.js","names":["_loggerV","require","_reactantShare","_rxjs","_constant","_Initiator","_decorators","_rxjs2","_dec","_dec2","_dec3","_class","_descriptor","_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","initializer","_classCallCheck","_defineProperties","_toPropertyKey","key","_createClass","_toPrimitive","_typeof","toPrimitive","String","Number","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","RcModule","exports","Reflect","metadata","ModuleStatus","Function","_this","logger","loggerV2","status$","fromWatchValue","status","ready$","pipe","filter","ready","readyState$","map","resetting$","resetting","initializedKey","ignoreReadyModulesKey","Set","initSuccess$","depsModulesKey","rehydrated$","rehydratedKey","Boolean","shareReplay","initModuleKey","process","env","NODE_ENV","BehaviorSubject","_this2","initiator","subscribe","container","getRef","isBound","Initiator","got","beforeInitialize","shouldActivate","subscribeModuleKey","onStateChange","_value","_callee","_this$onInit","_this$onInitSuccess","time","_this$initSuccess$","_this$onReset","_this$initSuccess$2","_context","_shouldInit","Date","now","_setStatus","Initializing","onInitOnce","onInit","Ready","moduleInitTimeKey","onInitSuccess","next","_shouldReset","Resetting","onReset","Pending","notReadyModulesKey","get","_this3","depsTokens","getMetadata","constructor","taggedTokens","item","index","token","_cb","depsModules","getAll","Array","push","module","has","_target$userStorageKe","target","rehydrated","getRehydrated","userStorageKey","size","_target$userIdReadyKe","userIdReadyKey","_ignoreModuleReadiness","dep","add","areAllReady","pending","areNotReady","identifier","state","action","getOwnPropertyDescriptor"],"sources":["src/lib/RcModule.ts"],"sourcesContent":["import { loggerV2 } from '@ringcentral-integration/core/lib/logger/loggerV2';\nimport {\n  action,\n  getRef,\n  getRehydrated,\n  state,\n  subscribe,\n} from 'reactant-share';\nimport { BehaviorSubject, filter, map, shareReplay } from 'rxjs';\n\nimport {\n  depsModulesKey,\n  ignoreReadyModulesKey,\n  initializedKey,\n  initModuleKey,\n  moduleInitTimeKey,\n  ModuleStatus,\n  notReadyModulesKey,\n  rehydratedKey,\n  subscribeModuleKey,\n  userIdReadyKey,\n} from '../constant';\nimport { Service } from '../interface';\nimport { Initiator } from '../modules/Initiator';\n\nimport type { RcViewModule } from './RcViewModule';\nimport { userStorageKey } from './decorators';\nimport { fromWatchValue } from './rxjs';\n\nexport interface IRcModule {\n  status: ModuleStatus;\n  pending: boolean;\n  ready: boolean;\n  resetting: boolean;\n  initializing: boolean;\n}\n\nexport class RcModule implements IRcModule {\n  protected logger = loggerV2.create(this);\n\n  status$ = fromWatchValue(this, () => this.status);\n\n  /**\n   * emit when module is ready\n   *\n   * 1. Only emit once when module is ready, if you want handle different status, you can use `status$`\n   *      normally should work with retry(this.resetting$) to re-start the flow when user logout\n   *\n   * 2. if you want to handle base on ready state, you can use `readyState$`\n   */\n  ready$ = this.status$.pipe(filter(() => this.ready));\n\n  readyState$ = this.status$.pipe(map(() => this.ready));\n\n  resetting$ = this.status$.pipe(filter(() => this.resetting));\n\n  protected onInit?(): Promise<void> | void;\n  /**\n   * `onInitOnce` once life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInitOnce?(): Promise<void> | void;\n  /**\n   * `onInitSuccess` life cycle for current initialization after this module is ready.\n   */\n  protected onInitSuccess?(): Promise<void> | void;\n  /**\n   * `onReset` life cycle for current reset before one of deps modules is not ready.\n   */\n  protected onReset?(): Promise<void> | void;\n  /**\n   * @deprecated\n   */\n  protected onStateChange?(): Promise<void> | void;\n\n  private [initializedKey] = false;\n\n  private [ignoreReadyModulesKey] = new Set<RcModule | RcViewModule>();\n\n  /**\n   * after onInitSuccess, initSuccess$ will emit true\n   *\n   * ### Only can use in test environment\n   */\n  initSuccess$?: BehaviorSubject<boolean>;\n\n  constructor() {\n    this[initModuleKey]();\n\n    if (process.env.NODE_ENV === 'test') {\n      this.initSuccess$ = new BehaviorSubject(false);\n    }\n  }\n\n  private [initModuleKey]() {\n    let initiator: Initiator | undefined;\n    subscribe(this, () => {\n      if (!initiator) {\n        const container = getRef(this).container!;\n        if (container.isBound(Initiator)) {\n          initiator = container.got(Initiator);\n          if (!initiator) {\n            throw new Error('Initiator is not created');\n          }\n          initiator.beforeInitialize(this);\n        } else {\n          throw new Error('Initiator is not bound');\n        }\n      }\n      if (initiator.shouldActivate) {\n        this[subscribeModuleKey]();\n        if (typeof this.onStateChange === 'function') {\n          this.onStateChange();\n        }\n      }\n    });\n  }\n\n  private async [subscribeModuleKey]() {\n    if (this._shouldInit()) {\n      let time: number;\n      if (process.env.NODE_ENV !== 'production') {\n        time = Date.now();\n      }\n      this._setStatus(ModuleStatus.Initializing);\n      if (typeof this.onInitOnce === 'function' && !this[initializedKey]) {\n        this[initializedKey] = true;\n        await this.onInitOnce();\n      }\n      await this.onInit?.();\n      this._setStatus(ModuleStatus.Ready);\n      if (process.env.NODE_ENV !== 'production') {\n        (this as any)[moduleInitTimeKey] = Date.now() - time!;\n      }\n      await this.onInitSuccess?.();\n      if (process.env.NODE_ENV === 'test') {\n        this.initSuccess$?.next(true);\n      }\n    } else if (this._shouldReset()) {\n      this._setStatus(ModuleStatus.Resetting);\n      await this.onReset?.();\n      this._setStatus(ModuleStatus.Pending);\n\n      if (process.env.NODE_ENV === 'test') {\n        this.initSuccess$?.next(false);\n      }\n    }\n  }\n\n  private [depsModulesKey]: any[] | null = null;\n\n  // TODO: remove this method, _shouldInit and _shouldReset\n  // just workaround for migration phase\n  private get [notReadyModulesKey]() {\n    if (!this[depsModulesKey]) {\n      const depsTokens: any[] = Reflect.getMetadata(\n        'inversify:paramtypes',\n        this.constructor,\n      );\n      const taggedTokens = Reflect.getMetadata(\n        'inversify:tagged',\n        this.constructor,\n      );\n      this[depsModulesKey] = [];\n\n      const container = getRef(this).container!;\n\n      depsTokens.forEach((item, index) => {\n        const token = taggedTokens?.[index]\n          ? /**\n             * from `inversify` lib Meta interface\n             * get the actual token\n             */\n            taggedTokens[index][0].value._cb()\n          : item;\n        const isBound = container.isBound(token);\n        // TODO: should check here when do lazyLoad, find way to get all again.\n        const depsModules = isBound ? container.getAll(token) : [];\n        Array.prototype.push.apply(this[depsModulesKey], depsModules);\n      });\n    }\n    return this[depsModulesKey].filter(\n      (module: RcModule) =>\n        module?.status &&\n        !module.ready &&\n        !this[ignoreReadyModulesKey].has(module),\n    );\n  }\n\n  private get [rehydratedKey]() {\n    const target: Service = this as any;\n    const rehydrated = getRehydrated(target);\n    if (target[userStorageKey]?.size) {\n      return rehydrated && target[userIdReadyKey]?.();\n    }\n    return rehydrated !== false;\n  }\n\n  rehydrated$ = fromWatchValue(this, () => !!this[rehydratedKey]).pipe(\n    filter(Boolean),\n    // once rehydrated, shareReplay(1) to avoid re execute check again, that only rehydrated once in whole life cycle\n    shareReplay(1),\n  );\n\n  protected _ignoreModuleReadiness(dep: RcModule | RcViewModule) {\n    this[ignoreReadyModulesKey].add(dep);\n  }\n\n  /**\n   * @deprecated\n   */\n  protected _shouldInit() {\n    const areAllReady = this[notReadyModulesKey].length === 0;\n    return areAllReady && this.pending;\n  }\n\n  /**\n   * @deprecated\n   */\n  protected _shouldReset() {\n    const areNotReady = this[notReadyModulesKey].length > 0;\n    return areNotReady && this.ready;\n  }\n\n  @state\n  status: ModuleStatus = ModuleStatus.Pending;\n\n  @action\n  private _setStatus(status: ModuleStatus) {\n    this.status = status;\n  }\n\n  get pending() {\n    return this.status === ModuleStatus.Pending && !!this[rehydratedKey];\n  }\n\n  get ready() {\n    return this.status === ModuleStatus.Ready;\n  }\n\n  get resetting() {\n    return this.status === ModuleStatus.Resetting;\n  }\n\n  get initializing() {\n    return this.status === ModuleStatus.Initializing;\n  }\n\n  get identifier() {\n    const identifier = getRef(this).identifier;\n\n    return identifier!;\n  }\n}\n"],"mappings":"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","ignoreList":[]}