{"version":3,"sources":["modules/MessageSender/index.js"],"names":["MessageSender","deps","alert","client","extensionInfo","extensionPhoneNumber","numberValidate","options","actionTypes","_alert","_client","_extensionPhoneNumber","_extensionInfo","_reducer","_numberValidate","store","subscribe","_onStateChange","_shouldInit","_initModuleStatus","_shouldReset","_resetModuleStatus","ready","dispatch","type","initSuccess","resetSuccess","message","warning","ttl","text","_alertWarning","textEmpty","length","textTooLong","toNumbers","recipientsEmpty","senderNumber","validateResult","validate","isMySenderNumber","senderNumbersList","find","number","phoneNumber","validateError","senderNumberInvalid","errors","forEach","error","recipientNumberInvalids","result","_validateToNumbersIsEmpty","recipientNumbers","filter","item","index","arr","indexOf","validateNumbers","numberValidateResult","_alertInvalidRecipientErrors","numbers","subAddress","isCompanyExtension","e164","notAnExtension","push","fromNumber","replyOnMessageId","_validateText","_validateToNumbers","validateToNumberResult","extensionNumbers","phoneNumbers","_validateSenderNumber","send","responses","_sendPager","pagerResponse","_sendSms","toNumber","smsResponse","sendOver","sendError","_onSendError","console","debug","toUsers","account","extension","sms","post","from","to","response","extensionNumber","map","params","replyOn","companyPager","errResp","apiResponse","ok","_json","errorCode","err","parameterName","startsWith","notSmsToExtension","internationalSMSNotSupported","noInternalSMSPermission","state","status","sendStatus","idle","smsSenderNumbers"],"mappings":"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","file":"index.js","sourcesContent":["import 'core-js/fn/array/find';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport isBlank from '../../lib/isBlank';\nimport moduleStatuses from '../../enums/moduleStatuses';\n\nimport messageSenderActionTypes from './messageSenderActionTypes';\nimport getMessageSenderReducer from './getMessageSenderReducer';\n\nimport messageSenderStatus from './messageSenderStatus';\nimport messageSenderMessages from './messageSenderMessages';\nimport proxify from '../../lib/proxy/proxify';\n\n/**\n * @class\n * @description Message sender and validator module\n */\n@Module({\n  deps: ['Alert', 'Client', 'ExtensionInfo', 'ExtensionPhoneNumber', 'NumberValidate']\n})\nexport default class MessageSender extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Alert} params.alert - alert module instance\n   * @param {Client} params.client - client module instance\n   * @param {ExtensionInfo} params.extensionInfo - extensionInfo module instance\n   * @param {ExtensionPhoneNumber} params.extensionPhoneNumber - extensionPhoneNumber module instance\n   * @param {NumberValidate} params.numberValidate - numberValidate module instance\n   */\n  constructor({\n    alert,\n    client,\n    extensionInfo,\n    extensionPhoneNumber,\n    numberValidate,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: messageSenderActionTypes,\n    });\n\n    this._alert = alert;\n    this._client = client;\n    this._extensionPhoneNumber = extensionPhoneNumber;\n    this._extensionInfo = extensionInfo;\n    this._reducer = getMessageSenderReducer(this.actionTypes);\n    this._numberValidate = numberValidate;\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._initModuleStatus();\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._extensionPhoneNumber.ready &&\n      this._extensionInfo.ready &&\n      !this.ready\n    );\n  }\n\n  _initModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  _shouldReset() {\n    return (\n      (\n        !this._extensionPhoneNumber.ready ||\n        !this._extensionInfo.ready\n      ) &&\n      this.ready\n    );\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  _alertWarning(message) {\n    if (message) {\n      this._alert.warning({\n        message,\n        ttl: 0,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  _validateText(text) {\n    if (isBlank(text)) {\n      this._alertWarning(messageSenderMessages.textEmpty);\n      return false;\n    }\n\n    if (text.length > 1000) {\n      this._alertWarning(messageSenderMessages.textTooLong);\n      return false;\n    }\n\n    return true;\n  }\n\n  _validateToNumbersIsEmpty(toNumbers) {\n    if (toNumbers.length === 0) {\n      this._alertWarning(messageSenderMessages.recipientsEmpty);\n      return true;\n    }\n    return false;\n  }\n\n  _validateSenderNumber(senderNumber) {\n    let validateResult = true;\n    if (isBlank(senderNumber)) {\n      validateResult = false;\n    }\n    this.store.dispatch({ type: this.actionTypes.validate });\n    if (validateResult) {\n      const isMySenderNumber = this.senderNumbersList.find(number => (\n        number.phoneNumber === senderNumber\n      ));\n      if (!isMySenderNumber) {\n        validateResult = false;\n      }\n    }\n    if (!validateResult) {\n      this.store.dispatch({ type: this.actionTypes.validateError });\n      this._alertWarning(messageSenderMessages.senderNumberInvalid);\n    }\n    return validateResult;\n  }\n\n  _alertInvalidRecipientErrors(errors) {\n    errors.forEach((error) => {\n      const message = messageSenderMessages[error.type];\n      if (!this._alertWarning(message)) {\n        this._alertWarning(messageSenderMessages.recipientNumberInvalids);\n      }\n    });\n  }\n\n  @proxify\n  async _validateToNumbers(toNumbers) {\n    const result = {\n      result: false,\n    };\n    if (this._validateToNumbersIsEmpty(toNumbers)) {\n      return result;\n    }\n    const recipientNumbers\n      = toNumbers.filter((item, index, arr) => arr.indexOf(item) === index);\n    this.store.dispatch({ type: this.actionTypes.validate });\n    const numberValidateResult = await this._numberValidate.validateNumbers(recipientNumbers);\n    if (!numberValidateResult.result) {\n      this._alertInvalidRecipientErrors(numberValidateResult.errors);\n      this.store.dispatch({ type: this.actionTypes.validateError });\n      return result;\n    }\n    const numbers = [];\n    for (const number of numberValidateResult.numbers) {\n      if (number.subAddress && number.subAddress.length > 0) {\n        if (\n          !this._numberValidate.isCompanyExtension(number.e164, number.subAddress)\n        ) {\n          this._alertWarning(messageSenderMessages.notAnExtension);\n          this.store.dispatch({ type: this.actionTypes.validateError });\n          return result;\n        }\n        numbers.push(number.subAddress);\n      } else {\n        numbers.push(number.e164);\n      }\n    }\n    result.result = true;\n    result.numbers = numbers;\n    return result;\n  }\n\n  @proxify\n  async send({\n    fromNumber, toNumbers, text, replyOnMessageId\n  }) {\n    if (!this._validateText(text)) {\n      return null;\n    }\n    try {\n      const validateToNumberResult = await this._validateToNumbers(toNumbers);\n      if (!validateToNumberResult.result) {\n        return null;\n      }\n      const recipientNumbers = validateToNumberResult.numbers;\n\n      const extensionNumbers = recipientNumbers.filter(number => (number.length <= 6));\n      const phoneNumbers = recipientNumbers.filter(number => (number.length > 6));\n\n      // not validate sender number if recipient is only extension number\n      if (phoneNumbers.length > 0) {\n        if (!this._validateSenderNumber(fromNumber)) {\n          return null;\n        }\n      }\n\n      this.store.dispatch({\n        type: this.actionTypes.send,\n      });\n      const responses = [];\n      if (extensionNumbers.length > 0) {\n        const pagerResponse = await this._sendPager({\n          toNumbers: extensionNumbers,\n          text,\n          replyOnMessageId,\n        });\n        responses.push(pagerResponse);\n      }\n\n      if (phoneNumbers.length > 0) {\n        for (const phoneNumber of phoneNumbers) {\n          const smsResponse = await this._sendSms({ fromNumber, toNumber: phoneNumber, text });\n          responses.push(smsResponse);\n        }\n      }\n      this.store.dispatch({\n        type: this.actionTypes.sendOver,\n      });\n      return responses;\n    } catch (error) {\n      this.store.dispatch({\n        type: this.actionTypes.sendError,\n        error: 'error'\n      });\n      this._onSendError(error);\n      console.debug('sendComposeText e ', error);\n      throw error;\n    }\n  }\n  @proxify\n  async _sendSms({ fromNumber, toNumber, text }) {\n    const toUsers = [{ phoneNumber: toNumber }];\n    const response = await this._client.account().extension().sms().post({\n      from: { phoneNumber: fromNumber },\n      to: toUsers,\n      text,\n    });\n    return response;\n  }\n  @proxify\n  async _sendPager({ toNumbers, text, replyOnMessageId }) {\n    const from = { extensionNumber: this._extensionInfo.extensionNumber };\n    const toUsers = toNumbers.map(number => ({ extensionNumber: number }));\n    const params = { from, to: toUsers, text };\n    if (replyOnMessageId) {\n      params.replyOn = replyOnMessageId;\n    }\n    const response = await this._client.account().extension().companyPager().post(params);\n    return response;\n  }\n\n  _onSendError(error) {\n    const errResp = error.apiResponse;\n    if (\n      errResp && errResp.response &&\n      !errResp.response.ok\n      && (errResp._json.errorCode === 'InvalidParameter'\n      || errResp._json.errorCode === 'InternationalProhibited'\n      || errResp._json.errorCode === 'CMN-408')\n    ) {\n      errResp._json.errors.map((err) => {\n        if (\n          (\n            err.errorCode === 'CMN-101' ||\n            err.errorCode === 'CMN-102' ||\n            err.errorCode === 'CMN-414'\n          ) &&\n          err.parameterName.startsWith('to')\n        ) {\n          // 101 : \"Parameter [to.extensionNumber] value is invalid\"\n          // 101 : \"Parameter [to.phoneNumber] value is invalid\"\n          // 102 : \"Resource for parameter [to] is not found\"\n          this._alertWarning(messageSenderMessages.recipientNumberInvalids);\n          return null;\n        }\n        if (err.errorCode === 'MSG-246') {\n          // MSG-246 : \"Sending SMS from/to extension numbers is not available\"\n          this._alertWarning(messageSenderMessages.notSmsToExtension);\n        }\n        if (err.errorCode === 'MSG-240') {\n          // MSG-240 : \"International SMS is not supported\"\n          this._alertWarning(messageSenderMessages.internationalSMSNotSupported);\n        }\n        if (err.errorCode === 'CMN-408') {\n          // MSG-240 : \"In order to call this API endpoint, user needs to have [InternalSMS] permission for requested resource.\"\n          this._alertWarning(messageSenderMessages.noInternalSMSPermission);\n        }\n        return null;\n      });\n      return;\n    }\n    this._alertWarning(messageSenderMessages.sendError);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get sendStatus() {\n    return this.state.sendStatus;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get idle() {\n    return this.sendStatus === messageSenderStatus.idle;\n  }\n\n  get senderNumbersList() {\n    return this._extensionPhoneNumber.smsSenderNumbers;\n  }\n}\n"]}