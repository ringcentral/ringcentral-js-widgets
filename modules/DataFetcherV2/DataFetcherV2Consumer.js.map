{"version":3,"file":"DataFetcherV2Consumer.js","names":["_core","require","_ObjectMap","_events","_sourceStatus","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","_arrayLikeToArray","toString","call","slice","constructor","name","Array","from","test","length","l","Symbol","iterator","f","next","Object","push","isArray","_classCallCheck","_defineProperties","enumerable","configurable","writable","defineProperty","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","toPrimitive","String","Number","_get","Reflect","get","bind","p","_superPropBase","getOwnPropertyDescriptor","hasOwnProperty","_getPrototypeOf","_inherits","create","_setPrototypeOf","setPrototypeOf","__proto__","_createSuper","_isNativeReflectConstruct","s","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","baseEvents","ObjectMap","fromKeys","exports","DataFetcherV2Consumer","_RcModuleV","_super","_this","_len","args","_key","concat","_source","_emitter","EventEmitter","onInitOnce","_this2","watch","ready","data","_ref","_ref2","emit","events","dataReady","multiple","on","_this$_emitter","off","_this$_emitter2","_shouldInit","_deps","dataFetcherV2","getSourceStatus","sourceStatus","_shouldReset","_fetchData","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","abrupt","fetchData","stop","getData","RcModuleV2"],"sources":["modules/DataFetcherV2/DataFetcherV2Consumer.ts"],"sourcesContent":["import { RcModuleV2, watch } from '@ringcentral-integration/core';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\nimport { EventEmitter } from 'events';\n\nimport type { DataFetcherV2ConsumerBaseDeps } from './DataFetcherV2Consumer.interface';\nimport type { DataSource } from './DataSource';\nimport { sourceStatus } from './sourceStatus';\n\nexport const baseEvents = ObjectMap.fromKeys(['dataReady']);\n\nexport abstract class DataFetcherV2Consumer<\n  D extends DataFetcherV2ConsumerBaseDeps,\n  T,\n> extends RcModuleV2<D> {\n  // @ts-expect-error TS(2564): Property '_source' has no initializer and is not d... Remove this comment to see the full error message\n  protected _source: DataSource<T>;\n  protected _emitter = new EventEmitter();\n\n  get data() {\n    return this._deps.dataFetcherV2.getData(this._source);\n  }\n\n  get events() {\n    return baseEvents;\n  }\n\n  override onInitOnce() {\n    watch(\n      this,\n      () => [this.ready, this.data],\n      ([ready, data]) => {\n        if (ready && data) {\n          this._emitter.emit(this.events.dataReady);\n        }\n      },\n      {\n        multiple: true,\n      },\n    );\n  }\n\n  on(...args: Parameters<EventEmitter['on']>) {\n    return this._emitter.on(...args);\n  }\n\n  off(...args: Parameters<EventEmitter['off']>) {\n    return this._emitter.off(...args);\n  }\n\n  override _shouldInit() {\n    return !!(\n      super._shouldInit() &&\n      this._deps.dataFetcherV2.getSourceStatus(this._source) ===\n        sourceStatus.ready\n    );\n  }\n\n  override _shouldReset() {\n    return !!(\n      super._shouldReset() ||\n      (this.ready &&\n        this._deps.dataFetcherV2.getSourceStatus(this._source) !==\n          sourceStatus.ready)\n    );\n  }\n\n  async fetchData() {\n    if (this.ready) {\n      return this._deps.dataFetcherV2.fetchData(this._source);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}