{"version":3,"file":"DataFetcherV2Consumer.js","names":["_events","require","_core","_ObjectMap","_sourceStatus","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","push","isArray","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","_toPropertyKey","_createClass","protoProps","staticProps","_toPrimitive","_typeof","String","input","hint","prim","toPrimitive","res","Number","_get","Reflect","get","bind","property","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","baseEvents","ObjectMap","fromKeys","exports","DataFetcherV2Consumer","_RcModuleV","_super","_this","_len","_key","concat","_source","_emitter","EventEmitter","onInitOnce","_this2","watch","ready","data","_ref","_ref2","emit","events","dataReady","multiple","on","_this$_emitter","off","_this$_emitter2","_shouldInit","_deps","dataFetcherV2","getSourceStatus","sourceStatus","_shouldReset","_fetchData","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","abrupt","fetchData","stop","getData","RcModuleV2"],"sources":["modules/DataFetcherV2/DataFetcherV2Consumer.ts"],"sourcesContent":["import { EventEmitter } from 'events';\n\nimport { RcModuleV2, watch } from '@ringcentral-integration/core';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\n\nimport type { DataFetcherV2ConsumerBaseDeps } from './DataFetcherV2Consumer.interface';\nimport type { DataSource } from './DataSource';\nimport { sourceStatus } from './sourceStatus';\n\nexport const baseEvents = ObjectMap.fromKeys(['dataReady']);\n\nexport abstract class DataFetcherV2Consumer<\n  D extends DataFetcherV2ConsumerBaseDeps,\n  T,\n> extends RcModuleV2<D> {\n  // @ts-expect-error\n  protected _source: DataSource<T>;\n  protected _emitter = new EventEmitter();\n\n  get data() {\n    return this._deps.dataFetcherV2.getData(this._source);\n  }\n\n  get events() {\n    return baseEvents;\n  }\n\n  override onInitOnce() {\n    watch(\n      this,\n      () => [this.ready, this.data],\n      ([ready, data]) => {\n        if (ready && data) {\n          this._emitter.emit(this.events.dataReady);\n        }\n      },\n      {\n        multiple: true,\n      },\n    );\n  }\n\n  on(...args: Parameters<EventEmitter['on']>) {\n    return this._emitter.on(...args);\n  }\n\n  off(...args: Parameters<EventEmitter['off']>) {\n    return this._emitter.off(...args);\n  }\n\n  override _shouldInit() {\n    return !!(\n      super._shouldInit() &&\n      this._deps.dataFetcherV2.getSourceStatus(this._source) ===\n        sourceStatus.ready\n    );\n  }\n\n  override _shouldReset() {\n    return !!(\n      super._shouldReset() ||\n      (this.ready &&\n        this._deps.dataFetcherV2.getSourceStatus(this._source) !==\n          sourceStatus.ready)\n    );\n  }\n\n  async fetchData() {\n    if (this.ready) {\n      return this._deps.dataFetcherV2.fetchData(this._source);\n    }\n  }\n}\n"],"mappings":"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"}