{"version":3,"file":"EvCallDisposition.js","names":["_di","require","_core","_dec","_class","_class2","_descriptor","_descriptor2","_initializerDefineProperty","e","i","r","l","Object","defineProperty","enumerable","configurable","writable","value","initializer","call","_classCallCheck","a","n","TypeError","_defineProperties","t","length","o","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","arguments","apply","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","EvCallDisposition","Module","name","deps","dep","optional","_RcModuleV","_super","_this","enableCache","storageKey","setDisposition","id","data","callsMapping","removeDisposition","setDispositionState","disposed","dispositionStateMapping","onInitOnce","_this2","_deps","evCallMonitor","onCallAnswered","outdialDispositions","disposition","dispositions","find","_ref","isDefault","getCallId","session","dispositionId","notes","disposeCall","evCallHistory","callDisposition","isDisposed","evClient","dispositionCall","uii","dispId","RcModuleV2","storage","state","action","getOwnPropertyDescriptor","exports"],"sources":["modules/EvCallDisposition/EvCallDisposition.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\n\nimport type {\n  CallDisposition,\n  Deps,\n  EvCallDispositionMapping,\n  EvDispositionStateMapping,\n} from './EvCallDisposition.interface';\n\n@Module({\n  name: 'EvCallDisposition',\n  deps: [\n    'Storage',\n    'EvCallMonitor',\n    'EvCallHistory',\n    'EvClient',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ActivityMatcher', optional: true },\n    { dep: 'EvCallDispositionOptions', optional: true },\n  ],\n})\nclass EvCallDisposition extends RcModuleV2<Deps> implements CallDisposition {\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvCallDisposition',\n    });\n  }\n\n  @storage\n  @state\n  callsMapping: EvCallDispositionMapping = {};\n\n  @storage\n  @state\n  dispositionStateMapping: EvDispositionStateMapping = {};\n\n  @action\n  setDisposition(id: string, data: EvCallDispositionMapping[string]) {\n    this.callsMapping[id] = data;\n  }\n\n  @action\n  removeDisposition(id: string) {\n    delete this.callsMapping[id];\n  }\n\n  @action\n  setDispositionState(id: string, disposed: EvDispositionStateMapping[string]) {\n    this.dispositionStateMapping[id] = disposed;\n  }\n\n  override onInitOnce() {\n    this._deps.evCallMonitor.onCallAnswered((call) => {\n      if (call.outdialDispositions) {\n        const disposition = call.outdialDispositions.dispositions.find(\n          ({ isDefault }) => isDefault,\n        );\n        const id = this._deps.evCallMonitor.getCallId(call.session);\n        this.setDisposition(id, {\n          dispositionId: disposition ? disposition.dispositionId : null,\n          notes: '',\n        });\n      }\n    });\n  }\n\n  disposeCall(id: string) {\n    const call = this._deps.evCallHistory.callsMapping[id];\n    const callDisposition = this.callsMapping[id];\n    const isDisposed =\n      this.dispositionStateMapping[id] &&\n      this.dispositionStateMapping[id].disposed;\n    if (!call.outdialDispositions || isDisposed) return;\n\n    this._deps.evClient.dispositionCall({\n      uii: call.uii,\n      dispId: callDisposition.dispositionId,\n      notes: callDisposition.notes,\n    });\n\n    this.setDispositionState(id, { disposed: true });\n  }\n}\n\nexport { EvCallDisposition };\n"],"mappings":"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","ignoreList":[]}