{"version":3,"file":"EvCallDisposition.js","names":["_di","require","_core","_dec","_class","_class2","_descriptor","_descriptor2","_initializerDefineProperty","e","i","r","l","Object","defineProperty","enumerable","configurable","writable","value","initializer","call","_classCallCheck","a","n","TypeError","_defineProperties","t","length","o","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","_setPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","EvCallDisposition","exports","Module","name","deps","dep","optional","_RcModuleV","_this","enableCache","storageKey","setDisposition","id","data","callsMapping","removeDisposition","setDispositionState","disposed","dispositionStateMapping","onInitOnce","_this2","_deps","evCallMonitor","onCallAnswered","outdialDispositions","disposition","dispositions","find","_ref","isDefault","getCallId","session","dispositionId","notes","disposeCall","evCallHistory","callDisposition","isDisposed","evClient","dispositionCall","uii","dispId","RcModuleV2","storage","state","action","getOwnPropertyDescriptor"],"sources":["modules/EvCallDisposition/EvCallDisposition.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\n\nimport type {\n  CallDisposition,\n  Deps,\n  EvCallDispositionMapping,\n  EvDispositionStateMapping,\n} from './EvCallDisposition.interface';\n\n@Module({\n  name: 'EvCallDisposition',\n  deps: [\n    'Storage',\n    'EvCallMonitor',\n    'EvCallHistory',\n    'EvClient',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ActivityMatcher', optional: true },\n    { dep: 'EvCallDispositionOptions', optional: true },\n  ],\n})\nclass EvCallDisposition extends RcModuleV2<Deps> implements CallDisposition {\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvCallDisposition',\n    });\n  }\n\n  @storage\n  @state\n  callsMapping: EvCallDispositionMapping = {};\n\n  @storage\n  @state\n  dispositionStateMapping: EvDispositionStateMapping = {};\n\n  @action\n  setDisposition(id: string, data: EvCallDispositionMapping[string]) {\n    this.callsMapping[id] = data;\n  }\n\n  @action\n  removeDisposition(id: string) {\n    delete this.callsMapping[id];\n  }\n\n  @action\n  setDispositionState(id: string, disposed: EvDispositionStateMapping[string]) {\n    this.dispositionStateMapping[id] = disposed;\n  }\n\n  override onInitOnce() {\n    this._deps.evCallMonitor.onCallAnswered((call) => {\n      if (call.outdialDispositions) {\n        const disposition = call.outdialDispositions.dispositions.find(\n          ({ isDefault }) => isDefault,\n        );\n        const id = this._deps.evCallMonitor.getCallId(call.session);\n        this.setDisposition(id, {\n          dispositionId: disposition ? disposition.dispositionId : null,\n          notes: '',\n        });\n      }\n    });\n  }\n\n  disposeCall(id: string) {\n    const call = this._deps.evCallHistory.callsMapping[id];\n    const callDisposition = this.callsMapping[id];\n    const isDisposed =\n      this.dispositionStateMapping[id] &&\n      this.dispositionStateMapping[id].disposed;\n    if (!call.outdialDispositions || isDisposed) return;\n\n    this._deps.evClient.dispositionCall({\n      uii: call.uii,\n      dispId: callDisposition.dispositionId,\n      notes: callDisposition.notes,\n    });\n\n    this.setDispositionState(id, { disposed: true });\n  }\n}\n\nexport { EvCallDisposition };\n"],"mappings":"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","ignoreList":[]}