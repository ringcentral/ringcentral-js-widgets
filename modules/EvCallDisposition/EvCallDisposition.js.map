{"version":3,"file":"EvCallDisposition.js","names":["_di","require","_core","_dec","_class","_class2","_descriptor","_descriptor2","_initializerDefineProperty","target","property","descriptor","context","Object","defineProperty","enumerable","configurable","writable","value","initializer","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","i","length","_toPropertyKey","key","_createClass","protoProps","staticProps","prototype","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","decorators","desc","keys","forEach","slice","reverse","reduce","decorator","_initializerWarningHelper","Error","EvCallDisposition","Module","name","deps","dep","optional","_RcModuleV","_super","_this","enableCache","storageKey","setDisposition","id","data","callsMapping","removeDisposition","setDispositionState","disposed","dispositionStateMapping","onInitOnce","_this2","_deps","evCallMonitor","onCallAnswered","outdialDispositions","disposition","dispositions","find","_ref","isDefault","getCallId","session","dispositionId","notes","disposeCall","evCallHistory","callDisposition","isDisposed","evClient","dispositionCall","uii","dispId","RcModuleV2","storage","state","action","getOwnPropertyDescriptor","exports"],"sources":["modules/EvCallDisposition/EvCallDisposition.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\n\nimport type {\n  CallDisposition,\n  Deps,\n  EvCallDispositionMapping,\n  EvDispositionStateMapping,\n} from './EvCallDisposition.interface';\n\n@Module({\n  name: 'EvCallDisposition',\n  deps: [\n    'Storage',\n    'EvCallMonitor',\n    'EvCallHistory',\n    'EvClient',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ActivityMatcher', optional: true },\n    { dep: 'EvCallDispositionOptions', optional: true },\n  ],\n})\nclass EvCallDisposition extends RcModuleV2<Deps> implements CallDisposition {\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvCallDisposition',\n    });\n  }\n\n  @storage\n  @state\n  callsMapping: EvCallDispositionMapping = {};\n\n  @storage\n  @state\n  dispositionStateMapping: EvDispositionStateMapping = {};\n\n  @action\n  setDisposition(id: string, data: EvCallDispositionMapping[string]) {\n    this.callsMapping[id] = data;\n  }\n\n  @action\n  removeDisposition(id: string) {\n    delete this.callsMapping[id];\n  }\n\n  @action\n  setDispositionState(id: string, disposed: EvDispositionStateMapping[string]) {\n    this.dispositionStateMapping[id] = disposed;\n  }\n\n  override onInitOnce() {\n    this._deps.evCallMonitor.onCallAnswered((call) => {\n      if (call.outdialDispositions) {\n        const disposition = call.outdialDispositions.dispositions.find(\n          ({ isDefault }) => isDefault,\n        );\n        const id = this._deps.evCallMonitor.getCallId(call.session);\n        this.setDisposition(id, {\n          dispositionId: disposition ? disposition.dispositionId : null,\n          notes: '',\n        });\n      }\n    });\n  }\n\n  disposeCall(id: string) {\n    const call = this._deps.evCallHistory.callsMapping[id];\n    const callDisposition = this.callsMapping[id];\n    const isDisposed =\n      this.dispositionStateMapping[id] &&\n      this.dispositionStateMapping[id].disposed;\n    if (!call.outdialDispositions || isDisposed) return;\n\n    this._deps.evClient.dispositionCall({\n      uii: call.uii,\n      dispId: callDisposition.dispositionId,\n      notes: callDisposition.notes,\n    });\n\n    this.setDispositionState(id, { disposed: true });\n  }\n}\n\nexport { EvCallDisposition };\n"],"mappings":"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"}