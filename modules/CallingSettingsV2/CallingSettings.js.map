{"version":3,"sources":["modules/CallingSettingsV2/CallingSettings.ts"],"names":["LOCATION_NUMBER_ORDER","BLOCKED_ID_VALUE","CallingSettings","name","deps","dep","optional","that","_deps","extensionPhoneNumber","directNumbers","mainCompanyNumber","extensionInfo","extensionNumber","forwardingNumber","flipNumbers","callerIdNumbers","appFeatures","isRingOutEnabled","isWebPhoneEnabled","otherPhoneNumbers","length","numbers","myPhoneNumbers","availableNumbers","enableCache","storageKey","_myPhoneNumbers","_onFirstLogin","_ringoutEnabled","_otherPhoneNumbers","_webphoneEnabled","initRingoutPrompt","_blockedIdDisabled","_showCallWithJupiter","_emergencyCallAvailable","_availableNumbers","callingSettingsOptions","onFirstLogin","defaultRingoutPrompt","showCallWithJupiter","emergencyCallAvailable","storage","migrationMapping","callWith","ringoutPrompt","myLocation","timestamp","isCustomLocation","data","number","fromNumber","phoneNumber","_updateFromNumber","value","acknowledgeJPMessage","setAcknowledgeJPMessage","_shouldReset","_shouldInit","_shouldValidate","isBlockedIdDisabled","_validateSettings","isWebphoneMode","_verifyJPEmergency","ready","_init","resetSuccess","defaultCallWith","callWithOptions","setDataAction","Date","now","_warningEmergencyCallingNotAvailable","isCallingEnabled","_handleFirstTimeLogin","deprecatedCallingOptions","myphone","otherphone","customphone","callingOptions","ringout","_initFromNumber","browser","alert","info","message","callingSettingsMessages","emergencyCallingNotAvailable","ttl","_hasWebphonePermissionRemoved","isSoftphoneEnabled","_setSoftPhoneToCallWith","danger","webphonePermissionRemoved","_hasPermissionChanged","permissionChanged","_hasPhoneNumberChanged","phoneNumberChanged","hasJapanNumber","fromNumbers","find","record","country","id","warning","disableEmergencyInJapan","softphone","webphone","indexOf","devices","extensionDevice","mainPhoneNumber","registeredWithDevice","forEach","device","phoneLines","phoneLine","phoneInfo","isFlipNumber","flipNumber","label","defaultCallerId","callerId","ringOut","type","defaultPhoneNumber","defaultEntry","item","updateFromNumber","withPrompt","saveSuccessWithSoftphone","jupiter","saveSuccessWithJupiter","saveSuccess","map","push","filterMapping","filter","sort","a","b","hasExtensionPhoneNumber","brand","isRingCentralAppEnabled","sortedPhoneNumbers","firstItem","lastItem","usageType","concat","result","locationLabel","_getLocationLabel","callingMode","callingModes","driver","jupiterAppName","extensionFeatures","features","BlockingCallerId","available","RcModuleV2","state","action","proxify"],"mappings":"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","sourcesContent":["import {\n  action,\n  computed,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\n\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\nimport { callingModes } from './callingModes';\nimport { callingOptions, CallingOptionsType } from './callingOptions';\nimport { Deps } from './CallingSettings.interface';\nimport { callingSettingsMessages } from './callingSettingsMessages';\nimport { deprecatedCallingOptions } from './deprecatedCallingOptions';\nimport { mapOptionToMode } from './mapOptionToMode';\n\nconst LOCATION_NUMBER_ORDER = ['Other', 'Main'];\nexport const BLOCKED_ID_VALUE = 'anonymous';\n/**\n * @class\n * @description Call setting managing module\n */\n@Module({\n  name: 'CallingSettings',\n  deps: [\n    'Alert',\n    'Brand',\n    'Storage',\n    'ExtensionInfo',\n    'ExtensionDevice',\n    'ForwardingNumber',\n    'AppFeatures',\n    'ExtensionFeatures',\n    'ExtensionPhoneNumber',\n    { dep: 'CallerId', optional: true },\n    { dep: 'Webphone', optional: true },\n    { dep: 'Softphone', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'CallingSettingsOptions', optional: true },\n  ],\n})\nclass CallingSettings extends RcModuleV2<Deps> {\n  _myPhoneNumbers: string[];\n  _onFirstLogin?: () => {};\n  _ringoutEnabled: boolean;\n  _otherPhoneNumbers: string[];\n  _webphoneEnabled: boolean;\n  initRingoutPrompt?: boolean;\n  _blockedIdDisabled: boolean;\n  _showCallWithJupiter?: boolean;\n  _emergencyCallAvailable?: boolean;\n  _availableNumbers: string[];\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'CallingSettings',\n    });\n    this._onFirstLogin = this._deps.callingSettingsOptions?.onFirstLogin;\n    this.initRingoutPrompt =\n      this._deps.callingSettingsOptions?.defaultRingoutPrompt;\n    this._showCallWithJupiter =\n      this._deps.callingSettingsOptions?.showCallWithJupiter ?? true;\n    this._emergencyCallAvailable =\n      this._deps.callingSettingsOptions?.emergencyCallAvailable ?? false;\n    /* migration storage v1 to v2 */\n    if (this._deps.storage) {\n      this._deps.storage.migrationMapping =\n        this._deps.storage.migrationMapping ?? {};\n      this._deps.storage.migrationMapping['CallingSettings-data'] =\n        'callingSettingsData';\n    }\n    /* migration storage v1 to v2 */\n  }\n\n  get callWith() {\n    return this.data.callWith;\n  }\n\n  get ringoutPrompt() {\n    return this.data.ringoutPrompt;\n  }\n\n  get myLocation() {\n    return this.data.myLocation;\n  }\n\n  get fromNumber() {\n    return this.data.fromNumber;\n  }\n\n  get timestamp() {\n    return this.data.timestamp;\n  }\n\n  get isCustomLocation() {\n    return this.data.isCustomLocation;\n  }\n\n  // For Japan Emergency Service notification\n  @storage\n  @state\n  acknowledgeJPMessage = false;\n\n  @storage\n  @state\n  data: {\n    callWith: string;\n    ringoutPrompt: boolean;\n    myLocation: string;\n    fromNumber: string;\n    timestamp: number;\n    isCustomLocation: boolean;\n  } = {\n    callWith: null,\n    ringoutPrompt: true,\n    myLocation: '',\n    fromNumber: null,\n    timestamp: null,\n    isCustomLocation: false,\n  };\n\n  @action\n  setDataAction({\n    callWith = this.callWith,\n    ringoutPrompt = this.ringoutPrompt,\n    myLocation = this.myLocation,\n    timestamp = this.timestamp,\n    isCustomLocation = this.isCustomLocation,\n  }: {\n    callWith?: CallingOptionsType;\n    ringoutPrompt?: boolean;\n    myLocation?: string;\n    timestamp?: number;\n    isCustomLocation?: boolean;\n  }) {\n    this.data.callWith = callWith;\n    this.data.ringoutPrompt = ringoutPrompt;\n    this.data.myLocation = myLocation;\n    this.data.timestamp = timestamp;\n    this.data.isCustomLocation = isCustomLocation;\n  }\n\n  @action\n  _updateFromNumber(number: { phoneNumber?: string }) {\n    this.data.fromNumber = number && number?.phoneNumber;\n  }\n\n  @proxify\n  async updateFromNumber(number: { phoneNumber?: string }) {\n    this._updateFromNumber(number);\n  }\n\n  @action\n  setAcknowledgeJPMessage(value: boolean) {\n    this.acknowledgeJPMessage = value;\n  }\n\n  @action\n  resetSuccess() {\n    this.data.fromNumber = null;\n    this.setAcknowledgeJPMessage(false);\n  }\n\n  async onStateChange() {\n    if (!this._shouldReset() && !this._shouldInit() && this._shouldValidate()) {\n      this._ringoutEnabled = this._deps.appFeatures.isRingOutEnabled;\n      this._webphoneEnabled = this._deps.appFeatures.isWebPhoneEnabled;\n      this._myPhoneNumbers = this.myPhoneNumbers;\n      this._otherPhoneNumbers = this.otherPhoneNumbers;\n      this._blockedIdDisabled = this.isBlockedIdDisabled;\n      await this._validateSettings();\n    }\n  }\n\n  async onInitSuccess() {\n    if (this.isWebphoneMode) {\n      this._verifyJPEmergency();\n    }\n  }\n\n  _shouldValidate() {\n    return (\n      this.ready &&\n      (this._ringoutEnabled !== this._deps.appFeatures.isRingOutEnabled ||\n        this._webphoneEnabled !== this._deps.appFeatures.isWebPhoneEnabled ||\n        this._myPhoneNumbers !== this.myPhoneNumbers ||\n        this._otherPhoneNumbers !== this.otherPhoneNumbers ||\n        this._blockedIdDisabled !== this.isBlockedIdDisabled)\n    );\n  }\n\n  async onInit() {\n    await this._init();\n  }\n\n  onReset() {\n    this.resetSuccess();\n  }\n\n  _handleFirstTimeLogin() {\n    if (!this.timestamp) {\n      // first time login\n      const defaultCallWith = this.callWithOptions && this.callWithOptions[0];\n      this.setDataAction({ callWith: defaultCallWith, timestamp: Date.now() });\n      if (!this._emergencyCallAvailable) {\n        this._warningEmergencyCallingNotAvailable();\n      }\n      if (typeof this._onFirstLogin === 'function') {\n        this._onFirstLogin();\n      }\n    }\n  }\n\n  async _init() {\n    if (!this._deps.appFeatures.isCallingEnabled) return;\n\n    this._myPhoneNumbers = this.myPhoneNumbers;\n    this._otherPhoneNumbers = this.otherPhoneNumbers;\n    this._availableNumbers = this.availableNumbers;\n    this._ringoutEnabled = this._deps.appFeatures.isRingOutEnabled;\n    this._webphoneEnabled = this._deps.appFeatures.isWebPhoneEnabled;\n    this._blockedIdDisabled = this.isBlockedIdDisabled;\n\n    this._handleFirstTimeLogin();\n\n    if (\n      this.callWith === deprecatedCallingOptions.myphone ||\n      this.callWith === deprecatedCallingOptions.otherphone ||\n      this.callWith === deprecatedCallingOptions.customphone\n    ) {\n      this.setDataAction({\n        callWith: callingOptions.ringout,\n        isCustomLocation:\n          this.callWith === deprecatedCallingOptions.customphone,\n      });\n    }\n    await this._validateSettings();\n    await this._initFromNumber();\n  }\n\n  @proxify\n  async _warningEmergencyCallingNotAvailable() {\n    if (this.callWith === callingOptions.browser) {\n      this._deps.alert.info({\n        message: callingSettingsMessages.emergencyCallingNotAvailable,\n        ttl: 0,\n      });\n    }\n  }\n\n  @proxify\n  async _validateSettings() {\n    if (this._hasWebphonePermissionRemoved()) {\n      if (this._deps.appFeatures.isSoftphoneEnabled) {\n        await this._setSoftPhoneToCallWith();\n      }\n      this._deps.alert.danger({\n        message: callingSettingsMessages.webphonePermissionRemoved,\n        ttl: 0,\n      });\n    } else if (this._hasPermissionChanged()) {\n      if (this._deps.appFeatures.isSoftphoneEnabled) {\n        await this._setSoftPhoneToCallWith();\n      }\n      this._deps.alert.danger({\n        message: callingSettingsMessages.permissionChanged,\n        ttl: 0,\n      });\n    } else if (this._hasPhoneNumberChanged()) {\n      this.setDataAction({\n        callWith: callingOptions.ringout,\n        myLocation: this._myPhoneNumbers[0],\n        timestamp: Date.now(),\n      });\n      this._deps.alert.danger({\n        message: callingSettingsMessages.phoneNumberChanged,\n        ttl: 0,\n      });\n    }\n\n    if (this.isBlockedIdDisabled && this.fromNumber === BLOCKED_ID_VALUE) {\n      this._initFromNumber();\n    }\n  }\n\n  @proxify\n  async _verifyJPEmergency() {\n    if (this.acknowledgeJPMessage) return;\n\n    const hasJapanNumber = !!this.fromNumbers.find(\n      (record) => record?.country?.id === '112',\n    );\n    if (hasJapanNumber) {\n      this._deps.alert.warning({\n        message: callingSettingsMessages.disableEmergencyInJapan,\n        ttl: 0,\n      });\n      this.setAcknowledgeJPMessage(true);\n    }\n  }\n\n  @proxify\n  async _setSoftPhoneToCallWith() {\n    this.setDataAction({\n      callWith: callingOptions.softphone,\n      timestamp: Date.now(),\n    });\n  }\n\n  _hasWebphonePermissionRemoved() {\n    return (\n      !(this._webphoneEnabled && this._deps.webphone) &&\n      this.callWith === callingOptions.browser\n    );\n  }\n\n  _hasPermissionChanged() {\n    return !this._ringoutEnabled && this.callWith === callingOptions.ringout;\n  }\n\n  _hasPhoneNumberChanged() {\n    return (\n      this.callWith === callingOptions.ringout &&\n      !this.isCustomLocation &&\n      this._availableNumbers.indexOf(this.myLocation) === -1\n    );\n  }\n\n  _getLocationLabel(phoneNumber: string) {\n    const { devices } = this._deps.extensionDevice;\n    const { flipNumbers } = this._deps.forwardingNumber;\n    const { mainCompanyNumber } = this._deps.extensionPhoneNumber;\n    const { extensionNumber } = this._deps.extensionInfo;\n    const mainPhoneNumber = `${mainCompanyNumber.phoneNumber}*${extensionNumber}`;\n    let name = null;\n    if (devices.length) {\n      let registeredWithDevice = false;\n      devices.forEach((device) => {\n        const { phoneLines } = device;\n        if (phoneLines.length) {\n          registeredWithDevice = !!phoneLines.find((phoneLine) => {\n            return phoneLine.phoneInfo.phoneNumber === phoneNumber;\n          });\n          if (registeredWithDevice) {\n            name = device.name;\n          }\n        }\n      });\n      if (name) return name;\n    }\n    if (flipNumbers.length) {\n      const isFlipNumber = flipNumbers.find(\n        (flipNumber) => flipNumber.phoneNumber === phoneNumber,\n      );\n      if (isFlipNumber) {\n        return isFlipNumber.label || 'Other';\n      }\n    }\n\n    if (phoneNumber === mainPhoneNumber) {\n      return 'Main';\n    }\n    return 'Other';\n  }\n\n  @proxify\n  async _initFromNumber() {\n    const fromNumber = this.fromNumber;\n    if (\n      !fromNumber ||\n      (fromNumber === BLOCKED_ID_VALUE && this.isBlockedIdDisabled)\n    ) {\n      let defaultCallerId = this.fromNumbers[0];\n      if (this._deps.callerId?.ringOut) {\n        if (\n          this._deps.callerId.ringOut.type === 'Blocked' &&\n          !this.isBlockedIdDisabled\n        ) {\n          defaultCallerId = { phoneNumber: BLOCKED_ID_VALUE };\n        } else if (this._deps.callerId.ringOut.type === 'PhoneNumber') {\n          const defaultPhoneNumber =\n            this._deps.callerId?.ringOut.phoneInfo?.phoneNumber;\n          const defaultEntry = this.fromNumbers.find(\n            (item) => item.phoneNumber === defaultPhoneNumber,\n          );\n          if (defaultEntry) {\n            defaultCallerId = defaultEntry;\n          }\n        }\n      }\n      await this.updateFromNumber(defaultCallerId);\n    }\n  }\n\n  @proxify\n  async setData(\n    {\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      isCustomLocation,\n    }: {\n      callWith: CallingOptionsType;\n      myLocation: string;\n      ringoutPrompt: boolean;\n      isCustomLocation: boolean;\n    },\n    withPrompt: boolean,\n  ) {\n    // TODO validate myLocation\n    this.setDataAction({\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      timestamp: Date.now(),\n      isCustomLocation,\n    });\n    if (withPrompt) {\n      if (this.callWith === callingOptions.softphone) {\n        this._deps.alert.info({\n          message: callingSettingsMessages.saveSuccessWithSoftphone,\n        });\n      } else if (this.callWith === callingOptions.jupiter) {\n        this._deps.alert.info({\n          message: callingSettingsMessages.saveSuccessWithJupiter,\n        });\n      } else {\n        this._deps.alert.info({\n          message: callingSettingsMessages.saveSuccess,\n        });\n        if (!this._emergencyCallAvailable) {\n          this._warningEmergencyCallingNotAvailable();\n        }\n      }\n    }\n\n    if (this.isWebphoneMode) {\n      this._verifyJPEmergency();\n    }\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.extensionPhoneNumber.directNumbers,\n    that._deps.extensionPhoneNumber.mainCompanyNumber,\n    that._deps.extensionInfo.extensionNumber,\n  ])\n  get myPhoneNumbers() {\n    const { directNumbers, mainCompanyNumber } =\n      this._deps.extensionPhoneNumber;\n    const { extensionNumber } = this._deps.extensionInfo;\n    const myPhoneNumbers = directNumbers.map((item) => item.phoneNumber);\n    if (mainCompanyNumber && extensionNumber) {\n      myPhoneNumbers.push(\n        `${mainCompanyNumber.phoneNumber}*${extensionNumber}`,\n      );\n    }\n    return myPhoneNumbers;\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.forwardingNumber.flipNumbers,\n    that._deps.extensionPhoneNumber.callerIdNumbers,\n    that._deps.extensionPhoneNumber.directNumbers,\n  ])\n  get otherPhoneNumbers() {\n    const { flipNumbers } = this._deps.forwardingNumber;\n    const { callerIdNumbers, directNumbers } = this._deps.extensionPhoneNumber;\n    const filterMapping: { [k: string]: boolean } = {};\n    callerIdNumbers.forEach((item) => {\n      filterMapping[item.phoneNumber] = true;\n    });\n    directNumbers.forEach((item) => {\n      filterMapping[item.phoneNumber] = true;\n    });\n    return flipNumbers\n      .filter((item) => !filterMapping[item.phoneNumber])\n      .sort((a, b) => (a.label === 'Mobile' && a.label !== b.label ? -1 : 1))\n      .map((item) => item.phoneNumber);\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.appFeatures.isRingOutEnabled,\n    that._deps.appFeatures.isWebPhoneEnabled,\n    that.otherPhoneNumbers.length,\n    that._deps.extensionPhoneNumber.numbers.length,\n  ])\n  get callWithOptions() {\n    const { isRingOutEnabled, isWebPhoneEnabled } = this._deps.appFeatures;\n    const hasExtensionPhoneNumber =\n      this._deps.extensionPhoneNumber.numbers.length > 0;\n    if (!hasExtensionPhoneNumber && this._deps.appFeatures.isSoftphoneEnabled) {\n      return [callingOptions.softphone];\n    }\n    if (\n      !hasExtensionPhoneNumber &&\n      !this._deps.appFeatures.isSoftphoneEnabled\n    ) {\n      return [];\n    }\n    const callWithOptions = [];\n    if (this._deps.webphone && isWebPhoneEnabled) {\n      callWithOptions.push(callingOptions.browser);\n    }\n    if (\n      this._deps.brand &&\n      this._showCallWithJupiter &&\n      this._deps.appFeatures.isRingCentralAppEnabled\n    ) {\n      callWithOptions.push(callingOptions.jupiter);\n    }\n\n    if (this._deps.appFeatures.isSoftphoneEnabled) {\n      callWithOptions.push(callingOptions.softphone);\n    }\n    if (isRingOutEnabled && this._deps.appFeatures.isRingOutEnabled) {\n      callWithOptions.push(callingOptions.ringout);\n    }\n    return callWithOptions;\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.extensionPhoneNumber.callerIdNumbers,\n  ])\n  get fromNumbers() {\n    const { callerIdNumbers } = this._deps.extensionPhoneNumber;\n    const sortedPhoneNumbers = callerIdNumbers.sort((firstItem, lastItem) => {\n      if (firstItem.usageType === 'DirectNumber') return -1;\n      if (lastItem.usageType === 'DirectNumber') return 1;\n      if (firstItem.usageType === 'MainCompanyNumber') return -1;\n      if (lastItem.usageType === 'MainCompanyNumber') return 1;\n      if (firstItem.usageType < lastItem.usageType) return -1;\n      if (firstItem.usageType > lastItem.usageType) return 1;\n      return 0;\n    });\n    return sortedPhoneNumbers;\n  }\n\n  @computed((that: CallingSettings) => [\n    that.myPhoneNumbers,\n    that.otherPhoneNumbers,\n  ])\n  get availableNumbers() {\n    return this.myPhoneNumbers.concat(this.otherPhoneNumbers);\n  }\n\n  @computed((that: CallingSettings) => [that.availableNumbers])\n  get availableNumbersWithLabel() {\n    const { availableNumbers } = this;\n    const result: { label: string; value: string }[] = [];\n    if (availableNumbers.length) {\n      availableNumbers.forEach((phoneNumber) => {\n        const locationLabel = this._getLocationLabel(phoneNumber);\n        result.push({\n          label: locationLabel,\n          value: phoneNumber,\n        });\n      });\n    }\n    result.sort(\n      (a, b) =>\n        LOCATION_NUMBER_ORDER.indexOf(a.label) -\n        LOCATION_NUMBER_ORDER.indexOf(b.label),\n    );\n    return result;\n  }\n\n  get callingMode() {\n    return mapOptionToMode(this.callWith);\n  }\n\n  get defaultRingoutPrompt() {\n    return this.initRingoutPrompt;\n  }\n\n  get isWebphoneMode() {\n    return this.callingMode === callingModes.webphone;\n  }\n\n  /* ringtone */\n  get isChangeRingToneAllowed() {\n    return (\n      this._deps.webphone &&\n      (this._deps.storage.driver === 'INDEXEDDB' ||\n        this._deps.storage.driver === 'WEBSQL')\n    );\n  }\n\n  get jupiterAppName() {\n    return this._deps.softphone?.jupiterAppName;\n  }\n\n  /* India go */\n  get isBlockedIdDisabled() {\n    return (\n      this._deps.extensionFeatures.features?.BlockingCallerId?.available ===\n      false\n    );\n  }\n}\nexport { CallingSettings };\n"],"file":"CallingSettings.js"}