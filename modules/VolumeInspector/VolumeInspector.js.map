{"version":3,"file":"VolumeInspector.js","names":["_core","require","_utils","_di","_proxify","_AudioDetector","_MediaRecorderHelper","_MicLevelHelper","_break","_interopRequireDefault","_const","_createAudioElement","_stream","_dec","_class","_class2","_descriptor","_descriptor2","_descriptor3","_descriptor4","e","__esModule","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","l","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","TypeError","_defineProperties","length","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","VolumeInspector","Module","name","deps","_RcModuleV","_super","_this","mediaRecorderHelper","MediaRecorderHelper","micLevel","MicLevelHelper","audioDetector","AudioDetector","detectorListenDisposer","audioEl","createAudioElement","outputEl","_sampleAudioBlobUrl","startPlayback","_ref","regeneratorRuntime","mark","_callee","src","volume","_this$audioEl$capture","_this$audioEl","wrap","_callee$","_context","prev","next","setTestState","TEST_STATE","PLAYS_AUDIO","currentTime","setupAudioDetector","play","srcObject","captureStream","setSinkId","_deps","audioSettings","outputDeviceId","undefined","t0","console","warn","completeTest","stop","_x","_x2","setVolumeCb","setVolume","stopPlayback","_this$detectorListenD","_this2","pause","stopStream","onRecordingComplete","clear","startRecording","_callee2","stream","_callee2$","_context2","setType","TEST_TYPE","microphone","RECORDS_AUDIO","setupMicMedia","inputDeviceId","sent","IDLE","abrupt","listenToMic","t1","stopRecording","doCompleteTest","_preloadAudio","setRecordingCompleteCallback","setUpdateRecordingTimeCallback","setCountDown","onended","onEnded","_setType","type","_setType2","_callee3","_callee3$","_context3","_x3","_setTestState","testState","_setVolume","_setVolume2","_callee4","_callee4$","_context4","_x4","_setTestState2","_callee5","_callee5$","_context5","_x5","_setCountDown","countDown","_setCountDown2","_callee6","recordingTime","_callee6$","_context6","Math","ceil","MAX_RECORDING_TIME","_x6","_preloadAudio2","_callee7","_callee7$","_context7","getBlobURL","soundBreakMp3","error","_setupAudioDetector","_callee8","result","_callee8$","_context8","connect","registerListener","setInterval","LEVEL_CHECK_INTERVAL","start","startPlaySampleAudio","speaker","callVolume","RcModuleV2","state","MAX_RECORDING_SECS","action","getOwnPropertyDescriptor","proxify","exports"],"sources":["modules/VolumeInspector/VolumeInspector.ts"],"sourcesContent":["import { action, RcModuleV2, state } from '@ringcentral-integration/core';\nimport { getBlobURL } from '@ringcentral-integration/utils';\n\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\n\nimport { AudioDetector } from './AudioDetector';\nimport { MediaRecorderHelper } from './MediaRecorderHelper';\nimport { MicLevelHelper } from './MicLevelHelper';\nimport type { AUDIO_TYPE, Deps } from './VolumeInspector.interface';\nimport soundBreakMp3 from './audio/break.mp3';\nimport {\n  LEVEL_CHECK_INTERVAL,\n  MAX_RECORDING_SECS,\n  MAX_RECORDING_TIME,\n  TEST_STATE,\n  TEST_TYPE,\n} from './const';\nimport { createAudioElement } from './utils/createAudioElement';\nimport { stopStream } from './utils/stream';\n\n@Module({\n  name: 'VolumeInspector',\n  deps: ['AudioSettings'],\n})\nexport class VolumeInspector extends RcModuleV2<Deps> {\n  private readonly mediaRecorderHelper = new MediaRecorderHelper();\n  private micLevel = new MicLevelHelper();\n  private audioDetector = new AudioDetector();\n  private detectorListenDisposer: (() => void) | null = null;\n  private audioEl: HTMLAudioElement = createAudioElement();\n  private outputEl: HTMLAudioElement = createAudioElement();\n  private _sampleAudioBlobUrl: string = '';\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n    this._preloadAudio();\n    this.mediaRecorderHelper.setRecordingCompleteCallback(\n      this.onRecordingComplete.bind(this),\n    );\n    this.mediaRecorderHelper.setUpdateRecordingTimeCallback(\n      this.setCountDown.bind(this),\n    );\n    this.audioEl.onended = this.onEnded.bind(this);\n  }\n\n  @state testState: TEST_STATE = TEST_STATE.IDLE;\n  @state countDown: number = MAX_RECORDING_SECS;\n  @state volume = 0;\n  @state type: AUDIO_TYPE | null = null;\n\n  @action\n  private _setType(type: AUDIO_TYPE | null) {\n    this.type = type;\n  }\n\n  @proxify\n  async setType(type: AUDIO_TYPE | null) {\n    this._setType(type);\n  }\n\n  @action\n  private _setTestState(testState: TEST_STATE) {\n    this.testState = testState;\n  }\n\n  @action\n  private _setVolume(volume: number) {\n    this.volume = volume;\n  }\n\n  @proxify\n  async setVolume(volume: number) {\n    this._setVolume(volume);\n  }\n\n  @proxify\n  async setTestState(testState: TEST_STATE) {\n    this._setTestState(testState);\n    this._setVolume(0);\n  }\n\n  @action\n  private _setCountDown(countDown: number) {\n    this.countDown = countDown;\n  }\n\n  @proxify\n  async setCountDown(recordingTime: number) {\n    const countDown = Math.ceil((MAX_RECORDING_TIME - recordingTime) / 1000);\n    this._setCountDown(countDown);\n  }\n\n  private async _preloadAudio() {\n    try {\n      this._sampleAudioBlobUrl = await getBlobURL(soundBreakMp3);\n    } catch (e) {\n      console.error('failed to preload audio', e);\n    }\n  }\n\n  private async setupAudioDetector() {\n    if (!this.audioEl) {\n      console.warn('Can not setup AudioDetector - no audio element.');\n      return;\n    }\n    await this.audioDetector.connect(this.audioEl);\n\n    const result = this.audioDetector.registerListener(this.setVolumeCb);\n\n    if (result instanceof Error) {\n      console.warn('register detector listener error.');\n      return;\n    }\n    this.detectorListenDisposer = result\n      .setInterval(LEVEL_CHECK_INTERVAL)\n      .start();\n  }\n\n  // only for test speaker\n  public startPlaySampleAudio() {\n    this.setType(TEST_TYPE.speaker);\n    this.startPlayback(\n      this._sampleAudioBlobUrl,\n      this._deps.audioSettings.callVolume,\n    );\n  }\n\n  protected startPlayback = async (src: string, volume?: number) => {\n    this.setTestState(TEST_STATE.PLAYS_AUDIO);\n    try {\n      this.audioEl.src = src;\n      this.audioEl.currentTime = 0;\n      await this.setupAudioDetector();\n      await this.audioEl.play();\n      // this trick is due to connected audio analyzer (MicDetector) that makes\n      // impossible to output audio to specific (selected) device other than default\n      // @ts-expect-error\n      this.outputEl.srcObject = this.audioEl.captureStream?.();\n      if (this.outputEl.setSinkId && this._deps.audioSettings.outputDeviceId) {\n        this.outputEl.setSinkId(this._deps.audioSettings.outputDeviceId);\n      }\n      if (volume !== undefined) {\n        this.outputEl.volume = volume;\n      }\n      this.outputEl.play();\n    } catch (e) {\n      console.warn('Recording play failed', e);\n      this.completeTest();\n    }\n  };\n\n  protected setVolumeCb = (volume: number) => {\n    this.setVolume(volume);\n  };\n\n  protected stopPlayback = () => {\n    if (this.audioEl) {\n      this.audioEl.pause();\n    }\n    if (this.outputEl) {\n      this.outputEl.pause();\n      if (this.outputEl.srcObject) {\n        stopStream(this.outputEl.srcObject as MediaStream);\n        this.outputEl.srcObject = null;\n      }\n    }\n    this.detectorListenDisposer?.();\n    this.detectorListenDisposer = null;\n  };\n\n  private readonly onRecordingComplete = (src: string) => {\n    this.micLevel.clear();\n    this.startPlayback(src);\n  };\n\n  startRecording = async () => {\n    this.setType(TEST_TYPE.microphone);\n    this.setTestState(TEST_STATE.RECORDS_AUDIO);\n    let stream;\n    try {\n      stream = await this.micLevel.setupMicMedia(\n        this._deps.audioSettings.inputDeviceId,\n      );\n    } catch (e) {\n      console.warn('can not setup mic media', e);\n      this.setTestState(TEST_STATE.IDLE);\n      return;\n    }\n    try {\n      await this.micLevel.listenToMic(this.setVolumeCb);\n      this.mediaRecorderHelper.startRecording(stream);\n    } catch (e) {\n      console.warn('can not start startRecording', e);\n    }\n  };\n\n  stopRecording = () => {\n    try {\n      this.mediaRecorderHelper.stopRecording();\n    } catch (e) {\n      console.warn('stopRecording failed', e);\n      this.completeTest();\n    }\n    this.micLevel.clear();\n  };\n\n  completeTest = () => {\n    this.doCompleteTest();\n  };\n\n  protected onEnded() {\n    this.doCompleteTest();\n  }\n\n  private doCompleteTest() {\n    this.setType(null);\n    this.setTestState(TEST_STATE.IDLE);\n    this.stopPlayback();\n  }\n}\n"],"mappings":"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","ignoreList":[]}