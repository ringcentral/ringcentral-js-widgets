{"version":3,"sources":["modules/QuickAccess/index.ts"],"names":["QuickAccess","deps","auth","webphone","options","actionTypes","_auth","_webphone","_reducer","store","subscribe","_onStateChange","ready","dispatch","type","initSuccess","resetSuccess","ringSession","_lastRingSession","exit","updatePage","entered","state","status","RcModule","proxify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAKqBA,W,WAHpB,gBAAO;AACNC,EAAAA,IAAI,EAAE,CAAC,MAAD,EAAS,SAAT,EAAoB,UAApB;AADA,CAAP,C;;;;;AAIC,6BAA4C;AAAA;;AAAA,QAA9BC,IAA8B,QAA9BA,IAA8B;AAAA,QAAxBC,QAAwB,QAAxBA,QAAwB;AAAA,QAAXC,OAAW;;AAAA;;AAC1C;AACEC,MAAAA,WAAW,EAAXA;AADF,OAEKD,OAFL;AAIA,UAAKE,KAAL,GAAaJ,IAAb;AACA,UAAKK,SAAL,GAAiBJ,QAAjB;AACA,UAAKK,QAAL,GAAgB,uCAAsB,MAAKH,WAA3B,CAAhB;AAP0C;AAQ3C;;;;iCAEY;AAAA;;AACX,WAAKI,KAAL,CAAWC,SAAX,CAAqB;AAAA,eAAM,MAAI,CAACC,cAAL,EAAN;AAAA,OAArB;AACD;;;;;;;;;AAGC,oBAAI,KAAKL,KAAL,CAAWM,KAAX,IAAoB,CAAC,KAAKA,KAA9B,EAAqC;AACnC,uBAAKH,KAAL,CAAWI,QAAX,CAAoB;AAClBC,oBAAAA,IAAI,EAAE,KAAKT,WAAL,CAAiBU;AADL,mBAApB;AAGD,iBAJD,MAIO,IAAI,CAAC,KAAKT,KAAL,CAAWM,KAAZ,IAAqB,KAAKA,KAA9B,EAAqC;AAC1C,uBAAKH,KAAL,CAAWI,QAAX,CAAoB;AAClBC,oBAAAA,IAAI,EAAE,KAAKT,WAAL,CAAiBW;AADL,mBAApB;AAGD,iB,CACD;AACA;;;AACA,oBACE,KAAKT,SAAL,CAAeK,KAAf,IACA,KAAKL,SAAL,CAAeU,WADf,IAEA,KAAKV,SAAL,CAAeU,WAAf,KAA+B,KAAKC,gBAHtC,EAIE;AACA,uBAAKA,gBAAL,GAAwB,KAAKX,SAAL,CAAeU,WAAvC;AACA,uBAAKE,IAAL;AACD;;;;;;;;;;;;;;;;;;;;;;;;AAKD,qBAAKV,KAAL,CAAWI,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKT,WAAL,CAAiBe,UADL;AAElBC,kBAAAA,OAAO,EAAE;AAFS,iBAApB;;;;;;;;;;;;;;;;;;;;;;;;AAQA,qBAAKZ,KAAL,CAAWI,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKT,WAAL,CAAiBe,UADL;AAElBC,kBAAAA,OAAO,EAAE;AAFS,iBAApB;;;;;;;;;;;;;;;;;;wBAMY;AACZ,aAAO,KAAKC,KAAL,CAAWD,OAAlB;AACD;;;wBAEY;AACX,aAAO,KAAKC,KAAL,CAAWC,MAAlB;AACD;;;;EA3DsCC,qB,2DAqCtCC,mB,0IAQAA,mB","sourcesContent":["import { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\nimport RcModule from '../../lib/RcModule';\nimport actionTypes from './actionTypes';\nimport getQuickAccessReducer from './getQuickAccessReducer';\n\n@Module({\n  deps: ['Auth', 'Storage', 'Webphone'],\n})\nexport default class QuickAccess extends RcModule {\n  constructor({ auth, webphone, ...options }) {\n    super({\n      actionTypes,\n      ...options,\n    });\n    this._auth = auth;\n    this._webphone = webphone;\n    this._reducer = getQuickAccessReducer(this.actionTypes);\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._auth.ready && !this.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (!this._auth.ready && this.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    }\n    // When there is an incoming call,\n    // the page should be dismissed\n    if (\n      this._webphone.ready &&\n      this._webphone.ringSession &&\n      this._webphone.ringSession !== this._lastRingSession\n    ) {\n      this._lastRingSession = this._webphone.ringSession;\n      this.exit();\n    }\n  }\n\n  @proxify\n  async enter() {\n    this.store.dispatch({\n      type: this.actionTypes.updatePage,\n      entered: true,\n    });\n  }\n\n  @proxify\n  async exit() {\n    this.store.dispatch({\n      type: this.actionTypes.updatePage,\n      entered: false,\n    });\n  }\n\n  get entered() {\n    return this.state.entered;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n}\n"],"file":"index.js"}