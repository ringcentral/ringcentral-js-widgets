{"version":3,"file":"EvAgentScript.js","names":["_events","require","_ramda","_debounceThrottle","_di","_SingleTabBroadcastChannel","_core","_enums","_dec","_class","_class2","_descriptor","_descriptor2","_descriptor3","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","undefined","_initializerDefineProperty","target","property","descriptor","context","defineProperty","enumerable","configurable","writable","initializer","_classCallCheck","instance","Constructor","_defineProperties","props","_toPropertyKey","_createClass","protoProps","staticProps","_toPrimitive","_typeof","String","input","hint","prim","toPrimitive","res","Number","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","decorators","desc","keys","forEach","reverse","reduce","decorator","_initializerWarningHelper","Error","EvAgentScript","Module","deps","dep","optional","_ref","_super","_this","enableCache","storageKey","_channel","_eventEmitter","EventEmitter","_hadResponse","debouncedSetCallScriptResult","debounce","setCallScriptResult","setIsDisplayAgentScript","state","isDisplayAgentScript","setCurrentCallScript","script","currentCallScript","id","data","callScriptResultMapping","emit","agentScriptEvents","SET_SCRIPT_RESULT","reset","console","log","onSetScriptResult","cb","on","onUpdateDisposition","UPDATE_DISPOSITION","onInitOnce","_this2","_bindChannel","watch","_responseInitScript","_deps","evCallMonitor","onCallAnswered","_ref2","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","getIsAgentScript","getScript","scriptId","scriptVersion","uii","stop","evAuth","beforeAgentLogout","onInit","_this3","tabManager","enable","sessionStorage","getItem","EV_AGENT_SCRIPT_BROADCAST_KEY","setItem","SingleTabBroadcastChannel","EV_APP_PAGE_KEY","to","EV_AGENT_SCRIPT_PAGE_KEY","init","addEventListener","_ref3","_this3$_deps$evCall","evCall","activityCallId","currentCall","INIT","GET_KNOWLEDGE_BASE_ARTICLES","_getKnowledgeBaseGroups","setTimeout","_getKnowledgeBaseGroups2","_callee2","knowledgeBaseGroupIds","_callee2$","_context2","evClient","getKnowledgeBaseGroups","sent","send","_x2","config","_getScript","_callee3","version","type","response","_args3","_callee3$","_context3","JSON","parse","json","t0","abrupt","_x3","saveScriptResult","scriptResult","encodeUii","sessionId","session","_formatScriptResult","resultCopy","clone","model","output","_ref4","_value$leadField","_ref5","leadField","entries","RcModuleV2","storage","action","getOwnPropertyDescriptor","exports"],"sources":["modules/EvAgentScript/EvAgentScript.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { clone, reduce } from 'ramda';\n\nimport { debounce } from '@ringcentral-integration/commons/lib/debounce-throttle';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport { SingleTabBroadcastChannel } from '@ringcentral-integration/commons/lib/SingleTabBroadcastChannel';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n  watch,\n} from '@ringcentral-integration/core';\n\nimport {\n  agentScriptEvents,\n  EV_AGENT_SCRIPT_BROADCAST_KEY,\n  EV_AGENT_SCRIPT_PAGE_KEY,\n  EV_APP_PAGE_KEY,\n} from '../../enums';\nimport type { EvCallData } from '../../interfaces/EvData.interface';\nimport type {\n  EvAgentScriptData,\n  EvAgentScriptResult,\n  EvAgentScriptResultModel,\n  EvBaseCall,\n  EvCallDispositionItem,\n  EvScriptResponseJSON,\n} from '../../lib/EvClient';\nimport type {\n  AgentScript,\n  Deps,\n  EvCallScriptResultMapping,\n} from './EvAgentScript.interface';\n\n@Module({\n  name: 'EvAgentScript',\n  deps: [\n    'EvClient',\n    'EvAuth',\n    'EvCall',\n    'Storage',\n    'TabManager',\n    'EvCallMonitor',\n    { dep: 'EvAgentScriptOptions', optional: true },\n  ],\n})\nclass EvAgentScript<T extends Deps = Deps>\n  extends RcModuleV2<T>\n  implements AgentScript\n{\n  private _channel: SingleTabBroadcastChannel;\n\n  protected _eventEmitter = new EventEmitter();\n  private _hadResponse = false;\n\n  constructor(deps: T) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvAgentScript',\n    });\n  }\n\n  // currentChatScripts: any = null;\n\n  @storage\n  @state\n  currentCallScript: EvAgentScriptData = null;\n\n  @storage\n  @state\n  isDisplayAgentScript = true;\n\n  @storage\n  @state\n  callScriptResultMapping: EvCallScriptResultMapping = {};\n\n  @action\n  setIsDisplayAgentScript(state: boolean) {\n    this.isDisplayAgentScript = state;\n  }\n\n  @action\n  setCurrentCallScript(script: EvAgentScriptData) {\n    this.currentCallScript = script;\n  }\n\n  @action\n  setCallScriptResult(id: string, data: EvAgentScriptResult) {\n    this.callScriptResultMapping[id] = data;\n    this._eventEmitter.emit(agentScriptEvents.SET_SCRIPT_RESULT, id, data);\n  }\n\n  debouncedSetCallScriptResult = debounce({ fn: this.setCallScriptResult });\n\n  reset() {\n    console.log('!!!EvAgentScript reset');\n    // this.setIsDisplayAgentScript(false);\n  }\n\n  onSetScriptResult(cb: (id: string, data: EvAgentScriptResult) => any) {\n    this._eventEmitter.on(agentScriptEvents.SET_SCRIPT_RESULT, cb);\n  }\n\n  onUpdateDisposition(cb: (id: string, data: EvCallDispositionItem) => any) {\n    this._eventEmitter.on(agentScriptEvents.UPDATE_DISPOSITION, cb);\n  }\n\n  override onInitOnce() {\n    this._bindChannel();\n\n    // when script change emit that\n    watch(\n      this,\n      () => this.currentCallScript,\n      () => {\n        this._responseInitScript();\n      },\n    );\n\n    this._deps.evCallMonitor.onCallAnswered(async (call) => {\n      if (this.getIsAgentScript(call)) {\n        await this.getScript(\n          call.scriptId,\n          call.scriptVersion,\n          'CALL',\n          call.uii,\n        );\n      }\n    });\n\n    this._deps.evAuth.beforeAgentLogout(() => {\n      this.reset();\n    });\n  }\n\n  override onInit() {\n    console.log('EvAgentScript!! init');\n    this.setIsDisplayAgentScript(true);\n  }\n\n  getIsAgentScript(call: EvBaseCall) {\n    return !!(this.isDisplayAgentScript && call?.scriptId);\n  }\n\n  private _bindChannel() {\n    if (\n      this._deps.tabManager.enable &&\n      !sessionStorage.getItem(EV_AGENT_SCRIPT_BROADCAST_KEY)\n    ) {\n      sessionStorage.setItem(\n        EV_AGENT_SCRIPT_BROADCAST_KEY,\n        this._deps.tabManager.id,\n      );\n    }\n\n    this._channel = new SingleTabBroadcastChannel(\n      EV_AGENT_SCRIPT_BROADCAST_KEY,\n      {\n        from: EV_APP_PAGE_KEY,\n        to: EV_AGENT_SCRIPT_PAGE_KEY,\n      },\n    ).init();\n\n    this._channel.addEventListener(({ data }) => {\n      const { key, value } = data;\n      const { activityCallId, currentCall } = this._deps.evCall;\n\n      if (\n        this.isDisplayAgentScript &&\n        activityCallId &&\n        currentCall?.scriptId\n      ) {\n        switch (key) {\n          case agentScriptEvents.INIT:\n            this._responseInitScript();\n            break;\n          case agentScriptEvents.SET_SCRIPT_RESULT:\n            this.debouncedSetCallScriptResult(activityCallId, value);\n            break;\n          case agentScriptEvents.GET_KNOWLEDGE_BASE_ARTICLES:\n            this._getKnowledgeBaseGroups(value);\n            break;\n          case agentScriptEvents.UPDATE_DISPOSITION:\n            this._eventEmitter.emit(\n              agentScriptEvents.UPDATE_DISPOSITION,\n              activityCallId,\n              value,\n            );\n            break;\n          default:\n            break;\n        }\n      }\n    });\n\n    // if that agent Script is more quick than CTI app, that will need emit that when app init.\n    setTimeout(() => {\n      if (this.currentCallScript && !this._hadResponse) {\n        this._responseInitScript();\n      }\n    }, 1000);\n  }\n\n  private async _getKnowledgeBaseGroups(knowledgeBaseGroupIds: number[]) {\n    const value = await this._deps.evClient.getKnowledgeBaseGroups(\n      knowledgeBaseGroupIds,\n    );\n\n    this._channel.send({\n      key: agentScriptEvents.GET_KNOWLEDGE_BASE_ARTICLES,\n      value,\n    });\n  }\n\n  private _responseInitScript() {\n    this._channel.send({\n      key: agentScriptEvents.INIT,\n      value: {\n        config: this.currentCallScript,\n        call: this._deps.evCall.currentCall,\n      },\n    });\n\n    this._hadResponse = true;\n  }\n\n  async getScript(\n    scriptId: string,\n    version: string = null,\n    type = 'CALL',\n    uii: string = null,\n  ) {\n    const response = await this._deps.evClient.getScript(scriptId, version);\n    // TODO: that will fix in next MR\n    const result: EvAgentScriptData = {\n      scriptId: response.scriptId,\n      // scriptName: response.scriptName,\n      // finalResult: null as any, // used for reporting\n      // navPosition: null as any,\n      // version: response.version,\n      data: JSON.parse(response.json) as EvScriptResponseJSON,\n    } as any;\n\n    switch (type) {\n      // case 'CHAT':\n      //   this.currentChatScripts[uii] = result;\n      //   break;\n      case 'CALL':\n        this.setCurrentCallScript(result);\n        break;\n\n      default:\n        break;\n    }\n\n    return result;\n  }\n\n  /**\n   * @param call - the corresponding chat or call object\n   */\n  saveScriptResult(call: EvCallData) {\n    const scriptResult =\n      this.callScriptResultMapping[\n        this._deps.evClient.encodeUii({\n          uii: call.uii,\n          sessionId: call.session.sessionId,\n        })\n      ];\n\n    if (scriptResult) {\n      const result = this._formatScriptResult(scriptResult);\n      this._deps.evClient.saveScriptResult(call.uii, call.scriptId, result);\n    }\n  }\n\n  private _formatScriptResult(scriptResult: EvAgentScriptResult) {\n    const resultCopy = clone(scriptResult);\n\n    resultCopy.model = reduce(\n      (output, [key, value]) => {\n        let result = value;\n        if (result.value !== undefined) {\n          result = result.value;\n        }\n\n        output[key] = {\n          value: result,\n          leadField: value.leadField ?? '',\n        };\n        return output;\n      },\n      {} as EvAgentScriptResultModel,\n      Object.entries<any>(resultCopy.model),\n    );\n\n    return resultCopy;\n  }\n}\n\nexport { EvAgentScript };\n"],"mappings":"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"}