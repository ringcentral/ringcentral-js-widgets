{"version":3,"file":"EvAgentScript.js","names":["_SingleTabBroadcastChannel","require","_debounceThrottle","_di","_core","_events","_ramda","_enums","_dec","_class","_class2","_descriptor","_descriptor2","_descriptor3","_slicedToArray","r","e","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","asyncGeneratorStep","c","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","defineProperty","enumerable","configurable","writable","initializer","_classCallCheck","_defineProperties","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","toPrimitive","String","Number","_inherits","create","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","keys","forEach","reverse","reduce","_initializerWarningHelper","Error","EvAgentScript","Module","deps","dep","optional","_ref","_super","_this","enableCache","storageKey","_channel","_eventEmitter","EventEmitter","_hadResponse","debouncedSetCallScriptResult","debounce","fn","setCallScriptResult","setIsDisplayAgentScript","state","isDisplayAgentScript","setCurrentCallScript","script","currentCallScript","id","data","callScriptResultMapping","emit","agentScriptEvents","SET_SCRIPT_RESULT","reset","console","log","onSetScriptResult","cb","on","onUpdateDisposition","UPDATE_DISPOSITION","onInitOnce","_this2","_bindChannel","watch","_responseInitScript","_deps","evCallMonitor","onCallAnswered","_ref2","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","getIsAgentScript","getScript","scriptId","scriptVersion","uii","stop","_x","evAuth","beforeAgentLogout","onInit","_this3","tabManager","enable","sessionStorage","getItem","EV_AGENT_SCRIPT_BROADCAST_KEY","setItem","SingleTabBroadcastChannel","EV_APP_PAGE_KEY","to","EV_AGENT_SCRIPT_PAGE_KEY","init","addEventListener","_ref3","_this3$_deps$evCall","evCall","activityCallId","currentCall","INIT","GET_KNOWLEDGE_BASE_ARTICLES","_getKnowledgeBaseGroups","setTimeout","_getKnowledgeBaseGroups2","_callee2","knowledgeBaseGroupIds","_callee2$","_context2","evClient","getKnowledgeBaseGroups","sent","send","_x2","config","_getScript","_callee3","version","type","response","result","_args3","_callee3$","_context3","undefined","JSON","parse","json","t0","abrupt","_x3","saveScriptResult","scriptResult","encodeUii","sessionId","session","_formatScriptResult","resultCopy","clone","model","output","_ref4","_value$leadField","_ref5","leadField","entries","RcModuleV2","storage","action","getOwnPropertyDescriptor","exports"],"sources":["modules/EvAgentScript/EvAgentScript.ts"],"sourcesContent":["import { SingleTabBroadcastChannel } from '@ringcentral-integration/commons/lib/SingleTabBroadcastChannel';\nimport { debounce } from '@ringcentral-integration/commons/lib/debounce-throttle';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n  watch,\n} from '@ringcentral-integration/core';\nimport { EventEmitter } from 'events';\nimport { clone, reduce } from 'ramda';\n\nimport {\n  agentScriptEvents,\n  EV_AGENT_SCRIPT_BROADCAST_KEY,\n  EV_AGENT_SCRIPT_PAGE_KEY,\n  EV_APP_PAGE_KEY,\n} from '../../enums';\nimport type { EvCallData } from '../../interfaces/EvData.interface';\nimport type {\n  EvAgentScriptData,\n  EvAgentScriptResult,\n  EvAgentScriptResultModel,\n  EvBaseCall,\n  EvCallDispositionItem,\n  EvScriptResponseJSON,\n} from '../../lib/EvClient';\n\nimport type {\n  AgentScript,\n  Deps,\n  EvCallScriptResultMapping,\n} from './EvAgentScript.interface';\n\n@Module({\n  name: 'EvAgentScript',\n  deps: [\n    'EvClient',\n    'EvAuth',\n    'EvCall',\n    'Storage',\n    'TabManager',\n    'EvCallMonitor',\n    { dep: 'EvAgentScriptOptions', optional: true },\n  ],\n})\nclass EvAgentScript<T extends Deps = Deps>\n  extends RcModuleV2<T>\n  implements AgentScript\n{\n  private _channel: SingleTabBroadcastChannel;\n\n  protected _eventEmitter = new EventEmitter();\n  private _hadResponse = false;\n\n  constructor(deps: T) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvAgentScript',\n    });\n  }\n\n  // currentChatScripts: any = null;\n\n  @storage\n  @state\n  currentCallScript: EvAgentScriptData = null;\n\n  @storage\n  @state\n  isDisplayAgentScript = true;\n\n  @storage\n  @state\n  callScriptResultMapping: EvCallScriptResultMapping = {};\n\n  @action\n  setIsDisplayAgentScript(state: boolean) {\n    this.isDisplayAgentScript = state;\n  }\n\n  @action\n  setCurrentCallScript(script: EvAgentScriptData) {\n    this.currentCallScript = script;\n  }\n\n  @action\n  setCallScriptResult(id: string, data: EvAgentScriptResult) {\n    this.callScriptResultMapping[id] = data;\n    this._eventEmitter.emit(agentScriptEvents.SET_SCRIPT_RESULT, id, data);\n  }\n\n  debouncedSetCallScriptResult = debounce({ fn: this.setCallScriptResult });\n\n  reset() {\n    console.log('!!!EvAgentScript reset');\n    // this.setIsDisplayAgentScript(false);\n  }\n\n  onSetScriptResult(cb: (id: string, data: EvAgentScriptResult) => any) {\n    this._eventEmitter.on(agentScriptEvents.SET_SCRIPT_RESULT, cb);\n  }\n\n  onUpdateDisposition(cb: (id: string, data: EvCallDispositionItem) => any) {\n    this._eventEmitter.on(agentScriptEvents.UPDATE_DISPOSITION, cb);\n  }\n\n  override onInitOnce() {\n    this._bindChannel();\n\n    // when script change emit that\n    watch(\n      this,\n      () => this.currentCallScript,\n      () => {\n        this._responseInitScript();\n      },\n    );\n\n    this._deps.evCallMonitor.onCallAnswered(async (call) => {\n      if (this.getIsAgentScript(call)) {\n        await this.getScript(\n          call.scriptId,\n          call.scriptVersion,\n          'CALL',\n          call.uii,\n        );\n      }\n    });\n\n    this._deps.evAuth.beforeAgentLogout(() => {\n      this.reset();\n    });\n  }\n\n  override onInit() {\n    console.log('EvAgentScript!! init');\n    this.setIsDisplayAgentScript(true);\n  }\n\n  getIsAgentScript(call: EvBaseCall) {\n    return !!(this.isDisplayAgentScript && call?.scriptId);\n  }\n\n  private _bindChannel() {\n    if (\n      this._deps.tabManager.enable &&\n      !sessionStorage.getItem(EV_AGENT_SCRIPT_BROADCAST_KEY)\n    ) {\n      sessionStorage.setItem(\n        EV_AGENT_SCRIPT_BROADCAST_KEY,\n        this._deps.tabManager.id,\n      );\n    }\n\n    this._channel = new SingleTabBroadcastChannel(\n      EV_AGENT_SCRIPT_BROADCAST_KEY,\n      {\n        from: EV_APP_PAGE_KEY,\n        to: EV_AGENT_SCRIPT_PAGE_KEY,\n      },\n    ).init();\n\n    this._channel.addEventListener(({ data }) => {\n      const { key, value } = data;\n      const { activityCallId, currentCall } = this._deps.evCall;\n\n      if (\n        this.isDisplayAgentScript &&\n        activityCallId &&\n        currentCall?.scriptId\n      ) {\n        switch (key) {\n          case agentScriptEvents.INIT:\n            this._responseInitScript();\n            break;\n          case agentScriptEvents.SET_SCRIPT_RESULT:\n            this.debouncedSetCallScriptResult(activityCallId, value);\n            break;\n          case agentScriptEvents.GET_KNOWLEDGE_BASE_ARTICLES:\n            this._getKnowledgeBaseGroups(value);\n            break;\n          case agentScriptEvents.UPDATE_DISPOSITION:\n            this._eventEmitter.emit(\n              agentScriptEvents.UPDATE_DISPOSITION,\n              activityCallId,\n              value,\n            );\n            break;\n          default:\n            break;\n        }\n      }\n    });\n\n    // if that agent Script is more quick than CTI app, that will need emit that when app init.\n    setTimeout(() => {\n      if (this.currentCallScript && !this._hadResponse) {\n        this._responseInitScript();\n      }\n    }, 1000);\n  }\n\n  private async _getKnowledgeBaseGroups(knowledgeBaseGroupIds: number[]) {\n    const value = await this._deps.evClient.getKnowledgeBaseGroups(\n      knowledgeBaseGroupIds,\n    );\n\n    this._channel.send({\n      key: agentScriptEvents.GET_KNOWLEDGE_BASE_ARTICLES,\n      value,\n    });\n  }\n\n  private _responseInitScript() {\n    this._channel.send({\n      key: agentScriptEvents.INIT,\n      value: {\n        config: this.currentCallScript,\n        call: this._deps.evCall.currentCall,\n      },\n    });\n\n    this._hadResponse = true;\n  }\n\n  async getScript(\n    scriptId: string,\n    version: string = null,\n    type = 'CALL',\n    uii: string = null,\n  ) {\n    const response = await this._deps.evClient.getScript(scriptId, version);\n    // TODO: that will fix in next MR\n    const result: EvAgentScriptData = {\n      scriptId: response.scriptId,\n      // scriptName: response.scriptName,\n      // finalResult: null as any, // used for reporting\n      // navPosition: null as any,\n      // version: response.version,\n      data: JSON.parse(response.json) as EvScriptResponseJSON,\n    } as any;\n\n    switch (type) {\n      // case 'CHAT':\n      //   this.currentChatScripts[uii] = result;\n      //   break;\n      case 'CALL':\n        this.setCurrentCallScript(result);\n        break;\n\n      default:\n        break;\n    }\n\n    return result;\n  }\n\n  /**\n   * @param call - the corresponding chat or call object\n   */\n  saveScriptResult(call: EvCallData) {\n    const scriptResult =\n      this.callScriptResultMapping[\n        this._deps.evClient.encodeUii({\n          uii: call.uii,\n          sessionId: call.session.sessionId,\n        })\n      ];\n\n    if (scriptResult) {\n      const result = this._formatScriptResult(scriptResult);\n      this._deps.evClient.saveScriptResult(call.uii, call.scriptId, result);\n    }\n  }\n\n  private _formatScriptResult(scriptResult: EvAgentScriptResult) {\n    const resultCopy = clone(scriptResult);\n\n    resultCopy.model = reduce(\n      (output, [key, value]) => {\n        let result = value;\n        if (result.value !== undefined) {\n          result = result.value;\n        }\n\n        output[key] = {\n          value: result,\n          leadField: value.leadField ?? '',\n        };\n        return output;\n      },\n      {} as EvAgentScriptResultModel,\n      Object.entries<any>(resultCopy.model),\n    );\n\n    return resultCopy;\n  }\n}\n\nexport { EvAgentScript };\n"],"mappings":"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","ignoreList":[]}