{"version":3,"sources":["modules/Presence/index.js"],"names":["presenceRegExp","detailedPresenceRegExp","Presence","deps","dep","optional","detailed","fetchRemainingDelay","ttl","polling","pollingInterval","connectivityMonitor","rolesAndPermissions","options","getDataReducer","fetchFunction","endpoint","_detailed","subscriptionFilters","detailedPresence","presence","_client","service","platform","get","data","json","subscriptionHandler","message","regExp","test","event","body","sequence","store","dispatch","type","actionTypes","notification","lastDndStatus","dndStatus","timestamp","Date","now","activeCalls","totalActiveCalls","length","_fetchRemainingCalls","readyCheckFn","_rolesAndPermissions","ready","_connectivityMonitor","ensureExist","fetchData","_shouldInit","_connectivity","connectivity","_hasPermission","params","hasEditPresencePermission","ownerId","_auth","put","response","updateSuccess","updateError","error","userStatusParams","userStatus","takeAllCalls","doNotAcceptDepartmentCalls","lastNotDisturbDndStatus","presenceStatus","available","doNotAcceptAnyCalls","_getUpdateStatusParams","_update","busy","offline","presenceData","setAvailable","setBusy","setDoNotDisturb","setInvisible","Enum","Object","keys","_name","telephonyStatus","meetingStatus","hasPresencePermission","DataFetcher","proxify","selector","calls","filter","call","map","sessionId"],"mappings":"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","sourcesContent":["import DataFetcher from '../../lib/DataFetcher';\nimport { Module } from '../../lib/di';\nimport { selector } from '../../lib/selector';\nimport Enum from '../../lib/Enum';\nimport { actionTypeGenerator } from '../../lib/actionTypeGenerator';\nimport { isEnded, removeInboundRingOutLegs } from '../../lib/callLogHelpers';\nimport debounce from '../../lib/debounce';\n\nimport { getDataReducer } from './getPresenceReducer';\nimport subscriptionFilters from '../../enums/subscriptionFilters';\nimport dndStatus from './dndStatus';\nimport presenceStatus from './presenceStatus';\nimport proxify from '../../lib/proxy/proxify';\nimport ensureExist from '../../lib/ensureExist';\n\nconst presenceRegExp = /.*\\/presence(\\?.*)?/;\nconst detailedPresenceRegExp = /.*\\/presence\\?detailedTelephonyState=true&sipData=true/;\n\n@Module({\n  deps: [\n    'RolesAndPermissions',\n    'ConnectivityMonitor',\n    { dep: 'Storage', optional: true },\n    { dep: 'PresenceOptions', optional: true },\n  ],\n})\nexport default class Presence extends DataFetcher {\n  constructor({\n    detailed = true,\n    fetchRemainingDelay = 2000,\n    ttl = 62 * 1000,\n    polling = false,\n    pollingInterval = 3 * 60 * 1000,\n    connectivityMonitor,\n    rolesAndPermissions,\n    ...options\n  }) {\n    super({\n      ...options,\n      polling,\n      ttl,\n      pollingInterval,\n      getDataReducer,\n      fetchFunction: async () => {\n        const endpoint = this._detailed\n          ? subscriptionFilters.detailedPresence\n          : subscriptionFilters.presence;\n        const data = (await this._client.service\n          .platform()\n          .get(endpoint)).json();\n        return data;\n      },\n      subscriptionFilters: [\n        detailed\n          ? subscriptionFilters.detailedPresence\n          : subscriptionFilters.presence,\n      ],\n      subscriptionHandler: (message) => {\n        const regExp = this._detailed ? detailedPresenceRegExp : presenceRegExp;\n        if (regExp.test(message.event) && message.body) {\n          if (message.body.sequence) {\n            if (message.body.sequence < this.sequence) {\n              return;\n            }\n          }\n          const { body } = message;\n          this.store.dispatch({\n            data: body,\n            type: this.actionTypes.notification,\n            lastDndStatus: this.dndStatus,\n            timestamp: Date.now(),\n          });\n\n          /**\n           * as pointed out by Igor in https://jira.ringcentral.com/browse/PLA-33391,\n           * when the real calls count larger than the active calls returned by the pubnub,\n           * we need to pulling the calls manually.\n           */\n          const { activeCalls = [], totalActiveCalls = 0 } = body;\n          if (activeCalls.length !== totalActiveCalls) {\n            this._fetchRemainingCalls();\n          }\n        }\n      },\n      readyCheckFn: () =>\n        this._rolesAndPermissions.ready && this._connectivityMonitor.ready,\n    });\n    this._detailed = true;\n    this._connectivityMonitor = this::ensureExist(\n      connectivityMonitor,\n      'connectivityMonitor',\n    );\n    this._rolesAndPermissions = this::ensureExist(\n      rolesAndPermissions,\n      'rolesAndPermissions',\n    );\n    this._fetchRemainingCalls = debounce(\n      () => this.fetchData(),\n      fetchRemainingDelay,\n    );\n  }\n\n  get _name() {\n    return 'presence';\n  }\n\n  get _actionTypes() {\n    return new Enum(\n      [\n        ...Object.keys(super._actionTypes),\n        ...actionTypeGenerator('update'),\n        'notification',\n      ],\n      this._name,\n    );\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n    }\n    super._onStateChange();\n    if (\n      this.ready &&\n      this._connectivityMonitor &&\n      this._connectivityMonitor.ready &&\n      this._connectivity !== this._connectivityMonitor.connectivity\n    ) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n      // fetch data on regain connectivity\n      if (this._connectivity && this._hasPermission) {\n        this.fetchData();\n      }\n    }\n  }\n\n  @proxify\n  async _update(params) {\n    if (!this._rolesAndPermissions.hasEditPresencePermission) {\n      return;\n    }\n    try {\n      const { ownerId } = this._auth;\n      const platform = this._client.service.platform();\n      const response = await platform.put(\n        '/account/~/extension/~/presence',\n        params,\n      );\n      const data = response.json();\n      if (ownerId === this._auth.ownerId) {\n        this.store.dispatch({\n          type: this.actionTypes.updateSuccess,\n          data,\n          lastDndStatus: this.dndStatus,\n        });\n      }\n    } catch (error) {\n      this.store.dispatch({\n        type: this.actionTypes.updateError,\n        error,\n      });\n      throw error;\n    }\n  }\n\n  _getUpdateStatusParams(userStatusParams) {\n    const params = {\n      dndStatus: this.dndStatus,\n      userStatus: userStatusParams,\n    };\n    if (\n      params.dndStatus !== dndStatus.takeAllCalls &&\n      params.dndStatus !== dndStatus.doNotAcceptDepartmentCalls\n    ) {\n      params.dndStatus = this.lastNotDisturbDndStatus || dndStatus.takeAllCalls;\n    }\n    return params;\n  }\n\n  async setAvailable() {\n    if (\n      this.userStatus === presenceStatus.available &&\n      this.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return;\n    }\n    const params = this._getUpdateStatusParams(presenceStatus.available);\n    await this._update(params);\n  }\n\n  async setBusy() {\n    if (\n      this.userStatus === presenceStatus.busy &&\n      this.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return;\n    }\n    const params = this._getUpdateStatusParams(presenceStatus.busy);\n    await this._update(params);\n  }\n\n  async setDoNotDisturb() {\n    if (this.dndStatus === dndStatus.doNotAcceptAnyCalls) {\n      return;\n    }\n    const params = {\n      dndStatus: dndStatus.doNotAcceptAnyCalls,\n      userStatus: presenceStatus.busy,\n    };\n    await this._update(params);\n  }\n\n  async setInvisible() {\n    if (\n      this.userStatus === presenceStatus.offline &&\n      this.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return;\n    }\n    const params = this._getUpdateStatusParams(presenceStatus.offline);\n    await this._update(params);\n  }\n\n  async setPresence(presenceData) {\n    switch (presenceData) {\n      case presenceStatus.available:\n        await this.setAvailable();\n        break;\n      case presenceStatus.busy:\n        await this.setBusy();\n        break;\n      case dndStatus.doNotAcceptAnyCalls:\n        await this.setDoNotDisturb();\n        break;\n      case presenceStatus.offline:\n        await this.setInvisible();\n        break;\n      default:\n        await this.setAvailable();\n        break;\n    }\n  }\n\n  async toggleAcceptCallQueueCalls() {\n    const params = {\n      userStatus: this.userStatus,\n    };\n    if (this.dndStatus === dndStatus.takeAllCalls) {\n      params.dndStatus = dndStatus.doNotAcceptDepartmentCalls;\n    } else if (this.dndStatus === dndStatus.doNotAcceptDepartmentCalls) {\n      params.dndStatus = dndStatus.takeAllCalls;\n    }\n    if (params.dndStatus) {\n      await this._update(params);\n    }\n  }\n\n  /**\n   * @override\n   * @description make sure data returns object so that the property getters\n   *  will not fail.\n   * @returns {Object}\n   */\n  get data() {\n    return super.data || {};\n  }\n\n  get sequence() {\n    return this.data.sequence;\n  }\n\n  @selector\n  activeCalls = [() => this.data.activeCalls, (calls) => calls || []];\n\n  @selector\n  calls = [\n    () => this.activeCalls,\n    (activeCalls) =>\n      removeInboundRingOutLegs(activeCalls).filter((call) => !isEnded(call)),\n  ];\n\n  @selector\n  sessionIdList = [\n    () => this.calls,\n    (calls) => calls.map((call) => call.sessionId),\n  ];\n\n  get telephonyStatus() {\n    return this.data.telephonyStatus;\n  }\n\n  get dndStatus() {\n    return this.data.dndStatus;\n  }\n\n  get lastNotDisturbDndStatus() {\n    return this.data.lastNotDisturbDndStatus;\n  }\n\n  get userStatus() {\n    return this.data.userStatus;\n  }\n\n  get presenceStatus() {\n    return this.data.presenceStatus;\n  }\n\n  get meetingStatus() {\n    return this.data.meetingStatus;\n  }\n\n  get presenceOption() {\n    // available\n    if (\n      this.data.userStatus === presenceStatus.available &&\n      this.data.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return presenceStatus.available;\n    }\n\n    // busy\n    if (\n      this.data.userStatus === presenceStatus.busy &&\n      this.data.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return presenceStatus.busy;\n    }\n\n    // doNotDisturb\n    if (this.data.dndStatus === dndStatus.doNotAcceptAnyCalls) {\n      return dndStatus.doNotAcceptAnyCalls;\n    }\n\n    // invisible\n    if (\n      this.data.userStatus === presenceStatus.offline &&\n      this.data.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return presenceStatus.offline;\n    }\n\n    return presenceStatus.available;\n  }\n\n  get _hasPermission() {\n    return this._rolesAndPermissions.hasPresencePermission;\n  }\n}\n"],"file":"index.js"}