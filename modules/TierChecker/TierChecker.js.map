{"version":3,"file":"TierChecker.js","names":["_core","require","_permissionsMessages","_di","_Auth","_dec","_class","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","undefined","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","_toPropertyKey","_createClass","protoProps","staticProps","_toPrimitive","_typeof","String","input","hint","prim","toPrimitive","res","Number","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","TierChecker","Module","deps","dep","optional","_RcModuleV","_super","onInitOnce","_this","watch","ready","_deps","auth","loginStatus","loggedIn","enforceCRMFeature","isCRMEnabled","_ref2","regeneratorRuntime","mark","_callee","_ref","_ref3","wrap","_callee$","_context","prev","logout","alert","danger","message","permissionsMessages","invalidTier","ttl","stop","multiple","get","_this$_deps$tierCheck","_this$_deps$tierCheck2","tierCheckerOptions","crmFeature","_this$_deps$extension","_this$_deps$extension2","extensionFeatures","features","available","_this$_deps$tierCheck3","_this$_deps$tierCheck4","RcModuleV2","exports"],"sources":["modules/TierChecker/TierChecker.ts"],"sourcesContent":["import { RcModuleV2, watch } from '@ringcentral-integration/core';\n\nimport { permissionsMessages } from '../../enums/permissionsMessages';\nimport { Module } from '../../lib/di';\nimport { loginStatus } from '../Auth';\nimport type { Deps } from './TierChecker.interface';\n\n@Module({\n  name: 'TierChecker',\n  deps: [\n    'Auth',\n    'Alert',\n    'ExtensionFeatures',\n    { dep: 'TierCheckerOptions', optional: true },\n  ],\n})\nexport class TierChecker extends RcModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n\n  get crmFeature() {\n    return this._deps.tierCheckerOptions?.crmFeature ?? 'SalesForce';\n  }\n\n  get isCRMEnabled() {\n    return !!this._deps.extensionFeatures.features?.[this.crmFeature]\n      ?.available;\n  }\n\n  get enforceCRMFeature() {\n    return this._deps.tierCheckerOptions?.enforceCRMFeature ?? true;\n  }\n\n  override onInitOnce() {\n    watch(\n      this,\n      () => [\n        this.ready,\n        this._deps.auth.loginStatus === loginStatus.loggedIn,\n        this.enforceCRMFeature,\n        this.isCRMEnabled,\n      ],\n      async ([ready, loggedIn, enforceCRMFeature, isCRMEnabled]) => {\n        if (ready && loggedIn && enforceCRMFeature && !isCRMEnabled) {\n          await this._deps.auth.logout();\n          this._deps.alert.danger({\n            message: permissionsMessages.invalidTier,\n            ttl: 0,\n          });\n        }\n      },\n      {\n        multiple: true,\n      },\n    );\n  }\n}\n"],"mappings":"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"}