{"version":3,"file":"TierChecker.js","names":["_core","require","_permissionsMessages","_di","_Auth","_dec","_class","_slicedToArray","r","e","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","asyncGeneratorStep","c","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_classCallCheck","_defineProperties","enumerable","configurable","writable","defineProperty","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","toPrimitive","String","Number","_inherits","create","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","TierChecker","Module","deps","dep","optional","_RcModuleV","_super","onInitOnce","_this","watch","ready","_deps","auth","loginStatus","loggedIn","enforceCRMFeature","isCRMEnabled","_ref2","regeneratorRuntime","mark","_callee","_ref","_ref3","wrap","_callee$","_context","prev","logout","alert","danger","message","permissionsMessages","invalidTier","ttl","stop","_x","multiple","get","_this$_deps$tierCheck","_this$_deps$tierCheck2","tierCheckerOptions","crmFeature","_this$_deps$extension","_this$_deps$extension2","extensionFeatures","features","available","_this$_deps$tierCheck3","_this$_deps$tierCheck4","RcModuleV2","exports"],"sources":["modules/TierChecker/TierChecker.ts"],"sourcesContent":["import { RcModuleV2, watch } from '@ringcentral-integration/core';\n\nimport { permissionsMessages } from '../../enums/permissionsMessages';\nimport { Module } from '../../lib/di';\nimport { loginStatus } from '../Auth';\n\nimport type { Deps } from './TierChecker.interface';\n\n@Module({\n  name: 'TierChecker',\n  deps: [\n    'Auth',\n    'Alert',\n    'ExtensionFeatures',\n    { dep: 'TierCheckerOptions', optional: true },\n  ],\n})\nexport class TierChecker extends RcModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n\n  get crmFeature() {\n    return this._deps.tierCheckerOptions?.crmFeature ?? 'SalesForce';\n  }\n\n  get isCRMEnabled() {\n    return !!this._deps.extensionFeatures.features?.[this.crmFeature]\n      ?.available;\n  }\n\n  get enforceCRMFeature() {\n    return this._deps.tierCheckerOptions?.enforceCRMFeature ?? true;\n  }\n\n  override onInitOnce() {\n    watch(\n      this,\n      () => [\n        this.ready,\n        this._deps.auth.loginStatus === loginStatus.loggedIn,\n        this.enforceCRMFeature,\n        this.isCRMEnabled,\n      ],\n      async ([ready, loggedIn, enforceCRMFeature, isCRMEnabled]) => {\n        if (ready && loggedIn && enforceCRMFeature && !isCRMEnabled) {\n          await this._deps.auth.logout();\n          this._deps.alert.danger({\n            message: permissionsMessages.invalidTier,\n            ttl: 0,\n          });\n        }\n      },\n      {\n        multiple: true,\n      },\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}