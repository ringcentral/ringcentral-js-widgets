{"version":3,"sources":["modules/TierChecker/TierChecker.ts"],"names":["TierChecker","name","deps","dep","optional","ready","_deps","auth","loginStatus","loggedIn","enforceCRMFeature","isCRMEnabled","logout","alert","danger","message","permissionsMessages","invalidTier","ttl","multiple","tierCheckerOptions","crmFeature","extensionFeatures","features","available","RcModuleV2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAYaA,W,WATZ,gBAAO;AACNC,EAAAA,IAAI,EAAE,aADA;AAENC,EAAAA,IAAI,EAAE,CACJ,MADI,EAEJ,OAFI,EAGJ,mBAHI,EAIJ;AAAEC,IAAAA,GAAG,EAAE,oBAAP;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GAJI;AAFA,CAAP,C;;;;;AAUC,uBAAYF,IAAZ,EAAwB;AAAA;;AAAA,6BAChB;AACJA,MAAAA,IAAI,EAAJA;AADI,KADgB;AAIvB;;;;iCAeY;AAAA;;AACX,uBACE,IADF,EAEE;AAAA,eAAM,CACJ,KAAI,CAACG,KADD,EAEJ,KAAI,CAACC,KAAL,CAAWC,IAAX,CAAgBC,WAAhB,KAAgCA,yBAAYC,QAFxC,EAGJ,KAAI,CAACC,iBAHD,EAIJ,KAAI,CAACC,YAJD,CAAN;AAAA,OAFF;AAAA,4EAQE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mDAAQN,KAAR,aAAeI,QAAf,aAAyBC,iBAAzB,aAA4CC,YAA5C;;AAAA,wBACMN,KAAK,IAAII,QAAT,IAAqBC,iBAArB,IAA0C,CAACC,YADjD;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAEU,KAAI,CAACL,KAAL,CAAWC,IAAX,CAAgBK,MAAhB,EAFV;;AAAA;AAGI,kBAAA,KAAI,CAACN,KAAL,CAAWO,KAAX,CAAiBC,MAAjB,CAAwB;AACtBC,oBAAAA,OAAO,EAAEC,yCAAoBC,WADP;AAEtBC,oBAAAA,GAAG,EAAE;AAFiB,mBAAxB;;AAHJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SARF;;AAAA;AAAA;AAAA;AAAA,WAiBE;AACEC,QAAAA,QAAQ,EAAE;AADZ,OAjBF;AAqBD;;;wBAnCgB;AAAA;;AACf,gEAAO,KAAKb,KAAL,CAAWc,kBAAlB,2DAAO,uBAA+BC,UAAtC,yEAAoD,YAApD;AACD;;;wBAEkB;AAAA;;AACjB,aAAO,CAAC,2BAAC,KAAKf,KAAL,CAAWgB,iBAAX,CAA6BC,QAA9B,oFAAC,sBAAwC,KAAKF,UAA7C,CAAD,2DAAC,uBACLG,SADI,CAAR;AAED;;;wBAEuB;AAAA;;AACtB,iEAAO,KAAKlB,KAAL,CAAWc,kBAAlB,2DAAO,uBAA+BV,iBAAtC,2EAA2D,IAA3D;AACD;;;;EAlB8Be,gB","sourcesContent":["import { RcModuleV2, watch } from '@ringcentral-integration/core';\n\nimport { permissionsMessages } from '../../enums/permissionsMessages';\nimport { Module } from '../../lib/di';\nimport { loginStatus } from '../AuthV2/loginStatus';\nimport { Deps } from './TierChecker.interface';\n\n@Module({\n  name: 'TierChecker',\n  deps: [\n    'Auth',\n    'Alert',\n    'ExtensionFeatures',\n    { dep: 'TierCheckerOptions', optional: true },\n  ],\n})\nexport class TierChecker extends RcModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n\n  get crmFeature() {\n    return this._deps.tierCheckerOptions?.crmFeature ?? 'SalesForce';\n  }\n\n  get isCRMEnabled() {\n    return !!this._deps.extensionFeatures.features?.[this.crmFeature]\n      ?.available;\n  }\n\n  get enforceCRMFeature() {\n    return this._deps.tierCheckerOptions?.enforceCRMFeature ?? true;\n  }\n\n  onInitOnce() {\n    watch(\n      this,\n      () => [\n        this.ready,\n        this._deps.auth.loginStatus === loginStatus.loggedIn,\n        this.enforceCRMFeature,\n        this.isCRMEnabled,\n      ],\n      async ([ready, loggedIn, enforceCRMFeature, isCRMEnabled]) => {\n        if (ready && loggedIn && enforceCRMFeature && !isCRMEnabled) {\n          await this._deps.auth.logout();\n          this._deps.alert.danger({\n            message: permissionsMessages.invalidTier,\n            ttl: 0,\n          });\n        }\n      },\n      {\n        multiple: true,\n      },\n    );\n  }\n}\n"],"file":"TierChecker.js"}