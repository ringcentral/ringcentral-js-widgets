{"version":3,"file":"Environment.js","names":["_core","require","_sdk","_di","_proxify","_enabledDataTrackingTimestamp","_dec","_class","_class2","_descriptor","_descriptor2","_descriptor3","_descriptor4","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","asyncGeneratorStep","n","a","c","i","u","done","Promise","resolve","then","_asyncToGenerator","_next","_throw","_initializerDefineProperty","l","initializer","call","_classCallCheck","TypeError","_defineProperties","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","slice","reverse","reduce","_initializerWarningHelper","Error","DEFAULT_RECORDING_HOST","TWO_HOURS_IN_MILLISECONDS","Environment","Module","name","deps","dep","optional","_RcModuleV","_super","_this","enableGlobalCache","storageKey","recordingHostState","_defaultRecordingHost","onInit","enabled","changeEnvironment","setEnvData","_ref","server","recordingHost","allowDataTracking","localStorageDataTrackingTimestamp","set","Date","now","updateChangeCounter","changeCounter","_changeEnvironment","regeneratorRuntime","mark","_callee","sdkConfig","discovery","_discovery$removeExte","_discovery$removeInit","wrap","_callee$","_context","prev","next","getSdkConfig","enableDiscovery","_deps","client","service","platform","removeExternalData","removeInitialData","SDK","removeSDKNonISO8859Chars","discoveryAutoInit","initDiscovery","stop","newConfig","discoveryServer","_setData","_callee2","_ref2","_ref2$allowDataTracki","_ref2$environmentChan","environmentChanged","isEnvChanged","_callee2$","_context2","setData","_x","get","useDataTrackingSetting","timestamp","enabledDataTrackingTimestamp","isWithinTwoHours","process","env","NODE_ENV","BUILD_ENVIRONMENT","includes","_this$_deps$environme","_this$_deps$environme2","environmentOptions","defaultRecordingHost","RcModuleV2","globalStorage","state","sandbox","action","proxify","exports"],"sources":["modules/Environment/Environment.ts"],"sourcesContent":["import {\n  action,\n  globalStorage,\n  RcModuleV2,\n  removeSDKNonISO8859Chars,\n  state,\n} from '@ringcentral-integration/core';\nimport { SDK } from '@ringcentral/sdk';\n\nimport type { SDKConfig } from '../../lib/createSdkConfig';\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\n\nimport type { Deps, SetDataOptions } from './Environment.interface';\nimport { localStorageDataTrackingTimestamp } from './enabledDataTrackingTimestamp';\n\nconst DEFAULT_RECORDING_HOST =\n  'https://apps.ringcentral.com/integrations/recording/v3.0/rc/index.html';\nconst TWO_HOURS_IN_MILLISECONDS = 2 * 60 * 60 * 1000;\n\n@Module({\n  name: 'Environment',\n  deps: [\n    'Client',\n    'GlobalStorage',\n    'SdkConfig',\n    { dep: 'EnvironmentOptions', optional: true },\n  ],\n})\nexport class Environment extends RcModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableGlobalCache: true,\n      storageKey: 'environment',\n    });\n    this.recordingHostState = this._defaultRecordingHost;\n  }\n\n  override onInit() {\n    if (this.enabled) {\n      this.changeEnvironment();\n    }\n  }\n\n  @globalStorage\n  @state\n  server: SDKConfig['server'] = SDK.server.sandbox;\n\n  @globalStorage\n  @state\n  recordingHostState: string | null = null;\n\n  get enabledDataTrackingTimestamp() {\n    return localStorageDataTrackingTimestamp.get();\n  }\n\n  @globalStorage\n  @state\n  enabled = false;\n\n  @state\n  changeCounter = 0;\n\n  @action\n  setEnvData({\n    server,\n    recordingHost,\n    enabled,\n    allowDataTracking,\n  }: SetDataOptions) {\n    this.server = server;\n    this.recordingHostState = recordingHost;\n    this.enabled = enabled;\n    localStorageDataTrackingTimestamp.set(\n      allowDataTracking ? Date.now() : null,\n    );\n  }\n\n  @action\n  updateChangeCounter() {\n    this.changeCounter++;\n  }\n\n  protected async changeEnvironment() {\n    const sdkConfig = this.getSdkConfig();\n    if (sdkConfig.enableDiscovery) {\n      // Clear discovery data before switching to new env\n      const discovery = this._deps.client.service.platform().discovery();\n      if (discovery) {\n        await discovery.removeExternalData?.();\n        await discovery.removeInitialData?.();\n      }\n    }\n    this._deps.client.service = new SDK(removeSDKNonISO8859Chars(sdkConfig));\n    if (sdkConfig.enableDiscovery && sdkConfig.discoveryAutoInit === false) {\n      // make sure to init discovery API if discoveryAutoInit is deliberately set to false\n      this._deps.client.service.platform().initDiscovery();\n    }\n  }\n\n  getSdkConfig() {\n    const newConfig = {\n      ...this._deps.sdkConfig,\n    };\n    if (this.enabled) {\n      newConfig.server = this.server;\n      newConfig.discoveryServer = this.server;\n    }\n    return newConfig;\n  }\n\n  @proxify\n  async setData({\n    server,\n    recordingHost,\n    enabled,\n    allowDataTracking = false,\n    environmentChanged = false,\n  }: SetDataOptions) {\n    // `recordingHost` change no need to set to SDK\n    const isEnvChanged =\n      environmentChanged ||\n      this.enabled !== enabled ||\n      (enabled && this.server !== server);\n\n    this.setEnvData({\n      server,\n      recordingHost,\n      enabled,\n      allowDataTracking,\n    });\n\n    if (isEnvChanged) {\n      // apply changes\n      await this.changeEnvironment();\n      // notify change at last\n      this.updateChangeCounter();\n    }\n  }\n\n  get recordingHost() {\n    return this.enabled ? this.recordingHostState : this._defaultRecordingHost;\n  }\n\n  get allowDataTracking() {\n    if (!this.useDataTrackingSetting) return true;\n\n    const timestamp = this.enabledDataTrackingTimestamp;\n    if (!timestamp) return false;\n\n    const isWithinTwoHours = Date.now() - timestamp < TWO_HOURS_IN_MILLISECONDS;\n\n    if (!isWithinTwoHours) {\n      // clear data tracking setting if it's expired for prevent get Date.now() anymore\n      localStorageDataTrackingTimestamp.set(null);\n    }\n\n    return isWithinTwoHours;\n  }\n\n  /**\n   * when that be true, the data tracking will not auto be tracked, will base on `allowDataTracking` setting to decide whether to track data\n   */\n  get useDataTrackingSetting() {\n    return Boolean(\n      // in production mode, use data tracking setting to avoid data tracking in those test environment\n      ((process.env.NODE_ENV === 'production' ||\n        // also in test mode same as production to able to test that\n        process.env.NODE_ENV === 'test') &&\n        process.env.BUILD_ENVIRONMENT &&\n        ['dev', 'local', 'reg'].includes(process.env.BUILD_ENVIRONMENT)) ||\n        // in development mode always use data tracking setting, to avoid data tracking in dev mode\n        process.env.NODE_ENV === 'development',\n    );\n  }\n\n  protected get _defaultRecordingHost() {\n    return (\n      this._deps.environmentOptions?.defaultRecordingHost ??\n      DEFAULT_RECORDING_HOST\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}