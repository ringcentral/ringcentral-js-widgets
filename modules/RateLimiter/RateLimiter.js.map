{"version":3,"file":"RateLimiter.js","names":["_core","require","_di","_proxify","_errorMessages","_dec","_class","_class2","_descriptor","_descriptor2","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","l","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","TypeError","_defineProperties","length","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","DEFAULT_THROTTLE_DURATION","RateLimiter","Module","name","deps","dep","optional","_RcModuleV","_super","_this$_deps$rateLimit","_this$_deps$rateLimit2","_this","enableGlobalCache","storageKey","_timeoutId","_unbindHandlers","_throttleDuration","_beforeRequestHandler","throttling","errorMessages","rateLimitReached","_checkTimestamp","stopThrottle","_requestErrorHandler","error","message","response","retryAfter","headers","get","parseInt","wasThrottling","startThrottle","Date","now","showAlert","clearTimeout","setTimeout","_deps","rateLimiterOptions","throttleDuration","timestamp","onInitOnce","_this2","environment","watch","changeCounter","ready","_bindHandlers","onInit","_showAlert","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","alert","_suppressAlerts","abrupt","warning","ttl","allowDuplicates","rateLimitAlertId","sent","stop","_this3","client","service","on","events","requestError","beforeRequest","removeListener","_this$_deps$rateLimit3","_this$_deps$rateLimit4","suppressAlerts","RcModuleV2","globalStorage","state","action","getOwnPropertyDescriptor","proxify","exports"],"sources":["modules/RateLimiter/RateLimiter.ts"],"sourcesContent":["import {\n  action,\n  globalStorage,\n  RcModuleV2,\n  state,\n  watch,\n} from '@ringcentral-integration/core';\nimport type { ApiError } from '@ringcentral/sdk';\n\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\n\nimport type { Deps } from './RateLimiter.interface';\nimport { errorMessages } from './errorMessages';\n\nconst DEFAULT_THROTTLE_DURATION = 61 * 1000;\n\n@Module({\n  name: 'RateLimiter',\n  deps: [\n    'Alert',\n    'Client',\n    'GlobalStorage',\n    { dep: 'Environment', optional: true },\n    { dep: 'RateLimiterOptions', optional: true },\n  ],\n})\nexport class RateLimiter extends RcModuleV2<Deps> {\n  // @ts-expect-error TS(2322): Type 'null' is not assignable to type 'Timeout'.\n  protected _timeoutId: NodeJS.Timeout = null;\n  protected _unbindHandlers?: () => void;\n  protected _throttleDuration: number = DEFAULT_THROTTLE_DURATION;\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableGlobalCache: true,\n      storageKey: 'RateLimiter',\n    });\n    this._throttleDuration =\n      this._deps.rateLimiterOptions?.throttleDuration ??\n      DEFAULT_THROTTLE_DURATION;\n  }\n\n  get _suppressAlerts() {\n    return this._deps.rateLimiterOptions?.suppressAlerts ?? false;\n  }\n\n  @globalStorage\n  @state\n  // @ts-expect-error TS(2322): Type 'null' is not assignable to type 'number'.\n  timestamp: number = null;\n\n  @globalStorage\n  @state\n  // @ts-expect-error TS(2322): Type 'null' is not assignable to type 'string'.\n  rateLimitAlertId: string = null;\n\n  @action\n  startThrottle(timestamp: number) {\n    this.timestamp = timestamp;\n  }\n\n  @action\n  stopThrottle() {\n    // @ts-expect-error TS(2322): Type 'null' is not assignable to type 'number'.\n    this.timestamp = null;\n  }\n\n  override onInitOnce() {\n    if (this._deps.environment) {\n      watch(\n        this,\n        // @ts-expect-error TS(2532): Object is possibly 'undefined'.\n        () => this._deps.environment.changeCounter,\n        () => {\n          if (this.ready) {\n            this._bindHandlers();\n          }\n        },\n      );\n    }\n  }\n\n  override onInit() {\n    this._bindHandlers();\n  }\n\n  /**\n   * If the app is throttling, an incoming request will lead to an exception\n   */\n  _beforeRequestHandler = () => {\n    if (this.throttling) {\n      throw new Error(errorMessages.rateLimitReached);\n    }\n  };\n\n  _checkTimestamp = () => {\n    // @ts-expect-error TS(2322): Type 'null' is not assignable to type 'Timeout'.\n    this._timeoutId = null;\n    if (!this.throttling) {\n      this.stopThrottle();\n    }\n  };\n\n  @proxify\n  async showAlert() {\n    if (!this.throttling || !this._deps.alert || this._suppressAlerts) {\n      return;\n    }\n\n    this.rateLimitAlertId = await this._deps.alert.warning({\n      message: errorMessages.rateLimitReached,\n      ttl: this.ttl,\n      allowDuplicates: false,\n    });\n  }\n\n  _requestErrorHandler = (error: ApiError) => {\n    if (\n      !(error instanceof Error) ||\n      error.message !== 'Request rate exceeded'\n    ) {\n      return;\n    }\n\n    // Get `retry-after` from response headers first\n    this._throttleDuration = DEFAULT_THROTTLE_DURATION;\n    if (error.response) {\n      const retryAfter = error.response.headers.get('retry-after');\n      if (retryAfter) {\n        this._throttleDuration = 1000 * Number.parseInt(retryAfter, 10);\n      }\n    }\n\n    const wasThrottling = this.throttling;\n    this.startThrottle(Date.now());\n    if (!wasThrottling) {\n      this.showAlert();\n    }\n    clearTimeout(this._timeoutId);\n    this._timeoutId = setTimeout(this._checkTimestamp, this._throttleDuration);\n  };\n\n  _bindHandlers() {\n    if (this._unbindHandlers) {\n      this._unbindHandlers();\n    }\n    const client = this._deps.client.service.client();\n    // TODO: Bind the `rateLimitError` event instead\n    client.on(client.events.requestError, this._requestErrorHandler);\n    client.on(client.events.beforeRequest, this._beforeRequestHandler);\n    this._unbindHandlers = () => {\n      client.removeListener(\n        client.events.requestError,\n        this._requestErrorHandler,\n      );\n      client.removeListener(\n        client.events.beforeRequest,\n        this._beforeRequestHandler,\n      );\n      // @ts-expect-error TS(2322): Type 'null' is not assignable to type '(() => void... Remove this comment to see the full error message\n      this._unbindHandlers = null;\n    };\n  }\n\n  get ttl() {\n    return this.throttling\n      ? this._throttleDuration - (Date.now() - this.timestamp)\n      : 0;\n  }\n\n  get throttleDuration() {\n    return this._throttleDuration;\n  }\n\n  /**\n   * Is in throttling status\n   */\n  get throttling() {\n    return Date.now() - this.timestamp <= this._throttleDuration;\n  }\n}\n"],"mappings":"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","ignoreList":[]}