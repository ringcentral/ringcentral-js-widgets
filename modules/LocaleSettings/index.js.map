{"version":3,"sources":["modules/LocaleSettings/index.js"],"names":["LocaleSettings","name","deps","dep","optional","globalStorage","locale","supportedLocales","options","_globalStorage","_locale","_supportedLocales","_storageKey","registerReducer","key","reducer","actionTypes","pending","ready","store","dispatch","type","init","savedLocale","saveLocale","currentLocale","setLocale","initSuccess","status","state","getItem","s","slice","sort"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;AAEA;;;;IAYqBA,c,WARpB,gBAAO;AACNC,QAAM,gBADA;AAENC,QAAM,CACJ,eADI,EAEJ,QAFI,EAGJ,EAAEC,KAAK,uBAAP,EAAgCC,UAAU,IAA1C,EAHI;AAFA,CAAP,C;;;AASC;;;;;AAKA,4BAKQ;AAAA,mFAAJ,EAAI;;AAAA,QAJNC,aAIM,QAJNA,aAIM;AAAA,QAHNC,MAGM,QAHNA,MAGM;AAAA,qCAFNC,gBAEM;AAAA,QAFNA,gBAEM,yCAFa,wBAAcA,gBAE3B;AAAA,QADHC,OACG;AAAA;;AAAA,iLAEDA,OAFC;;AAAA;;AAIN,UAAKC,cAAL,GAAsB,kCAAkBJ,aAAlB,EAAiC,eAAjC,CAAtB;AACA,UAAKK,OAAL,GAAe,kCAAkBJ,MAAlB,EAA0B,QAA1B,CAAf;AACA,UAAKK,iBAAL,GAAyBJ,gBAAzB;AACA,UAAKK,WAAL,GAAmB,oBAAnB;AACA,UAAKH,cAAL,CAAoBI,eAApB,CAAoC;AAClCC,WAAK,MAAKF,WADwB;AAElCG,eAAS,qCAAsB,MAAKC,WAA3B;AAFyB,KAApC;AARM;AAYP;;;;;;;;;;sBAiBG,KAAKC,OAAL,IACA,KAAKR,cAAL,CAAoBS,KADpB,IAEA,KAAKR,OAAL,CAAaQ,K;;;;;AAEb,qBAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKL,WAAL,CAAiBM;AADL,iBAApB;;oBAGK,KAAKC,W;;;;;AACR,qBAAKC,UAAL,CAAgB,KAAKd,OAAL,CAAae,aAA7B;;;;;sBACS,KAAKF,WAAL,KAAqB,KAAKb,OAAL,CAAae,a;;;;;;uBACrC,KAAKf,OAAL,CAAagB,SAAb,CAAuB,KAAKH,WAA5B,C;;;AAER,qBAAKJ,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKL,WAAL,CAAiBW;AADL,iBAApB;;;;;;;;;;;;;;;;;;;+FAqBarB,M;;;;;;uBACT,KAAKI,OAAL,CAAagB,SAAb,CAAuBpB,MAAvB,C;;;AACN,qBAAKa,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKL,WAAL,CAAiBQ,UADL;AAElBlB;AAFkB,iBAApB;;;;;;;;;;;;;;;;;;wBAlDiB;AACjB,aAAO,8DACF,gDADE,IAEL,YAFK,IAGJ,gBAHI,CAAP;AAID;;;wBAEa;AACZ,aAAO,4BAAgB;AACrBsB,gBAAQ,sCAAuB,KAAKZ,WAA5B;AADa,OAAhB,CAAP;AAGD;;;wBAsBY;AACX,aAAO,KAAKa,KAAL,CAAWD,MAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKnB,cAAL,CAAoBqB,OAApB,CAA4B,KAAKlB,WAAjC,CAAP;AACD;;;;;;;;WAGkB,8BACjB;AAAA,aAAM,OAAKD,iBAAX;AAAA,KADiB,EAEjB;AAAA,aAAKoB,EAAEC,KAAF,GAAUC,IAAV,EAAL;AAAA,KAFiB,C;;;kBAnEAjC,c","file":"index.js","sourcesContent":["import defaultConfig from 'locale-loader/defaultConfig';\r\nimport { createSelector } from 'reselect';\r\nimport { combineReducers } from 'redux';\r\nimport RcModule from '../../lib/RcModule';\r\nimport Enum from '../../lib/Enum';\r\nimport moduleActionTypes from '../../enums/moduleActionTypes';\r\nimport proxify from '../../lib/proxy/proxify';\r\nimport { Module } from '../../lib/di';\r\nimport ensureExist from '../../lib/ensureExist';\r\nimport getter from '../../lib/getter';\r\nimport getModuleStatusReducer from '../../lib/getModuleStatusReducer';\r\nimport {\r\n  getSavedLocaleReducer,\r\n} from './reducers';\r\n\r\n/* eslint-disable global-require */\r\n\r\n/**\r\n * @class\r\n * @description Locale managing module\r\n */\r\n@Module({\r\n  name: 'LocaleSettings',\r\n  deps: [\r\n    'GlobalStorage',\r\n    'Locale',\r\n    { dep: 'LocaleSettingsOptions', optional: true }\r\n  ]\r\n})\r\nexport default class LocaleSettings extends RcModule {\r\n  /**\r\n   * @constructor\r\n   * @param {Object} params - params object\r\n   * @param {String} params.defaultLocale - default 'en-US'\r\n   */\r\n  constructor({\r\n    globalStorage,\r\n    locale,\r\n    supportedLocales = defaultConfig.supportedLocales,\r\n    ...options\r\n  } = {}) {\r\n    super({\r\n      ...options,\r\n    });\r\n    this._globalStorage = this::ensureExist(globalStorage, 'globalStorage');\r\n    this._locale = this::ensureExist(locale, 'locale');\r\n    this._supportedLocales = supportedLocales;\r\n    this._storageKey = 'localeSettingsData';\r\n    this._globalStorage.registerReducer({\r\n      key: this._storageKey,\r\n      reducer: getSavedLocaleReducer(this.actionTypes),\r\n    });\r\n  }\r\n\r\n  get _actionTypes() {\r\n    return new Enum([\r\n      ...Object.keys(moduleActionTypes),\r\n      'saveLocale',\r\n    ], 'localeSettings');\r\n  }\r\n\r\n  get reducer() {\r\n    return combineReducers({\r\n      status: getModuleStatusReducer(this.actionTypes),\r\n    });\r\n  }\r\n\r\n  async _onStateChange() {\r\n    if (\r\n      this.pending &&\r\n      this._globalStorage.ready &&\r\n      this._locale.ready\r\n    ) {\r\n      this.store.dispatch({\r\n        type: this.actionTypes.init,\r\n      });\r\n      if (!this.savedLocale) {\r\n        this.saveLocale(this._locale.currentLocale);\r\n      } else if (this.savedLocale !== this._locale.currentLocale) {\r\n        await this._locale.setLocale(this.savedLocale);\r\n      }\r\n      this.store.dispatch({\r\n        type: this.actionTypes.initSuccess,\r\n      });\r\n    }\r\n  }\r\n\r\n  get status() {\r\n    return this.state.status;\r\n  }\r\n\r\n  get savedLocale() {\r\n    return this._globalStorage.getItem(this._storageKey);\r\n  }\r\n\r\n  @getter\r\n  supportedLocales = createSelector(\r\n    () => this._supportedLocales,\r\n    s => s.slice().sort(),\r\n  );\r\n\r\n  @proxify\r\n  async saveLocale(locale) {\r\n    await this._locale.setLocale(locale);\r\n    this.store.dispatch({\r\n      type: this.actionTypes.saveLocale,\r\n      locale,\r\n    });\r\n  }\r\n}\r\n"]}