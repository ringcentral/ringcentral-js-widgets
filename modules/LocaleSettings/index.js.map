{"version":3,"sources":["modules/LocaleSettings/index.ts"],"names":["LocaleSettings","name","deps","dep","optional","globalStorage","locale","supportedLocales","DEFAULT_LOCALE","options","_globalStorage","ensureExist","call","_locale","_supportedLocales","_storageKey","registerReducer","key","reducer","actionTypes","pending","ready","store","dispatch","type","init","savedLocale","saveLocale","currentLocale","setLocale","initSuccess","ObjectMap","prefixKeys","keys","moduleActionTypes","status","state","getItem","RcModule","selector","s","slice","sort","proxify"],"mappings":"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","sourcesContent":["import { combineReducers } from 'redux';\n\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\nimport { DEFAULT_LOCALE } from '@ringcentral-integration/i18n';\n\nimport { moduleActionTypes } from '../../enums/moduleActionTypes';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport getModuleStatusReducer from '../../lib/getModuleStatusReducer';\nimport proxify from '../../lib/proxy/proxify';\nimport RcModule from '../../lib/RcModule';\nimport { selector } from '../../lib/selector';\nimport { getSavedLocaleReducer } from './reducers';\n\n/* eslint-disable global-require */\n\n/**\n * @class\n * @description Locale managing module\n */\n@Module({\n  name: 'LocaleSettings',\n  deps: [\n    'GlobalStorage',\n    'Locale',\n    { dep: 'LocaleSettingsOptions', optional: true },\n  ],\n})\nexport default class LocaleSettings extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {String} params.defaultLocale - default 'en-US'\n   */\n  constructor({\n    globalStorage,\n    locale,\n    supportedLocales = [DEFAULT_LOCALE],\n    ...options\n  } = {}) {\n    super({\n      ...options,\n    });\n    this._globalStorage = ensureExist.call(\n      this,\n      globalStorage,\n      'globalStorage',\n    );\n    this._locale = ensureExist.call(this, locale, 'locale');\n    this._supportedLocales = supportedLocales;\n    this._storageKey = 'localeSettingsData';\n    this._globalStorage.registerReducer({\n      key: this._storageKey,\n      reducer: getSavedLocaleReducer(this.actionTypes),\n    });\n  }\n\n  get _actionTypes() {\n    return ObjectMap.prefixKeys(\n      [...ObjectMap.keys(moduleActionTypes), 'saveLocale'],\n      'localeSettings',\n    );\n  }\n\n  get reducer() {\n    return combineReducers({\n      status: getModuleStatusReducer(this.actionTypes),\n    });\n  }\n\n  async _onStateChange() {\n    if (this.pending && this._globalStorage.ready && this._locale.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      if (!this.savedLocale) {\n        this.saveLocale(this._locale.currentLocale);\n      } else if (this.savedLocale !== this._locale.currentLocale) {\n        await this._locale.setLocale(this.savedLocale);\n      }\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get savedLocale() {\n    return this._globalStorage.getItem(this._storageKey);\n  }\n\n  @selector\n  supportedLocales = [() => this._supportedLocales, (s) => s.slice().sort()];\n\n  @proxify\n  async saveLocale(locale) {\n    await this._locale.setLocale(locale);\n    this.store.dispatch({\n      type: this.actionTypes.saveLocale,\n      locale,\n    });\n  }\n}\n"],"file":"index.js"}