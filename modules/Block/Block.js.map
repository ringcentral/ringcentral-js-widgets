{"version":3,"file":"Block.js","names":["_di","require","_core","_uuid","_dec","_dec2","_class","_class2","_descriptor","_descriptor2","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","l","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","TypeError","_defineProperties","length","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","bind","__proto__","_createSuper","_isNativeReflectConstruct","_getPrototypeOf","s","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","Block","Module","name","deps","dep","optional","computed","that","blockIds","blockMapping","_RcModuleV","_super","_this","_len","args","Array","_key","concat","_setListItem","id","data","push","_removeListItem","filter","blockId","_clearAllItem","block","props","undefined","_getId","unblock","_next2","regeneratorRuntime","mark","_callee","cb","wrap","_callee$","_context","prev","next","finish","stop","_x","unblockAll","v4","get","_this2","map","RcModuleV2","state","getOwnPropertyDescriptor","action","exports"],"sources":["modules/Block/Block.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  computed,\n  RcModuleV2,\n  state,\n} from '@ringcentral-integration/core';\nimport { v4 } from 'uuid';\n\nimport type { BlockItem, DepsModules, IBlock } from './Block.interface';\n\ntype ModalMappingType = Record<string, BlockItem>;\n\n@Module({\n  name: 'Block',\n  deps: [{ dep: 'BlockOptions', optional: true }],\n})\nexport class Block extends RcModuleV2<DepsModules> implements IBlock {\n  @state\n  blockIds: string[] = [];\n\n  @state\n  blockMapping: ModalMappingType = {};\n\n  @computed((that: Block) => [that.blockIds, that.blockMapping])\n  get blocks() {\n    return this.blockIds.map((id) => this.blockMapping[id]);\n  }\n\n  @action\n  private _setListItem(id: string, data: BlockItem) {\n    this.blockIds.push(id);\n    this.blockMapping[id] = data;\n  }\n\n  @action\n  private _removeListItem(id: string) {\n    this.blockIds = this.blockIds.filter((blockId) => blockId !== id);\n    delete this.blockMapping[id];\n  }\n\n  @action\n  private _clearAllItem() {\n    this.blockIds.length = 0;\n    this.blockMapping = {};\n  }\n\n  /**\n   * block view with `SpinnerOverlay`\n   * @param props props for show in `SpinnerOverlay`\n   */\n  block(props: BlockItem = {}) {\n    const id = this._getId();\n\n    this._setListItem(id, props);\n\n    return id;\n  }\n\n  /**\n   * that will unblock one of pass id\n   * @param id for unblock id\n   */\n  unblock(id: string) {\n    this._removeListItem(id);\n  }\n\n  /**\n   * Show block and wait for call back method complete that block will auto close\n   * @param cb the method you want to wait for complete\n   */\n  async next(cb: Function) {\n    const id = this.block();\n    try {\n      await cb();\n    } finally {\n      this.unblock(id);\n    }\n  }\n\n  /**\n   * clear all block item, and unblock view\n   */\n  unblockAll() {\n    this._clearAllItem();\n  }\n\n  private _getId() {\n    return v4();\n  }\n}\n"],"mappings":"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","ignoreList":[]}