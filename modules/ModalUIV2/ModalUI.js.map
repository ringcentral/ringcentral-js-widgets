{"version":3,"sources":["modules/ModalUIV2/ModalUI.tsx"],"names":["ModalUI","name","deps","_modals","currentLocale","_deps","locale","_rendererRegister","Map","_handlerRegister","_promises","registerRenderer","defaultOKRendererID","defaultOKRenderer","defaultCancelRendererID","defaultCancelRenderer","infoTitleRendererID","infoTitleRenderer","modalState","push","idx","item","id","Error","handlerID","args","get","loading","useLoadingOverlay","loadingOverlay","onConfirm","_setLoading","handler","resolve","close","onExited","_removeModal","onCancel","set","renderer","props","handlerIDs","oldProps","key","Object","prototype","hasOwnProperty","call","findIndex","_removeHandler","splice","result","oldID","_registerHandler","_genericHandler","oldState","titleProps","contentProps","footerProps","slice","dehydratedState","_dehydrateFunctions","undefined","usePromise","autoDisableBackdropClick","disableBackdropClick","fullScreen","_getDehydratedState","open","_addModal","resolveFn","promise","Promise","updatedState","_updateModal","confirmButtonText","cancelButtonText","variant","modals","title","content","footer","rest","uiProps","_onConfirm","_onExited","_onCancel","renderedTitle","_rehydrateFunctions","TitleProps","disableTypography","display","space","children","RcUIModuleV2","state","action","proxify","background"],"mappings":"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","sourcesContent":["import {\n  action,\n  computed,\n  RcUIModuleV2,\n  state,\n} from '@ringcentral-integration/core';\nimport { filter, find, findIndex, map } from 'ramda';\nimport background from '@ringcentral-integration/commons/lib/background';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport proxify from '@ringcentral-integration/commons/lib/proxy/proxify';\nimport { v4 } from 'uuid';\n\nimport {\n  ModalProps,\n  ModalV2UIFunctions,\n  ModalV2UIProps,\n} from '../../components/ModalV2/interface';\nimport {\n  AlertModalOptions,\n  ConfirmModalOptions,\n  CustomRenderer,\n  CustomRendererProps,\n  DehydratedModalState,\n  Deps,\n  HandlerFunction,\n  InfoModalOptions,\n  ModalOptions,\n} from './ModalUI.interface';\nimport {\n  defaultCancelRenderer,\n  defaultCancelRendererID,\n  defaultOKRenderer,\n  defaultOKRendererID,\n  infoTitleRenderer,\n  infoTitleRendererID,\n} from './utils';\n\n@Module({\n  name: 'ModalUI',\n  deps: ['Locale'],\n})\nexport class ModalUI extends RcUIModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n    this.registerRenderer(defaultOKRendererID, defaultOKRenderer);\n    this.registerRenderer(defaultCancelRendererID, defaultCancelRenderer);\n    this.registerRenderer(infoTitleRendererID, infoTitleRenderer);\n  }\n\n  @state\n  private _modals: DehydratedModalState[] = [];\n\n  @action\n  private _addModal(modalState: DehydratedModalState) {\n    this._modals.push(modalState);\n  }\n\n  @action\n  private _updateModal(modalState: DehydratedModalState) {\n    const idx = findIndex((item) => item.id === modalState.id, this._modals);\n    if (idx === -1) {\n      throw new Error(`modal id \"${modalState.id} not found`);\n    }\n    this._modals[idx] = modalState;\n  }\n\n  @action\n  private _removeModal(id: string) {\n    this._modals = filter((item) => item.id !== id, this._modals);\n  }\n\n  private _rendererRegister = new Map<string, CustomRenderer<any>>();\n  private _handlerRegister = new Map<string, Map<string, HandlerFunction>>();\n  private _promises = new Map<\n    string,\n    { promise: Promise<boolean>; resolve: (ok: boolean) => void }\n  >();\n\n  @proxify\n  private async _genericHandler(id: string, handlerID: string, ...args: any) {\n    return this._handlerRegister.get(id)?.get(handlerID)?.(...args);\n  }\n\n  @action\n  private _setLoading(id: string, loading: boolean) {\n    const idx = findIndex((item) => item.id === id, this._modals);\n    if (this._modals[idx].useLoadingOverlay) {\n      this._modals[idx].loadingOverlay = loading;\n    } else {\n      this._modals[idx].loading = loading;\n    }\n  }\n\n  @proxify\n  private async _onConfirm(id: string, onConfirm?: string) {\n    // here we assume the handler is async and set the loading status\n    // detecting whether the handler is async or not is unreliable and can be dangerous\n    // for most non-async functions the loading status will occur too briefly\n    // so that the UI will not really render the loading status at all\n    this._setLoading(id, true);\n    const handler = this._handlerRegister.get(id).get(onConfirm);\n\n    if (handler) {\n      // even though we add extra error handling here, handlers are expected to handle all its errors\n      // this is only a best-effort attempt to not let a modal block usage if the handler threw error\n      try {\n        if ((await handler()) === false) {\n          this._setLoading(id, false);\n          return;\n        }\n      } catch (err) {\n        // if handler has unhandled error, at least remove the loading state so the modal could\n        // still be closed by the user if cancel button is provided.\n        this._setLoading(id, false);\n        throw err;\n      }\n    }\n\n    this._promises.get(id).resolve(true);\n    this._promises.delete(id);\n    this.close(id);\n  }\n\n  @proxify\n  private async _onExited(id: string, onExited?: string) {\n    this._promises.get(id)?.resolve(false);\n    this._handlerRegister.get(id).get(onExited)?.();\n    this._promises.delete(id);\n    this._removeModal(id);\n    this._handlerRegister.delete(id);\n  }\n\n  @proxify\n  private async _onCancel(id: string, onCancel?: string) {\n    this._handlerRegister.get(id).get(onCancel)?.();\n    this.close(id);\n  }\n\n  private _registerHandler(id: string, handler: HandlerFunction) {\n    const handlerID = v4();\n    this._handlerRegister.get(id).set(handlerID, handler);\n    return handlerID;\n  }\n\n  private _removeHandler(id: string, handlerID: string) {\n    this._handlerRegister.get(id).delete(handlerID);\n  }\n\n  /**\n   * register render method for custom render if you want\n   *\n   * @example\n   *\n   * ```tsx\n   * const defaultOKRenderer: CustomRenderer = ({ currentLocale }) =>\n   *  <span>{i18n.getString('ok', currentLocale)}</span>\n   * ```\n   */\n  registerRenderer<T extends CustomRendererProps = CustomRendererProps>(\n    id: string,\n    renderer: CustomRenderer<T>,\n  ) {\n    this._rendererRegister.set(id, renderer);\n  }\n\n  private _dehydrateFunctions(\n    id: string,\n    props: any,\n    handlerIDs: string[],\n    oldProps?: any,\n  ): any {\n    if (props === null) {\n      // check oldProps for existing handlers and remove them\n      if (oldProps) {\n        for (const key in oldProps) {\n          if (Object.prototype.hasOwnProperty.call(oldProps, key)) {\n            const idx = handlerIDs.findIndex((id) => id === oldProps[key]);\n            if (idx > -1) {\n              this._removeHandler(id, oldProps[key]);\n              handlerIDs.splice(idx, 1);\n            }\n          }\n        }\n      }\n      return null;\n    }\n    const result = { ...oldProps, ...props };\n    for (const key in props) {\n      if (Object.prototype.hasOwnProperty.call(props, key)) {\n        if (typeof props[key] === 'function') {\n          // check if old handler exist\n          const oldID =\n            oldProps &&\n            oldProps[key] &&\n            find((id) => id === oldProps[key], handlerIDs);\n          if (oldID) {\n            // replace oldHandler\n            this._handlerRegister.get(id).set(oldID, props[key]);\n          } else {\n            const handlerID = this._registerHandler(id, props[key]);\n            handlerIDs.push(handlerID);\n            result[key] = handlerID;\n          }\n        } else if (\n          oldProps &&\n          Object.prototype.hasOwnProperty.call(oldProps, key)\n        ) {\n          const idx = handlerIDs.findIndex((id) => id === oldProps[key]);\n          if (idx > -1) {\n            this._removeHandler(id, oldProps[key]);\n            handlerIDs.splice(idx, 1);\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  private _rehydrateFunctions(id: string, props: any, handlerIDs: string[]) {\n    const result = { ...props };\n    for (const key in props) {\n      if (\n        Object.prototype.hasOwnProperty.call(props, key) &&\n        findIndex((id) => id === props[key], handlerIDs) > -1\n      ) {\n        result[key] = (...args: any) =>\n          this._genericHandler(id, props[key], ...args);\n      }\n    }\n    return result;\n  }\n\n  private _getDehydratedState(\n    {\n      titleProps,\n      contentProps,\n      footerProps,\n      ...props\n    }: Partial<ModalOptions> & {\n      id: string;\n      open?: boolean;\n    },\n    oldState?: DehydratedModalState,\n  ): DehydratedModalState {\n    const handlerIDs = oldState?.handlerIDs?.slice() ?? [];\n    const dehydratedState: DehydratedModalState = {\n      ...this._dehydrateFunctions(props.id, props, handlerIDs, oldState),\n      handlerIDs,\n    };\n\n    if (titleProps !== undefined) {\n      dehydratedState.titleProps = this._dehydrateFunctions(\n        props.id,\n        titleProps,\n        handlerIDs,\n        oldState?.titleProps,\n      );\n    }\n\n    if (contentProps !== undefined) {\n      dehydratedState.contentProps = this._dehydrateFunctions(\n        props.id,\n        contentProps,\n        handlerIDs,\n        oldState?.contentProps,\n      );\n    }\n\n    if (footerProps !== undefined) {\n      dehydratedState.footerProps = this._dehydrateFunctions(\n        props.id,\n        footerProps,\n        handlerIDs,\n        oldState?.footerProps,\n      );\n    }\n\n    return dehydratedState;\n  }\n\n  public open(props: ModalOptions): string;\n  public open(props: ModalOptions, usePromise: true): Promise<boolean>;\n  @background\n  open(\n    {\n      autoDisableBackdropClick = true,\n      disableBackdropClick = true,\n      fullScreen = false,\n      ...props\n    }: ModalOptions,\n    usePromise?: boolean,\n  ) {\n    const id = v4();\n    this._handlerRegister.set(id, new Map<string, HandlerFunction>());\n    const dehydratedState = this._getDehydratedState({\n      ...props,\n      id,\n      autoDisableBackdropClick,\n      disableBackdropClick,\n      fullScreen,\n      open: true,\n    });\n\n    this._addModal(dehydratedState);\n\n    let resolveFn;\n\n    const promise = new Promise<boolean>((resolve) => {\n      resolveFn = resolve;\n    });\n\n    this._promises.set(id, {\n      promise,\n      resolve: resolveFn,\n    });\n\n    return usePromise ? promise : id;\n  }\n\n  /**\n   *\n   * @returns Whether the update is successful.\n   */\n  @background\n  update(props: Partial<ModalOptions> & { id: string }) {\n    const oldState = find((item) => item.id === props.id, this._modals);\n    if (!oldState) {\n      return false;\n    }\n    const updatedState = this._getDehydratedState(props, oldState);\n    this._updateModal(updatedState);\n    return true;\n  }\n\n  @background\n  close(id: string) {\n    const dehydratedState = find((item) => item.id === id, this._modals);\n    if (!dehydratedState) {\n      return false;\n    }\n    const updatedState = {\n      ...dehydratedState,\n      open: false,\n    };\n    this._updateModal(updatedState);\n    return true;\n  }\n\n  public confirm(props: ConfirmModalOptions): string;\n  public confirm(\n    props: ConfirmModalOptions,\n    usePromise: true,\n  ): Promise<boolean>;\n  @background\n  confirm(props: ConfirmModalOptions = {}, usePromise?: true) {\n    return this.open(\n      {\n        confirmButtonText: defaultOKRendererID,\n        cancelButtonText: defaultCancelRendererID,\n        ...props,\n        variant: 'confirm',\n      },\n      usePromise,\n    ) as any;\n  }\n\n  public alert(props: AlertModalOptions): string;\n  public alert(props: AlertModalOptions, usePromise: true): Promise<boolean>;\n  @background\n  alert(props: AlertModalOptions = {}, usePromise?: true) {\n    return this.open(\n      {\n        confirmButtonText: defaultOKRendererID,\n        ...props,\n        variant: 'alert',\n      },\n      usePromise,\n    ) as any;\n  }\n\n  public info(props: InfoModalOptions): string;\n  public info(props: InfoModalOptions, usePromise: true): Promise<boolean>;\n  @background\n  info(props: InfoModalOptions, usePromise?: true) {\n    return this.open(\n      {\n        ...props,\n        variant: 'info',\n      },\n      usePromise,\n    ) as any;\n  }\n\n  @computed(({ _modals, _deps: { locale: { currentLocale } } }: ModalUI) => [\n    _modals,\n    currentLocale,\n  ])\n  get modals() {\n    const currentLocale = this._deps.locale.currentLocale;\n    return map(\n      ({\n        id,\n        onConfirm,\n        onCancel,\n        onExited,\n        title,\n        content,\n        footer,\n        confirmButtonText,\n        cancelButtonText,\n        titleProps = {},\n        contentProps = {},\n        footerProps = {},\n        variant,\n        handlerIDs,\n        autoDisableBackdropClick,\n        disableBackdropClick,\n        loading,\n        loadingOverlay,\n        // * just pick this field out of rest\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        useLoadingOverlay,\n        ...rest\n      }) => {\n        const uiProps: ModalProps = {\n          ...rest,\n          key: id,\n          loading,\n          loadingOverlay,\n          disableBackdropClick:\n            (autoDisableBackdropClick && (loading || loadingOverlay)) ||\n            disableBackdropClick,\n          onConfirm: () => this._onConfirm(id, onConfirm),\n          onExited: () => this._onExited(id, onExited),\n        };\n\n        if (onCancel || cancelButtonText) {\n          uiProps.onCancel = () => this._onCancel(id, onCancel);\n        }\n\n        const renderedTitle =\n          this._rendererRegister.get(title)?.({\n            currentLocale,\n            ...this._rehydrateFunctions(id, titleProps, handlerIDs),\n            onConfirm: uiProps.onConfirm,\n            onCancel: uiProps.onCancel,\n          }) ?? title;\n\n        if (variant === 'info') {\n          uiProps.title = this._rendererRegister.get(infoTitleRendererID)({\n            title: renderedTitle,\n            onConfirm: uiProps.onConfirm,\n            currentLocale,\n          });\n          uiProps.TitleProps = {\n            disableTypography: true,\n            display: 'flex',\n            space: [0, 6],\n          };\n        } else {\n          uiProps.title = renderedTitle;\n        }\n\n        uiProps.children =\n          this._rendererRegister.get(content)?.({\n            currentLocale,\n            ...this._rehydrateFunctions(id, contentProps, handlerIDs),\n            onConfirm: uiProps.onConfirm,\n            onCancel: uiProps.onCancel,\n          }) ?? content;\n\n        uiProps.footer =\n          variant === 'info'\n            ? null\n            : this._rendererRegister.get(footer)?.({\n                currentLocale,\n                ...this._rehydrateFunctions(id, footerProps, handlerIDs),\n                onConfirm: uiProps.onConfirm,\n                onCancel: uiProps.onCancel,\n              }) ?? footer;\n\n        uiProps.confirmButtonText =\n          (this._rendererRegister.get(confirmButtonText)?.({\n            currentLocale,\n            onConfirm: uiProps.onConfirm,\n            onCancel: uiProps.onCancel,\n          }) as string) ?? confirmButtonText;\n\n        uiProps.cancelButtonText =\n          (this._rendererRegister.get(cancelButtonText)?.({\n            currentLocale,\n            onConfirm: uiProps.onConfirm,\n            onCancel: uiProps.onCancel,\n          }) as string) ?? cancelButtonText;\n\n        return uiProps;\n      },\n      this._modals,\n    );\n  }\n\n  @background\n  getPromise(id: string) {\n    return this._promises.get(id).promise;\n  }\n\n  getUIFunctions(): ModalV2UIFunctions {\n    return {};\n  }\n\n  getUIProps(): ModalV2UIProps {\n    return {\n      modals: this.modals,\n    };\n  }\n}\n"],"file":"ModalUI.js"}