{"version":3,"sources":["modules/RcPhone/index.js"],"names":["RcPhone","providers","provide","useValue","prefix","spread","useFactory","clientOptions","config","clearCacheOnRefreshError","cachePrefix","deps","dep","optional","id","name","fullName","checkConnectionFunc","fetch","logFunction","readyCheckFunction","appKey","appName","appVersion","extensionMode","addressBook","accountContacts","sdkConfig","moduleOptions","modules","router","webphone","contactSearch","contacts","callMonitor","contactMatcher","addSearchProvider","searchFn","queries","matchContacts","phoneNumbers","readyCheckFn","ready","addSearchSource","sourceName","searchString","items","companyContacts","searchText","toLowerCase","filter","item","firstName","lastName","indexOf","extensionNumber","find","x","phoneNumber","formatFn","entities","map","entity","toString","type","hasProfileImage","phoneType","entityType","personalContacts"],"mappings":"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","file":"index.js","sourcesContent":["import 'whatwg-fetch';\nimport SDK from 'ringcentral';\nimport RingCentralClient from 'ringcentral-client';\n\nimport { ModuleFactory } from '../../lib/di';\nimport RcModule from '../../lib/RcModule';\n\nimport AccountContacts from '../AccountContacts';\nimport AccountExtension from '../AccountExtension';\nimport AccountInfo from '../AccountInfo';\nimport AccountPhoneNumber from '../AccountPhoneNumber';\nimport ActivityMatcher from '../ActivityMatcher';\nimport AddressBook from '../AddressBook';\nimport Alert from '../Alert';\nimport Auth from '../Auth';\nimport BlockedNumber from '../BlockedNumber';\nimport Brand from '../Brand';\nimport Call from '../Call';\nimport CallHistory from '../CallHistory';\nimport CallingSettings from '../CallingSettings';\nimport CallLog from '../CallLog';\nimport CallLogger from '../CallLogger';\nimport CallMonitor from '../CallMonitor';\nimport ComposeText from '../ComposeText';\nimport Conference from '../Conference';\nimport ConnectivityMonitor from '../ConnectivityMonitor';\nimport ContactMatcher from '../ContactMatcher';\nimport Contacts from '../Contacts';\nimport ContactDetails from '../ContactDetails';\nimport ContactSearch from '../ContactSearch';\nimport Conversation from '../Conversation';\nimport ConversationLogger from '../ConversationLogger';\nimport ConversationMatcher from '../ConversationMatcher';\nimport DateTimeFormat from '../DateTimeFormat';\nimport Presence from '../Presence';\nimport DetailedPresence from '../DetailedPresence';\nimport DialingPlan from '../DialingPlan';\nimport Environment from '../Environment';\nimport ExtensionDevice from '../ExtensionDevice';\nimport ExtensionInfo from '../ExtensionInfo';\nimport ExtensionPhoneNumber from '../ExtensionPhoneNumber';\nimport ForwardingNumber from '../ForwardingNumber';\nimport GlobalStorage from '../GlobalStorage';\nimport Locale from '../Locale';\nimport Messages from '../Messages';\nimport MessageSender from '../MessageSender';\nimport MessageStore from '../MessageStore';\nimport NumberValidate from '../NumberValidate';\nimport RateLimiter from '../RateLimiter';\nimport RegionSettings from '../RegionSettings';\nimport Ringout from '../Ringout';\nimport RolesAndPermissions from '../RolesAndPermissions';\nimport Softphone from '../Softphone';\nimport Storage from '../Storage';\nimport Subscription from '../Subscription';\nimport TabManager from '../TabManager';\nimport Webphone from '../Webphone';\nimport RecentMessages from '../RecentMessages';\nimport RecentCalls from '../RecentCalls';\nimport Analytics from '../Analytics';\nimport AudioSettings from '../AudioSettings';\nimport Meeting from '../Meeting';\nimport GlipCompany from '../GlipCompany';\nimport GlipPersons from '../GlipPersons';\nimport GlipPosts from '../GlipPosts';\nimport GlipGroups from '../GlipGroups';\n\n@ModuleFactory({\n  providers: [\n    AudioSettings,\n    Alert,\n    Brand,\n    Locale,\n    TabManager,\n    GlobalStorage,\n    Environment,\n    ConnectivityMonitor,\n    Auth,\n    Storage,\n    RateLimiter,\n    ExtensionDevice,\n    Softphone,\n    Ringout,\n    AccountInfo,\n    ExtensionInfo,\n    RolesAndPermissions,\n    DialingPlan,\n    ExtensionPhoneNumber,\n    ForwardingNumber,\n    BlockedNumber,\n    ContactMatcher,\n    Subscription,\n    RegionSettings,\n    AccountExtension,\n    NumberValidate,\n    Webphone,\n    CallingSettings,\n    Presence,\n    DetailedPresence,\n    CallLog,\n    Call,\n    MessageSender,\n    ComposeText,\n    CallMonitor,\n    CallHistory,\n    ActivityMatcher,\n    ConversationMatcher,\n    ContactSearch,\n    MessageStore,\n    Conversation,\n    DateTimeFormat,\n    Conference,\n    CallLogger,\n    AccountPhoneNumber,\n    AddressBook,\n    AccountContacts,\n    Contacts,\n    ContactDetails,\n    ConversationLogger,\n    Messages,\n    RecentMessages,\n    RecentCalls,\n    Analytics,\n    Meeting,\n    GlipCompany,\n    GlipPersons,\n    GlipPosts,\n    GlipGroups,\n    {\n      provide: 'ModuleOptions',\n      useValue: { prefix: 'rc-phone' },\n      spread: true\n    },\n    {\n      provide: 'Client',\n      useFactory: ({ clientOptions, config }) =>\n        new RingCentralClient(new SDK({\n          clearCacheOnRefreshError: false,\n          cachePrefix: 'rc-sdk',\n          ...config,\n          ...clientOptions,\n        })),\n      deps: [{ dep: 'Config' }, { dep: 'ClientOptions', optional: true }]\n    },\n    {\n      provide: 'BrandOptions',\n      spread: true,\n      useValue: { id: '1210', name: 'RingCentral', fullName: 'RingCentral' }\n    },\n    {\n      provide: 'ConnectivityMonitorOptions',\n      useValue: { checkConnectionFunc: async () => { await fetch('//pubsub.pubnub.com/time/0'); } },\n      spread: true\n    },\n    {\n      provide: 'CallLoggerOptions',\n      useValue: {\n        logFunction: async () => { },\n        readyCheckFunction: () => true\n      },\n      spread: true\n    },\n    {\n      provide: 'WebphoneOptions',\n      spread: true,\n      useValue: { appKey: null, appName: null, appVersion: null }\n    },\n    {\n      provide: 'ConversationLoggerOptions',\n      useValue: {\n        logFunction: async () => { },\n        readyCheckFunction: () => true\n      },\n      spread: true\n    },\n    { provide: 'SoftphoneOptions', useValue: { extensionMode: null }, spread: true },\n    {\n      provide: 'ContactSources',\n      useFactory: ({ addressBook, accountContacts }) =>\n        [addressBook, accountContacts],\n      deps: ['AccountContacts', 'AddressBook']\n    },\n    {\n      provide: 'EnvironmentOptions',\n      useFactory: ({ clientOptions, config }) => ({\n        sdkConfig: {\n          cachePrefix: 'rc-sdk',\n          clearCacheOnRefreshError: false,\n          ...config,\n          ...clientOptions,\n        },\n      }),\n      deps: [{ dep: 'Config' }, { dep: 'ClientOptions', optional: true }]\n    },\n  ]\n})\nexport default class RcPhone extends RcModule {\n  constructor({ moduleOptions, ...modules }) {\n    super({ prefix: moduleOptions.prefix, ...modules });\n    const {\n      router,\n      webphone,\n      contactSearch,\n      contacts,\n      callMonitor,\n      contactMatcher,\n    } = modules;\n\n    // Webphone configuration\n    // webphone._onCallEndFunc = (session) => {\n    //   if (router.currentPath !== '/calls/active') {\n    //     return;\n    //   }\n    //   const currentSession = webphone.activeSession;\n    //   if (currentSession && session.id !== currentSession.id) {\n    //     return;\n    //   }\n    //   router.goBack();\n    // };\n    // webphone._onCallStartFunc = () => {\n    //   if (router.currentPath === '/calls/active') {\n    //     return;\n    //   }\n    //   router.push('/calls/active');\n    // };\n    // webphone._onCallRingFunc = () => {\n    //   if (\n    //     webphone.ringSessions.length > 1\n    //   ) {\n    //     if (router.currentPath !== '/calls') {\n    //       router.push('/calls');\n    //     }\n    //     webphone.ringSessions.forEach((session) => {\n    //       webphone.toggleMinimized(session.id);\n    //     });\n    //   }\n    // };\n\n    // ContactMatcher configuration\n    contactMatcher.addSearchProvider({\n      name: 'contacts',\n      searchFn: async ({ queries }) => this.contacts.matchContacts({ phoneNumbers: queries }),\n      readyCheckFn: () => this.contacts.ready,\n    });\n\n    // ContactSearch configuration\n    contactSearch.addSearchSource({\n      sourceName: 'companyContacts',\n      searchFn: ({ searchString }) => {\n        const items = contacts.companyContacts;\n        if (!searchString) {\n          return items;\n        }\n        const searchText = searchString.toLowerCase();\n        return items.filter((item) => {\n          const name = `${item.firstName} ${item.lastName}`;\n          if (\n            name.toLowerCase().indexOf(searchText) >= 0 ||\n            item.extensionNumber.indexOf(searchText) >= 0 ||\n            item.phoneNumbers.find(x => x.phoneNumber.indexOf(searchText) >= 0)\n          ) {\n            return true;\n          }\n          return false;\n        });\n      },\n      formatFn: entities => entities.map(entity => ({\n        id: entity.id.toString(),\n        type: entity.type,\n        name: `${entity.firstName} ${entity.lastName}`,\n        hasProfileImage: !!entity.hasProfileImage,\n        phoneNumbers: entity.phoneNumbers,\n        phoneNumber: entity.extensionNumber,\n        phoneType: 'extension',\n        entityType: 'companyContact',\n      })),\n      readyCheckFn: () => contacts.ready,\n    });\n    contactSearch.addSearchSource({\n      sourceName: 'personalContacts',\n      searchFn: ({ searchString }) => {\n        const items = contacts.personalContacts;\n        if (!searchString) {\n          return items;\n        }\n        const searchText = searchString.toLowerCase();\n        return items.filter((item) => {\n          const name = `${item.firstName} ${item.lastName}`;\n          if (\n            name.toLowerCase().indexOf(searchText) >= 0 ||\n            item.phoneNumbers.find(x => x.phoneNumber.indexOf(searchText) >= 0)\n          ) {\n            return true;\n          }\n          return false;\n        });\n      },\n      formatFn: entities => entities.map(entity => ({\n        id: entity.id.toString(),\n        type: entity.type,\n        name: `${entity.firstName} ${entity.lastName}`,\n        hasProfileImage: false,\n        phoneNumbers: entity.phoneNumbers,\n        phoneNumber: entity.phoneNumbers[0] && entity.phoneNumbers[0].phoneNumber,\n        phoneType: entity.phoneNumbers[0] && entity.phoneNumbers[0].phoneType,\n        entityType: 'personalContact',\n      })),\n      readyCheckFn: () => contacts.ready,\n    });\n\n    // CallMonitor configuration\n    // callMonitor._onRinging = async () => {\n    //   if (this.webphone._webphone) {\n    //     return;\n    //   }\n    //   // TODO refactor some of these logic into appropriate modules\n    //   this.router.push('/calls');\n    // };\n  }\n\n  get _actionTypes() {\n    return null;\n  }\n}\n"]}