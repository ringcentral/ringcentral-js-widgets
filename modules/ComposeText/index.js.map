{"version":3,"sources":["modules/ComposeText/index.js"],"names":["ComposeText","deps","dep","optional","alert","auth","storage","messageSender","numberValidate","contactSearch","rolesAndPermissions","conversations","routerInteraction","options","actionTypes","composeTextActionTypes","_alert","_auth","_storage","_rolesAndPermissions","_storageKey","_reducer","_cacheReducer","_messageSender","_numberValidate","_contactSearch","_routerInteraction","_lastContactSearchResult","senderNumbersList","registerReducer","key","reducer","store","subscribe","_onStateChange","_shouldInit","dispatch","type","initSuccess","isFreshLogin","clean","_initSenderNumber","_shouldHandleRecipient","_handleRecipient","_shouldReset","_resetModuleStatus","ready","length","searchResult","resetSuccess","cachedPhoneNumber","cache","senderNumber","updateSenderNumber","phoneNumber","dummy","toNumbers","find","toNumber","entityType","recipient","item","id","addToNumber","slice","message","ttlConfig","messageSenderMessages","noAreaCode","ttl","warning","allowDuplicates","_validateIsOnlyPager","validateResult","validateFormat","result","error","errors","_alertWarning","recipientNumberInvalids","onlyPagerPermission","noSMSPermission","text","fromNumber","map","number","typingToNumber","_validatePhoneNumber","push","timeoutID","setTimeout","currentPath","alertMessageSending","send","responses","clearTimeout","dismissMessageSending","updateTypingToNumber","entityId","toNumberMatched","shouldClean","isAdded","cleanTypingToNumber","removeToNumber","textTooLong","updateMessageText","sending","alertMessage","messages","m","dismiss","getItem","state","status","moduleStatuses","toNumberEntity","messageText","RcModule","proxify"],"mappings":"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","sourcesContent":["import { Module } from '../../lib/di';\nimport RcModule from '../../lib/RcModule';\nimport isBlank from '../../lib/isBlank';\nimport moduleStatuses from '../../enums/moduleStatuses';\n\nimport composeTextActionTypes from './actionTypes';\nimport getComposeTextReducer from './getComposeTextReducer';\nimport getCacheReducer from './getCacheReducer';\n\nimport messageSenderMessages from '../MessageSender/messageSenderMessages';\nimport proxify from '../../lib/proxy/proxify';\n/**\n * @class\n * @description Compose text managing module\n */\n@Module({\n  deps: [\n    'Alert',\n    'Auth',\n    'Storage',\n    'MessageSender',\n    'NumberValidate',\n    'RolesAndPermissions',\n    // { dep: 'Conversations', optional: true },\n    { dep: 'RouterInteraction', optional: true },\n    { dep: 'ContactSearch', optional: true },\n    { dep: 'ComposeTextOptions', optional: true },\n  ],\n})\nexport default class ComposeText extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Alert} params.alert - alert module instance\n   * @param {Auth} params.auth - auth module instance\n   * @param {Storage} params.storage - storage module instance\n   * @param {MessageSender} params.messageSender - messageSender module instance\n   * @param {NumberValidate} params.numberValidate - numberValidate module instance\n   * @param {ContactSearch} params.contactSearch - contactSearch module instance\n   */\n  constructor({\n    alert,\n    auth,\n    storage,\n    messageSender,\n    numberValidate,\n    contactSearch,\n    rolesAndPermissions,\n    conversations,\n    routerInteraction,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: composeTextActionTypes,\n    });\n\n    this._alert = alert;\n    this._auth = auth;\n    this._storage = storage;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._storageKey = 'composeText';\n    this._reducer = getComposeTextReducer(this.actionTypes);\n    this._cacheReducer = getCacheReducer(this.actionTypes);\n    this._messageSender = messageSender;\n    this._numberValidate = numberValidate;\n    this._contactSearch = contactSearch;\n    // this._conversations = conversations;\n    this._routerInteraction = routerInteraction;\n    this._lastContactSearchResult = [];\n    this.senderNumbersList = [];\n    storage.registerReducer({\n      key: this._storageKey,\n      reducer: this._cacheReducer,\n    });\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.senderNumbersList = this._messageSender.senderNumbersList;\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n      if (this._auth.isFreshLogin) {\n        this.clean();\n      }\n      this._initSenderNumber();\n    } else if (this._shouldHandleRecipient()) {\n      this._handleRecipient();\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n    }\n    if (\n      this.ready &&\n      this._messageSender.senderNumbersList.length !==\n        this.senderNumbersList.length\n    ) {\n      this.senderNumbersList = this._messageSender.senderNumbersList;\n      this._initSenderNumber();\n    }\n  }\n\n  _shouldInit() {\n    return this._messageSender.ready && this._auth.ready && !this.ready;\n  }\n\n  _shouldReset() {\n    return !this._messageSender.ready && this.ready;\n  }\n\n  _shouldHandleRecipient() {\n    return (\n      this.ready &&\n      !!this._contactSearch &&\n      this._contactSearch.ready &&\n      this._contactSearch.searchResult.length > 0 &&\n      this._contactSearch.searchResult !== this._lastContactSearchResult\n    );\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  _initSenderNumber() {\n    const cachedPhoneNumber = this.cache && this.cache.senderNumber;\n    if (cachedPhoneNumber) {\n      this.updateSenderNumber(cachedPhoneNumber);\n    } else {\n      this.updateSenderNumber(\n        this._messageSender.senderNumbersList[0] &&\n          this._messageSender.senderNumbersList[0].phoneNumber,\n      );\n    }\n  }\n\n  _handleRecipient() {\n    const dummy = this.toNumbers.find((toNumber) => !toNumber.entityType);\n    if (dummy) {\n      const recipient = this._contactSearch.searchResult.find(\n        (item) => item.id === dummy.id,\n      );\n      if (recipient) {\n        this.addToNumber(recipient);\n        this._lastContactSearchResult = this._contactSearch.searchResult.slice();\n      }\n    }\n  }\n\n  _alertWarning(message) {\n    if (message) {\n      const ttlConfig =\n        message !== messageSenderMessages.noAreaCode ? { ttl: 0 } : null;\n      this._alert.warning({\n        message,\n        allowDuplicates: false,\n        ...ttlConfig,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  _validatePhoneNumber(phoneNumber) {\n    if (this._validateIsOnlyPager(phoneNumber)) {\n      return null;\n    }\n    const validateResult = this._numberValidate.validateFormat([phoneNumber]);\n    if (!validateResult.result) {\n      const error = validateResult.errors[0];\n      if (error && this._alertWarning(messageSenderMessages[error.type])) {\n        return false;\n      }\n      this._alertWarning(messageSenderMessages.recipientNumberInvalids);\n      return false;\n    }\n    return true;\n  }\n\n  @proxify\n  _validateIsOnlyPager(phoneNumber) {\n    if (\n      phoneNumber.length >= 7 &&\n      this._rolesAndPermissions.onlyPagerPermission\n    ) {\n      this._alertWarning(messageSenderMessages.noSMSPermission);\n      return true;\n    }\n    return false;\n  }\n\n  @proxify\n  validatePhoneNumber(phoneNumber) {\n    if (this._validateIsOnlyPager(phoneNumber)) {\n      return false;\n    }\n    const validateResult = this._numberValidate.validateFormat([phoneNumber]);\n    return !!validateResult.result;\n  }\n\n  @proxify\n  async send(text) {\n    const fromNumber = this.senderNumber;\n    const toNumbers = this.toNumbers.map((number) => number.phoneNumber);\n    const { typingToNumber } = this;\n    if (!isBlank(typingToNumber)) {\n      if (this._validatePhoneNumber(typingToNumber)) {\n        toNumbers.push(typingToNumber);\n      } else {\n        return null;\n      }\n    }\n    // this._conversations.addEntities(this.toNumbers);\n    let timeoutID = setTimeout(() => {\n      if (\n        this._routerInteraction &&\n        this._routerInteraction.currentPath === '/composeText'\n      ) {\n        this.alertMessageSending();\n      }\n      timeoutID = null;\n    }, 10000);\n\n    try {\n      const responses = await this._messageSender.send({\n        fromNumber,\n        toNumbers,\n        text,\n      });\n\n      if (timeoutID) {\n        clearTimeout(timeoutID);\n        timeoutID = null;\n      }\n      this.dismissMessageSending();\n      return responses;\n    } catch (err) {\n      if (timeoutID) {\n        clearTimeout(timeoutID);\n        timeoutID = null;\n      }\n      throw err;\n    }\n  }\n\n  @proxify\n  async updateSenderNumber(number) {\n    this.store.dispatch({\n      type: this.actionTypes.updateSenderNumber,\n      number: number || '',\n    });\n  }\n\n  @proxify\n  async updateTypingToNumber(number) {\n    if (number.length > 30) {\n      this._alertWarning(messageSenderMessages.recipientNumberInvalids);\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateTypingToNumber,\n      number,\n    });\n  }\n\n  @proxify\n  async onToNumberMatch({ entityId }) {\n    this.store.dispatch({\n      type: this.actionTypes.toNumberMatched,\n      entityId,\n    });\n  }\n\n  @proxify\n  async addToRecipients(recipient, shouldClean = true) {\n    const isAdded = await this.addToNumber(recipient);\n    if (isAdded && shouldClean) {\n      await this.cleanTypingToNumber();\n    }\n  }\n\n  @proxify\n  async cleanTypingToNumber() {\n    this.store.dispatch({\n      type: this.actionTypes.cleanTypingToNumber,\n    });\n  }\n\n  @proxify\n  async addToNumber(number) {\n    if (isBlank(number.phoneNumber)) {\n      return false;\n    }\n    if (!this._validatePhoneNumber(number.phoneNumber)) {\n      return false;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.addToNumber,\n      number,\n    });\n    return true;\n  }\n\n  @proxify\n  async removeToNumber(number) {\n    this.store.dispatch({\n      type: this.actionTypes.removeToNumber,\n      number,\n    });\n  }\n\n  @proxify\n  async updateMessageText(text) {\n    if (text.length > 1000) {\n      this._alertWarning(messageSenderMessages.textTooLong);\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateMessageText,\n      text,\n    });\n  }\n\n  @proxify\n  async clean() {\n    this.store.dispatch({\n      type: this.actionTypes.clean,\n    });\n  }\n\n  @proxify\n  async alertMessageSending() {\n    this._alert.warning({\n      message: messageSenderMessages.sending,\n      ttl: 0,\n    });\n  }\n\n  @proxify\n  async dismissMessageSending() {\n    const alertMessage = this._alert.messages.find(\n      (m) => m.message === messageSenderMessages.sending,\n    );\n    if (alertMessage && alertMessage.id) {\n      this._alert.dismiss(alertMessage.id);\n    }\n  }\n\n  get cache() {\n    return this._storage.getItem(this._storageKey);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get senderNumber() {\n    return this.state.senderNumber;\n  }\n\n  get typingToNumber() {\n    return this.state.typingToNumber;\n  }\n\n  get toNumbers() {\n    return this.state.toNumbers;\n  }\n\n  get toNumberEntity() {\n    return this.state.toNumberEntity;\n  }\n\n  get messageText() {\n    return this.state.messageText;\n  }\n}\n"],"file":"index.js"}