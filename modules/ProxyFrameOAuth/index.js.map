{"version":3,"sources":["modules/ProxyFrameOAuth/index.ts"],"names":["DEFAULT_PROXY_RETRY","ProxyFrameOAuth","name","deps","dep","optional","loginPath","redirectUri","proxyUri","defaultProxyRetry","client","routerInteraction","options","_callbackHandler","origin","data","callbackUri","proxyLoaded","_handleCallbackUri","clearTimeout","_retryTimeoutId","store","dispatch","type","actionTypes","setupOAuth","_createProxyFrame","_proxyFrame","document","createElement","src","style","display","isEdge","window","navigator","userAgent","indexOf","isIE","test","setAttribute","join","body","appendChild","addEventListener","setTimeout","_retrySetupProxyFrame","_defaultProxyRetry","_uuid","uuid","v4","_proxyUri","_client","_routerInteraction","_loginPath","_reducer","_loggedIn","ready","_auth","loggedIn","currentPath","oAuthReady","destroyOAuth","isImplicit","_createImplicitRefreshTimeout","_clearImplicitRefreshIframe","_implicitRefreshTimeoutId","refresh","proxyRetry","_destroyProxyFrame","removeChild","removeEventListener","setupProxy","service","platform","discovery","loginUrlWithDiscovery","contentWindow","postMessage","oAuthUri","_implicitRefreshFrame","implicitRefreshOAuthUri","_implicitRefreshCallBack","refreshCallbackUri","authData","token","refreshTokenExpiresIn","expiresIn","expireTime","refreshTokenTimeoutTime","parseInt","Date","now","_tabManager","active","_createImplicitRefreshIframe","url","resolve","location","href","encodeURIComponent","btoa","prefix","state","proxyRetryCount","OAuthBase","background","proxify"],"mappings":"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","sourcesContent":["import url from 'url';\nimport * as uuid from 'uuid';\n\nimport background from '@ringcentral-integration/commons/lib/background';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport ensureExist from '@ringcentral-integration/commons/lib/ensureExist';\nimport proxify from '@ringcentral-integration/commons/lib/proxy/proxify';\n\nimport OAuthBase from '../../lib/OAuthBase';\nimport { actionTypes } from './actionTypes';\nimport getProxyFrameOAuthReducer from './getProxyFrameOAuthReducer';\n\nconst DEFAULT_PROXY_RETRY = 5000;\n\n@Module({\n  name: 'OAuth',\n  deps: [\n    'Client',\n    'RouterInteraction',\n    { dep: 'OAuthOptions', optional: true },\n  ],\n})\nexport default class ProxyFrameOAuth extends OAuthBase {\n  constructor({\n    loginPath = '/',\n    redirectUri = './redirect.html',\n    proxyUri = './proxy.html',\n    defaultProxyRetry = DEFAULT_PROXY_RETRY,\n    client,\n    routerInteraction,\n    ...options\n  }) {\n    super({\n      redirectUri,\n      ...options,\n    });\n    this._uuid = uuid.v4();\n    this._proxyUri = ensureExist(proxyUri, 'proxyUri');\n    this._client = ensureExist(client, 'client');\n    this._routerInteraction = ensureExist(\n      routerInteraction,\n      'routerInteraction',\n    );\n    this._defaultProxyRetry = defaultProxyRetry;\n    this._loginPath = loginPath;\n\n    this._reducer = getProxyFrameOAuthReducer(this.actionTypes);\n\n    this._loggedIn = false;\n  }\n\n  _onStateChange() {\n    super._onStateChange();\n    if (\n      this.ready &&\n      !this._auth.loggedIn &&\n      this._routerInteraction.currentPath === this._loginPath &&\n      !this.oAuthReady &&\n      !this._proxyFrame\n    ) {\n      this.setupOAuth();\n    }\n    if (\n      this._proxyFrame &&\n      (this._auth.loggedIn ||\n        this._routerInteraction.currentPath !== this._loginPath)\n    ) {\n      this.destroyOAuth();\n    }\n    if (this._auth.loggedIn === this._loggedIn) {\n      return;\n    }\n    this._loggedIn = this._auth.loggedIn;\n    if (this._loggedIn && this._auth.isImplicit) {\n      this._createImplicitRefreshTimeout();\n    }\n    if (!this._loggedIn && this._auth.isImplicit) {\n      this._clearImplicitRefreshIframe();\n      if (this._implicitRefreshTimeoutId) {\n        clearTimeout(this._implicitRefreshTimeoutId);\n      }\n    }\n  }\n\n  async _handleCallbackUri(callbackUri, refresh) {\n    await super._handleCallbackUri(callbackUri, refresh);\n    if (this._auth.isImplicit && this._auth.loggedIn) {\n      this._createImplicitRefreshTimeout();\n    }\n  }\n\n  get name() {\n    return 'proxyFrameOAuth';\n  }\n\n  get _actionTypes() {\n    return actionTypes;\n  }\n\n  get proxyUri() {\n    return `${url.resolve(\n      window.location.href,\n      this._proxyUri,\n    )}?hash=${encodeURIComponent(btoa(this._uuid))}&prefix=${encodeURIComponent(\n      this.prefix,\n    )}`;\n  }\n\n  get proxyRetryCount() {\n    return this.state.proxyRetryCount;\n  }\n\n  _callbackHandler = async ({ origin, data }) => {\n    // TODO origin check\n    if (data) {\n      const { callbackUri, proxyLoaded } = data;\n      if (callbackUri) {\n        this._handleCallbackUri(callbackUri);\n      } else if (proxyLoaded) {\n        clearTimeout(this._retryTimeoutId);\n        this._retryTimeoutId = null;\n        this.store.dispatch({\n          type: this.actionTypes.setupOAuth,\n        });\n      }\n    }\n  };\n\n  _createProxyFrame = () => {\n    this._proxyFrame = document.createElement('iframe');\n    this._proxyFrame.src = this.proxyUri;\n    this._proxyFrame.style.display = 'none';\n    const isEdge =\n      window &&\n      window.navigator &&\n      window.navigator.userAgent.indexOf('Edge') > -1;\n    const isIE =\n      window &&\n      window.navigator &&\n      /MSIE|Trident/i.test(window.navigator.userAgent);\n    if (!isEdge && !isIE) {\n      this._proxyFrame.setAttribute(\n        'sandbox',\n        [\n          'allow-scripts',\n          'allow-popups',\n          'allow-same-origin',\n          'allow-forms',\n        ].join(' '),\n      );\n    }\n    document.body.appendChild(this._proxyFrame);\n    window.addEventListener('message', this._callbackHandler);\n    this._retryTimeoutId = setTimeout(() => {\n      this._retrySetupProxyFrame();\n    }, this._defaultProxyRetry);\n  };\n\n  _retrySetupProxyFrame() {\n    this._retryTimeoutId = null;\n    if (!this.oAuthReady) {\n      this.store.dispatch({\n        type: this.actionTypes.proxyRetry,\n      });\n      this._destroyProxyFrame();\n      this._createProxyFrame();\n    }\n  }\n\n  _destroyProxyFrame() {\n    document.body.removeChild(this._proxyFrame);\n    this._proxyFrame = null;\n    window.removeEventListener('message', this._callbackHandler);\n  }\n\n  @background\n  async setupOAuth() {\n    if (!this._proxyFrame) {\n      this._createProxyFrame();\n      this.store.dispatch({\n        type: this.actionTypes.setupProxy,\n      });\n    }\n  }\n\n  @background\n  async destroyOAuth() {\n    if (this._proxyFrame) {\n      if (this._retryTimeoutId) {\n        clearTimeout(this._retryTimeoutId);\n        this._retryTimeoutId = null;\n      }\n      this._destroyProxyFrame();\n      this.store.dispatch({\n        type: this.actionTypes.destroyOAuth,\n      });\n    }\n  }\n\n  @proxify\n  async openOAuthPage() {\n    if (this.oAuthReady) {\n      if (this._client.service.platform().discovery()) {\n        await this._client.service.platform().loginUrlWithDiscovery();\n      }\n      this._proxyFrame.contentWindow.postMessage(\n        {\n          oAuthUri: this.oAuthUri,\n        },\n        '*',\n      );\n    }\n  }\n\n  _createImplicitRefreshIframe() {\n    this._clearImplicitRefreshIframe();\n    this._implicitRefreshFrame = document.createElement('iframe');\n    this._implicitRefreshFrame.src = this.implicitRefreshOAuthUri;\n    this._implicitRefreshFrame.style.display = 'none';\n    document.body.appendChild(this._implicitRefreshFrame);\n    // eslint-disable-next-line\n    this._implicitRefreshCallBack = ({ origin, data }) => {\n      const { refreshCallbackUri } = data;\n      if (refreshCallbackUri && this._auth.loggedIn) {\n        this._handleCallbackUri(refreshCallbackUri, true);\n        this._clearImplicitRefreshIframe();\n      }\n    };\n    window.addEventListener('message', this._implicitRefreshCallBack);\n  }\n\n  _clearImplicitRefreshIframe() {\n    if (this._implicitRefreshFrame) {\n      document.body.removeChild(this._implicitRefreshFrame);\n      this._implicitRefreshFrame = null;\n      window.removeEventListener('message', this._implicitRefreshCallBack);\n      this._callbackHandler = null;\n    }\n  }\n\n  // create a time out to refresh implicit flow token\n  _createImplicitRefreshTimeout() {\n    if (this._implicitRefreshTimeoutId) {\n      clearTimeout(this._implicitRefreshTimeoutId);\n    }\n    const authData = this._auth.token;\n    const refreshTokenExpiresIn = authData.expiresIn;\n    const { expireTime } = authData;\n    if (!refreshTokenExpiresIn || !expireTime) {\n      return;\n    }\n    // set refresh time to (token exposre time) / 3\n    let refreshTokenTimeoutTime =\n      (parseInt(refreshTokenExpiresIn, 10) * 1000) / 3;\n    if (refreshTokenTimeoutTime + Date.now() > expireTime) {\n      refreshTokenTimeoutTime = expireTime - Date.now() - 5000;\n      if (refreshTokenTimeoutTime < 0) {\n        return;\n      }\n    }\n    this._implicitRefreshTimeoutId = setTimeout(() => {\n      if (!this._auth.loggedIn) {\n        return;\n      }\n      if (this._tabManager && !this._tabManager.active) {\n        this._createImplicitRefreshTimeout();\n        return;\n      }\n      this._createImplicitRefreshIframe();\n      this._implicitRefreshTimeoutId = null;\n    }, refreshTokenTimeoutTime);\n  }\n}\n"],"file":"index.js"}