{"version":3,"sources":["modules/EvSettings/EvSettings.ts"],"names":["EvSettings","name","deps","dep","optional","that","isOffhooking","isOffhook","enableCache","storageKey","_deps","evAgentSession","onTriggerConfig","presence","setOffhookTerm","setOffhooking","setIsManualOffhook","evClient","offhookTerm","offhookInit","loginType","isManualOffhook","RcModuleV2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeMA,U,WAXL,gBAAO;AACNC,EAAAA,IAAI,EAAE,YADA;AAENC,EAAAA,IAAI,EAAE,CACJ,UADI,EAEJ,QAFI,EAGJ,gBAHI,EAIJ,SAJI,EAKJ,UALI,EAMJ;AAAEC,IAAAA,GAAG,EAAE,mBAAP;AAA4BC,IAAAA,QAAQ,EAAE;AAAtC,GANI;AAFA,CAAP,C,UAoCE,oBAAS,UAACC,IAAD;AAAA,SAAsB,CAACA,IAAI,CAACC,YAAN,EAAoBD,IAAI,CAACE,SAAzB,CAAtB;AAAA,CAAT,C;;;;;AAxBD,sBAAYL,IAAZ,EAAwB;AAAA;;AAAA,6BAChB;AACJA,MAAAA,IAAI,EAAJA,IADI;AAEJM,MAAAA,WAAW,EAAE,IAFT;AAGJC,MAAAA,UAAU,EAAE;AAHR,KADgB;AAMvB;;;;iCA2BY;AAAA;;AACX,WAAKC,KAAL,CAAWC,cAAX,CAA0BC,eAA1B,uEAA0C;AAAA;AAAA;AAAA;AAAA;AACxC,gBAAA,KAAI,CAACF,KAAL,CAAWG,QAAX,CAAoBC,cAApB;;AADwC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA1C;AAGD;;;8BAES;AACR,WAAKJ,KAAL,CAAWG,QAAX,CAAoBE,aAApB,CAAkC,IAAlC;;AACA,UAAI,KAAKR,SAAT,EAAoB;AAClB,aAAKG,KAAL,CAAWG,QAAX,CAAoBG,kBAApB,CAAuC,KAAvC;;AACA,aAAKN,KAAL,CAAWO,QAAX,CAAoBC,WAApB;AACD,OAHD,MAGO;AACL,aAAKR,KAAL,CAAWG,QAAX,CAAoBG,kBAApB,CAAuC,IAAvC;;AACA,aAAKN,KAAL,CAAWO,QAAX,CAAoBE,WAApB;AACD;AACF;;;wBAxCe;AACd,aAAO,KAAKT,KAAL,CAAWC,cAAX,CAA0BS,SAAjC;AACD;;;wBAEe;AACd,aAAO,KAAKV,KAAL,CAAWG,QAAX,CAAoBN,SAA3B;AACD;;;wBAEkB;AACjB,aAAO,KAAKG,KAAL,CAAWG,QAAX,CAAoBP,YAA3B;AACD;;;wBAEqB;AACpB,aAAO,KAAKI,KAAL,CAAWG,QAAX,CAAoBQ,eAA3B;AACD;;;wBAGkB;AACjB,UAAI,KAAKf,YAAT,EAAuB;AACrB,eAAO,KAAKC,SAAL,GAAiB,eAAjB,GAAmC,YAA1C;AACD;;AAED,aAAO,KAAKA,SAAL,GAAiB,WAAjB,GAA+B,cAAtC;AACD;;;;EAhCsBe,gB","sourcesContent":["import { computed, RcModuleV2 } from '@ringcentral-integration/core';\nimport { Module } from 'ringcentral-integration/lib/di';\n\nimport { Deps, Settings } from './EvSettings.interface';\n\n@Module({\n  name: 'EvSettings',\n  deps: [\n    'EvClient',\n    'EvAuth',\n    'EvAgentSession',\n    'Storage',\n    'Presence',\n    { dep: 'EvSettingsOptions', optional: true },\n  ],\n})\nclass EvSettings extends RcModuleV2<Deps> implements Settings {\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvSettings',\n    });\n  }\n\n  get loginType() {\n    return this._deps.evAgentSession.loginType;\n  }\n\n  get isOffhook() {\n    return this._deps.presence.isOffhook;\n  }\n\n  get isOffhooking() {\n    return this._deps.presence.isOffhooking;\n  }\n\n  get isManualOffhook() {\n    return this._deps.presence.isManualOffhook;\n  }\n\n  @computed((that: EvSettings) => [that.isOffhooking, that.isOffhook])\n  get offhookState() {\n    if (this.isOffhooking) {\n      return this.isOffhook ? 'disconnecting' : 'connecting';\n    }\n\n    return this.isOffhook ? 'connected' : 'disconnected';\n  }\n\n  onInitOnce() {\n    this._deps.evAgentSession.onTriggerConfig(async () => {\n      this._deps.presence.setOffhookTerm();\n    });\n  }\n\n  offHook() {\n    this._deps.presence.setOffhooking(true);\n    if (this.isOffhook) {\n      this._deps.presence.setIsManualOffhook(false);\n      this._deps.evClient.offhookTerm();\n    } else {\n      this._deps.presence.setIsManualOffhook(true);\n      this._deps.evClient.offhookInit();\n    }\n  }\n}\n\nexport { EvSettings };\n"],"file":"EvSettings.js"}