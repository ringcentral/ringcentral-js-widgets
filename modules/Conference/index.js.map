{"version":3,"sources":["modules/Conference/index.js"],"names":["DEFAULT_MASK","Conference","deps","dep","optional","alert","client","regionSettings","storage","rolesAndPermissions","availabilityMonitor","showSaveAsDefault","extensionInfo","locale","options","fetchFunction","mask","_alert","_dialInNumberStorageKey","_additionalNumbersStorageKey","_savedStorageKey","_regionSettings","_rolesAndPermissions","_availabilityMonitor","_lastCountryCode","_showSaveAsDefault","_extensionInfo","_locale","_storage","registerReducer","key","reducer","actionTypes","updateDialInNumber","updateAdditionalNumbers","updateSaveCurrentSettings","data","ready","countryCode","matchedPhoneNumber","phoneNumbers","find","e","country","isoCode","phoneNumber","dialInNumber","allowJoinBeforeHost","_client","_store","dispatch","type","fetchSuccess","checkIfHAError","warning","message","callControlError","generalError","additionalNumbers","_saved","store","inviteWithText","joinAsHost","countryNames","console","log","dialInNumbers","currentLocale","areaCode","participantCode","extensionName","info","name","getItem","permissions","OrganizeConference","DataFetcher","proxify"],"mappings":"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","sourcesContent":["import mask from 'json-mask';\nimport { Module } from '../../lib/di';\nimport DataFetcher from '../../lib/DataFetcher';\nimport createSimpleReducer from '../../lib/createSimpleReducer';\nimport callControlError from '../ActiveCallControl/callControlError';\nimport actionTypes from './actionTypes';\nimport proxify from '../../lib/proxy/proxify';\nimport {\n  updateJoinBeforeHost,\n  getConferenceInfo,\n  formatDialInNumbers,\n} from './conferenceHelper';\n\nconst DEFAULT_MASK =\n  'phoneNumber,hostCode,participantCode,phoneNumbers(country(callingCode,id,isoCode,name),phoneNumber,location),allowJoinBeforeHost';\n\n/**\n * @class\n * @description Conference managing module\n */\n@Module({\n  deps: [\n    'Alert',\n    'Client',\n    'Storage',\n    'RegionSettings',\n    'RolesAndPermissions',\n    'ExtensionInfo',\n    'Locale',\n    { dep: 'AvailabilityMonitor', optional: true },\n    { dep: 'ConferenceOptions', optional: true },\n  ],\n})\nexport default class Conference extends DataFetcher {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {RegionSettings} params.regionSettings - regionSettings module instance\n   * @param {Client} params.client - client module instance\n   */\n  constructor({\n    alert,\n    client,\n    regionSettings,\n    storage,\n    rolesAndPermissions,\n    availabilityMonitor,\n    showSaveAsDefault,\n    extensionInfo,\n    locale,\n    ...options\n  }) {\n    super({\n      client,\n      fetchFunction: async () =>\n        mask(await getConferenceInfo(client), DEFAULT_MASK),\n      storage,\n      ...options,\n    });\n    this._alert = alert;\n    this._dialInNumberStorageKey = 'conferenceDialInNumber';\n    this._additionalNumbersStorageKey = 'conferenceAdditionalNumbers';\n    this._savedStorageKey = 'conferenceSaveCurrentSettings';\n    this._regionSettings = regionSettings;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._availabilityMonitor = availabilityMonitor;\n    this._lastCountryCode = null;\n    this._showSaveAsDefault = showSaveAsDefault;\n    this._extensionInfo = extensionInfo;\n    this._locale = locale;\n    this._storage.registerReducer({\n      key: this._dialInNumberStorageKey,\n      reducer: createSimpleReducer(\n        this.actionTypes.updateDialInNumber,\n        'dialInNumber',\n      ),\n    });\n    this._storage.registerReducer({\n      key: this._additionalNumbersStorageKey,\n      reducer: createSimpleReducer(\n        this.actionTypes.updateAdditionalNumbers,\n        'additionalNumbers',\n      ),\n    });\n    this._storage.registerReducer({\n      key: this._savedStorageKey,\n      reducer: createSimpleReducer(\n        this.actionTypes.updateSaveCurrentSettings,\n        '_saved',\n      ),\n    });\n  }\n\n  get _name() {\n    return 'conference';\n  }\n\n  get _actionTypes() {\n    return actionTypes;\n  }\n\n  async _onStateChange() {\n    super._onStateChange();\n    if (\n      !this.data ||\n      !this._regionSettings.ready ||\n      this._lastCountryCode === this._regionSettings.countryCode\n    ) {\n      return;\n    }\n    this._lastCountryCode = this._regionSettings.countryCode;\n    const matchedPhoneNumber = this.data.phoneNumbers.find(\n      (e) => e.country.isoCode === this._lastCountryCode,\n    );\n    if (\n      matchedPhoneNumber &&\n      matchedPhoneNumber.phoneNumber !== this.dialInNumber\n    ) {\n      this.updateDialInNumber(matchedPhoneNumber.phoneNumber);\n    }\n  }\n\n  _shouldInit() {\n    return (\n      super._shouldInit() &&\n      this._rolesAndPermissions.ready &&\n      this._alert.ready &&\n      (!this._availabilityMonitor || this._availabilityMonitor.ready) &&\n      this._extensionInfo.ready &&\n      this._locale.ready &&\n      this._regionSettings.ready\n    );\n  }\n\n  @proxify\n  async updateEnableJoinBeforeHost(allowJoinBeforeHost) {\n    try {\n      const data = await updateJoinBeforeHost(\n        this._client,\n        allowJoinBeforeHost,\n      );\n      this._store.dispatch({ type: this.actionTypes.fetchSuccess, data });\n      return data;\n    } catch (error) {\n      if (\n        !this._availabilityMonitor ||\n        !this._availabilityMonitor.checkIfHAError(error)\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n\n      return null;\n    }\n  }\n\n  @proxify\n  updateDialInNumber(dialInNumber) {\n    this._store.dispatch({\n      type: this.actionTypes.updateDialInNumber,\n      dialInNumber,\n    });\n  }\n\n  @proxify\n  updateAdditionalNumbers(additionalNumbers) {\n    this._store.dispatch({\n      type: this.actionTypes.updateAdditionalNumbers,\n      additionalNumbers,\n    });\n  }\n\n  @proxify\n  updateSaveCurrentSettings(_saved) {\n    this._store.dispatch({\n      type: this.actionTypes.updateSaveCurrentSettings,\n      _saved,\n    });\n  }\n\n  // for track invite with text\n  @proxify\n  onInviteWithText() {\n    this.store.dispatch({\n      type: this.actionTypes.inviteWithText,\n    });\n  }\n\n  // for track join as host\n  @proxify\n  onJoinAsHost() {\n    this.store.dispatch({\n      type: this.actionTypes.joinAsHost,\n    });\n  }\n\n  @proxify\n  getDefaultSettings(countryNames) {\n    if (!countryNames || typeof countryNames !== 'object') {\n      console.log('please privide the countryNames I18n object');\n      return;\n    }\n    const dialInNumbers = formatDialInNumbers({\n      currentLocale: this._locale.currentLocale,\n      areaCode: this._regionSettings.areaCode,\n      countryCode: this._regionSettings.countryCode,\n      phoneNumbers: this.data.phoneNumbers,\n      countryNames,\n    });\n    return {\n      dialInNumbers,\n      phoneNumber: this.data.phoneNumber,\n      dialInNumber: this.dialInNumber || '',\n      _saved: this._saved || false,\n      additionalNumbers: this.additionalNumbers,\n      allowJoinBeforeHost: this.data.allowJoinBeforeHost,\n      currentLocale: this._locale.currentLocale,\n      participantCode: this.data.participantCode,\n      extensionName: this._extensionInfo.info.name || '',\n    };\n  }\n\n  get additionalNumbers() {\n    return this._storage.getItem(this._additionalNumbersStorageKey) || [];\n  }\n\n  get _saved() {\n    return this._storage.getItem(this._savedStorageKey) || false;\n  }\n\n  get dialInNumber() {\n    return (\n      this._storage.getItem(this._dialInNumberStorageKey) ||\n      (this.data && this.data.phoneNumber)\n    );\n  }\n\n  get _hasPermission() {\n    return !!this._rolesAndPermissions.permissions.OrganizeConference;\n  }\n\n  get showSaveAsDefault() {\n    return this._showSaveAsDefault || false;\n  }\n}\n"],"file":"index.js"}