{"version":3,"file":"EvCallDataSource.js","names":["_di","require","_core","_dayjs","_interopRequireDefault","_events","_enums","_helper","_dec","_class","_class2","_descriptor","e","__esModule","_toConsumableArray","r","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","Symbol","iterator","isArray","length","n","ownKeys","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","_initializerDefineProperty","i","l","initializer","_classCallCheck","_defineProperties","key","_createClass","prototype","_toPrimitive","_typeof","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","_setPrototypeOf","_applyDecoratedDescriptor","reverse","reduce","_initializerWarningHelper","Error","EvCallDataSource","exports","Module","deps","dep","optional","_RcModuleV","_this","enableCache","storageKey","eventEmitter","EventEmitter","get","data","callIds","otherCallIds","callLogsIds","callsMapping","rawCallsMapping","_window$localStorage","window","localStorage","getItem","changeCallsLimited","_window$localStorage2","setItem","addNewCall","rawAgentRecording","agentRecording","pause","uii","timestamp","getTimeStamp","queueDts","gate","_getCurrentGateData","setNewSession","session","id","_deps","evClient","encodeUii","agentId","evAuth","index","indexOf","unshift","addNewSession","emit","callStatus","RINGING","dropSession","_getCallEncodeId","callId","removeEndedCall","endedCall","includes","callLogsIndex","JSON","parse","stringify","clearCalls","setCallHoldStatus","res","isHold","holdState","limitCalls","_this2","lastWeekDayTimestamp","_getLastWeekDayTimestamp","storageCallData","fullCallLogsIds","acc","curr","concat","substr","endsWith","currentGateId","queue","number","currentQueueGroup","availableRequeueQueues","find","_ref","gates","some","_ref2","gateId","gateGroupId","now","dayjs","lastWeekDay","clone","subtract","startOf","RcModuleV2","storage","state","action"],"sources":["modules/EvCallDataSource/EvCallDataSource.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport type { Mapping } from '@ringcentral-integration/widgets/typings';\nimport dayjs from 'dayjs';\nimport { EventEmitter } from 'events';\n\nimport { callStatus } from '../../enums';\nimport type {\n  EvCallData,\n  EvEvRequeueCallGate,\n} from '../../interfaces/EvData.interface';\nimport type {\n  EvAddSessionNotification,\n  EvBaseCall,\n  EvDropSessionNotification,\n  EvEndedCall,\n  EvHoldResponse,\n} from '../../lib/EvClient';\n\nimport type { CallDataSource, Deps } from './EvCallDataSource.interface';\nimport { getTimeStamp } from './helper';\n\n@Module({\n  name: 'EvCallDataSource',\n  deps: [\n    'EvAuth',\n    'EvClient',\n    'Storage',\n    'TabManager',\n    { dep: 'EvCallDataSourceOptions', optional: true },\n  ],\n})\nclass EvCallDataSource extends RcModuleV2<Deps> implements CallDataSource {\n  eventEmitter = new EventEmitter();\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvCallDataSource',\n    });\n  }\n\n  @storage\n  @state\n  data: {\n    callIds: string[];\n    otherCallIds: string[];\n    callLogsIds: string[];\n    callsMapping: Mapping<EvCallData>;\n    rawCallsMapping: Mapping<EvCallData>;\n  } = {\n    callIds: [],\n    otherCallIds: [],\n    callLogsIds: [],\n    callsMapping: {},\n    rawCallsMapping: {},\n  };\n\n  get callIds() {\n    return this.data.callIds;\n  }\n\n  get otherCallIds() {\n    return this.data.otherCallIds;\n  }\n\n  get callLogsIds() {\n    return this.data.callLogsIds;\n  }\n\n  get callsMapping() {\n    return this.data.callsMapping;\n  }\n\n  get rawCallsMapping() {\n    return this.data.rawCallsMapping;\n  }\n\n  get callsLimited() {\n    return window.localStorage?.getItem('callsLimited') === 'true';\n  }\n\n  changeCallsLimited(value: boolean) {\n    window.localStorage?.setItem('callsLimited', value?.toString());\n  }\n\n  @action\n  addNewCall(call: EvBaseCall) {\n    let rawAgentRecording = call?.agentRecording;\n    rawAgentRecording &&= {\n      ...rawAgentRecording,\n      pause: rawAgentRecording.pause ? Number(rawAgentRecording.pause) : null,\n    };\n    // note: rawCallsMapping index is raw call uii.\n    this.data.rawCallsMapping[call.uii] = {\n      ...call,\n      // input timezone in second arg if EV reponse has timezone propoty\n      // default timezone is 'America/New_York'\n      timestamp: getTimeStamp(call.queueDts),\n      gate: this._getCurrentGateData(call),\n      agentRecording: rawAgentRecording,\n    };\n  }\n\n  @action\n  setNewSession(session: EvAddSessionNotification) {\n    const id = this._deps.evClient.encodeUii(session);\n    if (session.agentId === this._deps.evAuth.agentId) {\n      // related to current agent session\n      const index = this.callIds.indexOf(id);\n      if (index === -1) {\n        this.data.callIds.unshift(id);\n      }\n    } else {\n      // other session without current agent\n      const index = this.otherCallIds.indexOf(id);\n      if (index === -1) {\n        this.data.otherCallIds.unshift(id);\n      }\n    }\n\n    this.data.callsMapping[id] = {\n      ...this.rawCallsMapping[session.uii],\n      session,\n    };\n  }\n\n  addNewSession(session: EvAddSessionNotification) {\n    this.setNewSession(session);\n    // check with other phone\n    if (session.agentId === '') {\n      // ringing\n      this.eventEmitter.emit(callStatus.RINGING, session);\n    }\n  }\n\n  @action\n  dropSession(dropSession: EvDropSessionNotification) {\n    const id = this._getCallEncodeId(dropSession);\n    this.data.otherCallIds = this.otherCallIds.filter(\n      (callId) => callId !== id,\n    );\n  }\n\n  @action\n  removeEndedCall(endedCall: EvEndedCall) {\n    const id = this._getCallEncodeId(endedCall);\n    // remove current agent session call with uii.\n    this.data.callIds = this.callIds.filter((callId) => callId !== id);\n    // remove other call session with uii.\n    this.data.otherCallIds = this.otherCallIds.filter(\n      (callId) => !callId.includes(endedCall.uii),\n    );\n\n    // add call with id (encodeUii({ uii, sessionId }))\n    const callLogsIndex = this.callLogsIds.indexOf(id);\n    if (callLogsIndex === -1) {\n      this.data.callLogsIds.unshift(id);\n    }\n    if (this.callsMapping[id]) {\n      this.data.callsMapping[id].endedCall = JSON.parse(\n        JSON.stringify(endedCall),\n      );\n    }\n  }\n\n  @action\n  clearCalls() {\n    this.data.callIds = [];\n    this.data.otherCallIds = [];\n  }\n\n  @action\n  setCallHoldStatus(res: EvHoldResponse) {\n    const id = this._deps.evClient.encodeUii(res);\n    this.data.callsMapping[id].isHold = res.holdState;\n  }\n\n  @action\n  limitCalls() {\n    // max 250 and 7 days\n    const lastWeekDayTimestamp = this._getLastWeekDayTimestamp();\n    const storageCallData: {\n      callIds: string[];\n      otherCallIds: string[];\n      callLogsIds: string[];\n      callsMapping: Mapping<EvCallData>;\n      rawCallsMapping: Mapping<EvCallData>;\n    } = {\n      callIds: [],\n      otherCallIds: [],\n      callLogsIds: [],\n      callsMapping: {},\n      rawCallsMapping: {},\n    };\n\n    const fullCallLogsIds = this.callLogsIds\n      .slice(0, 250)\n      .reduce((acc, curr) => [...acc, curr.substr(0, curr.length - 2)], []);\n\n    // valid rawCallsMapping\n    storageCallData.rawCallsMapping = Object.keys(this.rawCallsMapping).reduce(\n      (acc, id) => {\n        if (\n          fullCallLogsIds.includes(id) &&\n          getTimeStamp(this.rawCallsMapping[id].queueDts) >=\n            lastWeekDayTimestamp\n        ) {\n          acc[id] = this.rawCallsMapping[id];\n        }\n        return acc;\n      },\n      {} as Mapping<EvCallData>,\n    );\n\n    // valid callsMapping\n    storageCallData.callsMapping = Object.keys(this.callsMapping).reduce(\n      (acc, id) => {\n        if (\n          fullCallLogsIds.includes(id.substr(0, id.length - 2)) &&\n          getTimeStamp(this.callsMapping[id].queueDts) >= lastWeekDayTimestamp\n        ) {\n          acc[id] = this.callsMapping[id];\n          if (!id.endsWith('$1')) {\n            storageCallData.callLogsIds.unshift(id);\n          }\n        }\n        return acc;\n      },\n      {} as Mapping<EvCallData>,\n    );\n\n    this.data = storageCallData;\n    this.changeCallsLimited(true);\n  }\n\n  private _getCallEncodeId(session: Partial<EvAddSessionNotification>) {\n    return this._deps.evClient.encodeUii(session);\n  }\n\n  private _getCurrentGateData(call: Partial<EvCallData>): EvEvRequeueCallGate {\n    const currentGateId = call.queue.number;\n    const currentQueueGroup = this._deps.evAuth.availableRequeueQueues.find(\n      ({ gates }) => {\n        return gates.some(({ gateId }) => gateId === currentGateId);\n      },\n    );\n    return {\n      gateId: currentGateId,\n      gateGroupId: currentQueueGroup?.gateGroupId,\n    };\n  }\n\n  private _getLastWeekDayTimestamp() {\n    const now = dayjs();\n    const lastWeekDay = now.clone().subtract(7, 'days').startOf('day');\n    return lastWeekDay.valueOf();\n  }\n}\n\nexport { EvCallDataSource };\n"],"mappings":"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","ignoreList":[]}