{"version":3,"file":"ErrorLogger.js","names":["_core","require","Sentry","_interopRequireWildcard","_tracing","_di","_dec","_class","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","value","_toPropertyKey","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","ErrorLogger","Module","name","deps","dep","optional","_RcModuleV","_super","_this","_sentryInitialized","errorLoggerOptions","_bootstrap","options","appVersion","appRelease","environment","sentryConfig","endpoint","_init","dsn","sampleRate","release","integrations","BrowserTracing","appName","_deps","brandConfig","appBrand","code","setTags","init","ignoreErrors","onInitOnce","_this2","auth","watch","_this2$_deps$auth","loggedIn","_this2$_deps$auth2","setUser","id","ownerId","user","configureScope","scope","tags","log","message","level","eventId","captureMessage","logError","error","captureException","test","testError","setTimeout","Error","RcModuleV2","exports"],"sources":["modules/ErrorLogger/ErrorLogger.ts"],"sourcesContent":["import { RcModuleV2, watch } from '@ringcentral-integration/core';\n\nimport * as Sentry from '@sentry/browser';\nimport type { SeverityLevel, User } from '@sentry/types';\nimport { BrowserTracing } from '@sentry/tracing';\n\nimport { Module } from '../../lib/di';\nimport type { Deps, ErrorLoggerOptions } from './ErrorLogger.interface';\n\n@Module({\n  name: 'ErrorLogger',\n  deps: [\n    'BrandConfig',\n    { dep: 'Auth', optional: true },\n    { dep: 'ErrorLoggerOptions', optional: true },\n  ],\n})\nexport class ErrorLogger extends RcModuleV2<Deps> {\n  private _sentryInitialized = false;\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n\n    if (deps.errorLoggerOptions) {\n      this._bootstrap(deps.errorLoggerOptions);\n    }\n  }\n\n  private _bootstrap(options: ErrorLoggerOptions) {\n    const { appVersion, appRelease, environment, sentryConfig } = options;\n    if (sentryConfig?.endpoint) {\n      // init client\n      this._init({\n        dsn: sentryConfig.endpoint,\n        sampleRate: sentryConfig.sampleRate,\n        environment,\n        release: appRelease ?? appVersion,\n        integrations: [new BrowserTracing()],\n      });\n      // set tags\n      const appName = this._deps.brandConfig.appName;\n      const appBrand = this._deps.brandConfig.code;\n      this.setTags({\n        'app.name': appName as string,\n        'app.brand': appBrand,\n        'app.version': appVersion ?? '',\n      });\n    }\n  }\n\n  private _init(options: Sentry.BrowserOptions) {\n    Sentry.init({\n      ...options,\n      ignoreErrors: [\n        '200 OK',\n        'Failed to fetch',\n        'Request Timeout',\n        'Service is overloaded',\n        'In order to call this API endpoint, user needs to have [ReadCallLog] permission for requested resource',\n        'INVALID_STATE_ERROR: Invalid status: 11',\n        'INVALID_STATE_ERROR: Invalid status: 1',\n        'rateLimiterErrorMessages-rateLimitReached',\n      ],\n    });\n    this._sentryInitialized = true;\n  }\n\n  override onInitOnce() {\n    if (this._sentryInitialized && this._deps.auth) {\n      watch(\n        this,\n        () => this._deps.auth?.loggedIn,\n        (loggedIn) => {\n          if (loggedIn) {\n            // set user\n            this.setUser({\n              id: this._deps.auth?.ownerId,\n            });\n          }\n        },\n      );\n    }\n  }\n\n  setUser(user: User | null) {\n    Sentry.configureScope((scope) => {\n      scope.setUser(user);\n    });\n  }\n\n  setTags(tags: Record<string, string>) {\n    Sentry.configureScope((scope) => {\n      scope.setTags(tags);\n    });\n  }\n\n  log(message: string, level?: SeverityLevel) {\n    const eventId = Sentry.captureMessage(message, level);\n    return eventId;\n  }\n\n  logError(error: unknown) {\n    const eventId = Sentry.captureException(error);\n    return eventId;\n  }\n\n  test(message = '[ErrorLogger] test') {\n    const eventId = this.log(message, 'debug');\n    return eventId;\n  }\n\n  testError(message = '[ErrorLogger] test error') {\n    // To support test with devtool console, throw error within a new thread by using setTimeout\n    setTimeout(() => {\n      throw new Error(message);\n    }, 0);\n  }\n}\n"],"mappings":"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"}