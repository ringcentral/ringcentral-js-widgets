{"version":3,"sources":["modules/Softphone/index.js"],"names":["Softphone","deps","dep","optional","brand","extensionMode","options","_brand","_extensionMode","phoneNumber","uri","protocol","encodeURIComponent","window","open","frame","document","createElement","style","display","body","appendChild","contentWindow","location","href","removeChild","id","ready"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;IAOqBA,S,WAHpB,gBAAO;AACNC,QAAM,CAAC,OAAD,EAAU,EAAEC,KAAK,kBAAP,EAA2BC,UAAU,IAArC,EAAV;AADA,CAAP,C;;;AAIC;;;;;;AAMA,2BAIG;AAAA,QAHDC,KAGC,QAHDA,KAGC;AAAA,kCAFDC,aAEC;AAAA,QAFDA,aAEC,sCAFe,KAEf;AAAA,QADEC,OACF;AAAA;;AAAA,uKAEIA,OAFJ;;AAID,UAAKC,MAAL,GAAcH,KAAd;AACA,UAAKI,cAAL,GAAsBH,aAAtB;AALC;AAMF;;;;qCAOgB;AACf;AACD;;;;8FAgBcI,W;;;;;;AACb;AACA;AACMC,mB,GAAS,KAAKC,Q,uBAA0BC,mBAAmBH,WAAnB,C;;qBAC1C,KAAKD,c;;;;;AACPK,uBAAOC,IAAP,CAAYJ,GAAZ;;;;;AAEMK,qB,GAAQC,SAASC,aAAT,CAAuB,QAAvB,C;;AACdF,sBAAMG,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;;AAEAH,yBAASI,IAAT,CAAcC,WAAd,CAA0BN,KAA1B;;uBACM,qBAAM,GAAN,C;;;AACNA,sBAAMO,aAAN,CAAoBC,QAApB,CAA6BC,IAA7B,GAAoCd,GAApC;;uBACM,qBAAM,GAAN,C;;;AACNM,yBAASI,IAAT,CAAcK,WAAd,CAA0BV,KAA1B;;;;;;;;;;;;;;;;;AAIJ;;;;wBAzCmB;AACjB;AACA,aAAO,IAAP;AACD;;;wBAMc;AACb,cAAQ,KAAKR,MAAL,CAAYmB,EAApB;AACE,aAAK,MAAL;AAAa;AACX,iBAAO,SAAP;AACF,aAAK,MAAL;AAAa;AACX,iBAAO,YAAP;AACF,aAAK,MAAL;AAAa;AACX,iBAAO,SAAP;AACF;AACE,iBAAO,UAAP;AARJ;AAUD;;;wBAsBY;AACX,aAAO,yBAAeC,KAAtB;AACD;;;;kBA/DkB3B,S","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport sleep from '../../lib/sleep';\nimport proxify from '../../lib/proxy/proxify';\n\n/**\n * @class\n * @description Softphone module to call softphone\n */\n@Module({\n  deps: ['Brand', { dep: 'SoftphoneOptions', optional: true }]\n})\nexport default class Softphone extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Brnad} params.brand - brand module instance\n   * @param {Bool} params.extensionMode - default false\n   */\n  constructor({\n    brand,\n    extensionMode = false,\n    ...options\n  }) {\n    super({\n      ...options,\n    });\n    this._brand = brand;\n    this._extensionMode = extensionMode;\n  }\n\n  get _actionTypes() {\n    /* no action types */\n    return null;\n  }\n\n  _onStateChange() {\n    /* do nothing */\n  }\n\n  get protocol() {\n    switch (this._brand.id) {\n      case '3420': // ATT\n        return 'attvr20';\n      case '7710': // BT\n        return 'rcbtmobile';\n      case '7310': // TELUS\n        return 'rctelus';\n      default:\n        return 'rcmobile';\n    }\n  }\n\n  @proxify\n  async makeCall(phoneNumber) {\n    // TODO use window.open in extension background, this method will crash chrome when\n    // executed in background page.\n    const uri = `${this.protocol}://call?number=${encodeURIComponent(phoneNumber)}`;\n    if (this._extensionMode) {\n      window.open(uri);\n    } else {\n      const frame = document.createElement('iframe');\n      frame.style.display = 'none';\n\n      document.body.appendChild(frame);\n      await sleep(100);\n      frame.contentWindow.location.href = uri;\n      await sleep(300);\n      document.body.removeChild(frame);\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get status() {\n    return moduleStatuses.ready;\n  }\n}\n"]}