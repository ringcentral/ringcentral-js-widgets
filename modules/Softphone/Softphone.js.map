{"version":3,"file":"Softphone.js","names":["_bowser","_interopRequireDefault","require","_core","_utils","_di","_proxify","_callingModes","_softphoneStatus","_dec","_class","_class2","_descriptor","_descriptor2","obj","__esModule","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_initializerDefineProperty","target","property","descriptor","context","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","i","length","_toPropertyKey","_createClass","protoProps","staticProps","prototype","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","decorators","desc","keys","forEach","slice","reverse","reduce","decorator","_initializerWarningHelper","Error","Softphone","Module","name","deps","dep","optional","_RcModuleV","_super","_this$_deps$softphone","_this$_deps$softphone2","_this$_deps$softphone3","_this","_callHandler","_extensionMode","_ignoreModuleReadiness","contactMatcher","_deps","softphoneOptions","extensionMode","callHandler","startToConnect","phoneNumber","softphoneStatus","connecting","connectingPhoneNumber","connectComplete","idle","detectPlatform","bowser","parse","window","navigator","userAgent","platform","type","getMakeCallUri","callingMode","command","concat","encodeURIComponent","protocol","spartanProtocol","isJupiterUniversalLink","isCallWithJupiter","callingModes","jupiter","jupiterUniversalLink","includes","_useJupiterUniversalLink","jupiterProtocol","uri","_this$_deps$softphone4","_this$_deps$softphone5","useJupiterUniversalLink","brand","brandConfig","allowJupiterUniversalLink","_makeCall","regeneratorRuntime","mark","_callee","_this$getMakeCallUri","openLink","frame","wrap","_callee$","_context","prev","next","ActiveXObject","open","msLaunchUri","document","createElement","style","display","body","appendChild","sleep","contentWindow","location","href","removeChild","forceMatchNumber","stop","makeCall","_x","_x2","get","callWithSoftphone","_this$_deps$brand$bra","callWithJupiter","link","_this$_deps$brand$bra2","_this$_deps$brand$bra3","RcModuleV2","state","action","getOwnPropertyDescriptor","proxify","exports"],"sources":["modules/Softphone/Softphone.ts"],"sourcesContent":["import bowser from 'bowser';\n\nimport { action, RcModuleV2, state } from '@ringcentral-integration/core';\nimport { sleep } from '@ringcentral-integration/utils';\n\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\nimport { callingModes } from '../CallingSettings/callingModes';\nimport type {\n  CallHandlerContext,\n  CallUriInfo,\n  Deps,\n} from './Softphone.interface';\nimport { softphoneStatus } from './softphoneStatus';\n\n/**\n * @class\n * @description Softphone module to call softphone\n */\n@Module({\n  name: 'Softphone',\n  deps: [\n    'Brand',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'SoftphoneOptions', optional: true },\n  ],\n})\nexport class Softphone<T extends Deps = Deps> extends RcModuleV2<T> {\n  protected _callHandler: (context: CallHandlerContext) => any;\n  protected _extensionMode: boolean;\n\n  constructor(deps: T) {\n    super({\n      deps,\n    });\n    // @ts-expect-error\n    this._ignoreModuleReadiness(deps.contactMatcher);\n    this._extensionMode = this._deps.softphoneOptions?.extensionMode ?? false;\n    // @ts-expect-error\n    this._callHandler = this._deps.softphoneOptions?.callHandler;\n  }\n\n  @state\n  // @ts-expect-error\n  connectingPhoneNumber: string = null;\n\n  @state\n  softphoneStatus = softphoneStatus.idle;\n\n  @action\n  startToConnect(phoneNumber: string) {\n    this.softphoneStatus = softphoneStatus.connecting;\n    this.connectingPhoneNumber = phoneNumber;\n  }\n\n  @action\n  connectComplete() {\n    this.softphoneStatus = softphoneStatus.idle;\n    // @ts-expect-error\n    this.connectingPhoneNumber = null;\n  }\n\n  detectPlatform() {\n    return bowser.parse(\n      (window.navigator && window.navigator.userAgent) || 'unknown',\n    ).platform.type;\n  }\n\n  get spartanProtocol() {\n    // @ts-expect-error\n    return this._deps.brand.brandConfig.callWithSoftphone.protocol;\n  }\n\n  // currently we only have RingCentral App(rc brand)'s & AT&T universal link\n  get jupiterUniversalLink() {\n    return this._deps.brand.brandConfig.callWithJupiter?.link;\n  }\n\n  get jupiterAppName() {\n    return this._deps.brand.brandConfig.callWithJupiter?.name;\n  }\n\n  // currently we don't have Bt brand uri scheme\n  get jupiterProtocol() {\n    return this._deps.brand.brandConfig.callWithJupiter?.protocol;\n  }\n\n  getMakeCallUri(phoneNumber: string, callingMode: string): CallUriInfo {\n    // spartan\n    let command = `call?number=${encodeURIComponent(phoneNumber)}`;\n    let protocol = this.spartanProtocol;\n    let isJupiterUniversalLink = false;\n    // jupiter\n    const isCallWithJupiter = [\n      callingModes.jupiter,\n      callingModes.jupiterUniversalLink,\n    ].includes(callingMode);\n    if (isCallWithJupiter) {\n      // jupiter doesn't recognize encoded string for now\n      command = `r/call?number=${phoneNumber}`;\n      // @ts-expect-error\n      isJupiterUniversalLink = this._useJupiterUniversalLink(callingMode);\n      // @ts-expect-error\n      protocol = isJupiterUniversalLink\n        ? this.jupiterUniversalLink\n        : this.jupiterProtocol;\n    }\n    return {\n      command,\n      protocol,\n      isJupiterUniversalLink,\n      uri: `${protocol}${command}`,\n    };\n  }\n\n  private _useJupiterUniversalLink(callingMode: string) {\n    // rc brand: call with jupiter, use scheme\n    // rc brand: call with jupiter web, use universal link\n    // partner brand: use universal link\n    if (callingMode === callingModes.jupiterUniversalLink) {\n      return true;\n    }\n    return (\n      this._deps.softphoneOptions?.useJupiterUniversalLink ??\n      this._deps.brand.brandConfig.allowJupiterUniversalLink\n    );\n  }\n\n  @proxify\n  async makeCall(phoneNumber: string, callingMode: string) {\n    this.startToConnect(phoneNumber);\n\n    const { protocol, command, uri, isJupiterUniversalLink } =\n      this.getMakeCallUri(phoneNumber, callingMode);\n\n    if (this._callHandler) {\n      this._callHandler({\n        callingMode,\n        protocol,\n        command,\n        uri,\n        isJupiterUniversalLink,\n        phoneNumber,\n      });\n    } else {\n      /**\n       * 1. Use window.open in extension background scripts to avoid crashing Browsers\n       * 2. Use window.open in non-desktop platforms\n       * 3. to support ie on Windows < 8\n       * 4. for Jupiter universal link, should open link directly\n       */\n      const openLink =\n        isJupiterUniversalLink ||\n        this._extensionMode ||\n        this.detectPlatform() !== 'desktop' ||\n        (window as any).ActiveXObject ||\n        'ActiveXObject' in window;\n\n      if (openLink) {\n        window.open(uri);\n        // @ts-expect-error\n      } else if (window.navigator.msLaunchUri) {\n        // to support ie to start the service\n        // @ts-expect-error\n        window.navigator.msLaunchUri(uri);\n      } else {\n        // open via iframe\n        const frame = document.createElement('iframe');\n        frame.style.display = 'none';\n        document.body.appendChild(frame);\n        await sleep(100);\n        // @ts-expect-error\n        frame.contentWindow.location.href = uri;\n        await sleep(300);\n        document.body.removeChild(frame);\n      }\n    }\n\n    if (this._deps.contactMatcher) {\n      await this._deps.contactMatcher.forceMatchNumber({\n        phoneNumber,\n      });\n    }\n\n    this.connectComplete();\n  }\n}\n"],"mappings":"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"}