{"version":3,"file":"EvStorage.js","names":["_di","require","_Auth","_Storage2","_loginStatus","_dec","_class","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","prototype","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","Number","_get","Reflect","get","bind","property","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","arguments","value","apply","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","EvStorage","Module","name","deps","dep","optional","_Storage","_super","_this$_deps$storageOp","_this$_deps$storageOp2","_this","_disableInactiveTabsWrite","_deps","storageOptions","disableInactiveTabsWrite","_shouldInit","auth","loginStatus","loggedIn","tabManager","ready","evAuth","evLoginStatus","LOGIN_SUCCESS","pending","_shouldReset","NOT_AUTH","agentId","concat","prefix","ownerId","Storage","exports"],"sources":["modules/EvStorage/EvStorage.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport { loginStatus } from '@ringcentral-integration/commons/modules/Auth';\nimport { Storage } from '@ringcentral-integration/commons/modules/Storage';\n\nimport { loginStatus as evLoginStatus } from '../../enums/loginStatus';\nimport type { Deps } from './EvStorage.interface';\n\n@Module({\n  name: 'Storage',\n  deps: [\n    'Auth',\n    'EvAuth',\n    { dep: 'TabManager', optional: true },\n    { dep: 'StorageOptions', optional: true },\n  ],\n})\nexport class EvStorage extends Storage<Deps> {\n  constructor(deps: Deps) {\n    super(deps);\n    this._disableInactiveTabsWrite =\n      this._deps.storageOptions?.disableInactiveTabsWrite ?? true;\n  }\n\n  override _shouldInit() {\n    return (\n      this._deps.auth.loginStatus === loginStatus.loggedIn &&\n      (!this._deps.tabManager || this._deps.tabManager.ready) &&\n      this._deps.evAuth.loginStatus === evLoginStatus.LOGIN_SUCCESS &&\n      this.pending\n    );\n  }\n\n  override _shouldReset() {\n    return (\n      super._shouldReset() ||\n      (this.ready && this._deps.evAuth.loginStatus === evLoginStatus.NOT_AUTH)\n    );\n  }\n\n  get storageKey() {\n    const { agentId } = this._deps.evAuth;\n    return `${this.prefix ? `${this.prefix}-` : ''}storage-${\n      this._deps.auth.ownerId\n    }${agentId ? `-${agentId}` : ''}`;\n  }\n}\n"],"mappings":"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"}