{"version":3,"file":"EvStorage.js","names":["_di","require","_Auth","_Storage2","_loginStatus","_dec","_class","_classCallCheck","a","n","TypeError","_defineProperties","e","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","_superPropGet","p","_get","get","bind","_superPropBase","getOwnPropertyDescriptor","arguments","value","hasOwnProperty","setPrototypeOf","getPrototypeOf","__proto__","_inherits","create","_setPrototypeOf","EvStorage","exports","Module","name","deps","dep","optional","_Storage","_this$_deps$storageOp","_this$_deps$storageOp2","_this","_disableInactiveTabsWrite","_deps","storageOptions","disableInactiveTabsWrite","_shouldInit","auth","loginStatus","loggedIn","tabManager","ready","evAuth","evLoginStatus","LOGIN_SUCCESS","pending","_shouldReset","NOT_AUTH","agentId","concat","prefix","ownerId","Storage"],"sources":["modules/EvStorage/EvStorage.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport { loginStatus } from '@ringcentral-integration/commons/modules/Auth';\nimport { Storage } from '@ringcentral-integration/commons/modules/Storage';\n\nimport { loginStatus as evLoginStatus } from '../../enums/loginStatus';\n\nimport type { Deps } from './EvStorage.interface';\n\n@Module({\n  name: 'Storage',\n  deps: [\n    'Auth',\n    'EvAuth',\n    { dep: 'TabManager', optional: true },\n    { dep: 'StorageOptions', optional: true },\n  ],\n})\nexport class EvStorage extends Storage<Deps> {\n  constructor(deps: Deps) {\n    super(deps);\n    this._disableInactiveTabsWrite =\n      this._deps.storageOptions?.disableInactiveTabsWrite ?? true;\n  }\n\n  override _shouldInit() {\n    return (\n      this._deps.auth.loginStatus === loginStatus.loggedIn &&\n      (!this._deps.tabManager || this._deps.tabManager.ready) &&\n      this._deps.evAuth.loginStatus === evLoginStatus.LOGIN_SUCCESS &&\n      this.pending\n    );\n  }\n\n  override _shouldReset() {\n    return (\n      super._shouldReset() ||\n      (this.ready && this._deps.evAuth.loginStatus === evLoginStatus.NOT_AUTH)\n    );\n  }\n\n  get storageKey() {\n    const { agentId } = this._deps.evAuth;\n    return `${this.prefix ? `${this.prefix}-` : ''}storage-${\n      this._deps.auth.ownerId\n    }${agentId ? `-${agentId}` : ''}`;\n  }\n}\n"],"mappings":"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","ignoreList":[]}