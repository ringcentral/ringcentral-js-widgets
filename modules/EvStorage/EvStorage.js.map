{"version":3,"file":"EvStorage.js","names":["_di","require","_Auth","_Storage2","_loginStatus","_dec","_class","_classCallCheck","a","n","TypeError","_defineProperties","e","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_get","Reflect","get","bind","p","_superPropBase","getOwnPropertyDescriptor","arguments","value","apply","hasOwnProperty","_getPrototypeOf","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","__proto__","_createSuper","_isNativeReflectConstruct","s","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","EvStorage","Module","name","deps","dep","optional","_Storage","_super","_this$_deps$storageOp","_this$_deps$storageOp2","_this","_disableInactiveTabsWrite","_deps","storageOptions","disableInactiveTabsWrite","_shouldInit","auth","loginStatus","loggedIn","tabManager","ready","evAuth","evLoginStatus","LOGIN_SUCCESS","pending","_shouldReset","NOT_AUTH","agentId","concat","prefix","ownerId","Storage","exports"],"sources":["modules/EvStorage/EvStorage.ts"],"sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport { loginStatus } from '@ringcentral-integration/commons/modules/Auth';\nimport { Storage } from '@ringcentral-integration/commons/modules/Storage';\n\nimport { loginStatus as evLoginStatus } from '../../enums/loginStatus';\n\nimport type { Deps } from './EvStorage.interface';\n\n@Module({\n  name: 'Storage',\n  deps: [\n    'Auth',\n    'EvAuth',\n    { dep: 'TabManager', optional: true },\n    { dep: 'StorageOptions', optional: true },\n  ],\n})\nexport class EvStorage extends Storage<Deps> {\n  constructor(deps: Deps) {\n    super(deps);\n    this._disableInactiveTabsWrite =\n      this._deps.storageOptions?.disableInactiveTabsWrite ?? true;\n  }\n\n  override _shouldInit() {\n    return (\n      this._deps.auth.loginStatus === loginStatus.loggedIn &&\n      (!this._deps.tabManager || this._deps.tabManager.ready) &&\n      this._deps.evAuth.loginStatus === evLoginStatus.LOGIN_SUCCESS &&\n      this.pending\n    );\n  }\n\n  override _shouldReset() {\n    return (\n      super._shouldReset() ||\n      (this.ready && this._deps.evAuth.loginStatus === evLoginStatus.NOT_AUTH)\n    );\n  }\n\n  get storageKey() {\n    const { agentId } = this._deps.evAuth;\n    return `${this.prefix ? `${this.prefix}-` : ''}storage-${\n      this._deps.auth.ownerId\n    }${agentId ? `-${agentId}` : ''}`;\n  }\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,GAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AAEA,IAAAG,YAAA,GAAAH,OAAA;AAAuE,IAAAI,IAAA,EAAAC,MAAA;AAAA,SAAAC,gBAAAC,CAAA,EAAAC,CAAA,UAAAD,CAAA,YAAAC,CAAA,aAAAC,SAAA;AAAA,SAAAC,kBAAAC,CAAA,EAAAC,CAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAD,CAAA,CAAAE,MAAA,EAAAD,CAAA,UAAAE,CAAA,GAAAH,CAAA,CAAAC,CAAA,GAAAE,CAAA,CAAAC,UAAA,GAAAD,CAAA,CAAAC,UAAA,QAAAD,CAAA,CAAAE,YAAA,kBAAAF,CAAA,KAAAA,CAAA,CAAAG,QAAA,QAAAC,MAAA,CAAAC,cAAA,CAAAT,CAAA,EAAAU,cAAA,CAAAN,CAAA,CAAAO,GAAA,GAAAP,CAAA;AAAA,SAAAQ,aAAAZ,CAAA,EAAAC,CAAA,EAAAC,CAAA,WAAAD,CAAA,IAAAF,iBAAA,CAAAC,CAAA,CAAAa,SAAA,EAAAZ,CAAA,GAAAC,CAAA,IAAAH,iBAAA,CAAAC,CAAA,EAAAE,CAAA,GAAAM,MAAA,CAAAC,cAAA,CAAAT,CAAA,iBAAAO,QAAA,SAAAP,CAAA;AAAA,SAAAU,eAAAR,CAAA,QAAAY,CAAA,GAAAC,YAAA,CAAAb,CAAA,gCAAAc,OAAA,CAAAF,CAAA,IAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAC,aAAAb,CAAA,EAAAD,CAAA,oBAAAe,OAAA,CAAAd,CAAA,MAAAA,CAAA,SAAAA,CAAA,MAAAF,CAAA,GAAAE,CAAA,CAAAe,MAAA,CAAAC,WAAA,kBAAAlB,CAAA,QAAAc,CAAA,GAAAd,CAAA,CAAAmB,IAAA,CAAAjB,CAAA,EAAAD,CAAA,gCAAAe,OAAA,CAAAF,CAAA,UAAAA,CAAA,YAAAhB,SAAA,yEAAAG,CAAA,GAAAmB,MAAA,GAAAC,MAAA,EAAAnB,CAAA;AAAA,SAAAoB,KAAA,WAAAA,IAAA,yBAAAC,OAAA,IAAAA,OAAA,CAAAC,GAAA,GAAAD,OAAA,CAAAC,GAAA,CAAAC,IAAA,eAAAzB,CAAA,EAAAE,CAAA,EAAAD,CAAA,QAAAyB,CAAA,GAAAC,cAAA,CAAA3B,CAAA,EAAAE,CAAA,OAAAwB,CAAA,QAAA7B,CAAA,GAAAW,MAAA,CAAAoB,wBAAA,CAAAF,CAAA,EAAAxB,CAAA,UAAAL,CAAA,CAAA2B,GAAA,GAAA3B,CAAA,CAAA2B,GAAA,CAAAL,IAAA,CAAAU,SAAA,CAAA1B,MAAA,OAAAH,CAAA,GAAAC,CAAA,IAAAJ,CAAA,CAAAiC,KAAA,OAAAR,IAAA,CAAAS,KAAA,OAAAF,SAAA;AAAA,SAAAF,eAAAzB,CAAA,EAAAE,CAAA,eAAA4B,cAAA,CAAAb,IAAA,CAAAjB,CAAA,EAAAE,CAAA,eAAAF,CAAA,GAAA+B,eAAA,CAAA/B,CAAA,kBAAAA,CAAA;AAAA,SAAAgC,UAAAhC,CAAA,EAAAF,CAAA,6BAAAA,CAAA,aAAAA,CAAA,YAAAF,SAAA,wDAAAI,CAAA,CAAAW,SAAA,GAAAL,MAAA,CAAA2B,MAAA,CAAAnC,CAAA,IAAAA,CAAA,CAAAa,SAAA,IAAAuB,WAAA,IAAAN,KAAA,EAAA5B,CAAA,EAAAK,QAAA,MAAAD,YAAA,WAAAE,MAAA,CAAAC,cAAA,CAAAP,CAAA,iBAAAK,QAAA,SAAAP,CAAA,IAAAqC,eAAA,CAAAnC,CAAA,EAAAF,CAAA;AAAA,SAAAqC,gBAAAnC,CAAA,EAAAF,CAAA,WAAAqC,eAAA,GAAA7B,MAAA,CAAA8B,cAAA,GAAA9B,MAAA,CAAA8B,cAAA,CAAAb,IAAA,eAAAvB,CAAA,EAAAF,CAAA,WAAAE,CAAA,CAAAqC,SAAA,GAAAvC,CAAA,EAAAE,CAAA,KAAAmC,eAAA,CAAAnC,CAAA,EAAAF,CAAA;AAAA,SAAAwC,aAAAtC,CAAA,QAAAD,CAAA,GAAAwC,yBAAA,6BAAAzC,CAAA,EAAAI,CAAA,GAAA6B,eAAA,CAAA/B,CAAA,OAAAD,CAAA,QAAAyC,CAAA,GAAAT,eAAA,OAAAG,WAAA,EAAApC,CAAA,GAAAuB,OAAA,CAAAoB,SAAA,CAAAvC,CAAA,EAAAyB,SAAA,EAAAa,CAAA,UAAA1C,CAAA,GAAAI,CAAA,CAAA2B,KAAA,OAAAF,SAAA,UAAAe,0BAAA,OAAA5C,CAAA;AAAA,SAAA4C,2BAAA1C,CAAA,EAAAF,CAAA,QAAAA,CAAA,iBAAAgB,OAAA,CAAAhB,CAAA,0BAAAA,CAAA,UAAAA,CAAA,iBAAAA,CAAA,YAAAF,SAAA,qEAAA+C,sBAAA,CAAA3C,CAAA;AAAA,SAAA2C,uBAAA7C,CAAA,mBAAAA,CAAA,YAAA8C,cAAA,sEAAA9C,CAAA;AAAA,SAAAyC,0BAAA,cAAAvC,CAAA,IAAA6C,OAAA,CAAAlC,SAAA,CAAAmC,OAAA,CAAA7B,IAAA,CAAAI,OAAA,CAAAoB,SAAA,CAAAI,OAAA,iCAAA7C,CAAA,aAAAuC,yBAAA,YAAAA,0BAAA,aAAAvC,CAAA;AAAA,SAAA+B,gBAAA/B,CAAA,WAAA+B,eAAA,GAAAzB,MAAA,CAAA8B,cAAA,GAAA9B,MAAA,CAAAyC,cAAA,CAAAxB,IAAA,eAAAvB,CAAA,WAAAA,CAAA,CAAAqC,SAAA,IAAA/B,MAAA,CAAAyC,cAAA,CAAA/C,CAAA,MAAA+B,eAAA,CAAA/B,CAAA;AAAA,IAa1DgD,SAAS,IAAAzD,IAAA,GATrB,IAAA0D,UAAM,EAAC;EACNC,IAAI,EAAE,SAAS;EACfC,IAAI,EAAE,CACJ,MAAM,EACN,QAAQ,EACR;IAAEC,GAAG,EAAE,YAAY;IAAEC,QAAQ,EAAE;EAAK,CAAC,EACrC;IAAED,GAAG,EAAE,gBAAgB;IAAEC,QAAQ,EAAE;EAAK,CAAC;AAE7C,CAAC,CAAC,EAAA9D,IAAA,CAAAC,MAAA,0BAAA8D,QAAA;EAAAtB,SAAA,CAAAgB,SAAA,EAAAM,QAAA;EAAA,IAAAC,MAAA,GAAAjB,YAAA,CAAAU,SAAA;EAEA,SAAAA,UAAYG,IAAU,EAAE;IAAA,IAAAK,qBAAA,EAAAC,sBAAA;IAAA,IAAAC,KAAA;IAAAjE,eAAA,OAAAuD,SAAA;IACtBU,KAAA,GAAAH,MAAA,CAAAtC,IAAA,OAAMkC,IAAI;IACVO,KAAA,CAAKC,yBAAyB,IAAAH,qBAAA,IAAAC,sBAAA,GAC5BC,KAAA,CAAKE,KAAK,CAACC,cAAc,cAAAJ,sBAAA,uBAAzBA,sBAAA,CAA2BK,wBAAwB,cAAAN,qBAAA,cAAAA,qBAAA,GAAI,IAAI;IAAC,OAAAE,KAAA;EAChE;EAAChD,YAAA,CAAAsC,SAAA;IAAAvC,GAAA;IAAAmB,KAAA,WAAAmC,YAAA,EAEsB;MACrB,OACE,IAAI,CAACH,KAAK,CAACI,IAAI,CAACC,WAAW,KAAKA,iBAAW,CAACC,QAAQ,KACnD,CAAC,IAAI,CAACN,KAAK,CAACO,UAAU,IAAI,IAAI,CAACP,KAAK,CAACO,UAAU,CAACC,KAAK,CAAC,IACvD,IAAI,CAACR,KAAK,CAACS,MAAM,CAACJ,WAAW,KAAKK,wBAAa,CAACC,aAAa,IAC7D,IAAI,CAACC,OAAO;IAEhB;EAAC;IAAA/D,GAAA;IAAAmB,KAAA,WAAA6C,aAAA,EAEuB;MACtB,OACErD,IAAA,CAAAW,eAAA,CAAAiB,SAAA,CAAArC,SAAA,yBAAAM,IAAA,UACC,IAAI,CAACmD,KAAK,IAAI,IAAI,CAACR,KAAK,CAACS,MAAM,CAACJ,WAAW,KAAKK,wBAAa,CAACI,QAAS;IAE5E;EAAC;IAAAjE,GAAA;IAAAa,GAAA,WAAAA,IAAA,EAEgB;MAAA,IACPqD,OAAO,GAAK,IAAI,CAACf,KAAK,CAACS,MAAM,CAA7BM,OAAO;MACf,UAAAC,MAAA,CAAU,IAAI,CAACC,MAAM,MAAAD,MAAA,CAAM,IAAI,CAACC,MAAM,SAAM,EAAE,cAAAD,MAAA,CAC5C,IAAI,CAAChB,KAAK,CAACI,IAAI,CAACc,OAAO,EAAAF,MAAA,CACtBD,OAAO,OAAAC,MAAA,CAAOD,OAAO,IAAK,EAAE;IACjC;EAAC;EAAA,OAAA3B,SAAA;AAAA,EA5B4B+B,iBAAO,MAAAvF,MAAA;AAAAwF,OAAA,CAAAhC,SAAA,GAAAA,SAAA","ignoreList":[]}