{"version":3,"sources":["modules/EvStorage/EvStorage.ts"],"names":["EvStorage","name","deps","dep","optional","_disableInactiveTabsWrite","_deps","storageOptions","disableInactiveTabsWrite","auth","loginStatus","loggedIn","tabManager","ready","evAuth","evLoginStatus","LOGIN_SUCCESS","pending","NOT_AUTH","agentId","prefix","ownerId","Storage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAWaA,S,WATZ,gBAAO;AACNC,EAAAA,IAAI,EAAE,SADA;AAENC,EAAAA,IAAI,EAAE,CACJ,MADI,EAEJ,QAFI,EAGJ;AAAEC,IAAAA,GAAG,EAAE,YAAP;AAAqBC,IAAAA,QAAQ,EAAE;AAA/B,GAHI,EAIJ;AAAED,IAAAA,GAAG,EAAE,gBAAP;AAAyBC,IAAAA,QAAQ,EAAE;AAAnC,GAJI;AAFA,CAAP,C;;;;;AAUC,qBAAYF,IAAZ,EAAwB;AAAA;;AAAA;;AAAA;;AACtB,8BAAMA,IAAN;AACA,UAAKG,yBAAL,sDACE,MAAKC,KAAL,CAAWC,cADb,2DACE,uBAA2BC,wBAD7B,yEACyD,IADzD;AAFsB;AAIvB;;;;kCAEa;AACZ,aACE,KAAKF,KAAL,CAAWG,IAAX,CAAgBC,WAAhB,KAAgCA,wBAAYC,QAA5C,KACC,CAAC,KAAKL,KAAL,CAAWM,UAAZ,IAA0B,KAAKN,KAAL,CAAWM,UAAX,CAAsBC,KADjD,KAEA,KAAKP,KAAL,CAAWQ,MAAX,CAAkBJ,WAAlB,KAAkCK,0BAAcC,aAFhD,IAGA,KAAKC,OAJP;AAMD;;;mCAEc;AACb,aACE,+EACC,KAAKJ,KAAL,IAAc,KAAKP,KAAL,CAAWQ,MAAX,CAAkBJ,WAAlB,KAAkCK,0BAAcG,QAFjE;AAID;;;wBAEgB;AAAA,UACPC,OADO,GACK,KAAKb,KAAL,CAAWQ,MADhB,CACPK,OADO;AAEf,uBAAU,KAAKC,MAAL,aAAiB,KAAKA,MAAtB,SAAkC,EAA5C,qBACE,KAAKd,KAAL,CAAWG,IAAX,CAAgBY,OADlB,SAEGF,OAAO,cAAOA,OAAP,IAAmB,EAF7B;AAGD;;;;EA5B4BG,iB","sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport { Storage } from '@ringcentral-integration/commons/modules/StorageV2';\nimport loginStatus from '@ringcentral-integration/commons/modules/Auth/loginStatus';\nimport { ModuleStatus } from '@ringcentral-integration/core';\nimport { Deps } from './EvStorage.interface';\nimport { loginStatus as evLoginStatus } from '../../enums/loginStatus';\n\n@Module({\n  name: 'Storage',\n  deps: [\n    'Auth',\n    'EvAuth',\n    { dep: 'TabManager', optional: true },\n    { dep: 'StorageOptions', optional: true },\n  ],\n})\nexport class EvStorage extends Storage<Deps> {\n  constructor(deps: Deps) {\n    super(deps);\n    this._disableInactiveTabsWrite =\n      this._deps.storageOptions?.disableInactiveTabsWrite ?? true;\n  }\n\n  _shouldInit() {\n    return (\n      this._deps.auth.loginStatus === loginStatus.loggedIn &&\n      (!this._deps.tabManager || this._deps.tabManager.ready) &&\n      this._deps.evAuth.loginStatus === evLoginStatus.LOGIN_SUCCESS &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return (\n      super._shouldReset() ||\n      (this.ready && this._deps.evAuth.loginStatus === evLoginStatus.NOT_AUTH)\n    );\n  }\n\n  get storageKey() {\n    const { agentId } = this._deps.evAuth;\n    return `${this.prefix ? `${this.prefix}-` : ''}storage-${\n      this._deps.auth.ownerId\n    }${agentId ? `-${agentId}` : ''}`;\n  }\n}\n"],"file":"EvStorage.js"}