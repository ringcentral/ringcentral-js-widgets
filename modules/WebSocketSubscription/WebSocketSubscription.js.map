{"version":3,"file":"WebSocketSubscription.js","names":["_core","require","_background","_interopRequireDefault","_debounceThrottle","_di","_proxify","_webSocketReadyStates","_normalizeEventFilter","_dec","_class","_class2","_descriptor","_descriptor2","_descriptor3","_descriptor4","obj","__esModule","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_initializerDefineProperty","target","property","descriptor","context","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","i","length","_toPropertyKey","_createClass","protoProps","staticProps","prototype","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_initializerWarningHelper","Error","_applyDecoratedDescriptor","decorators","desc","keys","forEach","slice","reverse","reduce","decorator","DEFAULT_REFRESH_DELAY","process","env","NODE_ENV","SyncMessageTabEventName","exports","WebSocketSubscription","Module","name","deps","dep","optional","_RcModuleV","_super","_this","enableCache","storageKey","_wsSubscription","_debouncedUpdateSubscription","promisedDebounce","_updateSubscription","threshold","_onInitOnce","regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","_bindEvents","stop","onInitOnce","_onInitSuccess","_callee2","_callee2$","_context2","_debouncedUpdateSubscriptionCatchCancel","onInitSuccess","_onReset","_callee3","_callee3$","_context3","cancel","_removeSubscription","onReset","_debouncedUpdateSubscriptionCatchCancel2","_callee4","_callee4$","_context4","t0","message","_bindEvents2","_callee6","_this2","_callee6$","_context6","watch","_deps","ringCentralExtensions","webSocketReadyState","_ref","_callee5","wsState","_callee5$","_context5","ready","abrupt","webSocketReadyStates","closing","_revokeSubscription","_x","onlyOneTabConnected","tabManager","event","_tabEventHandler","_notifyMessage","_syncMessageToOtherTabs2","_callee7","_this$_deps$tabManage","_callee7$","_context7","send","_syncMessageToOtherTabs","_x2","_setTokens","subscriptionInfo","subscriptionChannel","_saveTokens","_this$_wsSubscription","webSocketExtension","ws","url","_clearTokens","_obtainSubscription2","_callee8","_this3","_subscription$subscri","isNewChannel","subscription","isNewSubscription","_callee8$","_context8","isTheSameWebSocket","console","log","concat","subscribe","filters","sent","id","_obtainSubscription","_refreshSubscription2","_callee9","_callee9$","_context9","eventFilters","refresh","_refreshSubscription","_revokeSubscription2","_callee10","_callee10$","_context10","revoke","client","service","platform","uri","warn","_removeSubscription2","_callee11","_callee11$","_context11","remove","_updateSubscription2","_callee12","_this$_wsSubscription2","_this$_wsSubscription3","_callee12$","_context12","isWebSocketReady","map","x","normalizeEventFilter","sort","join","_subscribe","_callee13","eventsFilters","oldLength","_args13","_callee13$","_context13","_addFilters","_unsubscribe","_callee14","_args14","_callee14$","_context14","_removeFilters","unsubscribe","filter","index","array","indexOf","includes","get","disconnectOnInactive","RcModuleV2","background","getOwnPropertyDescriptor","storage","state","action","proxify"],"sources":["modules/WebSocketSubscription/WebSocketSubscription.ts"],"sourcesContent":["import type SubscriptionInfo from '@rc-ex/core/lib/definitions/SubscriptionInfo';\nimport type Subscription from '@rc-ex/ws/lib/subscription';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n  watch,\n} from '@ringcentral-integration/core';\n\nimport type { SubscriptionFilter } from '../../enums/subscriptionFilters';\nimport background from '../../lib/background';\nimport { promisedDebounce } from '../../lib/debounce-throttle';\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\nimport { webSocketReadyStates } from '../RingCentralExtensions/webSocketReadyStates';\nimport type { TabEvent } from '../TabManager';\nimport {\n  isTheSameWebSocket,\n  normalizeEventFilter,\n} from './normalizeEventFilter';\nimport type { Deps } from './WebSocketSubscription.interface';\n\nconst DEFAULT_REFRESH_DELAY = process.env.NODE_ENV === 'test' ? 0 : 1000;\nexport const SyncMessageTabEventName = 'WebSocketSubscription-syncMessage';\n\n@Module({\n  name: 'WebSocketSubscription',\n  deps: [\n    'Client',\n    'Storage',\n    'RingCentralExtensions',\n    { dep: 'TabManager', optional: true },\n    { dep: 'WebSocketSubscriptionOptions', optional: true },\n  ],\n})\nexport class WebSocketSubscription extends RcModuleV2<Deps> {\n  private _wsSubscription?: Subscription;\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'WebSocketSubscription',\n    });\n  }\n\n  override async onInitOnce() {\n    await this._bindEvents();\n  }\n\n  override async onInitSuccess() {\n    await this._debouncedUpdateSubscriptionCatchCancel();\n  }\n\n  override async onReset() {\n    await this._debouncedUpdateSubscription.cancel();\n    await this._removeSubscription();\n  }\n\n  private async _debouncedUpdateSubscriptionCatchCancel() {\n    try {\n      await this._debouncedUpdateSubscription();\n    } catch (error: any /** TODO: confirm with instanceof */) {\n      if (error.message !== 'cancelled') {\n        throw error;\n      }\n    }\n  }\n\n  get onlyOneTabConnected(): boolean {\n    return this._deps.ringCentralExtensions.disconnectOnInactive;\n  }\n\n  @background\n  private async _bindEvents() {\n    watch(\n      this,\n      () => this._deps.ringCentralExtensions.webSocketReadyState,\n      async (wsState) => {\n        if (!this.ready || !wsState) {\n          return;\n        }\n        if (wsState === webSocketReadyStates.ready) {\n          await this._updateSubscription();\n        } else if (wsState === webSocketReadyStates.closing) {\n          // when websocket is going to close, revoke subscription beforehand\n          await this._revokeSubscription();\n        } else {\n          await this._debouncedUpdateSubscription.cancel();\n          await this._removeSubscription();\n        }\n      },\n    );\n    if (this.onlyOneTabConnected) {\n      watch(\n        this,\n        () => this._deps.tabManager!.event,\n        (event) => {\n          this._tabEventHandler(event);\n        },\n      );\n    }\n  }\n\n  private _tabEventHandler(event: TabEvent) {\n    if (!this.ready || !event) {\n      return;\n    }\n    if (event.name === SyncMessageTabEventName) {\n      this._notifyMessage(event.args![0]);\n    }\n  }\n\n  private async _syncMessageToOtherTabs(message: unknown) {\n    // sync notification message to other tabs, so that other tabs got the latest message state\n    await this._deps.tabManager?.send(SyncMessageTabEventName, message);\n  }\n\n  @storage\n  @state\n  subscriptionInfo?: SubscriptionInfo | null = null;\n\n  @storage\n  @state\n  subscriptionChannel?: string | null = null;\n\n  @action\n  private _setTokens(\n    subscriptionInfo?: SubscriptionInfo | null,\n    subscriptionChannel?: string | null,\n  ) {\n    this.subscriptionInfo = subscriptionInfo ?? null;\n    this.subscriptionChannel = subscriptionChannel ?? null;\n  }\n\n  private _saveTokens() {\n    this._setTokens(\n      this._wsSubscription?.subscriptionInfo,\n      this._deps.ringCentralExtensions.webSocketExtension.ws.url,\n    );\n  }\n\n  private _clearTokens() {\n    this._setTokens(null, null);\n  }\n\n  private async _obtainSubscription() {\n    const isNewChannel =\n      !this.subscriptionChannel ||\n      !isTheSameWebSocket(\n        this.subscriptionChannel,\n        this._deps.ringCentralExtensions.webSocketExtension.ws.url,\n      );\n    if (process.env.NODE_ENV !== 'test') {\n      console.log(\n        `[WebSocketSubscription] > _obtainSubscription > isNewChannel: ${isNewChannel}`,\n      );\n    }\n\n    // For reduce the total number of subscriptions (ttl 24 hours, limited number 20),\n    // Revoke existing subscription before creating new.\n    if (isNewChannel) {\n      await this._revokeSubscription();\n      if (process.env.NODE_ENV !== 'test') {\n        console.log(\n          '[WebSocketSubscription] > _obtainSubscription > existing subscription revoked',\n        );\n      }\n    }\n\n    // Create or recover subscription\n    const subscription =\n      await this._deps.ringCentralExtensions.webSocketExtension.subscribe(\n        this.filters,\n        (message) => {\n          this._notifyMessage(message);\n          if (this.onlyOneTabConnected) {\n            this._syncMessageToOtherTabs(message);\n          }\n        },\n        isNewChannel ? null : this.subscriptionInfo,\n      );\n\n    const isNewSubscription =\n      !this.subscriptionInfo ||\n      this.subscriptionInfo.id !== subscription.subscriptionInfo?.id;\n    if (isNewSubscription) {\n      if (process.env.NODE_ENV !== 'test') {\n        console.log(\n          '[WebSocketSubscription] > _obtainSubscription > subscription created',\n        );\n      }\n    } else {\n      if (process.env.NODE_ENV !== 'test') {\n        console.log(\n          '[WebSocketSubscription] > _obtainSubscription > subscription recovered',\n        );\n      }\n    }\n\n    this._wsSubscription = subscription;\n    this._saveTokens();\n  }\n\n  private async _refreshSubscription() {\n    if (this._wsSubscription) {\n      this._wsSubscription.eventFilters = this.filters;\n      await this._wsSubscription.refresh();\n      this._saveTokens();\n    }\n  }\n\n  private async _revokeSubscription() {\n    try {\n      // Prior using ws channel for revoking, it is faster\n      if (this._wsSubscription) {\n        await this._wsSubscription.revoke();\n      }\n      // Else try to revoke over RESTful API\n      // When page reload we do have cached subscriptionInfo but not _wsSubscription object\n      else if (this.subscriptionInfo) {\n        await this._deps.client.service\n          .platform()\n          .delete(this.subscriptionInfo.uri);\n      }\n    } catch (ex) {\n      // ignore error of revoke request\n      if (process.env.NODE_ENV !== 'test') {\n        console.warn(`[WebSocketSubscription] > _revokeSubscription > ${ex}`);\n      }\n    }\n    this._wsSubscription = undefined;\n    this._clearTokens(); // once subscription is revoked, all tokens are expired\n  }\n\n  // Remove client side subscription object only\n  private async _removeSubscription() {\n    if (this._wsSubscription) {\n      this._wsSubscription.remove();\n      this._wsSubscription = undefined;\n    }\n  }\n\n  @proxify\n  private async _updateSubscription() {\n    // only when websocket is ready for create/refresh/revoke subscription\n    if (!this._deps.ringCentralExtensions.isWebSocketReady) {\n      return;\n    }\n    if (this.filters.length === 0) {\n      await this._revokeSubscription();\n      return;\n    }\n    if (!this._wsSubscription) {\n      await this._obtainSubscription();\n    } else if (\n      this.filters\n        .map((x) => normalizeEventFilter(x))\n        .sort()\n        .join(',') !==\n      (this._wsSubscription.subscriptionInfo?.eventFilters ?? [])\n        .map((x: string) => normalizeEventFilter(x))\n        .sort()\n        .join(',')\n    ) {\n      await this._refreshSubscription();\n    }\n  }\n\n  private _debouncedUpdateSubscription = promisedDebounce({\n    fn: this._updateSubscription,\n    threshold: DEFAULT_REFRESH_DELAY,\n  });\n\n  @proxify\n  async subscribe(eventsFilters: SubscriptionFilter[] = []) {\n    if (!this.ready) {\n      return;\n    }\n    const oldLength = this.filters.length;\n    this._addFilters(eventsFilters);\n    if (oldLength !== this.filters.length) {\n      await this._debouncedUpdateSubscriptionCatchCancel();\n    }\n  }\n\n  @proxify\n  async unsubscribe(eventsFilters: SubscriptionFilter[] = []) {\n    if (!this.ready) {\n      return;\n    }\n    const oldLength = this.filters.length;\n    this._removeFilters(eventsFilters);\n    if (oldLength !== this.filters.length) {\n      await this._debouncedUpdateSubscriptionCatchCancel();\n    }\n  }\n\n  @action\n  private _addFilters(eventsFilters: SubscriptionFilter[]) {\n    this.filters = this.filters\n      .concat(eventsFilters)\n      .filter((x, index, array) => array.indexOf(x) === index); // remove duplicates\n  }\n\n  @action\n  private _removeFilters(eventsFilters: SubscriptionFilter[]) {\n    this.filters = this.filters.filter((x) => !eventsFilters.includes(x));\n  }\n\n  @action\n  private _notifyMessage(message: unknown) {\n    this.message = message ?? null;\n  }\n\n  @state\n  filters: SubscriptionFilter[] = [];\n\n  @state\n  message?: unknown = null;\n}\n"],"mappings":"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"}