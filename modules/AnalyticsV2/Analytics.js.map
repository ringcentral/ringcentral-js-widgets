{"version":3,"sources":["modules/AnalyticsV2/Analytics.ts"],"names":["Analytics","name","deps","dep","optional","_useLog","_deps","analyticsOptions","useLog","_lingerThreshold","lingerThreshold","_enablePendo","enablePendo","_pendoApiKey","pendoApiKey","_trackRouters","trackRouters","_segment","_logs","_lingerTimeout","_pendo","_waitPendoCount","_pendoTimeout","_env","env","Pendo","init","pendoInstance","analyticsKey","load","integrations","All","Mixpanel","routerInteraction","trackRouter","currentPath","target","getTrackTarget","trackNavigation","clearTimeout","setTimeout","trackLinger","_identify","userId","auth","ownerId","options","props","analytics","identify","companyName","extensionInfo","info","contact","company","_pendoInitialize","accountInfo","id","initializeFunc","isReady","initialize","updateOptions","pendoAgent","visitor","appName","brand","defaultConfig","appVersion","appBrand","code","plaBrand","serviceInfo","countryCode","account","event","properties","trackProps","analyticsEventExtendedProps","extendedProps","get","track","push","timeStamp","Date","toISOString","blob","Blob","JSON","stringify","type","router","eventPostfix","routes","split","formatRoute","needMatchSecondRoutes","length","indexOf","find","global","locale","currentLocale","browserLocale","RcModuleV2","proxify"],"mappings":"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","sourcesContent":["import { RcModuleV2, watch } from '@ringcentral-integration/core';\n\nimport { Pendo, Segment } from '../../lib/Analytics';\nimport { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\nimport saveBlob from '../../lib/saveBlob';\nimport {\n  Deps,\n  IdentifyOptions,\n  PendoAgent,\n  TrackLog,\n  TrackProps,\n  TrackRouter,\n} from './Analytics.interface';\nimport { trackRouters } from './analyticsRouters';\n\n// TODO: refactoring the module against `https://docs.google.com/spreadsheets/d/1xufV6-C-RJR6OJgwFYHYzNQwhIdN4BXXCo8ABs7RT-8/edit#gid=1480480736`\n// TODO: if use `dialerUI`/`callLogSection`/`adapter`, make sure they should all be RcModuleV2\n@Module({\n  name: 'Analytics',\n  deps: [\n    'Auth',\n    'Brand',\n    'AnalyticsOptions',\n    { dep: 'AccountInfo', optional: true },\n    { dep: 'ExtensionInfo', optional: true },\n    { dep: 'RouterInteraction', optional: true },\n    { dep: 'Locale', optional: true },\n    { dep: 'AnalyticsEventExtendedProps', optional: true },\n  ],\n})\nexport class Analytics<T extends Deps = Deps> extends RcModuleV2<T> {\n  protected _useLog = this._deps.analyticsOptions.useLog ?? false;\n\n  protected _lingerThreshold =\n    this._deps.analyticsOptions.lingerThreshold ?? 1000;\n\n  protected _enablePendo = this._deps.analyticsOptions.enablePendo ?? false;\n\n  protected _pendoApiKey = this._deps.analyticsOptions.pendoApiKey ?? '';\n\n  protected _trackRouters =\n    this._deps.analyticsOptions.trackRouters ?? trackRouters;\n\n  protected _segment: any;\n\n  protected _logs: TrackLog[] = [];\n\n  protected _lingerTimeout?: NodeJS.Timeout = null;\n\n  private _pendo: any;\n\n  private _waitPendoCount: number;\n\n  private _pendoTimeout: ReturnType<typeof setTimeout>;\n\n  private _env = this._deps.analyticsOptions.env ?? 'dev';\n\n  constructor(deps: T) {\n    super({\n      deps,\n    });\n    this._segment = Segment();\n    if (this._enablePendo && this._pendoApiKey) {\n      Pendo.init(this._pendoApiKey, (pendoInstance: any) => {\n        this._pendo = pendoInstance;\n      });\n    }\n  }\n\n  onInitOnce() {\n    if (this._deps.analyticsOptions.analyticsKey && this._segment) {\n      this._segment.load(this._deps.analyticsOptions.analyticsKey, {\n        integrations: {\n          All: true,\n          Mixpanel: true,\n        },\n      });\n    }\n    if (this._deps.routerInteraction) {\n      // make sure that track if refresh app\n      this.trackRouter();\n      watch(\n        this,\n        () => this._deps.routerInteraction.currentPath,\n        (currentPath) => {\n          this.trackRouter(currentPath);\n        },\n      );\n    }\n  }\n\n  trackRouter(currentPath = this._deps.routerInteraction.currentPath) {\n    const target = this.getTrackTarget(currentPath);\n    if (target) {\n      this.trackNavigation(target);\n    }\n\n    if (this._lingerTimeout) {\n      clearTimeout(this._lingerTimeout);\n    }\n    this._lingerTimeout = setTimeout(() => {\n      this._lingerTimeout = null;\n      if (target && this._deps.routerInteraction.currentPath === currentPath) {\n        this.trackLinger(target);\n      }\n    }, this._lingerThreshold);\n  }\n\n  setUserId() {\n    this._identify({\n      userId: this._deps.auth.ownerId,\n    });\n  }\n\n  identify(options: IdentifyOptions) {\n    this._identify(options);\n  }\n\n  protected _identify({ userId, ...props }: IdentifyOptions) {\n    if (this.analytics) {\n      this.analytics.identify(\n        userId,\n        {\n          ...props,\n          companyName: this._deps.extensionInfo?.info?.contact?.company,\n        },\n        {\n          integrations: {\n            All: true,\n            Mixpanel: true,\n            Pendo: this._enablePendo,\n          },\n        },\n      );\n    }\n    if (this._enablePendo && this._pendoApiKey) {\n      this._pendoInitialize({ userId, ...props, env: this._env });\n    }\n  }\n\n  protected _pendoInitialize({\n    userId,\n    ...props\n  }: { userId: string } & Record<string, any>) {\n    if (!this._deps.accountInfo || !this._deps.accountInfo.id || !userId) {\n      return;\n    }\n    if (this._pendoTimeout) {\n      clearTimeout(this._pendoTimeout);\n    }\n    if (this._waitPendoCount > 3) {\n      return;\n    }\n    if (!this._pendo) {\n      this._pendoTimeout = setTimeout(() => {\n        this._waitPendoCount += 1;\n        this._pendoInitialize({ userId, ...props });\n      }, 5 * 1000);\n      return;\n    }\n    const initializeFunc = !this._pendo.isReady()\n      ? this._pendo.initialize\n      : this._pendo.updateOptions;\n    const pendoAgent: PendoAgent = {\n      visitor: {\n        id: userId,\n        ...props,\n        companyName: this._deps.extensionInfo?.info?.contact?.company,\n        appName: this._deps.brand.defaultConfig.appName,\n        appVersion: this._deps.analyticsOptions.appVersion,\n        appBrand: this._deps.brand.defaultConfig.code,\n        plaBrand: this._deps.accountInfo?.serviceInfo?.brand?.name,\n        countryCode: this._deps.accountInfo?.countryCode,\n      },\n      account: {\n        id: `${this._deps.accountInfo.id}`,\n      },\n    };\n    typeof initializeFunc === 'function' &&\n      initializeFunc({\n        ...pendoAgent,\n      });\n  }\n\n  @proxify\n  async track(event: string, properties: any = {}) {\n    if (!this.analytics) {\n      return;\n    }\n\n    const trackProps: TrackProps = {\n      ...this.trackProps,\n      ...properties,\n      ...this._deps.analyticsEventExtendedProps?.extendedProps.get(event),\n    };\n\n    this.analytics.track(event, trackProps, {\n      integrations: {\n        All: true,\n        Mixpanel: true,\n        Pendo: this._enablePendo,\n      },\n    });\n\n    if (this._useLog) {\n      this._logs.push({\n        timeStamp: new Date().toISOString(),\n        event,\n        trackProps,\n      });\n    }\n\n    if (this._enablePendo && this._pendo?.isReady?.()) {\n      this._pendo.track(`${trackProps.appName}-${event}`, trackProps);\n    }\n  }\n\n  downloadLogs() {\n    if (!this._useLog) {\n      return;\n    }\n    const blob = new Blob([JSON.stringify(this._logs, null, 2)], {\n      type: 'application/json',\n    });\n    saveBlob('logs.json', blob);\n  }\n\n  trackNavigation({ router, eventPostfix }: TrackRouter) {\n    const trackProps = {\n      router,\n      appName: this._deps.brand.defaultConfig.appName,\n      appVersion: this._deps.analyticsOptions.appVersion,\n      brand: this._deps.brand.defaultConfig.code,\n    };\n    this.track(`Navigation: Click/${eventPostfix}`, trackProps);\n  }\n\n  trackLinger({ router, eventPostfix }: TrackRouter) {\n    const trackProps = {\n      router,\n      appName: this._deps.brand.defaultConfig.appName,\n      appVersion: this._deps.analyticsOptions.appVersion,\n      brand: this._deps.brand.defaultConfig.code,\n    };\n    this.track(`Navigation: View/${eventPostfix}`, trackProps);\n  }\n\n  getTrackTarget(\n    currentPath = this._deps.routerInteraction?.currentPath,\n  ): TrackRouter {\n    if (!currentPath) {\n      return null;\n    }\n    const routes = currentPath.split('/');\n    let formatRoute: string = null;\n    const needMatchSecondRoutes = ['calls'];\n    if (routes.length >= 3 && needMatchSecondRoutes.indexOf(routes[1]) !== -1) {\n      formatRoute = `/${routes[1]}/${routes[2]}`;\n    } else if (routes.length > 1) {\n      formatRoute = `/${routes[1]}`;\n    }\n    const target = this._trackRouters.find(\n      (target) => formatRoute === target.router,\n    );\n    return target;\n  }\n\n  get analytics() {\n    return (global as any).analytics;\n  }\n\n  get trackProps(): TrackProps {\n    return {\n      appName: this._deps.brand.defaultConfig.appName,\n      appVersion: this._deps.analyticsOptions.appVersion,\n      brand: this._deps.brand.defaultConfig.code,\n      'App Language': this._deps.locale?.currentLocale || '',\n      'Browser Language': this._deps.locale?.browserLocale || '',\n      'Extension Type': this._deps.extensionInfo?.info.type || '',\n    };\n  }\n}\n"],"file":"Analytics.js"}