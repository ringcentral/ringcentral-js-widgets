{"version":3,"sources":["modules/RcVideo/RcVideo.ts"],"names":["RcVideo","deps","dep","optional","extensionId","accountId","state","loginUser","currentUser","extensionName","brandName","_brand","brandConfig","rcvMeetingTopic","alert","client","extensionInfo","brand","storage","reducers","availabilityMonitor","meetingProvider","accountInfo","locale","enableE2EE","showSaveAsDefault","isInstantMeeting","enablePersonalMeeting","enableReloadAfterSchedule","enableScheduleOnBehalf","enableWaitingRoom","enableInvitationApi","enableHostCountryDialinNumbers","options","actionTypes","_alert","_client","_defaultVideoSettingKey","_personalVideoKey","_extensionInfo","_storage","_availabilityMonitor","_showSaveAsDefault","_isInstantMeeting","_enableE2EE","_enablePersonalMeeting","_enableReloadAfterSchedule","_enableWaitingRoom","_enableInvitationApi","_meetingProvider","_reducer","_enableScheduleOnBehalf","_enableHostCountryDialinNumbers","_accountInfo","_locale","_createMeetingPromise","registerReducer","key","reducer","store","subscribe","_onStateChange","_shouldInit","_init","_shouldReset","_reset","pending","ready","isRCV","dispatch","type","resetSuccess","init","_onInit","initSuccess","_initMeeting","_initDelegators","updateDelegator","usePersonalMeetingId","_initMeetingSettings","delegator","userExtensionId","delegators","length","user","Number","initSettingsStart","_initPersonalMeeting","_initPreferences","initSettingsEnd","_getPreferences","preferences","settingLocks","password_instant","updateMeetingPreferences","updateMeetingSettingLocks","console","log","service","platform","get","meetingResult","json","meeting","_savePersonalMeeting","error","resetPersonalMeeting","_errorHandle","result","updateDelegatorList","savePersonalMeeting","allowJoinBeforeHost","isOnlyAuthUserJoin","isOnlyCoworkersJoin","allowScreenSharing","muteAudio","muteVideo","e2ee","isMeetingSecret","notShowAgain","waitingRoomMode","updateInfo","_saved","saveAsDefaultSetting","password","isSecret","isAlertSuccess","initCreating","saveAsDefault","meetingDetail","condition","RCV_WAITING_ROOM_API_KEYS","RCV_E2EE_API_KEYS","post","updateMeetingSettings","_getDialinNumbers","dialInNumber","getExtensionInfo","savePreferencesChanges","setTimeout","success","message","meetingStatus","scheduledSuccess","newMeeting","created","updateHasSettingsChanged","getMeetingInvitation","hostName","name","meetingName","meetingId","id","meetingUrl","joinUri","participantCode","mainPhoneNumber","meetingPassword","dialInPassword","meetingPasswordPSTN","premiumNumbers","invitationInfo","meetingResponse","resetCreating","isScheduling","createMeetingDirectly","createMeeting","expiresIn","RcVideoTypes","invitationRequest","apiResponse","warn","phoneNumbers","Array","isArray","countryDialinNumbers","obj","country","isoCode","defaultPhoneNumber","phoneNumber","RCV_PREFERENCES_IDS","res","list","forEach","value","readOnly","info","account","extension","preferenceId","send","method","url","body","isOverwrite","preferencesPayload","dirtyPreferences","Object","entries","filter","kvPairs","newValue","oldValue","isLocked","Promise","all","map","_saveSinglePreference","_updatePreference","shortId","initUpdating","updatedSuccess","updated","personalMeeting","resetUpdating","personalVideoSetting","defaultVideoSetting","isChanged","saveHasSettingChanged","RCV_E2EE_DEFAULT_SECURITY_OPTIONS","settingLock","patch","processedMeeting","transformedPreferences","isMeetingPasswordValid","validatePasswordSettings","_comparePreferences","saveMeetingPreferencesState","isPreferencesChanged","errors","MeetingErrors","warning","response","clone","errorCode","permissionName","danger","insufficientPermissions","payload","checkIfHAError","internalError","getItem","currentLocale","DEFAULT_LOCALE","shortName","code","status","videoStatus","initializing","creating","hasSettingsChanged","ASSISTED_USERS_MYSELF","isLoginUser","RcModule","proxify","background","selector","initialVideoSetting","transformedSettingLocks","initialSetting","processedSettings","startTime","Date","savedSetting","savedDefaultVideoSetting","topic"],"mappings":"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","sourcesContent":["import { filter, find } from 'ramda';\nimport Client from 'ringcentral-client';\n\nimport { computed } from '@ringcentral-integration/core';\nimport { DEFAULT_LOCALE } from '@ringcentral-integration/i18n';\n\nimport { getInitializedStartTime } from '../../helpers/meetingHelper';\nimport {\n  RcVDialInNumberGET,\n  RcVDialInNumberObj,\n  RcVideoAPI,\n  RcvInvitationInfo,\n  RcvInvitationRequest,\n  RcVMeetingModel,\n  RcVPreferenceDataItem,\n  RcVPreferences,\n  RcVPreferencesAPIResult,\n  RcVPreferencesGET,\n  RcVSettingLocks,\n  RcVSettingLocksGET,\n} from '../../interfaces/Rcv.model';\nimport background from '../../lib/background';\nimport { Module } from '../../lib/di';\nimport { proxify } from '../../lib/proxy/proxify';\nimport RcModule from '../../lib/RcModule';\nimport { selector } from '../../lib/selector';\nimport { MeetingErrors } from '../Meeting';\nimport meetingStatus from '../Meeting/meetingStatus';\nimport {\n  formatMainPhoneNumber,\n  formatPremiumNumbers,\n} from '../RcVideoV2/videoHelper';\nimport actionTypes, { RcVideoActionTypes } from './actionTypes';\nimport { ASSISTED_USERS_MYSELF, RcvWaitingRoomModeProps } from './constants';\nimport getRcVReducer, {\n  getDefaultVideoSettingReducer,\n  getPersonalMeetingReducer,\n} from './getRcVReducer';\nimport { RcvDelegator } from './interface';\nimport {\n  comparePreferences,\n  generateRandomPassword,\n  getDefaultVideoSettings,\n  getLockedPreferences,\n  getTopic,\n  patchWaitingRoomRelated,\n  pruneMeetingObject,\n  RCV_E2EE_API_KEYS,\n  RCV_E2EE_DEFAULT_SECURITY_OPTIONS,\n  RCV_PREFERENCES_IDS,\n  RCV_WAITING_ROOM_API_KEYS,\n  RcVideoTypes,\n  reversePreferences,\n  transformPreferences,\n  transformSettingLocks,\n  validatePasswordSettings,\n} from './videoHelper';\nimport { videoStatus } from './videoStatus';\n\n@Module({\n  deps: [\n    'Alert',\n    'Client',\n    'Brand',\n    'Storage',\n    'AccountInfo',\n    'ExtensionInfo',\n    'MeetingProvider',\n    'Locale',\n    { dep: 'AvailabilityMonitor', optional: true },\n    { dep: 'RcVideoOptions', optional: true },\n  ],\n})\nexport class RcVideo extends RcModule<Record<string, any>, RcVideoActionTypes> {\n  // TODO: add state interface\n  private _alert: any;\n  private _client: Client;\n  private _defaultVideoSettingKey: string;\n  private _personalVideoKey: string;\n  private _extensionInfo: any;\n  private _brand: any;\n  private _storage: any;\n  private _availabilityMonitor: any;\n  private _showSaveAsDefault: boolean;\n  private _isInstantMeeting: boolean;\n  private _enableE2EE: boolean;\n  private _enablePersonalMeeting: boolean;\n  private _enableReloadAfterSchedule: boolean;\n  private _enableWaitingRoom: boolean;\n  private _enableInvitationApi: boolean;\n\n  private _meetingProvider: any;\n  _reducer: any;\n  private _enableScheduleOnBehalf: boolean;\n  private _enableHostCountryDialinNumbers: boolean;\n  private _accountInfo: any;\n  private _locale: any;\n  private _createMeetingPromise: any = null;\n\n  constructor({\n    alert,\n    client,\n    extensionInfo,\n    brand,\n    storage,\n    reducers,\n    availabilityMonitor,\n    meetingProvider,\n    accountInfo,\n    locale,\n    enableE2EE = false,\n    showSaveAsDefault = false,\n    isInstantMeeting = false,\n    enablePersonalMeeting = false,\n    enableReloadAfterSchedule = true,\n    enableScheduleOnBehalf = false,\n    enableWaitingRoom = false,\n    enableInvitationApi = false,\n    enableHostCountryDialinNumbers = false,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: options.actionTypes || actionTypes,\n    });\n    this._alert = alert;\n    this._client = client;\n    this._extensionInfo = extensionInfo;\n    this._meetingProvider = meetingProvider;\n    this._brand = brand;\n    this._storage = storage;\n    this._accountInfo = accountInfo;\n    this._locale = locale;\n    this._reducer = getRcVReducer(this.actionTypes, reducers);\n    this._showSaveAsDefault = showSaveAsDefault;\n    this._isInstantMeeting = isInstantMeeting;\n    this._availabilityMonitor = availabilityMonitor;\n    this._defaultVideoSettingKey = 'savedDefaultSetting';\n    this._personalVideoKey = 'personalVideo';\n    this._enablePersonalMeeting = enablePersonalMeeting;\n    this._enableScheduleOnBehalf = enableScheduleOnBehalf;\n    this._enableHostCountryDialinNumbers = enableHostCountryDialinNumbers;\n    this._enableReloadAfterSchedule = enableReloadAfterSchedule;\n    this._enableWaitingRoom = enableWaitingRoom;\n    this._enableInvitationApi = enableInvitationApi;\n    this._enableE2EE = enableE2EE;\n    if (this._showSaveAsDefault) {\n      this._storage.registerReducer({\n        key: this._defaultVideoSettingKey,\n        reducer: getDefaultVideoSettingReducer(this.actionTypes),\n      });\n    }\n    if (this._enablePersonalMeeting) {\n      this._storage.registerReducer({\n        key: this._personalVideoKey,\n        reducer: getPersonalMeetingReducer(this.actionTypes),\n      });\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      await this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this.pending &&\n      this._accountInfo.ready &&\n      this._extensionInfo.ready &&\n      this._storage.ready &&\n      this._meetingProvider.ready &&\n      this._meetingProvider.isRCV &&\n      (!this._availabilityMonitor || this._availabilityMonitor.ready)\n    );\n  }\n\n  _shouldReset() {\n    return (\n      this.ready &&\n      (!this._accountInfo.ready ||\n        !this._extensionInfo.ready ||\n        !this._storage.ready ||\n        !this._meetingProvider.ready ||\n        !this._meetingProvider.isRCV ||\n        (this._availabilityMonitor && !this._availabilityMonitor.ready))\n    );\n  }\n\n  _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  async _init() {\n    this.store.dispatch({\n      type: this.actionTypes.init,\n    });\n\n    await this._onInit();\n\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  @proxify\n  async _onInit() {\n    await this._initMeeting();\n\n    if (this._enableScheduleOnBehalf) {\n      await this._initDelegators();\n      this.updateDelegator(this.loginUser);\n    }\n  }\n\n  /**\n   * Init basic meeting information\n   * also load meeting setting from previous one.\n   */\n  @background\n  async init() {\n    await this._onInit();\n  }\n\n  @proxify\n  async reload() {\n    await this._onInit();\n  }\n\n  @proxify\n  async switchUsePersonalMeetingId(usePersonalMeetingId: boolean) {\n    this._initMeetingSettings(usePersonalMeetingId);\n  }\n\n  @proxify\n  updateDelegator(delegator: RcvDelegator) {\n    this.store.dispatch({\n      type: this.actionTypes.updateDelegator,\n      delegator,\n    });\n  }\n\n  @proxify\n  async updateScheduleFor(userExtensionId: string) {\n    if (!userExtensionId || !this.delegators || this.delegators.length === 0) {\n      return;\n    }\n\n    const delegator = find(\n      (user: RcvDelegator) => user.extensionId === userExtensionId,\n      this.delegators,\n    );\n\n    if (!delegator) {\n      return;\n    }\n\n    this.updateDelegator(delegator);\n\n    await this._initMeeting(Number(delegator.extensionId));\n  }\n\n  private async _initMeeting(extensionId = this.extensionId) {\n    this.store.dispatch({\n      type: this.actionTypes.initSettingsStart,\n    });\n    if (this._enablePersonalMeeting) {\n      await this._initPersonalMeeting(this.accountId, extensionId);\n    }\n    await this._initPreferences();\n\n    this._initMeetingSettings(false);\n    this.store.dispatch({\n      type: this.actionTypes.initSettingsEnd,\n    });\n  }\n\n  private async _initPreferences() {\n    try {\n      const { preferences, settingLocks } = await this._getPreferences(\n        this.accountId,\n        this.extensionId,\n      );\n      // TODO [SFB] Remove the next line after rcv implement ui to manage password_instant\n      preferences.password_instant = false;\n      this.store.dispatch({\n        type: this.actionTypes.updateMeetingPreferences,\n        preferences,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.updateMeetingSettingLocks,\n        settingLocks,\n      });\n    } catch (errors) {\n      console.log('preference error:', errors);\n      // this._errorHandle(errors);\n    }\n  }\n\n  private async _initPersonalMeeting(\n    accountId = this.accountId,\n    extensionId = this.extensionId,\n  ) {\n    try {\n      const meetingResult = await this._client.service\n        .platform()\n        .get('/rcvideo/v1/bridges', {\n          default: true,\n          accountId,\n          extensionId,\n        });\n      const meeting = await meetingResult.json();\n      this._savePersonalMeeting(meeting);\n    } catch (errors) {\n      console.error('fetch personal meeting error:', errors);\n      this.store.dispatch({\n        type: this.actionTypes.resetPersonalMeeting,\n      });\n      this._errorHandle(errors);\n    }\n  }\n\n  private async _initDelegators() {\n    try {\n      const result = await this._client.service\n        .platform()\n        .get('/rcvideo/v1/accounts/~/extensions/~/delegators');\n      const delegators = await result.json();\n      this.store.dispatch({\n        type: this.actionTypes.updateDelegatorList,\n        delegators,\n      });\n    } catch (errors) {\n      this._errorHandle(errors);\n    }\n  }\n\n  private _savePersonalMeeting(meeting: RcVideoAPI) {\n    this.store.dispatch({\n      type: this.actionTypes.savePersonalMeeting,\n      meeting,\n    });\n  }\n\n  saveAsDefaultSetting(meeting: RcVMeetingModel) {\n    const {\n      allowJoinBeforeHost,\n      isOnlyAuthUserJoin,\n      isOnlyCoworkersJoin,\n      allowScreenSharing,\n      muteAudio,\n      muteVideo,\n      e2ee,\n      isMeetingSecret,\n      notShowAgain,\n      waitingRoomMode,\n    } = meeting;\n    const updateInfo: {\n      allowJoinBeforeHost: boolean;\n      isOnlyAuthUserJoin: boolean;\n      isOnlyCoworkersJoin: boolean;\n      allowScreenSharing: boolean;\n      muteAudio: boolean;\n      muteVideo: boolean;\n      e2ee: boolean;\n      isMeetingSecret: boolean;\n      waitingRoomMode: RcvWaitingRoomModeProps;\n      _saved?: boolean;\n    } = {\n      allowJoinBeforeHost,\n      isOnlyAuthUserJoin,\n      isOnlyCoworkersJoin,\n      allowScreenSharing,\n      muteAudio,\n      muteVideo,\n      e2ee,\n      isMeetingSecret,\n      waitingRoomMode,\n    };\n    if (notShowAgain) {\n      updateInfo._saved = notShowAgain;\n    }\n\n    this.store.dispatch({\n      type: this.actionTypes.saveAsDefaultSetting,\n      meeting: updateInfo,\n    });\n  }\n\n  validatePasswordSettings(password: string, isSecret: boolean): boolean {\n    return validatePasswordSettings(password, isSecret);\n  }\n\n  generateRandomPassword() {\n    return generateRandomPassword(10);\n  }\n\n  @proxify\n  async createMeetingDirectly(\n    meeting: RcVMeetingModel,\n    { isAlertSuccess = true }: { isAlertSuccess?: boolean } = {},\n  ) {\n    try {\n      this.store.dispatch({\n        type: this.actionTypes.initCreating,\n      });\n\n      if (this._showSaveAsDefault && meeting.saveAsDefault) {\n        this.saveAsDefaultSetting(meeting);\n      }\n\n      const meetingDetail = pruneMeetingObject(meeting, [\n        {\n          condition: this.enableWaitingRoom,\n          key: RCV_WAITING_ROOM_API_KEYS,\n        },\n        {\n          condition: this.enableE2EE && !meeting.usePersonalMeetingId,\n          key: RCV_E2EE_API_KEYS,\n        },\n      ]);\n\n      const meetingResult = await this._client.service\n        .platform()\n        .post('/rcvideo/v1/bridges', meetingDetail);\n\n      this.updateMeetingSettings({\n        ...meeting,\n        saveAsDefault: false,\n      });\n\n      // After Create\n      const dialInNumber = await this._getDialinNumbers();\n      const extensionInfo = await this.getExtensionInfo(\n        this.currentUser.extensionId,\n      );\n      // sync preferences changes to rcv backend\n      if (meeting.saveAsDefault) {\n        await this.savePreferencesChanges(meeting);\n      }\n      // this will also fetch preference from rcv backend\n      if (this._enableReloadAfterSchedule) {\n        await this._initMeeting(Number(this.currentUser.extensionId));\n      }\n\n      if (isAlertSuccess) {\n        setTimeout(() => {\n          this._alert.success({\n            message: meetingStatus.scheduledSuccess,\n          });\n        }, 50);\n      }\n\n      const newMeeting = await meetingResult.json();\n      this.store.dispatch({\n        type: this.actionTypes.created,\n      });\n\n      this.updateHasSettingsChanged(false);\n\n      const invitationInfo = await this.getMeetingInvitation({\n        hostName: extensionInfo.name,\n        meetingName: newMeeting.name,\n        meetingId: newMeeting.id,\n        meetingUrl: newMeeting.joinUri,\n        participantCode: newMeeting.participantCode,\n        mainPhoneNumber: formatMainPhoneNumber(dialInNumber),\n        password: newMeeting.meetingPassword,\n        dialInPassword: newMeeting.meetingPasswordPSTN,\n        premiumNumbers: formatPremiumNumbers(dialInNumber),\n      });\n\n      const meetingResponse = {\n        invitationInfo,\n        extensionInfo,\n        dialInNumber,\n        meeting: { ...meeting, ...newMeeting },\n      };\n\n      return {\n        ...meetingResponse,\n        ...meeting,\n      };\n    } catch (errors) {\n      this.store.dispatch({\n        type: this.actionTypes.resetCreating,\n      });\n      this._errorHandle(errors);\n      return null;\n    }\n  }\n\n  @proxify\n  async createMeeting(\n    meeting: RcVMeetingModel,\n    { isAlertSuccess = true }: { isAlertSuccess?: boolean } = {},\n  ) {\n    if (this.isScheduling) return this._createMeetingPromise;\n    this._createMeetingPromise = this.createMeetingDirectly(meeting, {\n      isAlertSuccess,\n    });\n    const result = await this._createMeetingPromise;\n    this._createMeetingPromise = null;\n    return result;\n  }\n\n  async startMeeting(\n    meeting: RcVMeetingModel,\n    isAlertSuccess: boolean = true,\n  ): Promise<any> {\n    // When user click on button \"start\", client create bridge type=0, but doesn't send time-to-life for this bridge. Backend has default ttl = 24 hours.\n    return this.createMeeting(\n      {\n        ...meeting,\n        expiresIn: null,\n        type: RcVideoTypes.meeting,\n      },\n      { isAlertSuccess },\n    );\n  }\n\n  @proxify\n  async getMeetingInvitation(\n    invitationRequest: RcvInvitationRequest,\n  ): Promise<RcvInvitationInfo> {\n    if (!this._enableInvitationApi) {\n      return null;\n    }\n\n    try {\n      const apiResponse = await this._client.service\n        .platform()\n        .post('/rcvideo/v1/invitations/render', invitationRequest);\n      return await apiResponse.json();\n    } catch (ex) {\n      console.warn('failed to get invitation', ex);\n      return null;\n    }\n  }\n\n  @proxify\n  private async _getDialinNumbers(): Promise<string | RcVDialInNumberObj[]> {\n    const result = await this._client.service\n      .platform()\n      .get('/rcvideo/v1/dial-in-numbers');\n    const { phoneNumbers } = (await result.json()) as RcVDialInNumberGET;\n    if (Array.isArray(phoneNumbers)) {\n      if (this._enableHostCountryDialinNumbers) {\n        const countryDialinNumbers = filter(\n          (obj) => obj?.country?.isoCode === this.country.isoCode,\n          phoneNumbers,\n        );\n        if (countryDialinNumbers.length > 0) {\n          return countryDialinNumbers;\n        }\n      }\n\n      const defaultPhoneNumber = find((obj) => obj.default, phoneNumbers);\n      if (defaultPhoneNumber) {\n        return defaultPhoneNumber.phoneNumber;\n      }\n    }\n    return [];\n  }\n\n  private async _getPreferences(\n    accountId = this.accountId,\n    extensionId = this.extensionId,\n  ): Promise<RcVPreferencesAPIResult> {\n    const res = await this._client.service\n      .platform()\n      .get(\n        `/rcvideo/v1/account/${accountId}/extension/${extensionId}/preferences`,\n        {\n          id: RCV_PREFERENCES_IDS,\n        },\n      );\n    const list: Array<RcVPreferenceDataItem> = await res.json();\n    const preferences: RcVPreferencesGET = {};\n    const settingLocks: RcVSettingLocksGET = {};\n\n    list.forEach(({ id, value, readOnly }) => {\n      preferences[id] = value;\n      settingLocks[id] = readOnly;\n    });\n    return { preferences, settingLocks };\n  }\n\n  @proxify\n  async getExtensionInfo(extensionId: string) {\n    if (Number(extensionId) === this.extensionId) {\n      return this._extensionInfo.info;\n    }\n    return this._client.account().extension(extensionId).get();\n  }\n\n  private _updatePreference(preferences: Partial<RcVPreferencesGET>) {\n    this.store.dispatch({\n      type: this.actionTypes.updateMeetingPreferences,\n      preferences,\n    });\n  }\n\n  private async _saveSinglePreference(\n    preferenceId: keyof RcVPreferencesGET,\n    value: boolean,\n  ): Promise<void> {\n    return this._client.service.platform().send({\n      method: 'PATCH',\n      url: `/rcvideo/v1/account/~/extension/~/preferences/${preferenceId}`,\n      body: { value },\n    });\n  }\n\n  /**\n   * Determined the different between client and server, then save them to the server.\n   * @param preferences preference fileds in meeting object\n   * @param isOverwrite if true, dispatch updateMeetingPreferences on success\n   */\n  async savePreferencesChanges(\n    preferences: RcVPreferences,\n    isOverwrite = false,\n  ): Promise<void> {\n    const preferencesPayload = reversePreferences(\n      preferences,\n      this._isInstantMeeting,\n    );\n    type PreferenceEntries = [keyof RcVPreferencesGET, boolean];\n    const dirtyPreferences = Object.entries(preferencesPayload).filter(\n      (kvPairs): kvPairs is PreferenceEntries => {\n        const [preferenceId, newValue] = kvPairs as PreferenceEntries;\n        const oldValue = this.preferences[preferenceId];\n        const isLocked = this.settingLocks[preferenceId];\n        // hack for watingRoom, it will change locked option\n        return newValue !== oldValue && !isLocked;\n      },\n    );\n    try {\n      await Promise.all(\n        dirtyPreferences.map(([preferenceId, newValue]: PreferenceEntries) => {\n          return this._saveSinglePreference(preferenceId, newValue);\n        }),\n      );\n      if (isOverwrite) {\n        this._updatePreference(preferencesPayload);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @proxify\n  async getMeeting(\n    meetingId: string,\n    accountId = this.accountId,\n    extensionId = this.extensionId,\n  ) {\n    const result = await this._client.service\n      .platform()\n      .get('/rcvideo/v1/bridges', {\n        shortId: meetingId,\n        accountId,\n        extensionId,\n      });\n    const meeting = await result.json();\n    return meeting;\n  }\n\n  @proxify\n  async updateMeeting(\n    meetingId: string,\n    meeting: RcVMeetingModel,\n    { isAlertSuccess = false }: { isAlertSuccess?: boolean } = {},\n  ) {\n    try {\n      this.store.dispatch({\n        type: this.actionTypes.initUpdating,\n      });\n\n      if (this._showSaveAsDefault && meeting.saveAsDefault) {\n        this.saveAsDefaultSetting(meeting);\n      }\n\n      const meetingDetail = pruneMeetingObject(meeting, [\n        {\n          condition: this.enableWaitingRoom,\n          key: RCV_WAITING_ROOM_API_KEYS,\n        },\n        {\n          condition: this.enableE2EE && !meeting.usePersonalMeetingId,\n          key: RCV_E2EE_API_KEYS,\n        },\n      ]);\n\n      const meetingResult = await this._client.service.platform().send({\n        method: 'PATCH',\n        url: `/rcvideo/v1/bridges/${meeting.id}`,\n        body: meetingDetail,\n      });\n      const newMeeting = await meetingResult.json();\n\n      // After Update\n      const dialInNumber = await this._getDialinNumbers();\n      const extensionInfo = await this.getExtensionInfo(\n        this.currentUser.extensionId,\n      );\n      const invitationInfo = await this.getMeetingInvitation({\n        hostName: extensionInfo.name,\n        meetingName: newMeeting.name,\n        meetingId: newMeeting.id,\n        meetingUrl: newMeeting.joinUri,\n        participantCode: newMeeting.participantCode,\n        mainPhoneNumber: formatMainPhoneNumber(dialInNumber),\n        password: newMeeting.meetingPassword,\n        dialInPassword: newMeeting.meetingPasswordPSTN,\n        premiumNumbers: formatPremiumNumbers(dialInNumber),\n      });\n\n      if (meeting.saveAsDefault) {\n        await this.savePreferencesChanges(meeting, true);\n      }\n\n      if (isAlertSuccess) {\n        setTimeout(() => {\n          this._alert.success({\n            message: meetingStatus.updatedSuccess,\n          });\n        }, 50);\n      }\n\n      this.store.dispatch({\n        type: this.actionTypes.updated,\n      });\n\n      this.updateHasSettingsChanged(false);\n\n      const meetingResponse = {\n        invitationInfo,\n        extensionInfo,\n        dialInNumber,\n        meeting: { ...meeting, ...newMeeting },\n      };\n      if (this.personalMeeting && newMeeting.id === this.personalMeeting.id) {\n        this._savePersonalMeeting(newMeeting);\n      }\n      return meetingResponse;\n    } catch (errors) {\n      this.store.dispatch({\n        type: this.actionTypes.resetUpdating,\n      });\n      this._errorHandle(errors);\n      return null;\n    }\n  }\n\n  private _initMeetingSettings(usePersonalMeetingId: boolean) {\n    if (usePersonalMeetingId) {\n      this.updateMeetingSettings({\n        ...this.personalVideoSetting,\n      });\n    } else {\n      this.updateMeetingSettings({\n        ...this.defaultVideoSetting,\n      });\n    }\n  }\n\n  updateHasSettingsChanged(isChanged: boolean) {\n    this.store.dispatch({\n      type: this.actionTypes.saveHasSettingChanged,\n      isChanged,\n    });\n  }\n\n  @proxify\n  async turnOnE2ee() {\n    this.updateMeetingSettings({\n      e2ee: true,\n      ...RCV_E2EE_DEFAULT_SECURITY_OPTIONS,\n      // if jbh is locked, do not change its value\n      allowJoinBeforeHost: this.meeting.settingLock.allowJoinBeforeHost\n        ? this.meeting.allowJoinBeforeHost\n        : RCV_E2EE_DEFAULT_SECURITY_OPTIONS.allowJoinBeforeHost,\n    });\n  }\n\n  @proxify\n  async updateMeetingSettings(\n    meeting: Partial<RcVMeetingModel>,\n    patch: boolean = true,\n  ) {\n    let processedMeeting = meeting;\n    if (this.enableWaitingRoom) {\n      processedMeeting = {\n        ...processedMeeting,\n        ...patchWaitingRoomRelated(\n          {\n            ...this.meeting,\n            ...processedMeeting,\n          },\n          this.transformedPreferences,\n          true,\n        ),\n      };\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateMeetingSettings,\n      meeting: {\n        ...processedMeeting,\n        isMeetingPasswordValid: this.validatePasswordSettings(\n          processedMeeting.meetingPassword ?? this.meeting?.meetingPassword,\n          processedMeeting.isMeetingSecret ?? this.meeting?.isMeetingSecret,\n        ),\n      },\n      patch,\n    });\n    this._comparePreferences();\n  }\n\n  private _comparePreferences() {\n    this.store.dispatch({\n      type: this.actionTypes.saveMeetingPreferencesState,\n      isPreferencesChanged: comparePreferences(\n        this.transformedPreferences,\n        this.meeting,\n      ),\n    });\n  }\n\n  private async _errorHandle(errors: any) {\n    if (errors instanceof MeetingErrors) {\n      for (const error of errors.all) {\n        this._alert.warning(error);\n      }\n    } else if (errors && errors.response) {\n      const { errorCode, permissionName } = await errors.response\n        .clone()\n        .json();\n      if (errorCode === 'InsufficientPermissions' && permissionName) {\n        this._alert.danger({\n          message: meetingStatus.insufficientPermissions,\n          payload: {\n            permissionName,\n          },\n        });\n      } else if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(errors))\n      ) {\n        this._alert.danger({\n          message: meetingStatus.internalError,\n        });\n      }\n    } else {\n      console.log('errors:', errors);\n      this._alert.danger({ message: meetingStatus.internalError });\n    }\n  }\n\n  get meeting(): RcVMeetingModel {\n    return this.state.meeting;\n  }\n\n  get personalMeeting(): RcVideoAPI {\n    return this._storage.getItem(this._personalVideoKey);\n  }\n\n  get country() {\n    return this._extensionInfo.country;\n  }\n\n  get currentLocale() {\n    return this._locale.currentLocale || DEFAULT_LOCALE;\n  }\n\n  get extensionName(): string {\n    return this._extensionInfo.info && this._extensionInfo.info.name;\n  }\n\n  get extensionId(): number {\n    return this._extensionInfo.info.id;\n  }\n\n  get accountId(): number {\n    return this._accountInfo.id;\n  }\n\n  get brandName(): string {\n    return this._brand.name;\n  }\n\n  get shortName(): string {\n    return this._brand.shortName;\n  }\n\n  get brandCode(): string {\n    return this._brand.code;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  // preferences directly from backend\n  get preferences(): RcVPreferencesGET {\n    return this.state.preferences;\n  }\n\n  get settingLocks(): RcVSettingLocksGET {\n    return this.state.settingLocks;\n  }\n\n  @selector\n  transformedPreferences: any = [\n    () => this._isInstantMeeting,\n    () => this.preferences,\n    (isInstantMeeting: boolean, preferences: RcVPreferencesGET) => {\n      return transformPreferences(preferences, isInstantMeeting);\n    },\n  ];\n\n  @selector\n  transformedSettingLocks: any = [\n    () => this._isInstantMeeting,\n    () => this.settingLocks,\n    (isInstantMeeting: boolean, settingLocks: RcVSettingLocksGET) => {\n      return transformSettingLocks(settingLocks, isInstantMeeting);\n    },\n  ];\n\n  @selector\n  personalVideoSetting: any = [\n    () => this.initialVideoSetting,\n    () => this.personalMeeting,\n    () => this.transformedPreferences,\n    () => this.transformedSettingLocks,\n    (\n      initialSetting: RcVMeetingModel,\n      personalMeeting: RcVideoAPI,\n      transformedPreferences: RcVPreferences,\n      transformedSettingLocks: RcVSettingLocks,\n    ) => {\n      if (!personalMeeting) {\n        return null;\n      }\n      const processedSettings = {\n        ...initialSetting,\n        ...personalMeeting,\n        ...getLockedPreferences(\n          transformedSettingLocks,\n          transformedPreferences,\n        ),\n        meetingPassword:\n          personalMeeting.meetingPassword || generateRandomPassword(10),\n        startTime: new Date(getInitializedStartTime()),\n        isMeetingPasswordValid: true, // assume personal meeting password is valid\n        id: personalMeeting.id,\n        usePersonalMeetingId: true,\n        settingLock: {\n          ...transformedSettingLocks,\n        },\n      } as RcVMeetingModel;\n      if (this.enableWaitingRoom) {\n        return {\n          ...processedSettings,\n          ...patchWaitingRoomRelated(processedSettings, transformedPreferences),\n        };\n      }\n      return processedSettings;\n    },\n  ];\n\n  @selector\n  defaultVideoSetting: any = [\n    () => this.initialVideoSetting,\n    () => {\n      const savedSetting = this._showSaveAsDefault\n        ? this.savedDefaultVideoSetting\n        : null;\n      return savedSetting;\n    },\n    () => this.transformedPreferences,\n    () => this.transformedSettingLocks,\n    (\n      initialSetting: RcVMeetingModel,\n      savedSetting: Partial<RcVMeetingModel>,\n      transformedPreferences: RcVPreferences,\n      transformedSettingLocks: RcVSettingLocks,\n    ) => {\n      return {\n        ...initialSetting,\n        ...savedSetting,\n        ...transformedPreferences,\n        meetingPassword: generateRandomPassword(10),\n        startTime: new Date(getInitializedStartTime()),\n        isMeetingPasswordValid: true, // generated random password is valid\n        id: null,\n        usePersonalMeetingId: false,\n        settingLock: {\n          ...transformedSettingLocks,\n        },\n      } as RcVMeetingModel;\n    },\n  ];\n\n  @selector\n  initialVideoSetting: any = [\n    () => {\n      let extensionName = this.extensionName;\n      if (this.currentUser?.extensionId !== `${this.extensionId}`) {\n        extensionName = this.currentUser?.name;\n      }\n      return extensionName;\n    },\n    () => this.brandName,\n    () => this.shortName,\n    () => this.currentUser,\n    () => this._brand.brandConfig.rcvMeetingTopic,\n    (\n      extensionName: string,\n      brandName: string,\n      shortName: string,\n      currentUser: RcvDelegator,\n      rcvMeetingTopic: string,\n    ) => {\n      const topic = getTopic({\n        extensionName,\n        brandName,\n        shortName,\n        rcvMeetingTopic,\n      });\n      return getDefaultVideoSettings({\n        topic,\n        accountId: currentUser.accountId,\n        extensionId: currentUser.extensionId,\n      });\n    },\n  ];\n\n  get savedDefaultVideoSetting(): Partial<RcVMeetingModel> {\n    return this._storage.getItem(this._defaultVideoSettingKey);\n  }\n\n  get isInitializing(): boolean {\n    return this.state.videoStatus === videoStatus.initializing;\n  }\n\n  get isScheduling(): boolean {\n    return this.state.videoStatus === videoStatus.creating;\n  }\n\n  get showSaveAsDefault(): boolean {\n    return this._showSaveAsDefault;\n  }\n\n  get enablePersonalMeeting(): boolean {\n    return this._enablePersonalMeeting;\n  }\n\n  get enableScheduleOnBehalf() {\n    return this._enableScheduleOnBehalf;\n  }\n\n  get enableWaitingRoom(): boolean {\n    return this._enableWaitingRoom;\n  }\n\n  get enableE2EE(): boolean {\n    return this._enableE2EE;\n  }\n\n  get isPreferencesChanged(): boolean {\n    return this.state.isPreferencesChanged;\n  }\n\n  get hasSettingsChanged(): boolean {\n    return this.state.hasSettingsChanged;\n  }\n\n  @computed(({ extensionId, accountId }: RcVideo) => [extensionId, accountId])\n  get loginUser(): RcvDelegator {\n    return {\n      name: ASSISTED_USERS_MYSELF,\n      id: `${this.extensionId}`,\n      extensionId: `${this.extensionId}`,\n      accountId: `${this.accountId}`,\n      isLoginUser: true,\n    };\n  }\n\n  @computed(({ state, loginUser }: RcVideo) => [state, loginUser])\n  get delegators(): RcvDelegator[] {\n    if (this.state.delegators.length === 0) {\n      return [];\n    }\n    return [this.loginUser, ...this.state.delegators];\n  }\n\n  get currentUser(): RcvDelegator {\n    return this.state.delegator || this.loginUser;\n  }\n\n  @computed(({ currentUser, extensionName, brandName, _brand }: RcVideo) => [\n    currentUser,\n    extensionName,\n    brandName,\n    _brand.brandConfig.rcvMeetingTopic,\n  ])\n  get defaultTopic(): string {\n    let extensionName = this.extensionName;\n    if (this.currentUser?.extensionId !== `${this.extensionId}`) {\n      extensionName = this.currentUser?.name;\n    }\n    return getTopic({\n      extensionName,\n      brandName: this.brandName,\n      shortName: this.shortName,\n      rcvMeetingTopic: this._brand.brandConfig.rcvMeetingTopic,\n    });\n  }\n}\n"],"file":"RcVideo.js"}