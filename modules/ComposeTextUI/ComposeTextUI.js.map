{"version":3,"sources":["modules/ComposeTextUI/ComposeTextUI.ts"],"names":["ComposeTextUI","name","deps","inputExpandable","supportAttachment","_deps","brand","locale","composeText","messageSender","connectivityMonitor","rateLimiter","extensionFeatures","contactSearch","isContentEmpty","messageText","length","attachments","fullName","currentLocale","sendButtonDisabled","ready","idle","toNumbers","typingToNumber","connectivity","throttling","senderNumbers","senderNumbersList","senderNumber","outboundSMS","hasOutboundSMSPermission","searchContactList","sortedResult","showSpinner","formatContactPhone","phoneNumber","areaCode","regionSettings","countryCode","phoneTypeRenderer","phoneSourceNameRenderer","recipientsContactInfoRenderer","recipientsContactPhoneRenderer","routerInteraction","messageStore","conversations","send","text","responses","pushMessages","conversationId","conversation","id","push","relateCorrespondentEntity","clean","console","log","then","err","formatPhone","detectPhoneNumbers","input","promises","split","map","item","validatePhoneNumber","isValid","undefined","Promise","all","results","detectedNumbers","filter","forEach","addToNumber","searchContact","searchString","debouncedSearch","updateSenderNumber","updateTypingToNumber","cleanTypingToNumber","removeToNumber","updateMessageText","addAttachment","removeAttachment","RcUIModuleV2"],"mappings":"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","sourcesContent":["import {\n  RcUIModuleV2,\n  UIFunctions,\n  UIProps,\n} from '@ringcentral-integration/core';\nimport Module from 'ringcentral-integration/lib/di/decorators/module';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\nimport {\n  ComposeTextPanelProps,\n  ComposeTextUIComponentProps,\n  Deps,\n} from './ComposeTextUI.interface';\n\n/**\n * TODO: check type correctness after migrating to @rx-ex for client\n */\n\n@Module({\n  name: 'ComposeTextUI',\n  deps: [\n    'Brand',\n    'ComposeText',\n    'ConnectivityMonitor',\n    'ContactSearch',\n    'Conversations',\n    'Locale',\n    'MessageSender',\n    'MessageStore',\n    'RateLimiter',\n    'RegionSettings',\n    'ExtensionFeatures',\n    'RouterInteraction',\n  ],\n})\nexport class ComposeTextUI extends RcUIModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n  getUIProps({\n    inputExpandable,\n    supportAttachment,\n  }: ComposeTextUIComponentProps): UIProps<ComposeTextPanelProps> {\n    const {\n      brand,\n      locale,\n      composeText,\n      messageSender,\n      connectivityMonitor,\n      rateLimiter,\n      extensionFeatures,\n      contactSearch,\n    } = this._deps;\n    const isContentEmpty =\n      composeText.messageText.length === 0 &&\n      (!composeText.attachments || composeText.attachments.length === 0);\n    return {\n      brand: brand.fullName,\n      currentLocale: locale.currentLocale,\n      sendButtonDisabled:\n        !(composeText.ready && messageSender.idle) ||\n        isContentEmpty ||\n        (composeText.toNumbers.length === 0 &&\n          composeText.typingToNumber.length === 0) ||\n        !connectivityMonitor.connectivity ||\n        rateLimiter.throttling,\n      senderNumbers: messageSender.senderNumbersList,\n      senderNumber: composeText.senderNumber,\n      typingToNumber: composeText.typingToNumber,\n      toNumbers: composeText.toNumbers,\n      messageText: composeText.messageText,\n      outboundSMS: extensionFeatures.hasOutboundSMSPermission,\n      searchContactList: contactSearch.sortedResult,\n      showSpinner: !(\n        composeText.ready &&\n        locale.ready &&\n        messageSender.ready &&\n        extensionFeatures.ready &&\n        contactSearch.ready\n      ),\n      inputExpandable,\n      attachments: composeText.attachments,\n      supportAttachment,\n    };\n  }\n\n  getUIFunctions({\n    formatContactPhone = (phoneNumber) =>\n      formatNumber({\n        phoneNumber,\n        areaCode: this._deps.regionSettings.areaCode,\n        countryCode: this._deps.regionSettings.countryCode,\n      }),\n    phoneTypeRenderer,\n    phoneSourceNameRenderer,\n    recipientsContactInfoRenderer,\n    recipientsContactPhoneRenderer,\n  }: ComposeTextUIComponentProps): UIFunctions<ComposeTextPanelProps> {\n    const {\n      routerInteraction,\n      composeText,\n      messageStore,\n      contactSearch,\n      conversations,\n    } = this._deps;\n    return {\n      async send(text, attachments) {\n        try {\n          const responses = await composeText.send(text, attachments);\n          if (!responses || responses.length === 0) {\n            return;\n          }\n          messageStore.pushMessages(responses);\n          if (responses.length === 1) {\n            const conversationId =\n              responses[0] &&\n              responses[0].conversation &&\n              responses[0].conversation.id;\n            if (!conversationId) {\n              return;\n            }\n            routerInteraction.push(`/conversations/${conversationId}`);\n          } else {\n            routerInteraction.push('/messages');\n          }\n          conversations.relateCorrespondentEntity(responses);\n          composeText.clean();\n          return;\n        } catch (err) {\n          console.log(err);\n        }\n        composeText.send(text, attachments).then(\n          (responses) => {\n            if (!responses || responses.length === 0) {\n              return null;\n            }\n            messageStore.pushMessages(responses);\n            if (responses.length === 1) {\n              const conversationId =\n                responses[0] &&\n                responses[0].conversation &&\n                responses[0].conversation.id;\n              if (!conversationId) {\n                return null;\n              }\n              routerInteraction.push(`/conversations/${conversationId}`);\n            } else {\n              routerInteraction.push('/messages');\n            }\n            conversations.relateCorrespondentEntity(responses);\n            composeText.clean();\n            return null;\n          },\n          (err) => {\n            console.log(err);\n          },\n        );\n      },\n      formatPhone: formatContactPhone,\n      formatContactPhone,\n      async detectPhoneNumbers(input) {\n        const promises = input.split(/,\\s*/g).map(async (item) => {\n          const isValid = await composeText.validatePhoneNumber(item);\n          return isValid ? item : undefined;\n        });\n        const results = await Promise.all(promises);\n        const detectedNumbers = results.filter((item) => !!item);\n        detectedNumbers.forEach((phoneNumber) => {\n          composeText.addToNumber({\n            phoneNumber,\n          });\n        });\n        return detectedNumbers.length > 0;\n      },\n      searchContact: (searchString) =>\n        contactSearch.debouncedSearch({ searchString }),\n      updateSenderNumber: ({ phoneNumber }) =>\n        composeText.updateSenderNumber(phoneNumber),\n      updateTypingToNumber: (...args) =>\n        composeText.updateTypingToNumber(...args),\n      cleanTypingToNumber: (...args) =>\n        composeText.cleanTypingToNumber(...args),\n      addToNumber: (...args) => composeText.addToNumber(...args),\n      removeToNumber: (...args) => composeText.removeToNumber(...args),\n      updateMessageText: (...args) => composeText.updateMessageText(...args),\n      phoneTypeRenderer,\n      phoneSourceNameRenderer,\n      recipientsContactInfoRenderer,\n      recipientsContactPhoneRenderer,\n      addAttachment: (...args) => composeText.addAttachment(...args),\n      removeAttachment: (...args) => composeText.removeAttachment(...args),\n    };\n  }\n}\n"],"file":"ComposeTextUI.js"}