{"version":3,"sources":["modules/ComposeTextUI/ComposeTextUI.ts"],"names":["ComposeTextUI","name","deps","inputExpandable","supportAttachment","_deps","brand","locale","composeText","messageSender","connectivityMonitor","rateLimiter","appFeatures","contactSearch","isContentEmpty","messageText","length","attachments","currentLocale","sendButtonDisabled","ready","idle","toNumbers","typingToNumber","connectivity","throttling","senderNumbers","senderNumbersList","senderNumber","outboundSMS","hasOutboundSMSPermission","searchContactList","sortedResult","showSpinner","formatContactPhone","phoneNumber","areaCode","regionSettings","countryCode","phoneTypeRenderer","phoneSourceNameRenderer","recipientsContactInfoRenderer","recipientsContactPhoneRenderer","routerInteraction","messageStore","conversations","send","text","responses","pushMessages","conversationId","conversation","id","push","relateCorrespondentEntity","clean","console","log","formatPhone","detectPhoneNumbers","input","promises","split","map","item","validatePhoneNumber","isValid","undefined","Promise","all","results","detectedNumbers","filter","forEach","addToNumber","searchContact","searchString","debouncedSearch","updateSenderNumber","updateTypingToNumber","cleanTypingToNumber","removeToNumber","updateMessageText","addAttachment","removeAttachment","RcUIModuleV2"],"mappings":"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","sourcesContent":["import Module from '@ringcentral-integration/commons/lib/di/decorators/module';\nimport formatNumber from '@ringcentral-integration/commons/lib/formatNumber';\nimport {\n  RcUIModuleV2,\n  UIFunctions,\n  UIProps,\n} from '@ringcentral-integration/core';\n\nimport { ComposeTextPanelProps } from '../../components/ComposeTextPanel';\nimport { ComposeTextUIComponentProps, Deps } from './ComposeTextUI.interface';\n\n/**\n * TODO: check type correctness after migrating to @rx-ex for client\n */\n\n@Module({\n  name: 'ComposeTextUI',\n  deps: [\n    'Brand',\n    'ComposeText',\n    'ConnectivityMonitor',\n    'ContactSearch',\n    'Conversations',\n    'Locale',\n    'MessageSender',\n    'MessageStore',\n    'RateLimiter',\n    'RegionSettings',\n    'AppFeatures',\n    'RouterInteraction',\n  ],\n})\nexport class ComposeTextUI extends RcUIModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n  getUIProps({\n    inputExpandable,\n    supportAttachment,\n  }: ComposeTextUIComponentProps): UIProps<ComposeTextPanelProps> {\n    const {\n      brand,\n      locale,\n      composeText,\n      messageSender,\n      connectivityMonitor,\n      rateLimiter,\n      appFeatures,\n      contactSearch,\n    } = this._deps;\n    const isContentEmpty =\n      composeText.messageText.length === 0 &&\n      (!composeText.attachments || composeText.attachments.length === 0);\n    return {\n      brand: brand.name,\n      currentLocale: locale.currentLocale,\n      sendButtonDisabled:\n        !(composeText.ready && messageSender.idle) ||\n        isContentEmpty ||\n        (composeText.toNumbers.length === 0 &&\n          composeText.typingToNumber.length === 0) ||\n        !connectivityMonitor.connectivity ||\n        rateLimiter.throttling,\n      senderNumbers: messageSender.senderNumbersList,\n      senderNumber: composeText.senderNumber,\n      typingToNumber: composeText.typingToNumber,\n      toNumbers: composeText.toNumbers,\n      messageText: composeText.messageText,\n      outboundSMS: appFeatures.hasOutboundSMSPermission,\n      searchContactList: contactSearch.sortedResult,\n      showSpinner: !(\n        composeText.ready &&\n        locale.ready &&\n        messageSender.ready &&\n        appFeatures.ready &&\n        contactSearch.ready\n      ),\n      inputExpandable,\n      attachments: composeText.attachments,\n      supportAttachment,\n    };\n  }\n\n  getUIFunctions({\n    formatContactPhone = (phoneNumber) =>\n      formatNumber({\n        phoneNumber,\n        areaCode: this._deps.regionSettings.areaCode,\n        countryCode: this._deps.regionSettings.countryCode,\n      }),\n    phoneTypeRenderer,\n    phoneSourceNameRenderer,\n    recipientsContactInfoRenderer,\n    recipientsContactPhoneRenderer,\n  }: ComposeTextUIComponentProps): UIFunctions<ComposeTextPanelProps> {\n    const {\n      routerInteraction,\n      composeText,\n      messageStore,\n      contactSearch,\n      conversations,\n    } = this._deps;\n    return {\n      async send(text, attachments) {\n        try {\n          const responses = await composeText.send(text, attachments);\n          if (!responses || responses.length === 0) {\n            return;\n          }\n          messageStore.pushMessages(responses);\n          if (responses.length === 1) {\n            const conversationId =\n              responses[0] &&\n              responses[0].conversation &&\n              responses[0].conversation.id;\n            if (!conversationId) {\n              return;\n            }\n            routerInteraction.push(`/conversations/${conversationId}`);\n          } else {\n            routerInteraction.push('/messages');\n          }\n          conversations.relateCorrespondentEntity(responses);\n          composeText.clean();\n          return;\n        } catch (err) {\n          console.log(err);\n        }\n      },\n      formatPhone: formatContactPhone,\n      formatContactPhone,\n      async detectPhoneNumbers(input) {\n        const promises = input.split(/,\\s*/g).map(async (item) => {\n          const isValid = await composeText.validatePhoneNumber(item);\n          return isValid ? item : undefined;\n        });\n        const results = await Promise.all(promises);\n        const detectedNumbers = results.filter((item) => !!item);\n        detectedNumbers.forEach((phoneNumber) => {\n          composeText.addToNumber({\n            phoneNumber,\n          });\n        });\n        return detectedNumbers.length > 0;\n      },\n      searchContact: (searchString) =>\n        contactSearch.debouncedSearch({ searchString }),\n      updateSenderNumber: ({ phoneNumber }) =>\n        composeText.updateSenderNumber(phoneNumber),\n      updateTypingToNumber: (...args) =>\n        composeText.updateTypingToNumber(...args),\n      cleanTypingToNumber: (...args) =>\n        composeText.cleanTypingToNumber(...args),\n      addToNumber: (...args) => composeText.addToNumber(...args),\n      removeToNumber: (...args) => composeText.removeToNumber(...args),\n      updateMessageText: (...args) => composeText.updateMessageText(...args),\n      phoneTypeRenderer,\n      phoneSourceNameRenderer,\n      recipientsContactInfoRenderer,\n      recipientsContactPhoneRenderer,\n      addAttachment: (...args) => composeText.addAttachment(...args),\n      removeAttachment: (...args) => composeText.removeAttachment(...args),\n    };\n  }\n}\n"],"file":"ComposeTextUI.js"}