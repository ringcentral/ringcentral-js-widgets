{"version":3,"sources":["modules/AppFeatures/AppFeatures.ts"],"names":["defaultConfiguration","CallLog","Conferencing","Fax","Voicemail","Pages","SMS","RingCentralApp","RingOut","Softphone","WebPhone","CallControl","ConferenceCall","Meetings","Glip","Contacts","HideContactsWhenNoCallOrMessage","CDC","AppFeaturesBase","name","deps","dep","optional","featureConfiguration","_deps","isRingOutEnabled","isWebPhoneEnabled","extensionFeatures","features","available","config","SMSReceiving","PagesReceiving","FaxReceiving","hasReadSMSPermission","hasReadPagesPermission","hasVoicemailPermission","hasReadFaxPermission","SMSSending","hasSendSMSPermission","PagesSending","hasSendPagesPermission","RoomConnectorBeta","MeetingsEncryption","ReadExtensionCallLog","auth","token","scope","indexOf","isCallingEnabled","hasReadMessagesPermission","RcModuleV2","AppFeatures"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA;AACO,IAAMA,oBAAoD,GAAG;AAClEC,EAAAA,OAAO,EAAE,IADyD;AAElE;AACAC,EAAAA,YAAY,EAAE,IAHoD;AAKlE;AACAC,EAAAA,GAAG,EAAE,IAN6D;AAOlEC,EAAAA,SAAS,EAAE,IAPuD;AAQlEC,EAAAA,KAAK,EAAE,IAR2D;AASlEC,EAAAA,GAAG,EAAE,IAT6D;AAWlE;AACAC,EAAAA,cAAc,EAAE,IAZkD;AAalEC,EAAAA,OAAO,EAAE,IAbyD;AAclEC,EAAAA,SAAS,EAAE,IAduD;AAelEC,EAAAA,QAAQ,EAAE,IAfwD;AAgBlEC,EAAAA,WAAW,EAAE,IAhBqD;AAiBlEC,EAAAA,cAAc,EAAE,IAjBkD;AAmBlE;AACAC,EAAAA,QAAQ,EAAE,IApBwD;AAsBlE;AACAC,EAAAA,IAAI,EAAE,KAvB4D;AAyBlE;AACAC,EAAAA,QAAQ,EAAE,IA1BwD;AA2BlEC,EAAAA,+BAA+B,EAAE,IA3BiC;AA6BlE;AACAC,EAAAA,GAAG,EAAE;AA9B6D,CAA7D;AAiCP;AACA;AACA;AACA;AACA;AACA;;;IAiBsBC,e,WAfrB,gBAAO;AACNC,EAAAA,IAAI,EAAE,aADA;AAENC,EAAAA,IAAI,EAAE,CACJ,MADI,EAEJ,mBAFI,EAGJ;AACEC,IAAAA,GAAG,EAAE,sBADP;AAEEC,IAAAA,QAAQ,EAAE;AAFZ,GAHI,EAOJ;AACED,IAAAA,GAAG,EAAE,oBADP;AAEEC,IAAAA,QAAQ,EAAE;AAFZ,GAPI;AAFA,CAAP,C,UAwBE,oBAAS;AAAA,MAAYC,oBAAZ,QAAGC,KAAH,CAAYD,oBAAZ;AAAA,SAA0D,CAClEA,oBADkE,CAA1D;AAAA,CAAT,C;;;;;AAND,2BAAYH,IAAZ,EAA2B;AAAA;;AAAA,6BACnB;AACJA,MAAAA,IAAI,EAAJA;AADI,KADmB;AAI1B;;;;wBAKe;AACd,6CACKpB,oBADL,GAEK,KAAKwB,KAAL,CAAWD,oBAFhB;AAID,K,CAED;;;;wBACuB;AACrB,aAAO,KAAKE,gBAAL,IAAyB,KAAKC,iBAArC;AACD;;;wBAEuB;AAAA;;AACtB,aAAO,CAAC,EACN,+BAAKF,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,0GAAuClB,QAAvC,kFAAiDmB,SAAjD,KACA,KAAKC,MAAL,CAAYpB,QAFN,CAAR;AAID;;;wBAEsB;AAAA;;AACrB,aAAO,CAAC,EACN,gCAAKc,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,4GAAuCpB,OAAvC,kFAAgDqB,SAAhD,KACA,KAAKC,MAAL,CAAYtB,OAFN,CAAR;AAID;;;wBAEwB;AACvB,aAAO,CAAC,CAAC,KAAKsB,MAAL,CAAYrB,SAArB;AACD;;;wBAE6B;AAC5B,aAAO,CAAC,CAAC,KAAKqB,MAAL,CAAYvB,cAArB;AACD;;;wBAE0B;AAAA;;AACzB,aAAO,CAAC,EACN,gCAAKiB,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,4GAAuCG,YAAvC,kFAAqDF,SAArD,KACA,KAAKC,MAAL,CAAYxB,GAFN,CAAR;AAID;;;wBAE4B;AAAA;;AAC3B,aAAO,CAAC,EACN,gCAAKkB,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,4GAAuCI,cAAvC,kFAAuDH,SAAvD,KACA,KAAKC,MAAL,CAAYzB,KAFN,CAAR;AAID;;;wBAE4B;AAAA;;AAC3B,aAAO,CAAC,EACN,gCAAKmB,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,6GAAuCxB,SAAvC,oFAAkDyB,SAAlD,KACA,KAAKC,MAAL,CAAY1B,SAFN,CAAR;AAID;;;wBAE0B;AAAA;;AACzB,aAAO,CAAC,EACN,iCAAKoB,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuCK,YAAvC,oFAAqDJ,SAArD,KACA,KAAKC,MAAL,CAAY3B,GAFN,CAAR;AAID;;;wBAE2B;AAC1B,aAAO,KAAK+B,oBAAL,IAA6B,KAAKC,sBAAzC;AACD;;;wBAE+B;AAC9B,aACE,KAAKD,oBAAL,IACA,KAAKC,sBADL,IAEA,KAAKC,sBAFL,IAGA,KAAKC,oBAJP;AAMD;;;wBAE0B;AAAA;;AACzB,aAAO,CAAC,EACN,iCAAKb,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuCU,UAAvC,oFAAmDT,SAAnD,KACA,KAAKC,MAAL,CAAYxB,GAFN,CAAR;AAID;;;wBAE8B;AAC7B,aAAO,KAAKiC,oBAAZ;AACD;;;wBAE4B;AAAA;;AAC3B,aAAO,CAAC,EACN,iCAAKf,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuCY,YAAvC,oFAAqDX,SAArD,KACA,KAAKC,MAAL,CAAYzB,KAFN,CAAR;AAID;;;wBAE8B;AAC7B,aAAO,KAAKoC,sBAAZ;AACD;;;wBAE8B;AAC7B,aAAO,KAAKF,oBAAL,IAA6B,KAAKE,sBAAzC;AACD;;;wBAE2B;AAAA;;AAC1B,aAAO,CAAC,EACN,iCAAKjB,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuCf,QAAvC,oFAAiDgB,SAAjD,KACA,KAAKC,MAAL,CAAYjB,QAFN,CAAR;AAID;;;wBAE0B;AAAA;;AACzB,aAAO,CAAC,6BAAC,KAAKW,KAAL,CAAWG,iBAAX,CAA6BC,QAA9B,uFAAC,wBAAuCc,iBAAxC,4DAAC,wBACLb,SADI,CAAR;AAED;;;wBAEkB;AAAA;;AACjB,aAAO,CAAC,6BAAC,KAAKL,KAAL,CAAWG,iBAAX,CAA6BC,QAA9B,uFAAC,wBAAuCe,kBAAxC,4DAAC,wBACLd,SADI,CAAR;AAED;;;wBAE6B;AAAA;;AAC5B,aAAO,CAAC,EACN,iCAAKL,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuCgB,oBAAvC,oFAA6Df,SAA7D,KACA,KAAKC,MAAL,CAAY7B,OAFN,CAAR;AAID;;;wBAEuB;AACtB,aACE,KAAKwB,gBAAL,IACA,KAAKC,iBADL,IAEA,KAAKI,MAAL,CAAYlB,cAHd;AAKD;;;wBAEqB;AAAA;;AACpB,aAAO,CAAC,EACN,iCAAKY,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuC1B,YAAvC,oFAAqD2B,SAArD,KACA,KAAKC,MAAL,CAAY5B,YAFN,CAAR;AAID;;;wBAEuB;AAAA;;AACtB,aAAO,CAAC,EACN,iCAAKsB,KAAL,CAAWG,iBAAX,CAA6BC,QAA7B,+GAAuCd,IAAvC,oFAA6Ce,SAA7C,KAA0D,KAAKC,MAAL,CAAYhB,IADhE,CAAR;AAGD;;;wBAEoB;AAAA;;AACnB,aACE,CAAC,+BAAKU,KAAL,CAAWqB,IAAX,CAAgBC,KAAhB,0GAAuBC,KAAvB,kFAA8BC,OAA9B,CAAsC,aAAtC,KAAuD,CAAC,CAAxD,IACC,gCAAKxB,KAAL,CAAWqB,IAAX,CAAgBC,KAAhB,4GAAuBC,KAAvB,kFAA8BC,OAA9B,CAAsC,kBAAtC,KAA4D,CAAC,CAD/D,KAEA,KAAKlB,MAAL,CAAYnB,WAHd;AAKD;;;wBAEuB;AACtB,aACE,KAAKmB,MAAL,CAAYf,QAAZ,KACC,CAAC,KAAKe,MAAL,CAAYd,+BAAb,IACE,KAAKc,MAAL,CAAYd,+BAAZ,KACE,KAAKiC,gBAAL,IAAyB,KAAKC,yBADhC,CAFH,CADF;AAMD;;;wBAEkB;AACjB,aAAO,CAAC,CAAC,KAAKpB,MAAL,CAAYb,GAArB;AACD;;;;EA/KOkC,gB;;IAmLGC,W,YADZ,iB;;;;;;;;;;;;EACgClC,e","sourcesContent":["import { computed, RcModuleV2 } from '@ringcentral-integration/core';\nimport { Module } from '../../lib/di';\nimport { Deps, FeatureConfiguration } from './AppFeatures.interface';\n\n// Required<FeatureConfiguration> helps to make sure that the default config aligns with the interface\nexport const defaultConfiguration: Required<FeatureConfiguration> = {\n  CallLog: true,\n  // Conferencing\n  Conferencing: true,\n\n  // Messages\n  Fax: true,\n  Voicemail: true,\n  Pages: true,\n  SMS: true,\n\n  // Call\n  RingCentralApp: true,\n  RingOut: true,\n  Softphone: true,\n  WebPhone: true,\n  CallControl: true,\n  ConferenceCall: true,\n\n  // Meetings\n  Meetings: true,\n\n  // Glip\n  Glip: false,\n\n  // Contacts Tab\n  Contacts: true,\n  HideContactsWhenNoCallOrMessage: true,\n\n  // CompanyDirectoryControl\n  CDC: false,\n};\n\n/**\n * AppFeatures:\n * * This module manages and provide access to feature toggle settings. This module also provide ways to dynamically update these settings. However, to avoid putting this module high in the dependency tree, this module only provide methods to update the settings that are cached in storage, but does not have the ability to make queries to external api to update settings on its own.\n * * (TODO): Implement cached settings and update settings features.\n * * (TODO): Brand module should depend on this and set the toggle based on brand if applicable. This module should not have other dependencies so it can be ready to use early in the init process.\n */\n\n@Module({\n  name: 'AppFeatures',\n  deps: [\n    'Auth',\n    'ExtensionFeatures',\n    {\n      dep: 'FeatureConfiguration',\n      optional: true,\n    },\n    {\n      dep: 'AppFeaturesOptions',\n      optional: true,\n    },\n  ],\n})\nexport abstract class AppFeaturesBase<\n  T extends FeatureConfiguration = FeatureConfiguration\n> extends RcModuleV2<Deps<T>> {\n  constructor(deps: Deps<T>) {\n    super({\n      deps,\n    });\n  }\n\n  @computed(({ _deps: { featureConfiguration } }: AppFeaturesBase) => [\n    featureConfiguration,\n  ])\n  get config(): T {\n    return {\n      ...defaultConfiguration,\n      ...this._deps.featureConfiguration,\n    };\n  }\n\n  // TODO: investigate on how or whether to include softphone and ringcentral app settings\n  get isCallingEnabled() {\n    return this.isRingOutEnabled || this.isWebPhoneEnabled;\n  }\n\n  get isWebPhoneEnabled() {\n    return !!(\n      this._deps.extensionFeatures.features?.WebPhone?.available &&\n      this.config.WebPhone\n    );\n  }\n\n  get isRingOutEnabled() {\n    return !!(\n      this._deps.extensionFeatures.features?.RingOut?.available &&\n      this.config.RingOut\n    );\n  }\n\n  get isSoftphoneEnabled() {\n    return !!this.config.Softphone;\n  }\n\n  get isRingCentralAppEnabled() {\n    return !!this.config.RingCentralApp;\n  }\n\n  get hasReadSMSPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.SMSReceiving?.available &&\n      this.config.SMS\n    );\n  }\n\n  get hasReadPagesPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.PagesReceiving?.available &&\n      this.config.Pages\n    );\n  }\n\n  get hasVoicemailPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.Voicemail?.available &&\n      this.config.Voicemail\n    );\n  }\n\n  get hasReadFaxPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.FaxReceiving?.available &&\n      this.config.Fax\n    );\n  }\n\n  get hasReadTextPermission() {\n    return this.hasReadSMSPermission || this.hasReadPagesPermission;\n  }\n\n  get hasReadMessagesPermission() {\n    return (\n      this.hasReadSMSPermission ||\n      this.hasReadPagesPermission ||\n      this.hasVoicemailPermission ||\n      this.hasReadFaxPermission\n    );\n  }\n\n  get hasSendSMSPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.SMSSending?.available &&\n      this.config.SMS\n    );\n  }\n\n  get hasOutboundSMSPermission() {\n    return this.hasSendSMSPermission;\n  }\n\n  get hasSendPagesPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.PagesSending?.available &&\n      this.config.Pages\n    );\n  }\n\n  get hasInternalSMSPermission() {\n    return this.hasSendPagesPermission;\n  }\n\n  get hasComposeTextPermission() {\n    return this.hasSendSMSPermission || this.hasSendPagesPermission;\n  }\n\n  get hasMeetingsPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.Meetings?.available &&\n      this.config.Meetings\n    );\n  }\n\n  get hasRoomConnectorBeta() {\n    return !!this._deps.extensionFeatures.features?.RoomConnectorBeta\n      ?.available;\n  }\n\n  get hasVideoE2EE() {\n    return !!this._deps.extensionFeatures.features?.MeetingsEncryption\n      ?.available;\n  }\n\n  get hasReadExtensionCallLog() {\n    return !!(\n      this._deps.extensionFeatures.features?.ReadExtensionCallLog?.available &&\n      this.config.CallLog\n    );\n  }\n\n  get hasConferenceCall() {\n    return (\n      this.isRingOutEnabled &&\n      this.isWebPhoneEnabled &&\n      this.config.ConferenceCall\n    );\n  }\n\n  get hasConferencing() {\n    return !!(\n      this._deps.extensionFeatures.features?.Conferencing?.available &&\n      this.config.Conferencing\n    );\n  }\n\n  get hasGlipPermission() {\n    return !!(\n      this._deps.extensionFeatures.features?.Glip?.available && this.config.Glip\n    );\n  }\n\n  get hasCallControl() {\n    return (\n      (this._deps.auth.token?.scope?.indexOf('CallControl') > -1 ||\n        this._deps.auth.token?.scope?.indexOf('TelephonySession') > -1) &&\n      this.config.CallControl\n    );\n  }\n\n  get isContactsEnabled() {\n    return (\n      this.config.Contacts &&\n      (!this.config.HideContactsWhenNoCallOrMessage ||\n        (this.config.HideContactsWhenNoCallOrMessage &&\n          (this.isCallingEnabled || this.hasReadMessagesPermission)))\n    );\n  }\n\n  get isCDCEnabled() {\n    return !!this.config.CDC;\n  }\n}\n\n@Module()\nexport class AppFeatures extends AppFeaturesBase {}\n"],"file":"AppFeatures.js"}