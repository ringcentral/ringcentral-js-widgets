{"version":3,"sources":["modules/SettingsUI/SettingsUI.ts"],"names":["DEFAULT_REGION_SETTINGS_URL","DEFAULT_CALLING_SETTINGS_URL","DEFAULT_AUDIO_SETTINGS_URL","DEFAULT_FEEDBACK_SETTINGS_URL","SettingsUI","name","deps","dep","optional","storageKey","enableCache","options","showCalling","showAudio","showFeedback","showUserGuide","showPresenceSettings","showQuickAccess","params","_deps","accountInfo","auth","brand","extensionInfo","extensionFeatures","locale","localeSettings","regionSettings","callingSettings","version","appFeatures","presence","userGuide","loginNumber","loggedIn","loginStatus","ready","mainCompanyNumber","extensionNumber","phoneNumber","join","countryCode","areaCode","showSpinner","isCallingEnabled","showRegion","showRegionSettings","currentLocale","eulaLabel","brandConfig","eulaLink","outboundSMS","hasOutboundSMSPermission","hasInternalSMSPermission","isCallQueueMember","dndStatus","userStatus","openPresenceSettings","features","EditPresenceStatus","available","supportedLocales","savedLocale","hasPermission","regionSettingsUrl","callingSettingsUrl","audioSettingsUrl","feedbackSettingsUrl","routerInteraction","quickAccess","onLogoutButtonClick","logout","onRegionSettingsLinkClick","push","onCallingSettingsLinkClick","onAudioSettingsLinkClick","onFeedbackSettingsLinkClick","onUserGuideClick","start","onQuickAccessLinkClick","enter","setAvailable","setBusy","setDoNotDisturb","setInvisible","toggleAcceptCallQueueCalls","saveLocale","RcUIModuleV2"],"mappings":"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","sourcesContent":["import { Module } from '@ringcentral-integration/commons/lib/di';\nimport formatNumber from '@ringcentral-integration/commons/lib/formatNumber';\nimport loginStatus from '@ringcentral-integration/commons/modules/Auth/loginStatus';\nimport {\n  RcUIModuleV2,\n  UIFunctions,\n  UIProps,\n} from '@ringcentral-integration/core';\n\nimport { SettingsPanelProps } from '../../components/SettingsPanel/SettingsPanel.interface';\nimport { Deps, SettingsContainerProps } from './SettingUI.interface';\n\nconst DEFAULT_REGION_SETTINGS_URL = '/settings/region';\nconst DEFAULT_CALLING_SETTINGS_URL = '/settings/calling';\nconst DEFAULT_AUDIO_SETTINGS_URL = '/settings/audio';\nconst DEFAULT_FEEDBACK_SETTINGS_URL = '/settings/feedback';\n\n@Module({\n  name: 'SettingsUI',\n  deps: [\n    'Auth',\n    'Brand',\n    'Locale',\n    'AccountInfo',\n    'ExtensionInfo',\n    'RegionSettings',\n    'ExtensionFeatures',\n    'AppFeatures',\n    'RouterInteraction',\n    {\n      dep: 'Version',\n      optional: true,\n    },\n    {\n      dep: 'Presence',\n      optional: true,\n    },\n    {\n      dep: 'CallingSettings',\n      optional: true,\n    },\n    {\n      dep: 'LocaleSettings',\n      optional: true,\n    },\n    {\n      dep: 'QuickAccess',\n      optional: true,\n    },\n    {\n      dep: 'UserGuide',\n      optional: true,\n    },\n    {\n      dep: 'SettingsUIOptions',\n      optional: true,\n    },\n  ],\n})\nexport class SettingsUI<T extends Deps = Deps> extends RcUIModuleV2<T> {\n  constructor({\n    storageKey,\n    enableCache,\n    deps,\n    ...options\n  }: {\n    storageKey?: string;\n    enableCache?: boolean;\n    deps?: T;\n  }) {\n    super({\n      deps: deps || (options as T),\n      storageKey,\n      enableCache,\n    });\n  }\n\n  getUIProps({\n    showCalling = true,\n    showAudio = true,\n    showFeedback = true,\n    showUserGuide = true,\n    showPresenceSettings = true,\n    showQuickAccess = false,\n    params,\n  }: SettingsContainerProps): UIProps<SettingsPanelProps> {\n    const {\n      accountInfo,\n      auth,\n      brand,\n      extensionInfo,\n      extensionFeatures,\n      locale,\n      localeSettings,\n      regionSettings,\n      callingSettings,\n      version,\n      appFeatures,\n      presence,\n      userGuide,\n    } = this._deps;\n    let loginNumber = brand.name;\n    const loggedIn = auth.loginStatus === loginStatus.loggedIn;\n    if (\n      loggedIn &&\n      accountInfo.ready &&\n      extensionInfo.ready &&\n      accountInfo.mainCompanyNumber\n    ) {\n      // If no extensionNumber, extensionNumber field needs to be omitted\n      const extensionNumber =\n        extensionInfo.extensionNumber && extensionInfo.extensionNumber !== '0'\n          ? extensionInfo.extensionNumber\n          : null;\n      const phoneNumber = [accountInfo.mainCompanyNumber, extensionNumber].join(\n        '*',\n      );\n      loginNumber = formatNumber({\n        phoneNumber,\n        countryCode: regionSettings.countryCode,\n        areaCode: regionSettings.areaCode,\n      });\n    }\n    return {\n      version,\n      loginNumber,\n      showFeedback,\n      showQuickAccess,\n      showSpinner: !(\n        accountInfo.ready &&\n        auth.ready &&\n        loggedIn &&\n        extensionInfo.ready &&\n        locale.ready &&\n        regionSettings.ready &&\n        (!callingSettings || callingSettings.ready) &&\n        appFeatures.ready &&\n        (!presence || presence.ready) &&\n        (!localeSettings || localeSettings.ready)\n      ),\n      showCalling:\n        showCalling && callingSettings && appFeatures.isCallingEnabled,\n      showAudio: showAudio && appFeatures.isCallingEnabled,\n      showRegion:\n        loggedIn &&\n        regionSettings.showRegionSettings &&\n        appFeatures.isCallingEnabled,\n      currentLocale: locale.currentLocale,\n      eulaLabel: brand.brandConfig.eulaLabel,\n      eulaLink: brand.brandConfig.eulaLink,\n      outboundSMS:\n        !!appFeatures.hasOutboundSMSPermission ||\n        !!appFeatures.hasInternalSMSPermission,\n      isCallQueueMember: extensionInfo.isCallQueueMember,\n      dndStatus: presence?.dndStatus,\n      userStatus: presence?.userStatus,\n      openPresenceSettings: !!(\n        presence &&\n        params &&\n        params.showPresenceSettings\n      ),\n      showPresenceSettings:\n        showPresenceSettings &&\n        !!extensionFeatures.features?.EditPresenceStatus?.available,\n      supportedLocales: localeSettings?.supportedLocales,\n      savedLocale: localeSettings?.savedLocale,\n      showUserGuide: showUserGuide && !!userGuide?.hasPermission,\n    };\n  }\n\n  getUIFunctions({\n    regionSettingsUrl = DEFAULT_REGION_SETTINGS_URL,\n    callingSettingsUrl = DEFAULT_CALLING_SETTINGS_URL,\n    audioSettingsUrl = DEFAULT_AUDIO_SETTINGS_URL,\n    feedbackSettingsUrl = DEFAULT_FEEDBACK_SETTINGS_URL,\n  }: SettingsContainerProps): UIFunctions<SettingsPanelProps> {\n    const {\n      auth,\n      presence,\n      routerInteraction,\n      localeSettings,\n      userGuide,\n      quickAccess,\n    } = this._deps;\n    return {\n      async onLogoutButtonClick() {\n        await auth.logout();\n      },\n      onRegionSettingsLinkClick() {\n        routerInteraction.push(regionSettingsUrl);\n      },\n      onCallingSettingsLinkClick() {\n        routerInteraction.push(callingSettingsUrl);\n      },\n      onAudioSettingsLinkClick() {\n        routerInteraction.push(audioSettingsUrl);\n      },\n      onFeedbackSettingsLinkClick() {\n        routerInteraction.push(feedbackSettingsUrl);\n      },\n      onUserGuideClick() {\n        userGuide.start();\n      },\n      onQuickAccessLinkClick() {\n        quickAccess.enter();\n      },\n      setAvailable: () => presence?.setAvailable(),\n      setBusy: () => presence?.setBusy(),\n      setDoNotDisturb: () => presence?.setDoNotDisturb(),\n      setInvisible: () => presence?.setInvisible(),\n      toggleAcceptCallQueueCalls: () => presence?.toggleAcceptCallQueueCalls(),\n      saveLocale:\n        localeSettings &&\n        ((locale: string) => localeSettings.saveLocale(locale)),\n    };\n  }\n}\n"],"file":"SettingsUI.js"}