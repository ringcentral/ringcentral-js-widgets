{"version":3,"file":"EvPresence.js","names":["_events","require","_di","_core","_enums","_callbackTypes","_trackEvents","_dec","_dec2","_dec3","_dec4","_dec5","_class","_class2","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_initializerDefineProperty","target","property","descriptor","context","Object","defineProperty","enumerable","configurable","writable","value","initializer","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","i","length","_toPropertyKey","key","_createClass","protoProps","staticProps","prototype","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","Number","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","decorators","desc","keys","forEach","slice","reverse","reduce","decorator","_initializerWarningHelper","Error","EvPresence","Module","name","deps","dep","optional","computed","that","callIds","callsMapping","otherCallIds","callLogsIds","track","analytics","recordingSetting","getRecordingSettings","agentRecording","callType","trackEvents","callInboundCallConnected","outboundCallConnected","voiceConnection","loginType","isOffhook","isOffhooking","_RcModuleV","_super","get","_deps","evCallDataSource","rawCallsMapping","_this","enableCache","storageKey","beforeunloadHandler","eventEmitter","evPresenceEvents","EventEmitter","showOffHookInitError","setCurrentCallUii","uii","currentCallUii","setDialoutStatus","status","dialoutStatus","setOffhookInit","_checkBeforeunload","setOffhookTerm","isManualOffhook","setIsManualOffhook","setOffhook","setOffhooking","offhooking","addNewCall","addNewSession","session","dropSession","removeEndedCall","endedCall","setCallHoldStatus","clearCalls","onInitOnce","_bindSubscription","record","pause","_this2","evSubscription","subscribe","EvCallbackTypes","OFFHOOK_INIT","data","emit","alert","danger","message","messageTypes","OFFHOOK_INIT_ERROR","EARLY_UII","OFFHOOK_TERM","OFFHOOK_TERM_ERROR","console","error","ADD_SESSION","ADD_SESSION_ERROR","DROP_SESSION","DROP_SESSION_ERROR","HOLD","HOLD_ERROR","NEW_CALL","END_CALL","id","evClient","encodeUii","offhookTerm","beforeunload","add","remove","_this3","map","filter","_this4","_this5","dialoutStatuses","callConnected","RcModuleV2","storage","state","idle","action","getOwnPropertyDescriptor","exports"],"sources":["modules/EvPresence/EvPresence.ts"],"sourcesContent":["import { EventEmitter } from 'events';\n\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport {\n  action,\n  computed,\n  RcModuleV2,\n  state,\n  storage,\n  track,\n} from '@ringcentral-integration/core';\n\nimport type { DialoutStatusesType } from '../../enums';\nimport { dialoutStatuses, messageTypes } from '../../enums';\nimport { EvCallbackTypes } from '../../lib/EvClient/enums/callbackTypes';\nimport type {\n  EvAddSessionNotification,\n  EvAgentRecording,\n  EvBaseCall,\n  EvDropSessionNotification,\n  EvEarlyUiiResponse,\n  EvEndedCall,\n  EvHoldResponse,\n  EvOffhookInitResponse,\n  EvOffhookTermResponse,\n} from '../../lib/EvClient/interfaces';\nimport { trackEvents } from '../../lib/trackEvents';\nimport type { Deps, Presence } from './EvPresence.interface';\n\n@Module({\n  name: 'EvPresence',\n  deps: [\n    'EvSubscription',\n    'EvCallDataSource',\n    'EvClient',\n    'Storage',\n    'Beforeunload',\n    'Alert',\n    { dep: 'PresenceOptions', optional: true },\n  ],\n})\nclass EvPresence extends RcModuleV2<Deps> implements Presence {\n  beforeunloadHandler = () => false;\n  eventEmitter = this._deps.evCallDataSource.eventEmitter;\n\n  evPresenceEvents = new EventEmitter();\n\n  showOffHookInitError = true;\n\n  get callIds() {\n    return this._deps.evCallDataSource.callIds;\n  }\n\n  get otherCallIds() {\n    return this._deps.evCallDataSource.otherCallIds;\n  }\n\n  get callLogsIds() {\n    return this._deps.evCallDataSource.callLogsIds;\n  }\n\n  get callsMapping() {\n    return this._deps.evCallDataSource.callsMapping;\n  }\n\n  get rawCallsMapping() {\n    return this._deps.evCallDataSource.rawCallsMapping;\n  }\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvPresence',\n    });\n  }\n\n  @storage\n  @state\n  currentCallUii = '';\n\n  @storage\n  @state\n  isOffhook = false;\n\n  @storage\n  @state\n  isManualOffhook = false;\n\n  @storage\n  @state\n  isOffhooking = false;\n\n  @storage\n  @state\n  dialoutStatus: DialoutStatusesType = dialoutStatuses.idle;\n\n  @action\n  setCurrentCallUii(uii: string) {\n    this.currentCallUii = uii;\n  }\n\n  @computed((that: EvPresence) => [that.callIds, that.callsMapping])\n  get calls() {\n    return this.callIds\n      .map((id) => this.callsMapping[id])\n      .filter((call) => !!call);\n  }\n\n  @computed((that: EvPresence) => [that.otherCallIds, that.callsMapping])\n  get otherCalls() {\n    return this.otherCallIds.map((id) => this.callsMapping[id]);\n  }\n\n  @computed((that: EvPresence) => [that.callLogsIds, that.callsMapping])\n  get callLogs() {\n    return this.callLogsIds.map((id) => this.callsMapping[id]);\n  }\n\n  @action\n  setDialoutStatus(status: DialoutStatusesType) {\n    if (this.dialoutStatus !== status) {\n      this.dialoutStatus = status;\n    }\n  }\n\n  @action\n  setOffhookInit() {\n    this.isOffhooking = false;\n    this.isOffhook = true;\n    this._checkBeforeunload();\n  }\n\n  @action\n  setOffhookTerm() {\n    this.isOffhooking = false;\n    this.isOffhook = false;\n    this.isManualOffhook = false;\n    this._checkBeforeunload();\n  }\n\n  @action\n  setIsManualOffhook(isManualOffhook: boolean) {\n    this.isManualOffhook = isManualOffhook;\n  }\n\n  @action\n  setOffhook(status: boolean) {\n    this.isOffhook = status;\n    this._checkBeforeunload();\n  }\n\n  @action\n  setOffhooking(offhooking: boolean) {\n    this.isOffhooking = offhooking;\n  }\n\n  @track((that: EvPresence, call: EvBaseCall) => (analytics) => {\n    const recordingSetting = that.getRecordingSettings(call.agentRecording);\n    return [\n      call.callType === 'INBOUND'\n        ? trackEvents.callInboundCallConnected\n        : trackEvents.outboundCallConnected,\n      {\n        recordingSetting,\n        voiceConnection: analytics.loginType,\n        isOffhook: that.isOffhook,\n        isOffhooking: that.isOffhooking,\n      },\n    ];\n  })\n  addNewCall(call: EvBaseCall) {\n    this._deps.evCallDataSource.addNewCall(call);\n  }\n\n  addNewSession(session: EvAddSessionNotification) {\n    this._deps.evCallDataSource.addNewSession(session);\n  }\n\n  dropSession(dropSession: EvDropSessionNotification) {\n    this._deps.evCallDataSource.dropSession(dropSession);\n  }\n\n  removeEndedCall(endedCall: EvEndedCall) {\n    this._deps.evCallDataSource.removeEndedCall(endedCall);\n  }\n\n  setCallHoldStatus(res: EvHoldResponse) {\n    this._deps.evCallDataSource.setCallHoldStatus(res);\n  }\n\n  clearCalls() {\n    this._deps.evCallDataSource.clearCalls();\n  }\n\n  override onInitOnce() {\n    this._bindSubscription();\n  }\n\n  getRecordingSettings(record: EvAgentRecording) {\n    let recordingSetting = '';\n    if (record.agentRecording) {\n      if (record.default === 'ON') {\n        if (record.pause) {\n          recordingSetting = 'Yes - Record Call (Agent Pause)';\n        } else {\n          recordingSetting = 'Agent Triggered (Default: Record)';\n        }\n      } else {\n        recordingSetting = \"Agent Triggered (Default: Don't Record)\";\n      }\n    } else if (!record.agentRecording) {\n      if (record.default === 'ON') {\n        recordingSetting = 'Yes - Record Full Call';\n      } else {\n        recordingSetting = \"No - Don't Record Call\";\n      }\n    }\n    return recordingSetting;\n  }\n\n  private _bindSubscription() {\n    this._deps.evSubscription\n      .subscribe(\n        EvCallbackTypes.OFFHOOK_INIT,\n        (data: EvOffhookInitResponse) => {\n          this.evPresenceEvents.emit(EvCallbackTypes.OFFHOOK_INIT, data);\n          if (data.status === 'OK') {\n            this.setOffhookInit();\n          } else {\n            // when that is reject integrated softphone, we not alert error\n            if (this.showOffHookInitError) {\n              this._deps.alert.danger({\n                message: messageTypes.OFFHOOK_INIT_ERROR,\n              });\n            }\n            this.setOffhookTerm();\n            this.showOffHookInitError = true;\n          }\n        },\n      )\n      .subscribe(EvCallbackTypes.EARLY_UII, (data: EvEarlyUiiResponse) => {\n        if (data.status === 'OK') {\n          this.setCurrentCallUii(data.uii);\n        }\n      })\n      .subscribe(\n        EvCallbackTypes.OFFHOOK_TERM,\n        (data: EvOffhookTermResponse) => {\n          if (data.status === 'OK') {\n            this.setOffhookTerm();\n          } else {\n            this._deps.alert.danger({\n              message: messageTypes.OFFHOOK_TERM_ERROR,\n            });\n            console.error(data);\n          }\n        },\n      )\n      .subscribe(EvCallbackTypes.ADD_SESSION, (data) => {\n        if (data.status === 'OK') {\n          this.addNewSession(data);\n        } else {\n          this._deps.alert.danger({\n            message: messageTypes.ADD_SESSION_ERROR,\n          });\n        }\n      })\n      .subscribe(EvCallbackTypes.DROP_SESSION, (data) => {\n        if (data.status === 'OK') {\n          this.dropSession(data);\n        } else {\n          this._deps.alert.danger({\n            message: messageTypes.DROP_SESSION_ERROR,\n          });\n        }\n      })\n      .subscribe(EvCallbackTypes.HOLD, (data) => {\n        if (data.status === 'OK') {\n          this.setCallHoldStatus(data);\n        } else {\n          this._deps.alert.danger({\n            message: messageTypes.HOLD_ERROR,\n          });\n        }\n      })\n      .subscribe(EvCallbackTypes.NEW_CALL, (data) => {\n        this.addNewCall(data);\n      })\n      .subscribe(EvCallbackTypes.END_CALL, (data) => {\n        const id = this._deps.evClient.encodeUii(data);\n        if (!this.callsMapping[id]) return;\n        if (!this.isManualOffhook) {\n          this._deps.evClient.offhookTerm();\n        }\n        this.removeEndedCall(data);\n      });\n  }\n\n  private _checkBeforeunload() {\n    if (this.isOffhook) {\n      this._deps.beforeunload.add(this.beforeunloadHandler);\n    } else {\n      this._deps.beforeunload.remove(this.beforeunloadHandler);\n    }\n  }\n\n  get isCallConnected() {\n    return this.dialoutStatus === dialoutStatuses.callConnected;\n  }\n}\n\nexport { EvPresence };\n"],"mappings":"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"}