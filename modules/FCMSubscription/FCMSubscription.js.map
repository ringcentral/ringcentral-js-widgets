{"version":3,"file":"FCMSubscription.js","names":["_core","require","_app","_messaging","_subscriptionFilters","_di","_utils","_dec","_class","_class2","_descriptor","_descriptor2","_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","initializer","_classCallCheck","_defineProperties","_toPropertyKey","key","_createClass","_toPrimitive","_typeof","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","_assertThisInitialized","ReferenceError","Boolean","valueOf","_superPropGet","_get","get","_superPropBase","getOwnPropertyDescriptor","hasOwnProperty","_inherits","_setPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","FCMSubscription","exports","Module","name","deps","dep","_RcModuleV","_this","enableCache","storageKey","messaging","firebaseApp","initializeApp","_deps","fCMSubscriptionOptions","firebaseConfig","getMessaging","_shouldInit","auth","loggedIn","_shouldReset","ready","onInitOnce","_this2","addBeforeLogoutHandler","_callee","fcmSubscription","_context","_deleteSubscription","setRegistrationToken","token","registrationToken","setFcmSubscription","subscription","getServiceworkerRigestration","_this3","reject","navigator","serviceWorker","serviceWorkerRegistration","getToken","vapidKey","currentToken","console","log","err","_createSubscription2","_callee2","response","_context2","client","service","post","eventFilters","subscriptionFilters","presence","deliveryMode","transportType","registrationId","certificateName","json","_createSubscription","_x","_deleteSubscription2","_callee3","_context3","concat","id","_x2","_createOrUpdateSubscription2","_callee4","renewResponse","_t","_context4","error","_createOrUpdateSubscription","_x3","_x4","_registerFCM2","_callee5","_context5","_registerFCM","_onInit","_callee7","_this4","_t2","_context7","waitUntilTo","_callee6","_context6","timeout","interval","onInit","RcModuleV2","state","action","storage"],"sources":["modules/FCMSubscription/FCMSubscription.ts"],"sourcesContent":["import {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken } from 'firebase/messaging';\n\nimport { subscriptionFilters } from '../../enums/subscriptionFilters';\nimport { Module } from '../../lib/di';\nimport { waitUntilTo } from '../../utils';\n\nimport {\n  Deps,\n  TFCMSubscription,\n  TRegistrationToken,\n} from './FCMSubscription.interface';\n\n@Module({\n  name: 'FCMSubscription',\n  deps: ['Auth', 'Storage', 'Client', { dep: 'FCMSubscriptionOptions' }],\n})\nexport class FCMSubscription extends RcModuleV2<Deps> {\n  messaging: ReturnType<typeof getMessaging>;\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'FCMSubscription',\n    });\n    // Initialize Firebase\n    const firebaseApp = initializeApp(\n      this._deps.fCMSubscriptionOptions.firebaseConfig,\n    );\n    this.messaging = getMessaging(firebaseApp);\n  }\n\n  override _shouldInit() {\n    return !!(super._shouldInit() && this._deps.auth.loggedIn);\n  }\n\n  override _shouldReset() {\n    return !!(\n      super._shouldReset() ||\n      (this.ready && !this._deps.auth.loggedIn)\n    );\n  }\n\n  override onInitOnce() {\n    this._deps.auth.addBeforeLogoutHandler(async () => {\n      const fcmSubscription = this.fcmSubscription;\n      if (fcmSubscription) {\n        await this._deleteSubscription(fcmSubscription);\n      }\n    });\n  }\n  @state\n  registrationToken: TRegistrationToken = null;\n\n  @action\n  setRegistrationToken(token: TRegistrationToken) {\n    this.registrationToken = token;\n  }\n\n  @storage\n  @state\n  fcmSubscription: TFCMSubscription = null;\n\n  @action\n  setFcmSubscription(subscription: TFCMSubscription) {\n    this.fcmSubscription = subscription;\n  }\n  getServiceworkerRigestration() {\n    return new Promise((resolve, reject) => {\n      navigator.serviceWorker.ready.then((serviceWorkerRegistration) => {\n        getToken(this.messaging, {\n          vapidKey: this._deps.fCMSubscriptionOptions.vapidKey,\n          serviceWorkerRegistration,\n        })\n          .then((currentToken) => {\n            if (currentToken) {\n              console.log('===registration token: ', currentToken);\n              this.setRegistrationToken(currentToken);\n              resolve(null);\n            } else {\n              // Show permission request UI\n              console.log(\n                '==No registration token available. Request permission to generate one.',\n              );\n              this.setRegistrationToken(null);\n              resolve(null);\n            }\n          })\n          .catch((err) => {\n            console.log('An error occurred while retrieving token. ', err);\n            this.setRegistrationToken(null);\n            reject();\n          });\n      });\n    });\n  }\n  async _createSubscription(registrationToken: TRegistrationToken) {\n    const response = await this._deps.client.service.post(\n      '/restapi/v1.0/subscription',\n      {\n        eventFilters: [\n          '/restapi/v1.0/account/~/extension/~/start-ring',\n          '/restapi/v1.0/account/~/extension/~/stop-ring',\n          '/restapi/v1.0/account/~/extension/~/missed-calls',\n          '/restapi/v1.0/account/~/extension/~/fax?direction=Inbound',\n          '/restapi/v1.0/account/~/extension/~/voicemail',\n          '/restapi/v1.0/account/~/extension/~/message-store/instant?type=SMS',\n          '/restapi/v1.0/account/~/extension/~/message-store?type=Pager&direction=Inbound',\n          subscriptionFilters.presence,\n        ],\n        deliveryMode: {\n          transportType: 'RC/GCM',\n          registrationId: registrationToken,\n          certificateName: this._deps.fCMSubscriptionOptions.certificateName,\n        },\n      },\n    );\n    return response.json();\n  }\n  async _deleteSubscription(fcmSubscription: TFCMSubscription) {\n    await this._deps.client.service.delete(\n      `/restapi/v1.0/subscription/${fcmSubscription!.id}`,\n    );\n    this.setFcmSubscription(null);\n  }\n  async _createOrUpdateSubscription(\n    fcmSubscription: TFCMSubscription,\n    registrationToken: TRegistrationToken,\n  ) {\n    if (!fcmSubscription) {\n      return await this._createSubscription(registrationToken);\n    }\n    if (fcmSubscription.deliveryMode.registrationId === registrationToken) {\n      const renewResponse = await this._deps.client.service.post(\n        `/restapi/v1.0/subscription/${fcmSubscription.id}/renew`,\n      );\n      return renewResponse.json();\n    }\n    try {\n      this._deleteSubscription(fcmSubscription);\n    } catch (e) {\n      console.error(`[FCMSubscription] subscription delete fail: ${e}`);\n      throw e;\n    }\n    return await this._createSubscription(registrationToken);\n  }\n\n  private async _registerFCM() {\n    await this.getServiceworkerRigestration();\n    const registrationToken = this.registrationToken;\n    let subscription = this.fcmSubscription;\n    subscription = await this._createOrUpdateSubscription(\n      subscription,\n      registrationToken,\n    );\n    this.setFcmSubscription(subscription);\n  }\n\n  override async onInit() {\n    try {\n      await waitUntilTo(async () => await this._registerFCM(), {\n        timeout: 30000,\n        interval: 10000,\n      });\n    } catch (e) {\n      console.error(`===something error:${e}`);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}