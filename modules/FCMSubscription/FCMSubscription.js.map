{"version":3,"file":"FCMSubscription.js","names":["_core","require","_app","_messaging","_subscriptionFilters","_di","_utils","_dec","_class","_class2","_descriptor","_descriptor2","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_initializerDefineProperty","l","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","TypeError","_defineProperties","length","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_get","Reflect","get","bind","p","_superPropBase","getOwnPropertyDescriptor","hasOwnProperty","_getPrototypeOf","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","__proto__","_createSuper","_isNativeReflectConstruct","s","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","keys","forEach","slice","reverse","reduce","_initializerWarningHelper","Error","FCMSubscription","Module","name","deps","dep","_RcModuleV","_super","_this","enableCache","storageKey","messaging","firebaseApp","initializeApp","_deps","fCMSubscriptionOptions","firebaseConfig","getMessaging","_shouldInit","auth","loggedIn","_shouldReset","ready","onInitOnce","_this2","addBeforeLogoutHandler","regeneratorRuntime","mark","_callee","fcmSubscription","wrap","_callee$","_context","prev","next","_deleteSubscription","stop","setRegistrationToken","token","registrationToken","setFcmSubscription","subscription","getServiceworkerRigestration","_this3","reject","navigator","serviceWorker","serviceWorkerRegistration","getToken","vapidKey","currentToken","console","log","err","_createSubscription2","_callee2","response","_callee2$","_context2","client","service","post","eventFilters","subscriptionFilters","presence","deliveryMode","transportType","registrationId","certificateName","sent","abrupt","json","_createSubscription","_x","_deleteSubscription2","_callee3","_callee3$","_context3","concat","id","_x2","_createOrUpdateSubscription2","_callee4","renewResponse","_callee4$","_context4","t0","error","_createOrUpdateSubscription","_x3","_x4","_registerFCM2","_callee5","_callee5$","_context5","_registerFCM","_onInit","_callee7","_this4","_callee7$","_context7","waitUntilTo","_callee6","_callee6$","_context6","timeout","interval","onInit","RcModuleV2","state","action","storage","exports"],"sources":["modules/FCMSubscription/FCMSubscription.ts"],"sourcesContent":["import {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken } from 'firebase/messaging';\n\nimport { subscriptionFilters } from '../../enums/subscriptionFilters';\nimport { Module } from '../../lib/di';\nimport { waitUntilTo } from '../../utils';\n\nimport {\n  Deps,\n  TFCMSubscription,\n  TRegistrationToken,\n} from './FCMSubscription.interface';\n\n@Module({\n  name: 'FCMSubscription',\n  deps: ['Auth', 'Storage', 'Client', { dep: 'FCMSubscriptionOptions' }],\n})\nexport class FCMSubscription extends RcModuleV2<Deps> {\n  messaging: ReturnType<typeof getMessaging>;\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'FCMSubscription',\n    });\n    // Initialize Firebase\n    const firebaseApp = initializeApp(\n      this._deps.fCMSubscriptionOptions.firebaseConfig,\n    );\n    this.messaging = getMessaging(firebaseApp);\n  }\n\n  override _shouldInit() {\n    return !!(super._shouldInit() && this._deps.auth.loggedIn);\n  }\n\n  override _shouldReset() {\n    return !!(\n      super._shouldReset() ||\n      (this.ready && !this._deps.auth.loggedIn)\n    );\n  }\n\n  override onInitOnce() {\n    this._deps.auth.addBeforeLogoutHandler(async () => {\n      const fcmSubscription = this.fcmSubscription;\n      if (fcmSubscription) {\n        await this._deleteSubscription(fcmSubscription);\n      }\n    });\n  }\n  @state\n  registrationToken: TRegistrationToken = null;\n\n  @action\n  setRegistrationToken(token: TRegistrationToken) {\n    this.registrationToken = token;\n  }\n\n  @storage\n  @state\n  fcmSubscription: TFCMSubscription = null;\n\n  @action\n  setFcmSubscription(subscription: TFCMSubscription) {\n    this.fcmSubscription = subscription;\n  }\n  getServiceworkerRigestration() {\n    return new Promise((resolve, reject) => {\n      navigator.serviceWorker.ready.then((serviceWorkerRegistration) => {\n        getToken(this.messaging, {\n          vapidKey: this._deps.fCMSubscriptionOptions.vapidKey,\n          serviceWorkerRegistration,\n        })\n          .then((currentToken) => {\n            if (currentToken) {\n              console.log('===registration token: ', currentToken);\n              this.setRegistrationToken(currentToken);\n              resolve(null);\n            } else {\n              // Show permission request UI\n              console.log(\n                '==No registration token available. Request permission to generate one.',\n              );\n              this.setRegistrationToken(null);\n              resolve(null);\n            }\n          })\n          .catch((err) => {\n            console.log('An error occurred while retrieving token. ', err);\n            this.setRegistrationToken(null);\n            reject();\n          });\n      });\n    });\n  }\n  async _createSubscription(registrationToken: TRegistrationToken) {\n    const response = await this._deps.client.service.post(\n      '/restapi/v1.0/subscription',\n      {\n        eventFilters: [\n          '/restapi/v1.0/account/~/extension/~/start-ring',\n          '/restapi/v1.0/account/~/extension/~/stop-ring',\n          '/restapi/v1.0/account/~/extension/~/missed-calls',\n          '/restapi/v1.0/account/~/extension/~/fax?direction=Inbound',\n          '/restapi/v1.0/account/~/extension/~/voicemail',\n          '/restapi/v1.0/account/~/extension/~/message-store/instant?type=SMS',\n          '/restapi/v1.0/account/~/extension/~/message-store?type=Pager&direction=Inbound',\n          subscriptionFilters.presence,\n        ],\n        deliveryMode: {\n          transportType: 'RC/GCM',\n          registrationId: registrationToken,\n          certificateName: this._deps.fCMSubscriptionOptions.certificateName,\n        },\n      },\n    );\n    return response.json();\n  }\n  async _deleteSubscription(fcmSubscription: TFCMSubscription) {\n    await this._deps.client.service.delete(\n      `/restapi/v1.0/subscription/${fcmSubscription!.id}`,\n    );\n    this.setFcmSubscription(null);\n  }\n  async _createOrUpdateSubscription(\n    fcmSubscription: TFCMSubscription,\n    registrationToken: TRegistrationToken,\n  ) {\n    if (!fcmSubscription) {\n      return await this._createSubscription(registrationToken);\n    }\n    if (fcmSubscription.deliveryMode.registrationId === registrationToken) {\n      const renewResponse = await this._deps.client.service.post(\n        `/restapi/v1.0/subscription/${fcmSubscription.id}/renew`,\n      );\n      return renewResponse.json();\n    }\n    try {\n      this._deleteSubscription(fcmSubscription);\n    } catch (e) {\n      console.error(`[FCMSubscription] subscription delete fail: ${e}`);\n      throw e;\n    }\n    return await this._createSubscription(registrationToken);\n  }\n\n  private async _registerFCM() {\n    await this.getServiceworkerRigestration();\n    const registrationToken = this.registrationToken;\n    let subscription = this.fcmSubscription;\n    subscription = await this._createOrUpdateSubscription(\n      subscription,\n      registrationToken,\n    );\n    this.setFcmSubscription(subscription);\n  }\n\n  override async onInit() {\n    try {\n      await waitUntilTo(async () => await this._registerFCM(), {\n        timeout: 30000,\n        interval: 10000,\n      });\n    } catch (e) {\n      console.error(`===something error:${e}`);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}