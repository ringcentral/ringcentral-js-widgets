{"version":3,"file":"FCMSubscription.js","names":["_app","require","_messaging","_core","_subscriptionFilters","_di","_utils","_dec","_class","_class2","_descriptor","_descriptor2","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_initializerDefineProperty","target","property","descriptor","context","Object","defineProperty","enumerable","configurable","writable","initializer","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","i","length","_toPropertyKey","_createClass","protoProps","staticProps","prototype","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","res","Number","_get","Reflect","get","bind","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","decorators","keys","forEach","slice","reverse","reduce","decorator","_initializerWarningHelper","Error","FCMSubscription","Module","name","deps","dep","_RcModuleV","_super","_this","enableCache","storageKey","messaging","firebaseApp","initializeApp","_deps","fCMSubscriptionOptions","firebaseConfig","getMessaging","_shouldInit","auth","loggedIn","_shouldReset","ready","onInitOnce","_this2","addBeforeLogoutHandler","regeneratorRuntime","mark","_callee","fcmSubscription","wrap","_callee$","_context","prev","next","_deleteSubscription","stop","setRegistrationToken","token","registrationToken","setFcmSubscription","subscription","getServiceworkerRigestration","_this3","navigator","serviceWorker","serviceWorkerRegistration","getToken","vapidKey","currentToken","console","log","_createSubscription2","_callee2","response","_callee2$","_context2","client","service","post","eventFilters","subscriptionFilters","presence","deliveryMode","transportType","registrationId","certificateName","sent","abrupt","json","_createSubscription","_x","_deleteSubscription2","_callee3","_callee3$","_context3","concat","id","_x2","_createOrUpdateSubscription2","_callee4","renewResponse","_callee4$","_context4","t0","_createOrUpdateSubscription","_x3","_x4","_registerFCM2","_callee5","_callee5$","_context5","_registerFCM","_onInit","_callee7","_this4","_callee7$","_context7","waitUntilTo","_callee6","_callee6$","_context6","timeout","interval","onInit","RcModuleV2","state","action","storage","exports"],"sources":["modules/FCMSubscription/FCMSubscription.ts"],"sourcesContent":["import { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken } from 'firebase/messaging';\nimport {\n  action,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport { subscriptionFilters } from '../../enums/subscriptionFilters';\nimport { Module } from '../../lib/di';\nimport { waitUntilTo } from '../../utils';\nimport {\n  Deps,\n  TFCMSubscription,\n  TRegistrationToken,\n} from './FCMSubscription.interface';\n@Module({\n  name: 'FCMSubscription',\n  deps: ['Auth', 'Storage', 'Client', { dep: 'FCMSubscriptionOptions' }],\n})\nexport class FCMSubscription extends RcModuleV2<Deps> {\n  messaging: ReturnType<typeof getMessaging>;\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'FCMSubscription',\n    });\n    // Initialize Firebase\n    const firebaseApp = initializeApp(\n      this._deps.fCMSubscriptionOptions.firebaseConfig,\n    );\n    this.messaging = getMessaging(firebaseApp);\n  }\n\n  override _shouldInit() {\n    return !!(super._shouldInit() && this._deps.auth.loggedIn);\n  }\n\n  override _shouldReset() {\n    return !!(\n      super._shouldReset() ||\n      (this.ready && !this._deps.auth.loggedIn)\n    );\n  }\n\n  override onInitOnce() {\n    this._deps.auth.addBeforeLogoutHandler(async () => {\n      const fcmSubscription = this.fcmSubscription;\n      if (fcmSubscription) {\n        await this._deleteSubscription(fcmSubscription);\n      }\n    });\n  }\n  @state\n  registrationToken: TRegistrationToken = null;\n\n  @action\n  setRegistrationToken(token: TRegistrationToken) {\n    this.registrationToken = token;\n  }\n\n  @storage\n  @state\n  fcmSubscription: TFCMSubscription = null;\n\n  @action\n  setFcmSubscription(subscription: TFCMSubscription) {\n    this.fcmSubscription = subscription;\n  }\n  getServiceworkerRigestration() {\n    return new Promise((resolve, reject) => {\n      navigator.serviceWorker.ready.then((serviceWorkerRegistration) => {\n        getToken(this.messaging, {\n          vapidKey: this._deps.fCMSubscriptionOptions.vapidKey,\n          serviceWorkerRegistration,\n        })\n          .then((currentToken) => {\n            if (currentToken) {\n              console.log('===registration token: ', currentToken);\n              this.setRegistrationToken(currentToken);\n              resolve(null);\n            } else {\n              // Show permission request UI\n              console.log(\n                '==No registration token available. Request permission to generate one.',\n              );\n              this.setRegistrationToken(null);\n              resolve(null);\n            }\n          })\n          .catch((err) => {\n            console.log('An error occurred while retrieving token. ', err);\n            this.setRegistrationToken(null);\n            reject();\n          });\n      });\n    });\n  }\n  async _createSubscription(registrationToken: TRegistrationToken) {\n    const response = await this._deps.client.service.post(\n      '/restapi/v1.0/subscription',\n      {\n        eventFilters: [\n          '/restapi/v1.0/account/~/extension/~/start-ring',\n          '/restapi/v1.0/account/~/extension/~/stop-ring',\n          '/restapi/v1.0/account/~/extension/~/missed-calls',\n          '/restapi/v1.0/account/~/extension/~/fax?direction=Inbound',\n          '/restapi/v1.0/account/~/extension/~/voicemail',\n          '/restapi/v1.0/account/~/extension/~/message-store/instant?type=SMS',\n          '/restapi/v1.0/account/~/extension/~/message-store?type=Pager&direction=Inbound',\n          subscriptionFilters.presence,\n        ],\n        deliveryMode: {\n          transportType: 'RC/GCM',\n          registrationId: registrationToken,\n          certificateName: this._deps.fCMSubscriptionOptions.certificateName,\n        },\n      },\n    );\n    return response.json();\n  }\n  async _deleteSubscription(fcmSubscription: TFCMSubscription) {\n    await this._deps.client.service.delete(\n      `/restapi/v1.0/subscription/${fcmSubscription!.id}`,\n    );\n    this.setFcmSubscription(null);\n  }\n  async _createOrUpdateSubscription(\n    fcmSubscription: TFCMSubscription,\n    registrationToken: TRegistrationToken,\n  ) {\n    if (!fcmSubscription) {\n      return await this._createSubscription(registrationToken);\n    }\n    if (fcmSubscription.deliveryMode.registrationId === registrationToken) {\n      const renewResponse = await this._deps.client.service.post(\n        `/restapi/v1.0/subscription/${fcmSubscription.id}/renew`,\n      );\n      return renewResponse.json();\n    }\n    try {\n      this._deleteSubscription(fcmSubscription);\n    } catch (e) {\n      console.error(`[FCMSubscription] subscription delete fail: ${e}`);\n      throw e;\n    }\n    return await this._createSubscription(registrationToken);\n  }\n\n  private async _registerFCM() {\n    await this.getServiceworkerRigestration();\n    const registrationToken = this.registrationToken;\n    let subscription = this.fcmSubscription;\n    subscription = await this._createOrUpdateSubscription(\n      subscription,\n      registrationToken,\n    );\n    this.setFcmSubscription(subscription);\n  }\n\n  override async onInit() {\n    try {\n      await waitUntilTo(async () => await this._registerFCM(), {\n        timeout: 30000,\n        interval: 10000,\n      });\n    } catch (e) {\n      console.error(`===something error:${e}`);\n    }\n  }\n}\n"],"mappings":"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"}