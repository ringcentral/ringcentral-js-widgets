{"version":3,"file":"OAuth.js","names":["uuid","_interopRequireWildcard","require","_background","_interopRequireDefault","_di","_proxify","_core","_utils","_OAuthBase2","_popWindow","_dec","_class","_class2","obj","__esModule","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","_objectSpread","target","i","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","res","Number","_get","Reflect","bind","property","receiver","base","_superPropBase","_getPrototypeOf","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","decorators","context","initializer","slice","reverse","reduce","decorator","OAuth","Module","name","deps","dep","optional","_OAuthBase","_super","_ref","_this","_ref$oAuthOptions","oAuthOptions","_ref$oAuthOptions$log","loginPath","_ref$oAuthOptions$red","redirectUri","_ref$oAuthOptions$res","restrictSameOriginRedirectUri","restOAuthOptions","_uuid","v4","_loginWindow","_redirectCheckTimeout","_isInElectron","isElectron","onInitOnce","_this2","window","addEventListener","close","_ref2","_ref2$data","data","callbackUri","_clearRedirectCheckTimeout","_handleCallbackUri","callbackUriStorageKey","newValue","localStorage","removeItem","watch","_this2$_deps$oAuthOpt","ready","_deps","auth","loggedIn","routerInteraction","currentPath","oAuthReady","_this2$_deps$oAuthOpt2","atLoginPage","setupOAuth","destroyOAuth","multiple","_setupOAuth","regeneratorRuntime","mark","_callee","_this3","wrap","_callee$","_context","prev","next","abrupt","oAuthCallback","setOAuthReady","stop","_destroyOAuth","_callee2","_callee2$","_context2","_openOAuthPage","_callee3","_callee3$","_context3","openOAuthPageInOtherRouter","openOAuthPage","_openOAuthPageInOtherRouter","_callee4","_callee4$","_context4","client","service","platform","discovery","loginUrlWithDiscovery","popWindow","oAuthUri","isRedirectUriSameOrigin","_setupRedirectCheckTimeout","clearTimeout","_this4","setTimeout","closed","location","href","_this$_deps$oAuthOpti","prefix","_this$_deps$oAuthOpti2","origin","concat","btoa","Date","now","encodeURIComponent","OAuthBase","background","proxify","exports"],"sources":["modules/OAuth/OAuth.ts"],"sourcesContent":["import * as uuid from 'uuid';\n\nimport background from '@ringcentral-integration/commons/lib/background';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport { proxify } from '@ringcentral-integration/commons/lib/proxy/proxify';\nimport { watch } from '@ringcentral-integration/core';\n\nimport { isElectron } from '@ringcentral-integration/utils';\nimport { OAuthBase } from '../../lib/OAuthBase';\nimport { popWindow } from '../../lib/popWindow';\nimport type { Deps } from './OAuth.interface';\n\n@Module({\n  name: 'OAuth',\n  deps: [\n    'Client',\n    'RouterInteraction',\n    { dep: 'OAuthOptions', optional: true },\n  ],\n})\nexport class OAuth<T extends Deps = Deps> extends OAuthBase<T> {\n  private _uuid = uuid.v4();\n\n  private _loginWindow: Window | null = null;\n  private _redirectCheckTimeout: ReturnType<typeof setTimeout> | null = null;\n  private _isInElectron = isElectron();\n\n  constructor({\n    oAuthOptions: {\n      loginPath = '/',\n      redirectUri = './redirect.html',\n      restrictSameOriginRedirectUri = true,\n      ...restOAuthOptions\n    } = {},\n    ...deps\n  }: Deps) {\n    // @ts-expect-error TS(2345): Argument of type '{ oAuthOptions: { prefix?: strin... Remove this comment to see the full error message\n    super({\n      ...deps,\n      oAuthOptions: {\n        loginPath,\n        redirectUri,\n        restrictSameOriginRedirectUri,\n        ...restOAuthOptions,\n      },\n    });\n  }\n\n  // @ts-expect-error TS(4114): This member must have an 'override' modifier becau... Remove this comment to see the full error message\n  get name() {\n    return 'OAuth';\n  }\n\n  get prefix() {\n    return this._deps.oAuthOptions?.prefix;\n  }\n\n  get restrictSameOriginRedirectUri() {\n    return this._deps.oAuthOptions?.restrictSameOriginRedirectUri;\n  }\n\n  get isRedirectUriSameOrigin() {\n    return this.restrictSameOriginRedirectUri\n      ? this.redirectUri.indexOf(window.origin) === 0\n      : true;\n  }\n\n  // @ts-expect-error TS(4114): This member must have an 'override' modifier becau... Remove this comment to see the full error message\n  get authState() {\n    return `${btoa(`${Date.now()}`)}-${this.prefix}-${encodeURIComponent(\n      btoa(this._uuid),\n    )}`;\n  }\n\n  get callbackUriStorageKey() {\n    return `${this.prefix}-${encodeURIComponent(btoa(this._uuid))}-callbackUri`;\n  }\n\n  override onInitOnce() {\n    super.onInitOnce && super.onInitOnce();\n    // close login window when unload and login window exist\n    window.addEventListener('beforeunload', () => {\n      if (this._loginWindow) {\n        try {\n          this._loginWindow.close();\n        } catch (error) {\n          /* ignore error */\n        }\n      }\n    });\n    // listen callback uri from redirect page, works with coss origin redirect page\n    window.addEventListener('message', ({ data = {} }) => {\n      if (!data) {\n        return;\n      }\n      const { callbackUri } = data;\n      if (callbackUri) {\n        this._clearRedirectCheckTimeout();\n        this._handleCallbackUri(callbackUri);\n      }\n    });\n    // listen callback uri from storage, works only with same origin\n    window.addEventListener('storage', (e) => {\n      if (\n        e.key === this.callbackUriStorageKey &&\n        e.newValue &&\n        e.newValue !== ''\n      ) {\n        const callbackUri = e.newValue;\n        localStorage.removeItem(this.callbackUriStorageKey);\n        this._clearRedirectCheckTimeout();\n        this._handleCallbackUri(callbackUri);\n      }\n    });\n\n    watch(\n      this,\n      () => [\n        this.ready,\n        this._deps.auth.loggedIn,\n        this._deps.routerInteraction.currentPath,\n        this._deps.oAuthOptions?.loginPath,\n        this.oAuthReady,\n      ],\n      () => {\n        const atLoginPage =\n          this._deps.routerInteraction.currentPath ===\n          this._deps.oAuthOptions?.loginPath;\n\n        if (\n          this.ready &&\n          !this._deps.auth.loggedIn &&\n          atLoginPage &&\n          !this.oAuthReady\n        ) {\n          this.setupOAuth();\n        } else if (this._deps.auth.loggedIn || !atLoginPage) {\n          this.destroyOAuth();\n        }\n      },\n      { multiple: true },\n    );\n  }\n\n  @background\n  async setupOAuth() {\n    if (this.oAuthReady) return;\n\n    window.oAuthCallback = (callbackUri) => {\n      this._clearRedirectCheckTimeout();\n      this._handleCallbackUri(callbackUri);\n    };\n\n    this.setOAuthReady(true);\n  }\n\n  @background\n  override async destroyOAuth() {\n    if (!this.oAuthReady) return;\n    // @ts-ignore\n    window.oAuthCallback = null;\n    this.setOAuthReady(false);\n  }\n\n  @proxify\n  override async openOAuthPage() {\n    if (!this.oAuthReady) return;\n    await this.openOAuthPageInOtherRouter();\n  }\n\n  @proxify\n  async openOAuthPageInOtherRouter() {\n    if (this._deps.client.service.platform().discovery()) {\n      await this._deps.client.service.platform().loginUrlWithDiscovery();\n    }\n    this._loginWindow = popWindow(this.oAuthUri, 'rc-oauth', 600, 600);\n\n    if (this.isRedirectUriSameOrigin) {\n      this._setupRedirectCheckTimeout();\n    }\n  }\n\n  private _clearRedirectCheckTimeout() {\n    if (this._redirectCheckTimeout === null) return;\n\n    clearTimeout(this._redirectCheckTimeout);\n  }\n\n  private _setupRedirectCheckTimeout() {\n    this._clearRedirectCheckTimeout();\n    this._redirectCheckTimeout = setTimeout(() => {\n      this._redirectCheckTimeout = null;\n\n      if (\n        !this._loginWindow ||\n        this._loginWindow.closed ||\n        // for electron, the .window is always undefined\n        (!this._isInElectron && !this._loginWindow.window)\n      ) {\n        this._loginWindow = null;\n        return;\n      }\n\n      try {\n        const callbackUri = this._loginWindow.location.href;\n        if (callbackUri.indexOf(this.redirectUri) !== -1) {\n          this._loginWindow.close();\n          this._loginWindow = null;\n          this._handleCallbackUri(callbackUri);\n          return;\n        }\n      } catch (e) {\n        // ignore e\n        // console.log('checking redirect uri');\n      }\n      this._setupRedirectCheckTimeout();\n    }, 1000);\n  }\n}\n"],"mappings":"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"}