{"version":3,"file":"OAuth.js","names":["_background","_interopRequireDefault","require","_di","_proxify","_core","_utils","_uuid","_OAuthBase2","_popWindow","_dec","_class","_class2","e","__esModule","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","Object","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","enumerable","push","_objectSpread","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","configurable","writable","_objectWithoutProperties","_objectWithoutPropertiesLoose","indexOf","propertyIsEnumerable","call","hasOwnProperty","_classCallCheck","TypeError","_defineProperties","key","_createClass","prototype","_toPrimitive","_typeof","Symbol","toPrimitive","String","Number","_get","Reflect","get","bind","p","_superPropBase","_getPrototypeOf","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","__proto__","_createSuper","_isNativeReflectConstruct","s","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","l","initializer","slice","reverse","reduce","OAuth","Module","name","deps","dep","optional","_OAuthBase","_super","_ref","_this","_ref$oAuthOptions","oAuthOptions","_ref$oAuthOptions$log","loginPath","_ref$oAuthOptions$red","redirectUri","_ref$oAuthOptions$res","restrictSameOriginRedirectUri","restOAuthOptions","v4","_loginWindow","_redirectCheckTimeout","_isInElectron","isElectron","combinedState","json","JSON","stringify","now","Date","uuid","prefix","origin","window","encoded","btoa","prefixedUuidState","concat","encodeURIComponent","onInitOnce","_this2","addEventListener","close","error","_ref2","_ref2$data","data","callbackUri","_clearRedirectCheckTimeout","_handleCallbackUri","callbackUriStorageKey","newValue","localStorage","removeItem","watch","_this2$_deps$oAuthOpt","ready","_deps","auth","loggedIn","routerInteraction","currentPath","oAuthReady","_this2$_deps$oAuthOpt2","atLoginPage","setupOAuth","destroyOAuth","multiple","_setupOAuth","regeneratorRuntime","mark","_callee","_this3","wrap","_callee$","_context","prev","next","abrupt","oAuthCallback","setOAuthReady","stop","_destroyOAuth","_callee2","_callee2$","_context2","_openOAuthPage","_callee3","_callee3$","_context3","openOAuthPageInOtherRouter","openOAuthPage","_openOAuthPageInOtherRouter","_callee4","_callee4$","_context4","client","service","platform","discovery","loginUrlWithDiscovery","popWindow","oAuthUri","isRedirectUriSameOrigin","_setupRedirectCheckTimeout","clearTimeout","_this4","setTimeout","closed","location","href","_this$_deps$oAuthOpti","_this$_deps$oAuthOpti2","OAuthBase","background","proxify","exports"],"sources":["modules/OAuth/OAuth.ts"],"sourcesContent":["import background from '@ringcentral-integration/commons/lib/background';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport { proxify } from '@ringcentral-integration/commons/lib/proxy/proxify';\nimport { watch } from '@ringcentral-integration/core';\nimport { isElectron } from '@ringcentral-integration/utils';\nimport { v4 } from 'uuid';\n\nimport { OAuthBase } from '../../lib/OAuthBase';\nimport { popWindow } from '../../lib/popWindow';\n\nimport type { CombinedAuthState, Deps } from './OAuth.interface';\n\n@Module({\n  name: 'OAuth',\n  deps: [\n    'Client',\n    'RouterInteraction',\n    { dep: 'OAuthOptions', optional: true },\n  ],\n})\nexport class OAuth<T extends Deps = Deps> extends OAuthBase<T> {\n  private _uuid = v4();\n\n  private _loginWindow: Window | null = null;\n  private _redirectCheckTimeout: ReturnType<typeof setTimeout> | null = null;\n  private _isInElectron = isElectron();\n\n  constructor({\n    oAuthOptions: {\n      loginPath = '/',\n      redirectUri = './redirect.html',\n      restrictSameOriginRedirectUri = true,\n      ...restOAuthOptions\n    } = {},\n    ...deps\n  }: Deps) {\n    // @ts-expect-error TS(2345): Argument of type '{ oAuthOptions: { prefix?: strin... Remove this comment to see the full error message\n    super({\n      ...deps,\n      oAuthOptions: {\n        loginPath,\n        redirectUri,\n        restrictSameOriginRedirectUri,\n        ...restOAuthOptions,\n      },\n    });\n  }\n\n  // @ts-expect-error TS(4114): This member must have an 'override' modifier becau... Remove this comment to see the full error message\n  get name() {\n    return 'OAuth';\n  }\n\n  get prefix() {\n    return this._deps.oAuthOptions?.prefix;\n  }\n\n  get restrictSameOriginRedirectUri() {\n    return this._deps.oAuthOptions?.restrictSameOriginRedirectUri;\n  }\n\n  get isRedirectUriSameOrigin() {\n    return this.restrictSameOriginRedirectUri\n      ? this.redirectUri.indexOf(window.origin) === 0\n      : true;\n  }\n\n  protected combinedState() {\n    const json = JSON.stringify({\n      now: Date.now(),\n      uuid: this._uuid,\n      prefix: this.prefix,\n      origin: window.origin,\n    } satisfies CombinedAuthState);\n    const encoded = window.btoa(json);\n    return encoded;\n  }\n\n  protected prefixedUuidState() {\n    return `${this.prefix}-${encodeURIComponent(btoa(this._uuid))}`;\n  }\n\n  override get authState() {\n    return `${this.combinedState()}-${this.prefixedUuidState()}`;\n  }\n\n  override onInitOnce() {\n    super.onInitOnce && super.onInitOnce();\n    // close login window when unload and login window exist\n    window.addEventListener('beforeunload', () => {\n      if (this._loginWindow) {\n        try {\n          this._loginWindow.close();\n        } catch (error) {\n          /* ignore error */\n        }\n      }\n    });\n\n    // listen callback uri from redirect page, works with coss origin redirect page\n    window.addEventListener('message', ({ data = {} }) => {\n      if (!data) {\n        return;\n      }\n      const { callbackUri } = data;\n      if (callbackUri) {\n        this._clearRedirectCheckTimeout();\n        this._handleCallbackUri(callbackUri);\n      }\n    });\n\n    // listen callback uri from storage, works only with same origin\n    window.addEventListener('storage', (e) => {\n      const callbackUriStorageKey = `${this.prefixedUuidState()}-callbackUri`;\n      if (e.key === callbackUriStorageKey && e.newValue) {\n        const callbackUri = e.newValue;\n        localStorage.removeItem(callbackUriStorageKey);\n        this._clearRedirectCheckTimeout();\n        this._handleCallbackUri(callbackUri);\n      }\n    });\n\n    watch(\n      this,\n      () => [\n        this.ready,\n        this._deps.auth.loggedIn,\n        this._deps.routerInteraction.currentPath,\n        this._deps.oAuthOptions?.loginPath,\n        this.oAuthReady,\n      ],\n      () => {\n        const atLoginPage =\n          this._deps.routerInteraction.currentPath ===\n          this._deps.oAuthOptions?.loginPath;\n\n        if (\n          this.ready &&\n          !this._deps.auth.loggedIn &&\n          atLoginPage &&\n          !this.oAuthReady\n        ) {\n          this.setupOAuth();\n        } else if (this._deps.auth.loggedIn || !atLoginPage) {\n          this.destroyOAuth();\n        }\n      },\n      { multiple: true },\n    );\n  }\n\n  @background\n  async setupOAuth() {\n    if (this.oAuthReady) return;\n\n    window.oAuthCallback = (callbackUri) => {\n      this._clearRedirectCheckTimeout();\n      this._handleCallbackUri(callbackUri);\n    };\n\n    this.setOAuthReady(true);\n  }\n\n  @background\n  override async destroyOAuth() {\n    if (!this.oAuthReady) return;\n    // @ts-ignore\n    window.oAuthCallback = null;\n    this.setOAuthReady(false);\n  }\n\n  @proxify\n  override async openOAuthPage() {\n    if (!this.oAuthReady) return;\n    await this.openOAuthPageInOtherRouter();\n  }\n\n  @proxify\n  async openOAuthPageInOtherRouter() {\n    if (this._deps.client.service.platform().discovery()) {\n      await this._deps.client.service.platform().loginUrlWithDiscovery();\n    }\n    this._loginWindow = popWindow(this.oAuthUri, 'rc-oauth', 700, 700);\n\n    if (this.isRedirectUriSameOrigin) {\n      this._setupRedirectCheckTimeout();\n    }\n  }\n\n  private _clearRedirectCheckTimeout() {\n    if (this._redirectCheckTimeout === null) return;\n\n    clearTimeout(this._redirectCheckTimeout);\n  }\n\n  private _setupRedirectCheckTimeout() {\n    this._clearRedirectCheckTimeout();\n    this._redirectCheckTimeout = setTimeout(() => {\n      this._redirectCheckTimeout = null;\n\n      if (\n        !this._loginWindow ||\n        this._loginWindow.closed ||\n        // for electron, the .window is always undefined\n        (!this._isInElectron && !this._loginWindow.window)\n      ) {\n        this._loginWindow = null;\n        return;\n      }\n\n      try {\n        const callbackUri = this._loginWindow.location.href;\n        if (callbackUri.indexOf(this.redirectUri) !== -1) {\n          this._loginWindow.close();\n          this._loginWindow = null;\n          this._handleCallbackUri(callbackUri);\n          return;\n        }\n      } catch (e) {\n        // ignore e\n        // console.log('checking redirect uri');\n      }\n      this._setupRedirectCheckTimeout();\n    }, 1000);\n  }\n}\n"],"mappings":"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","ignoreList":[]}