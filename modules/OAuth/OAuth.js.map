{"version":3,"file":"OAuth.js","names":["_background","_interopRequireDefault","require","_di","_proxify","_core","_utils","uuid","_interopRequireWildcard","_OAuthBase2","_popWindow","_dec","_class","_class2","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","asyncGeneratorStep","o","c","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","push","_objectSpread","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_objectWithoutProperties","_objectWithoutPropertiesLoose","indexOf","propertyIsEnumerable","_classCallCheck","TypeError","_defineProperties","key","_createClass","prototype","_toPrimitive","Symbol","toPrimitive","String","Number","_get","Reflect","bind","p","_superPropBase","_getPrototypeOf","_inherits","create","constructor","_setPrototypeOf","setPrototypeOf","_createSuper","_isNativeReflectConstruct","s","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","Boolean","valueOf","getPrototypeOf","_applyDecoratedDescriptor","l","initializer","slice","reverse","reduce","OAuth","Module","name","deps","dep","optional","_OAuthBase","_super","_ref","_this","_ref$oAuthOptions","oAuthOptions","_ref$oAuthOptions$log","loginPath","_ref$oAuthOptions$red","redirectUri","_ref$oAuthOptions$res","restrictSameOriginRedirectUri","restOAuthOptions","_uuid","v4","_loginWindow","_redirectCheckTimeout","_isInElectron","isElectron","onInitOnce","_this2","window","addEventListener","close","error","_ref2","_ref2$data","data","callbackUri","_clearRedirectCheckTimeout","_handleCallbackUri","callbackUriStorageKey","newValue","localStorage","removeItem","watch","_this2$_deps$oAuthOpt","ready","_deps","auth","loggedIn","routerInteraction","currentPath","oAuthReady","_this2$_deps$oAuthOpt2","atLoginPage","setupOAuth","destroyOAuth","multiple","_setupOAuth","regeneratorRuntime","mark","_callee","_this3","wrap","_callee$","_context","prev","next","abrupt","oAuthCallback","setOAuthReady","stop","_destroyOAuth","_callee2","_callee2$","_context2","_openOAuthPage","_callee3","_callee3$","_context3","openOAuthPageInOtherRouter","openOAuthPage","_openOAuthPageInOtherRouter","_callee4","_callee4$","_context4","client","service","platform","discovery","loginUrlWithDiscovery","popWindow","oAuthUri","isRedirectUriSameOrigin","_setupRedirectCheckTimeout","clearTimeout","_this4","setTimeout","closed","location","href","_this$_deps$oAuthOpti","prefix","_this$_deps$oAuthOpti2","origin","concat","btoa","Date","now","encodeURIComponent","OAuthBase","background","proxify","exports"],"sources":["modules/OAuth/OAuth.ts"],"sourcesContent":["import background from '@ringcentral-integration/commons/lib/background';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport { proxify } from '@ringcentral-integration/commons/lib/proxy/proxify';\nimport { watch } from '@ringcentral-integration/core';\nimport { isElectron } from '@ringcentral-integration/utils';\nimport * as uuid from 'uuid';\n\nimport { OAuthBase } from '../../lib/OAuthBase';\nimport { popWindow } from '../../lib/popWindow';\n\nimport type { Deps } from './OAuth.interface';\n\n@Module({\n  name: 'OAuth',\n  deps: [\n    'Client',\n    'RouterInteraction',\n    { dep: 'OAuthOptions', optional: true },\n  ],\n})\nexport class OAuth<T extends Deps = Deps> extends OAuthBase<T> {\n  private _uuid = uuid.v4();\n\n  private _loginWindow: Window | null = null;\n  private _redirectCheckTimeout: ReturnType<typeof setTimeout> | null = null;\n  private _isInElectron = isElectron();\n\n  constructor({\n    oAuthOptions: {\n      loginPath = '/',\n      redirectUri = './redirect.html',\n      restrictSameOriginRedirectUri = true,\n      ...restOAuthOptions\n    } = {},\n    ...deps\n  }: Deps) {\n    // @ts-expect-error TS(2345): Argument of type '{ oAuthOptions: { prefix?: strin... Remove this comment to see the full error message\n    super({\n      ...deps,\n      oAuthOptions: {\n        loginPath,\n        redirectUri,\n        restrictSameOriginRedirectUri,\n        ...restOAuthOptions,\n      },\n    });\n  }\n\n  // @ts-expect-error TS(4114): This member must have an 'override' modifier becau... Remove this comment to see the full error message\n  get name() {\n    return 'OAuth';\n  }\n\n  get prefix() {\n    return this._deps.oAuthOptions?.prefix;\n  }\n\n  get restrictSameOriginRedirectUri() {\n    return this._deps.oAuthOptions?.restrictSameOriginRedirectUri;\n  }\n\n  get isRedirectUriSameOrigin() {\n    return this.restrictSameOriginRedirectUri\n      ? this.redirectUri.indexOf(window.origin) === 0\n      : true;\n  }\n\n  // @ts-expect-error TS(4114): This member must have an 'override' modifier becau... Remove this comment to see the full error message\n  get authState() {\n    return `${btoa(`${Date.now()}`)}-${this.prefix}-${encodeURIComponent(\n      btoa(this._uuid),\n    )}`;\n  }\n\n  get callbackUriStorageKey() {\n    return `${this.prefix}-${encodeURIComponent(btoa(this._uuid))}-callbackUri`;\n  }\n\n  override onInitOnce() {\n    super.onInitOnce && super.onInitOnce();\n    // close login window when unload and login window exist\n    window.addEventListener('beforeunload', () => {\n      if (this._loginWindow) {\n        try {\n          this._loginWindow.close();\n        } catch (error) {\n          /* ignore error */\n        }\n      }\n    });\n    // listen callback uri from redirect page, works with coss origin redirect page\n    window.addEventListener('message', ({ data = {} }) => {\n      if (!data) {\n        return;\n      }\n      const { callbackUri } = data;\n      if (callbackUri) {\n        this._clearRedirectCheckTimeout();\n        this._handleCallbackUri(callbackUri);\n      }\n    });\n    // listen callback uri from storage, works only with same origin\n    window.addEventListener('storage', (e) => {\n      if (\n        e.key === this.callbackUriStorageKey &&\n        e.newValue &&\n        e.newValue !== ''\n      ) {\n        const callbackUri = e.newValue;\n        localStorage.removeItem(this.callbackUriStorageKey);\n        this._clearRedirectCheckTimeout();\n        this._handleCallbackUri(callbackUri);\n      }\n    });\n\n    watch(\n      this,\n      () => [\n        this.ready,\n        this._deps.auth.loggedIn,\n        this._deps.routerInteraction.currentPath,\n        this._deps.oAuthOptions?.loginPath,\n        this.oAuthReady,\n      ],\n      () => {\n        const atLoginPage =\n          this._deps.routerInteraction.currentPath ===\n          this._deps.oAuthOptions?.loginPath;\n\n        if (\n          this.ready &&\n          !this._deps.auth.loggedIn &&\n          atLoginPage &&\n          !this.oAuthReady\n        ) {\n          this.setupOAuth();\n        } else if (this._deps.auth.loggedIn || !atLoginPage) {\n          this.destroyOAuth();\n        }\n      },\n      { multiple: true },\n    );\n  }\n\n  @background\n  async setupOAuth() {\n    if (this.oAuthReady) return;\n\n    window.oAuthCallback = (callbackUri) => {\n      this._clearRedirectCheckTimeout();\n      this._handleCallbackUri(callbackUri);\n    };\n\n    this.setOAuthReady(true);\n  }\n\n  @background\n  override async destroyOAuth() {\n    if (!this.oAuthReady) return;\n    // @ts-ignore\n    window.oAuthCallback = null;\n    this.setOAuthReady(false);\n  }\n\n  @proxify\n  override async openOAuthPage() {\n    if (!this.oAuthReady) return;\n    await this.openOAuthPageInOtherRouter();\n  }\n\n  @proxify\n  async openOAuthPageInOtherRouter() {\n    if (this._deps.client.service.platform().discovery()) {\n      await this._deps.client.service.platform().loginUrlWithDiscovery();\n    }\n    this._loginWindow = popWindow(this.oAuthUri, 'rc-oauth', 700, 700);\n\n    if (this.isRedirectUriSameOrigin) {\n      this._setupRedirectCheckTimeout();\n    }\n  }\n\n  private _clearRedirectCheckTimeout() {\n    if (this._redirectCheckTimeout === null) return;\n\n    clearTimeout(this._redirectCheckTimeout);\n  }\n\n  private _setupRedirectCheckTimeout() {\n    this._clearRedirectCheckTimeout();\n    this._redirectCheckTimeout = setTimeout(() => {\n      this._redirectCheckTimeout = null;\n\n      if (\n        !this._loginWindow ||\n        this._loginWindow.closed ||\n        // for electron, the .window is always undefined\n        (!this._isInElectron && !this._loginWindow.window)\n      ) {\n        this._loginWindow = null;\n        return;\n      }\n\n      try {\n        const callbackUri = this._loginWindow.location.href;\n        if (callbackUri.indexOf(this.redirectUri) !== -1) {\n          this._loginWindow.close();\n          this._loginWindow = null;\n          this._handleCallbackUri(callbackUri);\n          return;\n        }\n      } catch (e) {\n        // ignore e\n        // console.log('checking redirect uri');\n      }\n      this._setupRedirectCheckTimeout();\n    }, 1000);\n  }\n}\n"],"mappings":"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","ignoreList":[]}