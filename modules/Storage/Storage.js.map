{"version":3,"file":"Storage.js","names":["_StorageBase2","require","_di","_Auth","_dec","_class","_regeneratorKeys","e","n","Object","r","t","unshift","length","pop","value","done","_regenerator","Symbol","iterator","o","toStringTag","i","c","prototype","Generator","u","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","l","TypeError","call","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","apply","_objectSpread","arguments","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","_next","_throw","_classCallCheck","_defineProperties","key","_createClass","_toPrimitive","_typeof","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","_assertThisInitialized","ReferenceError","Boolean","valueOf","_inherits","_setPrototypeOf","dataFetcherKey","Storage","exports","Module","name","deps","dep","optional","_StorageBase","_deps$storageOptions","_this$_deps$storageOp","_this$_deps$storageOp2","_this","StorageProvider","storageOptions","_disableInactiveTabsWrite","_storage","_storageHandler","storedData","_deps","disableInactiveTabsWrite","get","tabManager","active","onStateChange","ready","storageWritable","currentData","data","setItem","_currentData$dataFetc","currentFetcherData","storedFetcherData","needToSave","cachedTimestamps","_key","cachedData","prefix","concat","auth","ownerId","_onInit","_callee","_this$_deps$storageOp3","_key2","_t","_t2","_context","_StorageProvider","storageKey","getData","disableClearUnused","_storageReducers","removeItem","setData","hasOwnProperty","onInit","onInitSuccess","_this2","_ref","syncData","on","_shouldInit","loginStatus","loggedIn","pending","_shouldReset","notLoggedIn","onReset","off","removeListener","destroy","resetData","StorageBase"],"sources":["modules/Storage/Storage.ts"],"sourcesContent":["// @ts-nocheck\nimport type { IStorage } from '../../lib/StorageBase';\nimport { StorageBase } from '../../lib/StorageBase';\nimport { Module } from '../../lib/di';\nimport { loginStatus } from '../Auth';\n\nimport type { Deps } from './Storage.interface';\n\nconst dataFetcherKey = 'dataFetcherV2-storageData';\n\n@Module({\n  name: 'Storage',\n  deps: [\n    'Auth',\n    { dep: 'TabManager', optional: true },\n    { dep: 'StorageOptions', optional: true },\n  ],\n})\nexport class Storage<T extends Deps = Deps> extends StorageBase<T> {\n  protected _disableInactiveTabsWrite: boolean;\n  protected _storage: IStorage;\n  protected _storageHandler: ({\n    key,\n    value,\n  }: {\n    key: string;\n    value: unknown;\n  }) => void = null;\n\n  constructor(deps: T) {\n    super(deps, {\n      name: 'storage',\n      StorageProvider: deps.storageOptions?.StorageProvider,\n    });\n    this._disableInactiveTabsWrite =\n      this._deps.storageOptions?.disableInactiveTabsWrite ?? true;\n  }\n\n  storedData: Record<string, any> = {};\n\n  get storageWritable() {\n    return (\n      !this._disableInactiveTabsWrite ||\n      !this._deps.tabManager ||\n      this._deps.tabManager.active\n    );\n  }\n\n  override onStateChange() {\n    if (this.ready && this.storageWritable) {\n      const currentData = this.data;\n      // save new data to storage when changed\n      for (const key in currentData) {\n        if (key !== dataFetcherKey) {\n          if (this.storedData[key] !== currentData[key]) {\n            this._storage.setItem(key, currentData[key]);\n            this.storedData[key] = currentData[key];\n          }\n        } else {\n          const currentFetcherData = currentData[dataFetcherKey] ?? {};\n          if (!this.storedData[dataFetcherKey]) {\n            this.storedData[dataFetcherKey] = {};\n          }\n          const storedFetcherData = this.storedData[dataFetcherKey];\n          let needToSave = false;\n          // initial state has no cachedTimestamps and need to save\n          if (!storedFetcherData.cachedTimestamps) {\n            needToSave = true;\n            this.storedData[dataFetcherKey] = currentFetcherData;\n          } else {\n            // if cachedTimestamps changed, cachedData should be changed too\n            // And an action only updates one data\n            for (const _key in currentFetcherData.cachedTimestamps) {\n              if (\n                storedFetcherData.cachedTimestamps[_key] !==\n                currentFetcherData.cachedTimestamps[_key]\n              ) {\n                needToSave = true;\n                storedFetcherData.cachedTimestamps[_key] =\n                  currentFetcherData.cachedTimestamps[_key];\n                storedFetcherData.cachedData[_key] =\n                  currentFetcherData.cachedData[_key];\n              }\n            }\n          }\n          if (needToSave) {\n            this._storage.setItem(\n              dataFetcherKey,\n              this.storedData[dataFetcherKey],\n            );\n          }\n        }\n      }\n    }\n  }\n\n  get storageKey() {\n    const prefix = this.prefix ? `${this.prefix}-` : '';\n\n    return `${prefix}storage-${this._deps.auth.ownerId}`;\n  }\n\n  override async onInit() {\n    this._storage = new this._StorageProvider({\n      storageKey: this.storageKey,\n    });\n    this.storedData = await this._storage.getData();\n    if (!this._deps.storageOptions?.disableClearUnused) {\n      for (const key in this.storedData) {\n        if (!this._storageReducers[key]) {\n          delete this.storedData[key];\n          await this._storage.removeItem(key);\n        }\n      }\n    }\n    this.setData({\n      ...this.data,\n      ...this.storedData,\n    });\n    const currentData = this.data;\n    for (const key in currentData) {\n      if (\n        !Object.prototype.hasOwnProperty.call(this.storedData, key) &&\n        this.storageWritable\n      ) {\n        this._storage.setItem(key, currentData[key]);\n      }\n    }\n  }\n\n  override onInitSuccess() {\n    this._storageHandler = ({ key, value }) => {\n      if (this.ready) {\n        this.storedData[key] = value;\n        this.syncData(key, value);\n      }\n    };\n    this._storage.on('storage', this._storageHandler);\n  }\n\n  override _shouldInit() {\n    return (\n      this._deps.auth.loginStatus === loginStatus.loggedIn &&\n      (!this._deps.tabManager || this._deps.tabManager.ready) &&\n      this.pending\n    );\n  }\n\n  override _shouldReset() {\n    return (\n      ((!!this._deps.tabManager && !this._deps.tabManager.ready) ||\n        this._deps.auth.notLoggedIn) &&\n      this.ready\n    );\n  }\n\n  override onReset() {\n    if (this._storageHandler) {\n      if (this._storage.off) {\n        this._storage.off('storage', this._storageHandler);\n      } else if (this._storage.removeListener) {\n        this._storage.removeListener('storage', this._storageHandler);\n      }\n      this._storageHandler = null;\n    }\n    if (this._storage) {\n      this._storage.destroy();\n      this._storage = null;\n    }\n    this.resetData();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAAA,aAAA,GAAAC,OAAA;AACA,IAAAC,GAAA,GAAAD,OAAA;AACA,IAAAE,KAAA,GAAAF,OAAA;AAAsC,IAAAG,IAAA,EAAAC,MAAA,EAJtC;AAAA,SAAAC,iBAAAC,CAAA,QAAAC,CAAA,GAAAC,MAAA,CAAAF,CAAA,GAAAG,CAAA,gBAAAC,CAAA,IAAAH,CAAA,EAAAE,CAAA,CAAAE,OAAA,CAAAD,CAAA,mBAAAJ,EAAA,WAAAG,CAAA,CAAAG,MAAA,QAAAF,CAAA,GAAAD,CAAA,CAAAI,GAAA,OAAAN,CAAA,SAAAD,CAAA,CAAAQ,KAAA,GAAAJ,CAAA,EAAAJ,CAAA,CAAAS,IAAA,OAAAT,CAAA,SAAAA,CAAA,CAAAS,IAAA,OAAAT,CAAA;AAAA,SAAAU,aAAA,IACA,uKAAAV,CAAA,EAAAI,CAAA,EAAAD,CAAA,wBAAAQ,MAAA,GAAAA,MAAA,OAAAV,CAAA,GAAAE,CAAA,CAAAS,QAAA,kBAAAC,CAAA,GAAAV,CAAA,CAAAW,WAAA,8BAAAC,EAAAZ,CAAA,EAAAF,CAAA,EAAAY,CAAA,EAAAE,CAAA,QAAAC,CAAA,GAAAf,CAAA,IAAAA,CAAA,CAAAgB,SAAA,YAAAC,SAAA,GAAAjB,CAAA,GAAAiB,SAAA,EAAAC,CAAA,GAAAjB,MAAA,CAAAkB,MAAA,CAAAJ,CAAA,CAAAC,SAAA,UAAAI,mBAAA,CAAAF,CAAA,uBAAAhB,CAAA,EAAAF,CAAA,EAAAY,CAAA,QAAAE,CAAA,EAAAC,CAAA,EAAAG,CAAA,EAAAG,CAAA,MAAAC,CAAA,GAAAV,CAAA,QAAAW,CAAA,OAAAC,CAAA,KAAAF,CAAA,KAAAtB,CAAA,KAAAyB,CAAA,EAAA1B,CAAA,EAAA2B,CAAA,EAAAC,CAAA,EAAAN,CAAA,EAAAM,CAAA,CAAAC,IAAA,CAAA7B,CAAA,MAAA4B,CAAA,WAAAA,EAAAxB,CAAA,EAAAD,CAAA,WAAAY,CAAA,GAAAX,CAAA,EAAAY,CAAA,MAAAG,CAAA,GAAAnB,CAAA,EAAAyB,CAAA,CAAAxB,CAAA,GAAAE,CAAA,EAAAwB,CAAA,gBAAAC,EAAAzB,CAAA,EAAAF,CAAA,SAAAe,CAAA,GAAAb,CAAA,EAAAgB,CAAA,GAAAlB,CAAA,EAAAG,CAAA,OAAAoB,CAAA,IAAAF,CAAA,KAAAT,CAAA,IAAAT,CAAA,GAAAmB,CAAA,CAAAjB,MAAA,EAAAF,CAAA,UAAAS,CAAA,EAAAE,CAAA,GAAAQ,CAAA,CAAAnB,CAAA,GAAAwB,CAAA,GAAAH,CAAA,CAAAF,CAAA,EAAAO,CAAA,GAAAf,CAAA,KAAAZ,CAAA,QAAAU,CAAA,GAAAiB,CAAA,KAAA7B,CAAA,MAAAkB,CAAA,GAAAJ,CAAA,EAAAC,CAAA,GAAAD,CAAA,YAAAC,CAAA,WAAAD,CAAA,MAAAA,CAAA,MAAAf,CAAA,IAAAe,CAAA,OAAAa,CAAA,MAAAf,CAAA,GAAAV,CAAA,QAAAyB,CAAA,GAAAb,CAAA,QAAAC,CAAA,MAAAS,CAAA,CAAAC,CAAA,GAAAzB,CAAA,EAAAwB,CAAA,CAAAxB,CAAA,GAAAc,CAAA,OAAAa,CAAA,GAAAE,CAAA,KAAAjB,CAAA,GAAAV,CAAA,QAAAY,CAAA,MAAAd,CAAA,IAAAA,CAAA,GAAA6B,CAAA,MAAAf,CAAA,MAAAZ,CAAA,EAAAY,CAAA,MAAAd,CAAA,EAAAwB,CAAA,CAAAxB,CAAA,GAAA6B,CAAA,EAAAd,CAAA,cAAAH,CAAA,IAAAV,CAAA,aAAAwB,CAAA,QAAAH,CAAA,OAAAvB,CAAA,qBAAAY,CAAA,EAAAU,CAAA,EAAAO,CAAA,QAAAR,CAAA,YAAAS,SAAA,uCAAAP,CAAA,UAAAD,CAAA,IAAAK,CAAA,CAAAL,CAAA,EAAAO,CAAA,GAAAd,CAAA,GAAAO,CAAA,EAAAJ,CAAA,GAAAW,CAAA,GAAA1B,CAAA,GAAAY,CAAA,OAAAhB,CAAA,GAAAmB,CAAA,MAAAK,CAAA,KAAAT,CAAA,KAAAC,CAAA,GAAAA,CAAA,QAAAA,CAAA,SAAAS,CAAA,CAAAxB,CAAA,QAAA2B,CAAA,CAAAZ,CAAA,EAAAG,CAAA,KAAAM,CAAA,CAAAxB,CAAA,GAAAkB,CAAA,GAAAM,CAAA,CAAAC,CAAA,GAAAP,CAAA,aAAAG,CAAA,MAAAP,CAAA,QAAAC,CAAA,KAAAH,CAAA,YAAAT,CAAA,GAAAW,CAAA,CAAAF,CAAA,WAAAT,CAAA,GAAAA,CAAA,CAAA4B,IAAA,CAAAjB,CAAA,EAAAI,CAAA,UAAAY,SAAA,2CAAA3B,CAAA,CAAAK,IAAA,SAAAL,CAAA,EAAAe,CAAA,GAAAf,CAAA,CAAAI,KAAA,EAAAQ,CAAA,SAAAA,CAAA,oBAAAA,CAAA,KAAAZ,CAAA,GAAAW,CAAA,eAAAX,CAAA,CAAA4B,IAAA,CAAAjB,CAAA,GAAAC,CAAA,SAAAG,CAAA,GAAAY,SAAA,uCAAAlB,CAAA,gBAAAG,CAAA,OAAAD,CAAA,GAAAf,CAAA,cAAAI,CAAA,IAAAoB,CAAA,GAAAC,CAAA,CAAAxB,CAAA,QAAAkB,CAAA,GAAAhB,CAAA,CAAA6B,IAAA,CAAA/B,CAAA,EAAAwB,CAAA,OAAAE,CAAA,kBAAAvB,CAAA,IAAAW,CAAA,GAAAf,CAAA,EAAAgB,CAAA,MAAAG,CAAA,GAAAf,CAAA,cAAAkB,CAAA,mBAAAd,KAAA,EAAAJ,CAAA,EAAAK,IAAA,EAAAe,CAAA,SAAArB,CAAA,EAAAU,CAAA,EAAAE,CAAA,QAAAI,CAAA,QAAAQ,CAAA,gBAAAT,UAAA,cAAAe,kBAAA,cAAAC,2BAAA,KAAA9B,CAAA,GAAAF,MAAA,CAAAiC,cAAA,MAAAnB,CAAA,MAAAf,CAAA,IAAAG,CAAA,CAAAA,CAAA,IAAAH,CAAA,SAAAoB,mBAAA,CAAAjB,CAAA,OAAAH,CAAA,iCAAAG,CAAA,GAAAe,CAAA,GAAAe,0BAAA,CAAAjB,SAAA,GAAAC,SAAA,CAAAD,SAAA,GAAAf,MAAA,CAAAkB,MAAA,CAAAJ,CAAA,YAAAM,EAAAtB,CAAA,WAAAE,MAAA,CAAAkC,cAAA,GAAAlC,MAAA,CAAAkC,cAAA,CAAApC,CAAA,EAAAkC,0BAAA,KAAAlC,CAAA,CAAAqC,SAAA,GAAAH,0BAAA,EAAAb,mBAAA,CAAArB,CAAA,EAAAa,CAAA,yBAAAb,CAAA,CAAAiB,SAAA,GAAAf,MAAA,CAAAkB,MAAA,CAAAD,CAAA,GAAAnB,CAAA,WAAAiC,iBAAA,CAAAhB,SAAA,GAAAiB,0BAAA,EAAAb,mBAAA,CAAAF,CAAA,iBAAAe,0BAAA,GAAAb,mBAAA,CAAAa,0BAAA,iBAAAD,iBAAA,GAAAA,iBAAA,CAAAK,WAAA,wBAAAjB,mBAAA,CAAAa,0BAAA,EAAArB,CAAA,wBAAAQ,mBAAA,CAAAF,CAAA,GAAAE,mBAAA,CAAAF,CAAA,EAAAN,CAAA,gBAAAQ,mBAAA,CAAAF,CAAA,EAAAlB,CAAA,iCAAAoB,mBAAA,CAAAF,CAAA,8DAAAT,YAAA,YAAAA,aAAA,aAAA6B,CAAA,EAAAxB,CAAA,EAAAyB,CAAA,EAAAlB,CAAA;AAAA,SAAAD,oBAAArB,CAAA,EAAAG,CAAA,EAAAF,CAAA,EAAAG,CAAA,QAAAW,CAAA,GAAAb,MAAA,CAAAuC,cAAA,QAAA1B,CAAA,uBAAAf,CAAA,IAAAe,CAAA,QAAAM,mBAAA,YAAAqB,mBAAA1C,CAAA,EAAAG,CAAA,EAAAF,CAAA,EAAAG,CAAA,aAAAS,EAAAV,CAAA,EAAAF,CAAA,IAAAoB,mBAAA,CAAArB,CAAA,EAAAG,CAAA,YAAAH,CAAA,gBAAA2C,OAAA,CAAAxC,CAAA,EAAAF,CAAA,EAAAD,CAAA,SAAAG,CAAA,GAAAY,CAAA,GAAAA,CAAA,CAAAf,CAAA,EAAAG,CAAA,IAAAK,KAAA,EAAAP,CAAA,EAAA2C,UAAA,GAAAxC,CAAA,EAAAyC,YAAA,GAAAzC,CAAA,EAAA0C,QAAA,GAAA1C,CAAA,MAAAJ,CAAA,CAAAG,CAAA,IAAAF,CAAA,IAAAY,CAAA,aAAAA,CAAA,cAAAA,CAAA,mBAAAQ,mBAAA,CAAArB,CAAA,EAAAG,CAAA,EAAAF,CAAA,EAAAG,CAAA;AAAA,SAAA2C,QAAA/C,CAAA,EAAAG,CAAA,QAAAC,CAAA,GAAAF,MAAA,CAAA8C,IAAA,CAAAhD,CAAA,OAAAE,MAAA,CAAA+C,qBAAA,QAAApC,CAAA,GAAAX,MAAA,CAAA+C,qBAAA,CAAAjD,CAAA,GAAAG,CAAA,KAAAU,CAAA,GAAAA,CAAA,CAAAqC,MAAA,WAAA/C,CAAA,WAAAD,MAAA,CAAAiD,wBAAA,CAAAnD,CAAA,EAAAG,CAAA,EAAAyC,UAAA,OAAAxC,CAAA,CAAAgD,IAAA,CAAAC,KAAA,CAAAjD,CAAA,EAAAS,CAAA,YAAAT,CAAA;AAAA,SAAAkD,cAAAtD,CAAA,aAAAG,CAAA,MAAAA,CAAA,GAAAoD,SAAA,CAAAjD,MAAA,EAAAH,CAAA,UAAAC,CAAA,WAAAmD,SAAA,CAAApD,CAAA,IAAAoD,SAAA,CAAApD,CAAA,QAAAA,CAAA,OAAA4C,OAAA,CAAA7C,MAAA,CAAAE,CAAA,OAAAoD,OAAA,WAAArD,CAAA,IAAAsD,eAAA,CAAAzD,CAAA,EAAAG,CAAA,EAAAC,CAAA,CAAAD,CAAA,SAAAD,MAAA,CAAAwD,yBAAA,GAAAxD,MAAA,CAAAyD,gBAAA,CAAA3D,CAAA,EAAAE,MAAA,CAAAwD,yBAAA,CAAAtD,CAAA,KAAA2C,OAAA,CAAA7C,MAAA,CAAAE,CAAA,GAAAoD,OAAA,WAAArD,CAAA,IAAAD,MAAA,CAAAuC,cAAA,CAAAzC,CAAA,EAAAG,CAAA,EAAAD,MAAA,CAAAiD,wBAAA,CAAA/C,CAAA,EAAAD,CAAA,iBAAAH,CAAA;AAAA,SAAAyD,gBAAAzD,CAAA,EAAAG,CAAA,EAAAC,CAAA,YAAAD,CAAA,GAAAyD,cAAA,CAAAzD,CAAA,MAAAH,CAAA,GAAAE,MAAA,CAAAuC,cAAA,CAAAzC,CAAA,EAAAG,CAAA,IAAAK,KAAA,EAAAJ,CAAA,EAAAwC,UAAA,MAAAC,YAAA,MAAAC,QAAA,UAAA9C,CAAA,CAAAG,CAAA,IAAAC,CAAA,EAAAJ,CAAA;AAAA,SAAA6D,mBAAA5D,CAAA,EAAAG,CAAA,EAAAJ,CAAA,EAAAG,CAAA,EAAAU,CAAA,EAAAc,CAAA,EAAAX,CAAA,cAAAD,CAAA,GAAAd,CAAA,CAAA0B,CAAA,EAAAX,CAAA,GAAAG,CAAA,GAAAJ,CAAA,CAAAP,KAAA,WAAAP,CAAA,gBAAAD,CAAA,CAAAC,CAAA,KAAAc,CAAA,CAAAN,IAAA,GAAAL,CAAA,CAAAe,CAAA,IAAA2C,OAAA,CAAAC,OAAA,CAAA5C,CAAA,EAAA6C,IAAA,CAAA7D,CAAA,EAAAU,CAAA;AAAA,SAAAoD,kBAAAhE,CAAA,6BAAAG,CAAA,SAAAJ,CAAA,GAAAuD,SAAA,aAAAO,OAAA,WAAA3D,CAAA,EAAAU,CAAA,QAAAc,CAAA,GAAA1B,CAAA,CAAAoD,KAAA,CAAAjD,CAAA,EAAAJ,CAAA,YAAAkE,MAAAjE,CAAA,IAAA4D,kBAAA,CAAAlC,CAAA,EAAAxB,CAAA,EAAAU,CAAA,EAAAqD,KAAA,EAAAC,MAAA,UAAAlE,CAAA,cAAAkE,OAAAlE,CAAA,IAAA4D,kBAAA,CAAAlC,CAAA,EAAAxB,CAAA,EAAAU,CAAA,EAAAqD,KAAA,EAAAC,MAAA,WAAAlE,CAAA,KAAAiE,KAAA;AAAA,SAAAE,gBAAAzC,CAAA,EAAA1B,CAAA,UAAA0B,CAAA,YAAA1B,CAAA,aAAA8B,SAAA;AAAA,SAAAsC,kBAAArE,CAAA,EAAAG,CAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAD,CAAA,CAAAG,MAAA,EAAAF,CAAA,UAAAS,CAAA,GAAAV,CAAA,CAAAC,CAAA,GAAAS,CAAA,CAAA+B,UAAA,GAAA/B,CAAA,CAAA+B,UAAA,QAAA/B,CAAA,CAAAgC,YAAA,kBAAAhC,CAAA,KAAAA,CAAA,CAAAiC,QAAA,QAAA5C,MAAA,CAAAuC,cAAA,CAAAzC,CAAA,EAAA4D,cAAA,CAAA/C,CAAA,CAAAyD,GAAA,GAAAzD,CAAA;AAAA,SAAA0D,aAAAvE,CAAA,EAAAG,CAAA,EAAAC,CAAA,WAAAD,CAAA,IAAAkE,iBAAA,CAAArE,CAAA,CAAAiB,SAAA,EAAAd,CAAA,GAAAC,CAAA,IAAAiE,iBAAA,CAAArE,CAAA,EAAAI,CAAA,GAAAF,MAAA,CAAAuC,cAAA,CAAAzC,CAAA,iBAAA8C,QAAA,SAAA9C,CAAA;AAAA,SAAA4D,eAAAxD,CAAA,QAAAW,CAAA,GAAAyD,YAAA,CAAApE,CAAA,gCAAAqE,OAAA,CAAA1D,CAAA,IAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAyD,aAAApE,CAAA,EAAAD,CAAA,oBAAAsE,OAAA,CAAArE,CAAA,MAAAA,CAAA,SAAAA,CAAA,MAAAJ,CAAA,GAAAI,CAAA,CAAAO,MAAA,CAAA+D,WAAA,kBAAA1E,CAAA,QAAAe,CAAA,GAAAf,CAAA,CAAAgC,IAAA,CAAA5B,CAAA,EAAAD,CAAA,gCAAAsE,OAAA,CAAA1D,CAAA,UAAAA,CAAA,YAAAgB,SAAA,yEAAA5B,CAAA,GAAAwE,MAAA,GAAAC,MAAA,EAAAxE,CAAA;AAAA,SAAAyE,WAAAzE,CAAA,EAAAS,CAAA,EAAAb,CAAA,WAAAa,CAAA,GAAAiE,eAAA,CAAAjE,CAAA,GAAAkE,0BAAA,CAAA3E,CAAA,EAAA4E,yBAAA,KAAAC,OAAA,CAAAC,SAAA,CAAArE,CAAA,EAAAb,CAAA,QAAA8E,eAAA,CAAA1E,CAAA,EAAA+E,WAAA,IAAAtE,CAAA,CAAAwC,KAAA,CAAAjD,CAAA,EAAAJ,CAAA;AAAA,SAAA+E,2BAAA3E,CAAA,EAAAJ,CAAA,QAAAA,CAAA,iBAAAyE,OAAA,CAAAzE,CAAA,0BAAAA,CAAA,UAAAA,CAAA,iBAAAA,CAAA,YAAA+B,SAAA,qEAAAqD,sBAAA,CAAAhF,CAAA;AAAA,SAAAgF,uBAAApF,CAAA,mBAAAA,CAAA,YAAAqF,cAAA,sEAAArF,CAAA;AAAA,SAAAgF,0BAAA,cAAA5E,CAAA,IAAAkF,OAAA,CAAArE,SAAA,CAAAsE,OAAA,CAAAvD,IAAA,CAAAiD,OAAA,CAAAC,SAAA,CAAAI,OAAA,iCAAAlF,CAAA,aAAA4E,yBAAA,YAAAA,0BAAA,aAAA5E,CAAA;AAAA,SAAA0E,gBAAA1E,CAAA,WAAA0E,eAAA,GAAA5E,MAAA,CAAAkC,cAAA,GAAAlC,MAAA,CAAAiC,cAAA,CAAAN,IAAA,eAAAzB,CAAA,WAAAA,CAAA,CAAAiC,SAAA,IAAAnC,MAAA,CAAAiC,cAAA,CAAA/B,CAAA,MAAA0E,eAAA,CAAA1E,CAAA;AAAA,SAAAoF,UAAApF,CAAA,EAAAJ,CAAA,6BAAAA,CAAA,aAAAA,CAAA,YAAA+B,SAAA,wDAAA3B,CAAA,CAAAa,SAAA,GAAAf,MAAA,CAAAkB,MAAA,CAAApB,CAAA,IAAAA,CAAA,CAAAiB,SAAA,IAAAkE,WAAA,IAAA3E,KAAA,EAAAJ,CAAA,EAAA0C,QAAA,MAAAD,YAAA,WAAA3C,MAAA,CAAAuC,cAAA,CAAArC,CAAA,iBAAA0C,QAAA,SAAA9C,CAAA,IAAAyF,eAAA,CAAArF,CAAA,EAAAJ,CAAA;AAAA,SAAAyF,gBAAArF,CAAA,EAAAJ,CAAA,WAAAyF,eAAA,GAAAvF,MAAA,CAAAkC,cAAA,GAAAlC,MAAA,CAAAkC,cAAA,CAAAP,IAAA,eAAAzB,CAAA,EAAAJ,CAAA,WAAAI,CAAA,CAAAiC,SAAA,GAAArC,CAAA,EAAAI,CAAA,KAAAqF,eAAA,CAAArF,CAAA,EAAAJ,CAAA;AAOA,IAAM0F,cAAc,GAAG,2BAA2B;AAAC,IAUtCC,OAAO,GAAAC,OAAA,CAAAD,OAAA,IAAA9F,IAAA,GARnB,IAAAgG,UAAM,EAAC;EACNC,IAAI,EAAE,SAAS;EACfC,IAAI,EAAE,CACJ,MAAM,EACN;IAAEC,GAAG,EAAE,YAAY;IAAEC,QAAQ,EAAE;EAAK,CAAC,EACrC;IAAED,GAAG,EAAE,gBAAgB;IAAEC,QAAQ,EAAE;EAAK,CAAC;AAE7C,CAAC,CAAC,EAAApG,IAAA,CAAAC,MAAA,0BAAAoG,YAAA;EAYA,SAAAP,QAAYI,IAAO,EAAE;IAAA,IAAAI,oBAAA,EAAAC,qBAAA,EAAAC,sBAAA;IAAA,IAAAC,KAAA;IAAAlC,eAAA,OAAAuB,OAAA;IACnBW,KAAA,GAAAzB,UAAA,OAAAc,OAAA,GAAMI,IAAI,EAAE;MACVD,IAAI,EAAE,SAAS;MACfS,eAAe,GAAAJ,oBAAA,GAAEJ,IAAI,CAACS,cAAc,cAAAL,oBAAA,uBAAnBA,oBAAA,CAAqBI;IACxC,CAAC;IAAED,KAAA,CAdKG,yBAAyB;IAAAH,KAAA,CACzBI,QAAQ;IAAAJ,KAAA,CACRK,eAAe,GAMZ,IAAI;IAAAL,KAAA,CAWjBM,UAAU,GAAwB,CAAC,CAAC;IAJlCN,KAAA,CAAKG,yBAAyB,IAAAL,qBAAA,IAAAC,sBAAA,GAC5BC,KAAA,CAAKO,KAAK,CAACL,cAAc,cAAAH,sBAAA,uBAAzBA,sBAAA,CAA2BS,wBAAwB,cAAAV,qBAAA,cAAAA,qBAAA,GAAI,IAAI;IAAC,OAAAE,KAAA;EAChE;EAACd,SAAA,CAAAG,OAAA,EAAAO,YAAA;EAAA,OAAA3B,YAAA,CAAAoB,OAAA;IAAArB,GAAA;IAAAyC,GAAA,EAID,SAAAA,IAAA,EAAsB;MACpB,OACE,CAAC,IAAI,CAACN,yBAAyB,IAC/B,CAAC,IAAI,CAACI,KAAK,CAACG,UAAU,IACtB,IAAI,CAACH,KAAK,CAACG,UAAU,CAACC,MAAM;IAEhC;EAAC;IAAA3C,GAAA;IAAA9D,KAAA,EAED,SAAS0G,aAAaA,CAAA,EAAG;MACvB,IAAI,IAAI,CAACC,KAAK,IAAI,IAAI,CAACC,eAAe,EAAE;QACtC,IAAMC,WAAW,GAAG,IAAI,CAACC,IAAI;QAC7B;QACA,KAAK,IAAMhD,GAAG,IAAI+C,WAAW,EAAE;UAC7B,IAAI/C,GAAG,KAAKoB,cAAc,EAAE;YAC1B,IAAI,IAAI,CAACkB,UAAU,CAACtC,GAAG,CAAC,KAAK+C,WAAW,CAAC/C,GAAG,CAAC,EAAE;cAC7C,IAAI,CAACoC,QAAQ,CAACa,OAAO,CAACjD,GAAG,EAAE+C,WAAW,CAAC/C,GAAG,CAAC,CAAC;cAC5C,IAAI,CAACsC,UAAU,CAACtC,GAAG,CAAC,GAAG+C,WAAW,CAAC/C,GAAG,CAAC;YACzC;UACF,CAAC,MAAM;YAAA,IAAAkD,qBAAA;YACL,IAAMC,kBAAkB,IAAAD,qBAAA,GAAGH,WAAW,CAAC3B,cAAc,CAAC,cAAA8B,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;YAC5D,IAAI,CAAC,IAAI,CAACZ,UAAU,CAAClB,cAAc,CAAC,EAAE;cACpC,IAAI,CAACkB,UAAU,CAAClB,cAAc,CAAC,GAAG,CAAC,CAAC;YACtC;YACA,IAAMgC,iBAAiB,GAAG,IAAI,CAACd,UAAU,CAAClB,cAAc,CAAC;YACzD,IAAIiC,UAAU,GAAG,KAAK;YACtB;YACA,IAAI,CAACD,iBAAiB,CAACE,gBAAgB,EAAE;cACvCD,UAAU,GAAG,IAAI;cACjB,IAAI,CAACf,UAAU,CAAClB,cAAc,CAAC,GAAG+B,kBAAkB;YACtD,CAAC,MAAM;cACL;cACA;cACA,KAAK,IAAMI,IAAI,IAAIJ,kBAAkB,CAACG,gBAAgB,EAAE;gBACtD,IACEF,iBAAiB,CAACE,gBAAgB,CAACC,IAAI,CAAC,KACxCJ,kBAAkB,CAACG,gBAAgB,CAACC,IAAI,CAAC,EACzC;kBACAF,UAAU,GAAG,IAAI;kBACjBD,iBAAiB,CAACE,gBAAgB,CAACC,IAAI,CAAC,GACtCJ,kBAAkB,CAACG,gBAAgB,CAACC,IAAI,CAAC;kBAC3CH,iBAAiB,CAACI,UAAU,CAACD,IAAI,CAAC,GAChCJ,kBAAkB,CAACK,UAAU,CAACD,IAAI,CAAC;gBACvC;cACF;YACF;YACA,IAAIF,UAAU,EAAE;cACd,IAAI,CAACjB,QAAQ,CAACa,OAAO,CACnB7B,cAAc,EACd,IAAI,CAACkB,UAAU,CAAClB,cAAc,CAChC,CAAC;YACH;UACF;QACF;MACF;IACF;EAAC;IAAApB,GAAA;IAAAyC,GAAA,EAED,SAAAA,IAAA,EAAiB;MACf,IAAMgB,MAAM,GAAG,IAAI,CAACA,MAAM,MAAAC,MAAA,CAAM,IAAI,CAACD,MAAM,SAAM,EAAE;MAEnD,UAAAC,MAAA,CAAUD,MAAM,cAAAC,MAAA,CAAW,IAAI,CAACnB,KAAK,CAACoB,IAAI,CAACC,OAAO;IACpD;EAAC;IAAA5D,GAAA;IAAA9D,KAAA;MAAA,IAAA2H,OAAA,GAAAlE,iBAAA,cAAAvD,YAAA,GAAA8B,CAAA,CAED,SAAA4F,QAAA;QAAA,IAAAC,sBAAA;QAAA,IAAA/D,GAAA,EAAA+C,WAAA,EAAAiB,KAAA,EAAAC,EAAA,EAAAC,GAAA;QAAA,OAAA9H,YAAA,GAAA6B,CAAA,WAAAkG,QAAA;UAAA,kBAAAA,QAAA,CAAAxI,CAAA;YAAA;cACE,IAAI,CAACyG,QAAQ,GAAG,IAAI,IAAI,CAACgC,gBAAgB,CAAC;gBACxCC,UAAU,EAAE,IAAI,CAACA;cACnB,CAAC,CAAC;cAACF,QAAA,CAAAxI,CAAA;cAAA,OACqB,IAAI,CAACyG,QAAQ,CAACkC,OAAO,CAAC,CAAC;YAAA;cAA/C,IAAI,CAAChC,UAAU,GAAA6B,QAAA,CAAA/G,CAAA;cAAA,KAAA2G,sBAAA,GACV,IAAI,CAACxB,KAAK,CAACL,cAAc,cAAA6B,sBAAA,uBAAzBA,sBAAA,CAA2BQ,kBAAkB;gBAAAJ,QAAA,CAAAxI,CAAA;gBAAA;cAAA;cAAAsI,EAAA,GAAAxI,gBAAA,CAC9B,IAAI,CAAC6G,UAAU;YAAA;cAAA,KAAA4B,GAAA,GAAAD,EAAA,IAAA9H,IAAA;gBAAAgI,QAAA,CAAAxI,CAAA;gBAAA;cAAA;cAAtBqE,GAAG,GAAAkE,GAAA,CAAAhI,KAAA;cAAA,IACP,IAAI,CAACsI,gBAAgB,CAACxE,GAAG,CAAC;gBAAAmE,QAAA,CAAAxI,CAAA;gBAAA;cAAA;cAC7B,OAAO,IAAI,CAAC2G,UAAU,CAACtC,GAAG,CAAC;cAACmE,QAAA,CAAAxI,CAAA;cAAA,OACtB,IAAI,CAACyG,QAAQ,CAACqC,UAAU,CAACzE,GAAG,CAAC;YAAA;cAAAmE,QAAA,CAAAxI,CAAA;cAAA;YAAA;cAIzC,IAAI,CAAC+I,OAAO,CAAA1F,aAAA,CAAAA,aAAA,KACP,IAAI,CAACgE,IAAI,GACT,IAAI,CAACV,UAAU,CACnB,CAAC;cACIS,WAAW,GAAG,IAAI,CAACC,IAAI;cAC7B,KAAWhD,KAAG,IAAI+C,WAAW,EAAE;gBAC7B,IACE,CAACnH,MAAM,CAACe,SAAS,CAACgI,cAAc,CAACjH,IAAI,CAAC,IAAI,CAAC4E,UAAU,EAAEtC,KAAG,CAAC,IAC3D,IAAI,CAAC8C,eAAe,EACpB;kBACA,IAAI,CAACV,QAAQ,CAACa,OAAO,CAACjD,KAAG,EAAE+C,WAAW,CAAC/C,KAAG,CAAC,CAAC;gBAC9C;cACF;YAAC;cAAA,OAAAmE,QAAA,CAAA9G,CAAA;UAAA;QAAA,GAAAyG,OAAA;MAAA,CACF;MAAA,SA1Bcc,MAAMA,CAAA;QAAA,OAAAf,OAAA,CAAA9E,KAAA,OAAAE,SAAA;MAAA;MAAA,OAAN2F,MAAM;IAAA;EAAA;IAAA5E,GAAA;IAAA9D,KAAA,EA4BrB,SAAS2I,aAAaA,CAAA,EAAG;MAAA,IAAAC,MAAA;MACvB,IAAI,CAACzC,eAAe,GAAG,UAAA0C,IAAA,EAAoB;QAAA,IAAjB/E,GAAG,GAAA+E,IAAA,CAAH/E,GAAG;UAAE9D,KAAK,GAAA6I,IAAA,CAAL7I,KAAK;QAClC,IAAI4I,MAAI,CAACjC,KAAK,EAAE;UACdiC,MAAI,CAACxC,UAAU,CAACtC,GAAG,CAAC,GAAG9D,KAAK;UAC5B4I,MAAI,CAACE,QAAQ,CAAChF,GAAG,EAAE9D,KAAK,CAAC;QAC3B;MACF,CAAC;MACD,IAAI,CAACkG,QAAQ,CAAC6C,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC5C,eAAe,CAAC;IACnD;EAAC;IAAArC,GAAA;IAAA9D,KAAA,EAED,SAASgJ,WAAWA,CAAA,EAAG;MACrB,OACE,IAAI,CAAC3C,KAAK,CAACoB,IAAI,CAACwB,WAAW,KAAKA,iBAAW,CAACC,QAAQ,KACnD,CAAC,IAAI,CAAC7C,KAAK,CAACG,UAAU,IAAI,IAAI,CAACH,KAAK,CAACG,UAAU,CAACG,KAAK,CAAC,IACvD,IAAI,CAACwC,OAAO;IAEhB;EAAC;IAAArF,GAAA;IAAA9D,KAAA,EAED,SAASoJ,YAAYA,CAAA,EAAG;MACtB,OACE,CAAE,CAAC,CAAC,IAAI,CAAC/C,KAAK,CAACG,UAAU,IAAI,CAAC,IAAI,CAACH,KAAK,CAACG,UAAU,CAACG,KAAK,IACvD,IAAI,CAACN,KAAK,CAACoB,IAAI,CAAC4B,WAAW,KAC7B,IAAI,CAAC1C,KAAK;IAEd;EAAC;IAAA7C,GAAA;IAAA9D,KAAA,EAED,SAASsJ,OAAOA,CAAA,EAAG;MACjB,IAAI,IAAI,CAACnD,eAAe,EAAE;QACxB,IAAI,IAAI,CAACD,QAAQ,CAACqD,GAAG,EAAE;UACrB,IAAI,CAACrD,QAAQ,CAACqD,GAAG,CAAC,SAAS,EAAE,IAAI,CAACpD,eAAe,CAAC;QACpD,CAAC,MAAM,IAAI,IAAI,CAACD,QAAQ,CAACsD,cAAc,EAAE;UACvC,IAAI,CAACtD,QAAQ,CAACsD,cAAc,CAAC,SAAS,EAAE,IAAI,CAACrD,eAAe,CAAC;QAC/D;QACA,IAAI,CAACA,eAAe,GAAG,IAAI;MAC7B;MACA,IAAI,IAAI,CAACD,QAAQ,EAAE;QACjB,IAAI,CAACA,QAAQ,CAACuD,OAAO,CAAC,CAAC;QACvB,IAAI,CAACvD,QAAQ,GAAG,IAAI;MACtB;MACA,IAAI,CAACwD,SAAS,CAAC,CAAC;IAClB;EAAC;AAAA,EAxJiDC,yBAAW,MAAArK,MAAA","ignoreList":[]}