{"version":3,"file":"ExtensionFeatures.js","names":["_ramda","require","_core","_permissionsMessages","_subscriptionFilters","_subscriptionHints","_di","_Auth","_DataFetcherV","_dec","_dec2","_class","_class2","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","undefined","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","_objectSpread","target","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","_toPropertyKey","configurable","writable","_classCallCheck","instance","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toPrimitive","_typeof","String","input","hint","prim","toPrimitive","res","Number","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_applyDecoratedDescriptor","property","decorators","context","desc","initializer","reverse","reduce","decorator","ExtensionFeatures","Module","deps","dep","optional","computed","_ref","data","_DataFetcherV2Consume","_super","_deps$extensionFeatur","_deps$extensionFeatur2","_this","_stopWatchingSubscription","_handleSubscription","message","_this$_deps$tabManage","_this$_deps$tabManage2","_message$body","ready","_source","disableCache","_deps","tabManager","active","body","hints","includes","subscriptionHints","limits","features","permissions","fetchData","DataSource","polling","extensionFeaturesOptions","cleanOnReset","fetchFunction","_fetchFunction","regeneratorRuntime","mark","_callee","response","_response","wrap","_callee$","_context","prev","client","service","platform","get","sent","abrupt","json","t0","status","auth","logout","alert","danger","permissionsMessages","insufficientPrivilege","ttl","stop","readyCheckFunction","dataFetcherV2","register","onInitOnce","_this2","watch","_this2$features","_this2$features$ReadE","ReadExtensionInfo","available","loginStatus","loggedIn","_ref3","_callee2","_ref2","_ref4","hasData","readExtensionInfo","_callee2$","_context2","multiple","onInit","_this3","subscription","subscribe","subscriptionFilters","extensionInfo","onReset","_this$_stopWatchingSu","_this$data$records","_this$data","item","id","records","DataFetcherV2Consumer","exports"],"sources":["modules/ExtensionFeatures/ExtensionFeatures.ts"],"sourcesContent":["import { reduce } from 'ramda';\nimport type { Unsubscribe } from 'redux';\nimport type ExtensionInfoEvent from '@rc-ex/core/lib/definitions/ExtensionInfoEvent';\nimport type FeatureInfo from '@rc-ex/core/lib/definitions/FeatureInfo';\nimport type FeatureList from '@rc-ex/core/lib/definitions/FeatureList';\nimport { computed, watch } from '@ringcentral-integration/core';\n\nimport { permissionsMessages } from '../../enums/permissionsMessages';\nimport { subscriptionFilters } from '../../enums/subscriptionFilters';\nimport { subscriptionHints } from '../../enums/subscriptionHints';\nimport { Module } from '../../lib/di';\nimport { loginStatus } from '../Auth';\nimport { DataFetcherV2Consumer, DataSource } from '../DataFetcherV2';\nimport type { Deps } from './ExtensionFeatures.interface';\n\n@Module({\n  name: 'ExtensionFeatures',\n  deps: [\n    'Auth',\n    'Alert',\n    'Client',\n    'DataFetcherV2',\n    { dep: 'Subscription', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'ExtensionFeaturesOptions', optional: true },\n  ],\n})\nexport class ExtensionFeatures extends DataFetcherV2Consumer<\n  Deps,\n  FeatureList\n> {\n  // @ts-expect-error\n  protected _stopWatchingSubscription: Unsubscribe = null;\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n\n    this._source = new DataSource({\n      polling: deps.extensionFeaturesOptions?.polling ?? true,\n      ...deps.extensionFeaturesOptions,\n      key: 'extensionFeatures',\n      cleanOnReset: true,\n      fetchFunction: async () => {\n        try {\n          const response = await this._deps.client.service\n            .platform()\n            .get('/restapi/v1.0/account/~/extension/~/features');\n          return response.json();\n        } catch (error: any /** TODO: confirm with instanceof */) {\n          if ((error as { response?: Response }).response?.status === 403) {\n            await this._deps.auth.logout();\n            this._deps.alert.danger({\n              message: permissionsMessages.insufficientPrivilege,\n              ttl: 0,\n            });\n            return {};\n          }\n          throw error;\n        }\n      },\n      readyCheckFunction: () => true,\n    });\n    this._deps.dataFetcherV2.register(this._source);\n  }\n\n  protected _handleSubscription = (message: ExtensionInfoEvent) => {\n    if (\n      this.ready &&\n      (this._source.disableCache || (this._deps.tabManager?.active ?? true)) &&\n      message?.body?.hints &&\n      (message.body.hints.includes(subscriptionHints.limits) ||\n        message.body.hints.includes(subscriptionHints.features) ||\n        message.body.hints.includes(subscriptionHints.permissions))\n    ) {\n      this.fetchData();\n    }\n  };\n\n  override onInitOnce() {\n    watch(\n      this,\n      () => [\n        this.ready,\n        !!this.data,\n        !!this.features?.ReadExtensionInfo?.available,\n        this._deps.auth.loginStatus === loginStatus.loggedIn,\n      ],\n      async ([ready, hasData, readExtensionInfo, loggedIn]) => {\n        if (ready && loggedIn && !readExtensionInfo) {\n          await this._deps.auth.logout();\n          if (hasData) {\n            // only show alert if featuresList was successfully fetched,\n            // but the user has no ReadExtensionInfo feature\n            this._deps.alert.danger({\n              message: permissionsMessages.insufficientPrivilege,\n              ttl: 0,\n            });\n          }\n        }\n      },\n      {\n        multiple: true,\n      },\n    );\n  }\n\n  override onInit() {\n    if (this._deps.subscription) {\n      this._deps.subscription.subscribe([subscriptionFilters.extensionInfo]);\n      this._stopWatchingSubscription = watch(\n        this,\n        () => this._deps.subscription!.message,\n        this._handleSubscription,\n      );\n    }\n  }\n\n  override onReset() {\n    this._stopWatchingSubscription?.();\n    // @ts-expect-error\n    this._stopWatchingSubscription = null;\n  }\n\n  @computed(({ data }: ExtensionFeatures) => [data])\n  get features() {\n    return reduce(\n      (features, item) => {\n        if (item && item.id) features[item.id] = item;\n        return features;\n      },\n      {} as Record<string, FeatureInfo>,\n      this.data?.records ?? [],\n    );\n  }\n}\n"],"mappings":"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"}