{"version":3,"sources":["modules/MeetingProvider/index.ts"],"names":["MeetingProvider","deps","appFeatures","options","subscriptionFilters","extensionInfo","subscriptionHandler","message","_subscriptionHandleFn","readyCheckFn","_appFeatures","ready","fetchFunction","_client","data","disableCache","cleanOnReset","body","hints","includes","subscriptionHints","videoConfiguration","fetchData","provider","meetingProviderTypes","video","meeting","none","userLicenseType","hasMeetingsPermission","DataFetcher"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IASqBA,e;AAPrB;AACA;AACA;OAEC,gBAAO;AACNC,EAAAA,IAAI,EAAE,CAAC,QAAD,EAAW,aAAX;AADA,CAAP,C;;;;;AAIC,iCAAyC;AAAA;;AAAA,QAA3BC,WAA2B,QAA3BA,WAA2B;AAAA,QAAXC,OAAW;;AAAA;;AACvC,8DACKA,OADL;AAEEC,MAAAA,mBAAmB,EAAE,CAACA,gCAAoBC,aAArB,CAFvB;AAGEC,MAAAA,mBAAmB;AAAA,2FAAE,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACb,MAAKC,qBAAL,CAA2BD,OAA3B,CADa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA,SAHrB;AAMEE,MAAAA,YAAY,EAAE;AAAA,eAAM,MAAKC,YAAL,CAAkBC,KAAxB;AAAA,OANhB;AAOQC,MAAAA,aAPR,2BAOwB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACD,iCAAmB,MAAI,CAACC,OAAxB,CADC;;AAAA;AACdC,kBAAAA,IADc;AAAA,oDAEbA,IAFa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGrB,OAVH;AAWEC,MAAAA,YAAY,EAAE,IAXhB;AAYEC,MAAAA,YAAY,EAAE;AAZhB;AAcA,UAAKN,YAAL,GAAoBR,WAApB;AAfuC;AAgBxC;;;;;6GAE2BK,O;;;;;;;sBACtBA,O,aAAAA,O,wCAAAA,OAAO,CAAEU,I,yEAAT,cAAeC,K,wDAAf,oBAAsBC,QAAtB,CAA+BC,8BAAkBC,kBAAjD,C;;;;;;uBAKI,kBAAM,IAAN,C;;;;uBACA,KAAKC,SAAL,E;;;;;;;;;;;;;;;;;;wBAIE;AACV,aAAO,KAAKC,QAAL,KAAkBC,gCAAqBC,KAA9C;AACD;;;wBAEW;AACV,aAAO,qBAAS,KAAKF,QAAd,EAAwB,CAC7BC,gCAAqBE,OADQ,EAE7BF,gCAAqBG,IAFQ,CAAxB,CAAP;AAID;;;wBAEc;AAAA;;AACb,aAAO,oBAAKb,IAAL,0DAAWS,QAAX,KAAuB,IAA9B;AACD;;;wBAEqB;AAAA;;AACpB,aAAO,qBAAKT,IAAL,4DAAWc,eAAX,KAA8B,IAArC;AACD;;;wBAEoB;AACnB,aAAO,KAAKlB,YAAL,CAAkBmB,qBAAzB;AACD;;;wBAEW;AACV,aAAO,iBAAP;AACD;;;;EAvD0CC,wB","sourcesContent":["import { contains } from 'ramda';\n\nimport subscriptionFilters from '../../enums/subscriptionFilters';\nimport subscriptionHints from '../../enums/subscriptionHints';\nimport DataFetcher from '../../lib/DataFetcher';\nimport { Module } from '../../lib/di';\nimport { sleep } from '../../lib/sleep';\nimport { meetingProviderTypes } from './interface';\nimport { getMeetingProvider } from './service';\n\n/**\n * MeetingProviderV2 is renamed to VideoConfigurations.\n */\n\n@Module({\n  deps: ['Client', 'AppFeatures'],\n})\nexport default class MeetingProvider extends DataFetcher {\n  constructor({ appFeatures, ...options }) {\n    super({\n      ...options,\n      subscriptionFilters: [subscriptionFilters.extensionInfo],\n      subscriptionHandler: async (message) => {\n        await this._subscriptionHandleFn(message);\n      },\n      readyCheckFn: () => this._appFeatures.ready,\n      async fetchFunction() {\n        const data = await getMeetingProvider(this._client);\n        return data;\n      },\n      disableCache: true,\n      cleanOnReset: true,\n    });\n    this._appFeatures = appFeatures;\n  }\n\n  async _subscriptionHandleFn(message) {\n    if (message?.body?.hints?.includes(subscriptionHints.videoConfiguration)) {\n      // https://jira.ringcentral.com/browse/ENV-67087\n      // the video configuration api may return the old value\n      // when we try to query immediately right after got the push notification\n      // here we wait for seconds as a workaround to solve the issue\n      await sleep(5000);\n      await this.fetchData();\n    }\n  }\n\n  get isRCV() {\n    return this.provider === meetingProviderTypes.video;\n  }\n\n  get isRCM() {\n    return contains(this.provider, [\n      meetingProviderTypes.meeting,\n      meetingProviderTypes.none,\n    ]);\n  }\n\n  get provider() {\n    return this.data?.provider || null;\n  }\n\n  get userLicenseType() {\n    return this.data?.userLicenseType || null;\n  }\n\n  get _hasPermission() {\n    return this._appFeatures.hasMeetingsPermission;\n  }\n\n  get _name() {\n    return 'meetingProvider';\n  }\n}\n"],"file":"index.js"}