{"version":3,"sources":["modules/DateTimeFormat/index.ts"],"names":["DateTimeFormat","deps","dep","optional","locale","options","actionTypes","_locale","_reducer","_proxyReducer","_formatters","pending","ready","_shouldInit","store","dispatch","type","init","_defaultFormatter","initSuccess","_shouldReset","reset","resetSuccess","subscribe","_onStateChange","proxyPending","proxyReady","proxyInit","proxyInitSuccess","name","formatter","Error","utcTimestamp","currentLocale","formatDateTime","proxyState","status","state","RcModule"],"mappings":"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","sourcesContent":["import { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport getIntlDateTimeFormatter from '../../lib/getIntlDateTimeFormatter';\nimport RcModule from '../../lib/RcModule';\nimport actionTypes from './actionTypes';\nimport getDateTimeFormatReducer from './getDateTimeFormatReducer';\nimport getProxyReducer from './getProxyReducer';\n\n/**\n * @class DateTimeFormat\n * @description Simple date and time formatting manager.\n */\n@Module({\n  deps: ['Locale', { dep: 'DateTimeFormatOptions', optional: true }],\n})\nexport default class DateTimeFormat extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Locale} params.locale - locale module instance\n   */\n  constructor({ locale, ...options }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._locale = ensureExist(locale, 'locale');\n\n    this._reducer = getDateTimeFormatReducer(this.actionTypes);\n    this._proxyReducer = getProxyReducer(this.actionTypes);\n\n    this._formatters = {};\n  }\n\n  _shouldInit() {\n    return this.pending && this._locale.ready;\n  }\n\n  _shouldReset() {\n    return this.ready && !this._locale.ready;\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      if (!this._defaultFormatter) {\n        this._defaultFormatter = getIntlDateTimeFormatter();\n      }\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.reset,\n      });\n      this._formatters = {};\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  initializeProxy() {\n    this.store.subscribe(() => {\n      if (this.proxyPending && this._locale.proxyReady) {\n        this.store.dispatch({\n          type: this.actionTypes.proxyInit,\n        });\n        if (!this._defaultFormatter) {\n          this._defaultFormatter = getIntlDateTimeFormatter();\n        }\n        this.store.dispatch({\n          type: this.actionTypes.proxyInitSuccess,\n        });\n      }\n    });\n  }\n\n  addFormatter({ name, formatter }) {\n    if (!name) {\n      throw new Error('`name` property cannot be empty.');\n    }\n    if (this._formatters[name]) {\n      throw new Error(\n        `A formatter with the same name: ${name} already exists.`,\n      );\n    }\n    if (typeof formatter !== 'function') {\n      throw new Error('formatter must be a function.');\n    }\n    this._formatters[name] = formatter;\n  }\n\n  formatDateTime({\n    name,\n    utcTimestamp,\n    locale = this._locale.currentLocale,\n    type,\n  }) {\n    if (name && typeof this._formatters[name] === 'function') {\n      return this._formatters[name]({\n        utcTimestamp,\n        locale,\n        type,\n      });\n    }\n    return this._defaultFormatter({\n      utcTimestamp,\n      locale,\n      type,\n    });\n  }\n\n  formatDate({ name, utcTimestamp, locale }) {\n    return this.formatDateTime({\n      name,\n      utcTimestamp,\n      locale,\n      type: 'date',\n    });\n  }\n\n  formatTime({ name, utcTimestamp, locale }) {\n    return this.formatDateTime({\n      name,\n      utcTimestamp,\n      locale,\n      type: 'time',\n    });\n  }\n\n  get status() {\n    return (this.proxyState && this.proxyState.status) || this.state.status;\n  }\n\n  get proxyStatus() {\n    return this.proxyState.status;\n  }\n}\n"],"file":"index.js"}