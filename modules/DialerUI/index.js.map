{"version":3,"sources":["modules/DialerUI/index.js"],"names":["getToNumberFieldReducer","types","state","type","phoneNumber","setToNumberField","loadLastCallState","call","setRecipient","clearToNumberField","resetSuccess","callSuccess","getRecipientReducer","recipient","clearRecipient","DialerUI","name","deps","dep","optional","alert","options","_call","_alert","_storageKey","pending","ready","store","dispatch","actionTypes","init","initSuccess","reset","toNumberField","callError","error","trim","length","lastRecipient","lastPhoneNumber","warning","message","noToNumber","status","_storage","getItem"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from 'ringcentral-integration/lib/RcModule';\r\nimport Enum from 'ringcentral-integration/lib/Enum';\r\nimport { Module } from 'ringcentral-integration/lib/di';\r\nimport { combineReducers } from 'redux';\r\nimport { createSelector } from 'reselect';\r\nimport proxify from 'ringcentral-integration/lib/proxy/proxify';\r\nimport getter from 'ringcentral-integration/lib/getter';\r\nimport ensureExist from 'ringcentral-integration/lib/ensureExist';\r\nimport getModuleStatusReducer from 'ringcentral-integration/lib/getModuleStatusReducer';\r\nimport moduleActionTypes from 'ringcentral-integration/enums/moduleActionTypes';\r\nimport callErrors from 'ringcentral-integration/modules/Call/callErrors';\r\n\r\nfunction getToNumberFieldReducer(types) {\r\n  return (state = '', { type, phoneNumber }) => {\r\n    switch (type) {\r\n      case types.setToNumberField:\r\n      case types.loadLastCallState:\r\n      case types.call:\r\n        return phoneNumber;\r\n      case types.setRecipient:\r\n      case types.clearToNumberField:\r\n      case types.resetSuccess:\r\n      case types.callSuccess:\r\n        return '';\r\n      default:\r\n        return state;\r\n    }\r\n  };\r\n}\r\nfunction getRecipientReducer(types) {\r\n  return (state = null, { type, recipient }) => {\r\n    switch (type) {\r\n      case types.setRecipient:\r\n      case types.loadLastCallState:\r\n      case types.call:\r\n        return recipient;\r\n      case types.clearRecipient:\r\n      case types.resetSuccess:\r\n      case types.callSuccess:\r\n        return null;\r\n      default:\r\n        return state;\r\n    }\r\n  };\r\n}\r\n\r\n@Module({\r\n  name: 'DialerUI',\r\n  deps: [\r\n    'Call',\r\n    'Alert',\r\n    { dep: 'DialerUIOptions', optional: true },\r\n  ],\r\n})\r\nexport default class DialerUI extends RcModule {\r\n  constructor({\r\n    call,\r\n    alert,\r\n    ...options\r\n  }) {\r\n    super({\r\n      ...options,\r\n    });\r\n    this._call = this:: ensureExist(call, 'call');\r\n    this._alert = this::ensureExist(alert, 'alert');\r\n    this._storageKey = 'dialerUIData';\r\n  }\r\n\r\n  get _actionTypes() {\r\n    return new Enum([\r\n      ...Object.keys(moduleActionTypes),\r\n      'setToNumberField',\r\n      'clearToNumberField',\r\n      'setRecipient',\r\n      'clearRecipient',\r\n      'loadLastCallState',\r\n      'call',\r\n      'callError',\r\n      'callSuccess',\r\n    ], 'dialerUI');\r\n  }\r\n\r\n\r\n  get reducer() {\r\n    return combineReducers({\r\n      status: getModuleStatusReducer(this.actionTypes),\r\n      toNumberField: getToNumberFieldReducer(this.actionTypes),\r\n      recipient: getRecipientReducer(this.actionTypes),\r\n    });\r\n  }\r\n\r\n  async _onStateChange() {\r\n    if (\r\n      this.pending &&\r\n      this._call.ready\r\n    ) {\r\n      this.store.dispatch({\r\n        type: this.actionTypes.init,\r\n      });\r\n      this.store.dispatch({\r\n        type: this.actionTypes.initSuccess,\r\n      });\r\n    } else if (\r\n      this.ready &&\r\n      (\r\n        !this._call.ready\r\n      )\r\n    ) {\r\n      this.store.dispatch({\r\n        type: this.actionTypes.reset,\r\n      });\r\n      this.store.dispatch({\r\n        type: this.actionTypes.resetSuccess,\r\n      });\r\n    }\r\n  }\r\n\r\n  @proxify\r\n  async clearToNumberField() {\r\n    this.store.dispatch({\r\n      type: this.actionTypes.clearToNumberField,\r\n    });\r\n  }\r\n\r\n  @proxify\r\n  async setToNumberField(phoneNumber) {\r\n    if (this.toNumberField !== phoneNumber) {\r\n      this.store.dispatch({\r\n        type: this.actionTypes.setToNumberField,\r\n        phoneNumber,\r\n      });\r\n    }\r\n  }\r\n\r\n  @proxify\r\n  async setRecipient(recipient) {\r\n    this.store.dispatch({\r\n      type: this.actionTypes.setRecipient,\r\n      recipient,\r\n    });\r\n  }\r\n  @proxify\r\n  async clearRecipient() {\r\n    this.store.dispatch({\r\n      type: this.actionTypes.clearRecipient,\r\n    });\r\n  }\r\n\r\n  @proxify\r\n  async call({\r\n    phoneNumber = '',\r\n    recipient = null,\r\n  }) {\r\n    if (phoneNumber || recipient) {\r\n      this.store.dispatch({\r\n        type: this.actionTypes.call,\r\n        phoneNumber,\r\n        recipient,\r\n      });\r\n      try {\r\n        await this._call.call({\r\n          phoneNumber: this.toNumberField,\r\n          recipient: this.recipient,\r\n        });\r\n        this.store.dispatch({\r\n          type: this.actionTypes.callSuccess,\r\n        });\r\n      } catch (error) {\r\n        this.store.dispatch({\r\n          type: this.actionTypes.callError,\r\n          error,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  @proxify\r\n  async onCallButtonClick() {\r\n    if (\r\n      `${this.toNumberField}`.trim().length === 0 &&\r\n      !this.recipient\r\n    ) {\r\n      if (!this._call.lastRecipient && !this._call.lastPhoneNumber) {\r\n        this._alert.warning({\r\n          message: callErrors.noToNumber,\r\n        });\r\n      } else {\r\n        this.store.dispatch({\r\n          type: this.actionTypes.loadLastCallState,\r\n          phoneNumber: this._call.lastPhoneNumber,\r\n          recipient: this._call.lastRecipient,\r\n        });\r\n      }\r\n    } else {\r\n      await this.call({\r\n        phoneNumber: this.toNumberField,\r\n        recipient: this.recipient,\r\n      });\r\n    }\r\n  }\r\n\r\n  get lastDialedState() {\r\n    return this._storage.getItem(this._storageKey);\r\n  }\r\n\r\n  get toNumberField() {\r\n    return this.state.toNumberField;\r\n  }\r\n\r\n  get recipient() {\r\n    return this.state.recipient;\r\n  }\r\n\r\n  get status() {\r\n    return this.state.status;\r\n  }\r\n}\r\n"]}